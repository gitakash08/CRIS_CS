"use strict";(self.webpackChunkCRIS=self.webpackChunkCRIS||[]).push([[3871],{986:(Ut,Ft,B)=>{B.d(Ft,{E:()=>ft});const Ct=new(B(6879).Z);function ft(ot){if(null==ot)return["",!1];if(!Ct.hasBidiChar(ot))return[ot,!1];let xt;return xt="rtl"===Ct.checkContextual(ot)?"IDNNN":"ICNNN",[Ct.bidiTransform(ot,xt,"VLYSN"),!0]}},36161:(Ut,Ft,B)=>{B.d(Ft,{I:()=>Ct,v:()=>ft});var Tt=B(21286);function Ct(Q,W,k=0){const X=(0,Tt.uZ)(Q,0,Nt);for(let ht=0;ht<4;ht++)W[k+ht]=Math.floor(256*nt(X*ot[ht]))}function ft(Q,W=0){let k=0;for(let X=0;X<4;X++)k+=Q[W+X]*xt[X];return k}const ot=[1,256,65536,16777216],xt=[1/256,1/65536,1/16777216,1/4294967296],Nt=ft(new Uint8ClampedArray([255,255,255,255]));function nt(Q){return Q-Math.floor(Q)}},17002:(Ut,Ft,B)=>{B.d(Ft,{BN:()=>ht,Yc:()=>pt,em:()=>ft,mx:()=>Q});var Tt=B(15861),Ct=B(59318);const ft="arial-unicode-ms",ot="woff2",xt=new Map,Nt=new Set;class nt{constructor(b,ct){this.fontFace=b,this.promise=ct}}function Q(N){return W.apply(this,arguments)}function W(){return(W=(0,Tt.Z)(function*(N){const b=pt(N),ct=xt.get(b);if(ct)return ct.promise;const ut=new FontFace(N.family,`url('${Ct.Z.fontsUrl}/woff2/${b}.${ot}') format('${ot}')`,{style:N.style,weight:N.weight}),st=document.fonts;if(st.has(ut)&&"loading"===ut.status)return ut.loaded;const _t=ut.load().then(()=>(st.add(ut),ut));return xt.set(b,new nt(ut,_t)),Nt.add(ut),_t})).apply(this,arguments)}function ht(N){if(!N)return ft;const b=N.toLowerCase().split(" ").join("-");switch(b){case"serif":return"noto-serif";case"sans-serif":return"arial-unicode-ms";case"monospace":return"ubuntu-mono";case"fantasy":return"cabin-sketch";case"cursive":return"redressed";default:return b}}function pt(N){const b=function Pt(N){if(!N.weight)return"";switch(N.weight.toLowerCase()){case"bold":case"bolder":return"-bold"}return""}(N)+function F(N){if(!N.style)return"";switch(N.style.toLowerCase()){case"italic":case"oblique":return"-italic"}return""}(N);return ht(N.family)+(b.length>0?b:"-regular")}},29214:(Ut,Ft,B)=>{B.d(Ft,{L:()=>Nt,z:()=>xt});var Tt=B(33359),Ct=B(13160);const ft=512;let ot;class xt{constructor(Q){this._geometry=Q}next(){const Q=this._geometry;return this._geometry=null,Q}}function Nt(nt,Q){ot||(ot=new Ct.bN(0,0,0,1));const W="esriGeometryPolygon"===nt.geometryType,X=W?3:2;let ht,pt;for(ot.reset(W?Ct.Vl.Polygon:Ct.Vl.LineString),ot.setPixelMargin(Q+1),ot.setExtent(ft);nt.nextPath();)if(!(nt.pathSize<X)){for(nt.nextPoint(),ht=nt.x,pt=-nt.y,ot.moveTo(ht,pt);nt.nextPoint();)ht=nt.x,pt=-nt.y,ot.lineTo(ht,pt);W&&ot.close()}const Pt=ot.result(!1);if(Pt){const F=Tt.z.createEmptyOptimizedCIM(nt.geometryType);for(const N of Pt){F.startPath();for(const b of N)F.pushXY(b.x,-b.y)}return F.reset(),F}return null}},43080:(Ut,Ft,B)=>{B.d(Ft,{h:()=>te,W:()=>ee});let Tt=(()=>{class g{static local(){return null===g.instance&&(g.instance=new g),g.instance}execute(t,i,f,l,o){return new Ct(t,i,f)}}return g.instance=null,g})();class Ct{constructor(e,t,i){this._inputGeometries=e,this._angleTolerance=void 0!==t.angleTolerance?t.angleTolerance:120,this._maxCosAngle=Math.cos((1-Math.abs(this._angleTolerance)/180)*Math.PI)}next(){let e=this._inputGeometries.next();for(;e;){if("esriGeometryPolygon"===e.geometryType)this._isClosed=!0;else if("esriGeometryPolyline"===e.geometryType)this._isClosed=!1;else{if("esriGeometryEnvelope"!==e.geometryType){e=this._inputGeometries.next();continue}if(this._maxCosAngle)return e;this._isClosed=!0}for(;e.nextPath();)this._processPath(e);return e.reset(),e}return null}_processPath(e){if(e.nextPoint()){const t=e.x,i=e.y;let f=t,l=i,o=e.pathSize,m=0,h=0,p=0,v=0,w=0,j=0;this._isClosed&&++o;for(let G=1;e.nextPoint()||G<o;++G){let Z,tt;this._isClosed&&G===o-1?(Z=t,tt=i):(Z=e.x,tt=e.y);const dt=Z-f,zt=tt-l,kt=Math.sqrt(dt*dt+zt*zt);G>1&&kt>0&&p>0&&(m*dt+h*zt)/kt/p<=this._maxCosAngle&&e.setControlPointAt(G-1),1===G&&(v=dt,w=zt,j=kt),kt>0&&(f=Z,l=tt,m=dt,h=zt,p=kt)}this._isClosed&&p>0&&j>0&&(m*v+h*w)/j/p<=this._maxCosAngle&&e.setControlPointAt(0)}}}var ft=B(33359),ot=B(2362),xt=B(97373);function nt(g,e){g[4]=e}class Q{constructor(e,t=!0,i=!0,f=0){this.isClosed=!1,this.geometryCursor=null,this.geometryCursor=!t&&"esriGeometryPolygon"===e.geometryType||!i&&"esriGeometryPolyline"===e.geometryType?null:e,this.geomUnitsPerPoint=f,this.iteratePath=!1,this.internalPlacement=new xt.u}next(){if(!this.geometryCursor)return null;for(;this.iteratePath||this.geometryCursor.nextPath();){this.geometryCursor.seekPathStart();const e=this.processPath(this.geometryCursor);if(e)return e}return this.geometryCursor=null,null}}class W{constructor(e,t,i,f=0){this.isClosed=!1,this.inputGeometries=e,this.acceptPolygon=t,this.acceptPolyline=i,this.geomUnitsPerPoint=f,this.iteratePath=!1,this.multiPathCursor=null}next(){for(;;){if(!this.multiPathCursor){let e=this.inputGeometries.next();for(;e&&(this.isClosed=this.acceptPolygon&&"esriGeometryPolygon"===e.geometryType||"esriGeometryEnvelope"===e.geometryType,this.multiPathCursor=e,!this.multiPathCursor);)e=this.inputGeometries.next();if(!this.multiPathCursor)return null}for(;this.iteratePath||this.multiPathCursor.nextPath();){this.multiPathCursor.seekPathStart();const e=this.processPath(this.multiPathCursor);if(e)return e}this.multiPathCursor=null}}}var k=B(7547);const X=.03;class ht{constructor(e=0,t=!1){}isEmpty(e){if(!e.nextPoint())return!0;let t,i,f,l;for(t=e.x,i=e.y;e.nextPoint();t=i,i=l)if(f=e.x,l=e.y,f!==t||l!==i)return e.seekPathStart(),!1;return e.seekPathStart(),!0}normalize(e){const t=Math.sqrt(e[0]*e[0]+e[1]*e[1]);0!==t&&(e[0]/=t,e[1]/=t)}getLength(e,t,i,f){const l=i-e,o=f-t;return Math.sqrt(l*l+o*o)}getSegLength(e){const[[t,i],[f,l]]=e;return this.getLength(t,i,f,l)}getCoord2D(e,t,i,f,l){return[e+(i-e)*l,t+(f-t)*l]}getSegCoord2D(e,t){const[[i,f],[l,o]]=e;return this.getCoord2D(i,f,l,o,t)}getAngle(e,t,i,f,l){return Math.atan2(f-t,i-e)}getAngleCS(e,t,i,f,l){const o=i-e,m=f-t,h=Math.sqrt(o*o+m*m);return h>0?[o/h,m/h]:[1,0]}getSegAngleCS(e,t){const[[i,f],[l,o]]=e;return this.getAngleCS(i,f,l,o,t)}cut(e,t,i,f,l,o){return[l<=0?[e,t]:this.getCoord2D(e,t,i,f,l),o>=1?[i,f]:this.getCoord2D(e,t,i,f,o)]}getSubCurve(e,t,i){const f=ft.z.createEmptyOptimizedCIM("esriGeometryPolyline");return this.appendSubCurve(f,e,t,i)?f:null}appendSubCurve(e,t,i,f){e.startPath(),t.seekPathStart();let l=0,o=!0;if(!t.nextPoint())return!1;let m=t.x,h=t.y;for(;t.nextPoint();){const p=this.getLength(m,h,t.x,t.y);if(0!==p){if(o){if(l+p>i){let w=1,j=!1;l+p>=f&&(w=(f-l)/p,j=!0);const G=this.cut(m,h,t.x,t.y,(i-l)/p,w);if(G&&e.pushPoints(G),j)break;o=!1}}else{if(l+p>f){const v=this.cut(m,h,t.x,t.y,0,(f-l)/p);v&&e.pushPoint(v[1]);break}e.pushXY(t.x,t.y)}l+=p,m=t.x,h=t.y}else m=t.x,h=t.y}return!0}getCIMPointAlong(e,t){if(!e.nextPoint())return null;let i,f,l,o,m=0;for(i=e.x,f=e.y;e.nextPoint();i=l,f=o){l=e.x,o=e.y;const h=this.getLength(i,f,l,o);if(0!==h){if(m+h>t)return this.getCoord2D(i,f,l,o,(t-m)/h);m+=h}}return null}offset(e,t,i,f,l){if(!e||e.length<2)return null;let o=0,m=e[o++],h=o;for(;o<e.length;){const j=e[o];j[0]===m[0]&&j[1]===m[1]||(o!==h&&(e[h]=e[o]),m=e[h++]),o++}const p=e[0][0]===e[h-1][0]&&e[0][1]===e[h-1][1];if(p&&--h,h<(p?3:2))return null;const v=[];m=p?e[h-1]:null;let w=e[0];for(let j=0;j<h;j++){const G=j===h-1?p?e[0]:null:e[j+1];if(m)if(G){const Z=[G[0]-w[0],G[1]-w[1]];this.normalize(Z);const tt=[w[0]-m[0],w[1]-m[1]];this.normalize(tt);const dt=tt[0]*Z[1]-tt[1]*Z[0],zt=tt[0]*Z[0]+tt[1]*Z[1];if(0===dt&&1===zt){w=G;continue}if(dt>=0==t<=0){if(zt<1){const kt=[Z[0]-tt[0],Z[1]-tt[1]];this.normalize(kt);const Lt=Math.sqrt((1+zt)/2);if(Lt>1/f){const St=-Math.abs(t)/Lt;v.push([w[0]-kt[0]*St,w[1]-kt[1]*St])}}}else switch(i){case k.id.Mitered:{const kt=Math.sqrt((1+zt)/2);if(kt>0&&1/kt<f){const Lt=[Z[0]-tt[0],Z[1]-tt[1]];this.normalize(Lt);const St=Math.abs(t)/kt;v.push([w[0]-Lt[0]*St,w[1]-Lt[1]*St]);break}}case k.id.Bevelled:v.push([w[0]+tt[1]*t,w[1]-tt[0]*t]),v.push([w[0]+Z[1]*t,w[1]-Z[0]*t]);break;case k.id.Rounded:if(zt<1){v.push([w[0]+tt[1]*t,w[1]-tt[0]*t]);const kt=Math.floor(2.5*(1-zt));if(kt>0){const Lt=1/kt;let St=Lt;for(let Wt=1;Wt<kt;Wt++,St+=Lt){const Yt=[tt[1]*(1-St)+Z[1]*St,-tt[0]*(1-St)-Z[0]*St];this.normalize(Yt),v.push([w[0]+Yt[0]*t,w[1]+Yt[1]*t])}}v.push([w[0]+Z[1]*t,w[1]-Z[0]*t])}break;default:if(dt<0)v.push([w[0]+(tt[1]+tt[0])*t,w[1]+(tt[1]-tt[0])*t]),v.push([w[0]+(Z[1]-Z[0])*t,w[1]-(Z[0]+Z[1])*t]);else{const kt=Math.sqrt((1+Math.abs(zt))/2),Lt=[Z[0]-tt[0],Z[1]-tt[1]];this.normalize(Lt);const St=t/kt;v.push([w[0]-Lt[0]*St,w[1]-Lt[1]*St])}}}else{const Z=[w[0]-m[0],w[1]-m[1]];this.normalize(Z),v.push([w[0]+Z[1]*t,w[1]-Z[0]*t])}else{const Z=[G[0]-w[0],G[1]-w[1]];this.normalize(Z),v.push([w[0]+Z[1]*t,w[1]-Z[0]*t])}m=w,w=G}return v.length<(p?3:2)?null:(p&&v.push([v[0][0],v[0][1]]),v)}}const pt=1.7320508075688772,F=k.TF.OpenEnded;let N=(()=>{class g{static local(){return null===g.instance&&(g.instance=new g),g.instance}execute(t,i,f,l,o){return new b(t,i,f)}}return g.instance=null,g})();class b extends W{constructor(e,t,i){super(e,!1,!0),this._curveHelper=new ht,this._width=(void 0!==t.width?t.width:5)*i,this._arrowType=void 0!==t.geometricEffectArrowType?t.geometricEffectArrowType:void 0!==t.arrowType?t.arrowType:F,this._offsetFlattenError=X*i}processPath(e){const t=ft.z.createEmptyOptimizedCIM(e.geometryType);switch(this._arrowType){case k.TF.OpenEnded:default:this._constructSimpleArrow(t,e,!0);break;case k.TF.Block:this._constructSimpleArrow(t,e,!1);break;case k.TF.Crossed:this._constructCrossedArrow(t,e)}return t}_constructSimpleArrow(e,t,i){const f=t.pathLength();let l=this._width;f<2*l&&(l=f/2);const o=this._curveHelper.getSubCurve(t,0,f-l);if(!o||!o.nextPath())return;o.seekPathStart();const m=l/2;if(this._curveHelper.isEmpty(o))return;const h=(0,ot.l)(o),p=this._constructOffset(h,-m);if(!p)return;const v=this._constructOffset(h,m);if(!v)return;const w=this._constructArrowBasePoint(p,-m/2);if(!w)return;const j=this._constructArrowBasePoint(v,m/2);if(!j)return;t.seekInPath(t.pathSize-1);const G=[t.x,t.y];e.pushPath(v),e.nextPath(),e.nextPoint(),e.setControlPoint(),e.pushPoint(j),e.nextPoint(),e.setControlPoint(),e.pushPoint(G),e.nextPoint(),e.setControlPoint(),e.pushPoint(w),e.nextPoint(),e.setControlPoint(),e.pushPoints(p.reverse()),e.setControlPoint(),i||(e.setControlPointAt(0),e.setControlPointAt(e.pathSize-1),e.pushPoint(v[0])),e.reset()}_constructCrossedArrow(e,t){const i=t.pathLength();let f=this._width;i<f*(1+pt+1)&&(f=i/(1+pt+1)),t.seekPathStart();const l=this._curveHelper.getSubCurve(t,0,i-f*(1+pt));if(!l)return;l.nextPath();const o=f/2;if(this._curveHelper.isEmpty(l))return;const m=(0,ot.l)(l),h=this._constructOffset(m,o);if(!h)return;const p=this._constructOffset(m,-o);if(!p)return;const v=this._curveHelper.getSubCurve(t,0,i-f);if(!v||(v.nextPath(),this._curveHelper.isEmpty(v)))return;const w=(0,ot.l)(v),j=this._constructOffset(w,o);if(!j)return;const G=this._constructOffset(w,-o);if(!G)return;const Z=j[j.length-1],tt=this._constructArrowBasePoint(j,o/2);if(!tt)return;const dt=G[G.length-1],zt=this._constructArrowBasePoint(G,-o/2);if(!zt)return;t.seekInPath(t.pathSize-1);const kt=[t.x,t.y];e.pushPath(h),e.nextPath(),e.nextPoint(),e.setControlPoint(),e.pushPoint(dt),e.nextPoint(),e.setControlPoint(),e.pushPoint(zt),e.nextPoint(),e.setControlPoint(),e.pushPoint(kt),e.nextPoint(),e.setControlPoint(),e.pushPoint(tt),e.nextPoint(),e.setControlPoint(),e.pushPoint(Z),e.nextPoint(),e.setControlPoint(),e.pushPoints(p.reverse()),e.nextPoint(),e.setControlPoint(),e.reset()}_constructOffset(e,t){return this._curveHelper.offset(e,t,k.id.Rounded,4,this._offsetFlattenError)}_constructArrowBasePoint(e,t){if(!e||e.length<2)return null;const i=e[e.length-2],f=e[e.length-1],l=[f[0]-i[0],f[1]-i[1]];return this._curveHelper.normalize(l),[f[0]+l[1]*t,f[1]-l[0]*t]}}B(29132);var ut=B(29214),st=B(65234);let _t=(()=>{class g{static local(){return null===g.instance&&(g.instance=new g),g.instance}execute(t,i,f,l,o,m){return new Et(t,i,f,l,o,m)}}return g.instance=null,g})();class Et{constructor(e,t,i,f,l,o){this._inputGeometries=e,this._tileKey=f,this._geometryEngine=l,this._curveHelper=new ht,this._size=(void 0!==t.size?t.size:1)*i,this._maxInflateSize=o*i,this._offsetFlattenError=X*i}next(){let e;for(;e=this._inputGeometries.next();){if(0===this._size)return e;if("esriGeometryEnvelope"===e.geometryType)if(this._size>0){const l=ft.z.createEmptyOptimizedCIM(e.geometryType),o=(0,ot.M)(e)[0],m=this._curveHelper.offset(o,this._size,k.id.Rounded,4,this._offsetFlattenError);if(m)return l.pushPath(m),l}else if(this._size<0){const l=e.asJSON();if(Math.min(l.xmax-l.xmin,l.ymax-l.ymin)+2*this._size>0)return ft.z.fromJSONCIM({xmin:l.xmin-this._size,xmax:l.xmax+this._size,ymin:l.ymin-this._size,ymax:l.ymax+this._size})}const t=this._geometryEngine;if(null==t)return null;const i=this._tileKey?(0,ut.L)(e,this._maxInflateSize):e;if(!i)continue;const f=t.buffer(st.Z.WebMercator,i.asJSON(),this._size,1);return f?ft.z.fromJSONCIM(f):null}return null}}let At=(()=>{class g{static local(){return null===g.instance&&(g.instance=new g),g.instance}execute(t,i,f,l,o){return new yt(t,i,f)}}return g.instance=null,g})();class yt{constructor(e,t,i){this._defaultPointSize=20,this._inputGeometries=e,this._geomUnitsPerPoint=i,this._rule=t.rule??k.Em.FullGeometry,this._defaultSize=this._defaultPointSize*i}next(){let e;for(;e=this._inputGeometries.next();){const t=this._processGeom((0,ot.M)(e));if(t&&t.length)return ft.z.fromJSONCIM({paths:t})}return null}_clone(e){return[e[0],e[1]]}_mid(e,t){return[(e[0]+t[0])/2,(e[1]+t[1])/2]}_mix(e,t,i,f){return[e[0]*t+i[0]*f,e[1]*t+i[1]*f]}_add(e,t){return[e[0]+t[0],e[1]+t[1]]}_add2(e,t,i){return[e[0]+t,e[1]+i]}_sub(e,t){return[e[0]-t[0],e[1]-t[1]]}_dist(e,t){return Math.sqrt((e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1]))}_norm(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}_normalize(e,t=1){const i=t/this._norm(e);e[0]*=i,e[1]*=i}_leftPerpendicular(e){const i=e[0];e[0]=-e[1],e[1]=i}_leftPerp(e){return[-e[1],e[0]]}_rightPerpendicular(e){const i=-e[0];e[0]=e[1],e[1]=i}_rightPerp(e){return[e[1],-e[0]]}_dotProduct(e,t){return e[0]*t[0]+e[1]*t[1]}_crossProduct(e,t){return e[0]*t[1]-e[1]*t[0]}_rotateDirect(e,t,i){const l=e[0]*i+e[1]*t;e[0]=e[0]*t-e[1]*i,e[1]=l}_makeCtrlPt(e){const t=[e[0],e[1]];return nt(t,1),t}_addAngledTicks(e,t,i,f){const l=this._sub(i,t);this._normalize(l);const o=this._crossProduct(l,this._sub(f,t));let m;m=o>0?this._rightPerp(l):this._leftPerp(l);const h=Math.abs(o)/2,p=[];p.push([t[0]+(m[0]-l[0])*h,t[1]+(m[1]-l[1])*h]),p.push(t),p.push(i),p.push([i[0]+(m[0]+l[0])*h,i[1]+(m[1]+l[1])*h]),e.push(p)}_addBezier2(e,t,i,f,l){if(0==l--)return void e.push(f);const o=this._mid(t,i),m=this._mid(i,f),h=this._mid(o,m);this._addBezier2(e,t,o,h,l),this._addBezier2(e,h,m,f,l)}_addBezier3(e,t,i,f,l,o){if(0==o--)return void e.push(l);const m=this._mid(t,i),h=this._mid(i,f),p=this._mid(f,l),v=this._mid(m,h),w=this._mid(h,p),j=this._mid(v,w);this._addBezier3(e,t,m,v,j,o),this._addBezier3(e,j,w,p,l,o)}_add90DegArc(e,t,i,f,l){const o=l??this._crossProduct(this._sub(i,t),this._sub(f,t))>0,m=this._mid(t,i),h=this._sub(m,t);o?this._leftPerpendicular(h):this._rightPerpendicular(h),m[0]+=h[0],m[1]+=h[1],this._addBezier3(e,t,this._mix(t,.33333,m,.66667),this._mix(i,.33333,m,.66667),i,4)}_addArrow(e,t,i){const f=t[0],l=t[1],o=t[t.length-1],m=this._sub(f,l);this._normalize(m);const h=this._crossProduct(m,this._sub(o,l)),p=.5*h,v=this._leftPerp(m),w=[o[0]-v[0]*h,o[1]-v[1]*h],j=t.length-1,G=[];G.push(i?[-v[0],-v[1]]:v);let Z=[-m[0],-m[1]];for(let tt=1;tt<j-1;tt++){const dt=this._sub(t[tt+1],t[tt]);this._normalize(dt);const zt=this._dotProduct(dt,Z),kt=this._crossProduct(dt,Z),Lt=Math.sqrt((1+zt)/2),St=this._sub(dt,Z);this._normalize(St),St[0]/=Lt,St[1]/=Lt,G.push(kt<0?[-St[0],-St[1]]:St),Z=dt}G.push(this._rightPerp(Z));for(let tt=G.length-1;tt>0;tt--)e.push([t[tt][0]+G[tt][0]*p,t[tt][1]+G[tt][1]*p]);e.push([w[0]+G[0][0]*p,w[1]+G[0][1]*p]),e.push([w[0]+G[0][0]*h,w[1]+G[0][1]*h]),e.push(f),e.push([w[0]-G[0][0]*h,w[1]-G[0][1]*h]),e.push([w[0]-G[0][0]*p,w[1]-G[0][1]*p]);for(let tt=1;tt<G.length;tt++)e.push([t[tt][0]-G[tt][0]*p,t[tt][1]-G[tt][1]*p])}_cp2(e,t,i){return e.length>=2?e[1]:this._add2(e[0],t*this._defaultSize,i*this._defaultSize)}_cp3(e,t,i,f){if(e.length>=3)return e[2];const l=this._mix(e[0],1-i,t,i),o=this._sub(t,e[0]);return this._normalize(o),this._rightPerpendicular(o),[l[0]+o[0]*f*this._defaultSize,l[1]+o[1]*f*this._defaultSize]}_arrowPath(e){if(e.length>2)return e;const t=e[0],i=this._cp2(e,-4,0),f=this._sub(t,i);this._normalize(f);const l=this._rightPerp(f);return[t,i,[t[0]+(l[0]-f[0])*this._defaultSize,t[1]+(l[1]-f[1])*this._defaultSize]]}_arrowLastSeg(e){const t=e[0],i=this._cp2(e,-4,0);let f;if(e.length>=3)f=e[e.length-1];else{const l=this._sub(t,i);this._normalize(l);const o=this._rightPerp(l);f=[t[0]+(o[0]-l[0])*this._defaultSize,t[1]+(o[1]-l[1])*this._defaultSize]}return[i,f]}_processGeom(e){if(!e)return null;const t=[];for(const i of e){if(!i||0===i.length)continue;const f=i.length;let l=i[0];switch(this._rule){case k.Em.PerpendicularFromFirstSegment:{const o=this._cp2(i,0,-1),m=this._cp3(i,o,.5,4),h=[];h.push(m),h.push(this._mid(l,o)),t.push(h);break}case k.Em.ReversedFirstSegment:{const o=this._cp2(i,0,-1);t.push([o,l]);break}case k.Em.PerpendicularToSecondSegment:{const o=this._cp2(i,-4,1),m=this._cp3(i,o,.882353,-1.94),h=[];h.push(this._mid(o,m)),h.push(l),t.push(h);break}case k.Em.SecondSegmentWithTicks:{const o=this._cp2(i,-4,1),m=this._cp3(i,o,.882353,-1.94),h=this._sub(m,o);let p;p=this._crossProduct(h,this._sub(l,o))>0?this._rightPerp(p):this._leftPerp(h);const v=[];v.push([o[0]+(p[0]-h[0])/3,o[1]+(p[1]-h[1])/3]),v.push(o),v.push(m),v.push([m[0]+(p[0]+h[0])/3,m[1]+(p[1]+h[1])/3]),t.push(v);break}case k.Em.DoublePerpendicular:{const o=this._cp2(i,0,-1),m=this._cp3(i,o,.5,3),h=this._mid(l,o),p=this._sub(h,m);this._normalize(p);const v=this._crossProduct(p,this._sub(l,m));this._leftPerpendicular(p);const w=[];w.push(l),w.push([m[0]+p[0]*v,m[1]+p[1]*v]),t.push(w);const j=[];j.push([m[0]-p[0]*v,m[1]-p[1]*v]),j.push(o),t.push(j);break}case k.Em.OppositeToFirstSegment:{const o=this._cp2(i,0,-1),m=this._cp3(i,o,.5,3),h=this._mid(l,o),p=this._sub(h,m);this._normalize(p);const v=this._crossProduct(p,this._sub(l,m));this._leftPerpendicular(p);const w=[];w.push([m[0]+p[0]*v,m[1]+p[1]*v]),w.push([m[0]-p[0]*v,m[1]-p[1]*v]),t.push(w);break}case k.Em.TriplePerpendicular:{const o=this._cp2(i,0,-1),m=this._cp3(i,o,.5,4),h=this._mid(l,o),p=this._sub(h,m);this._normalize(p);const v=this._crossProduct(p,this._sub(l,m));this._leftPerpendicular(p);const w=[];w.push([m[0]+p[0]*v*.8,m[1]+p[1]*v*.8]),w.push([h[0]+.8*(l[0]-h[0]),h[1]+.8*(l[1]-h[1])]),t.push(w),t.push([m,h]);const j=[];j.push([m[0]-p[0]*v*.8,m[1]-p[1]*v*.8]),j.push([h[0]+.8*(o[0]-h[0]),h[1]+.8*(o[1]-h[1])]),t.push(j);break}case k.Em.HalfCircleFirstSegment:{const o=this._cp2(i,0,-1),m=this._cp3(i,o,.5,4),h=this._mid(l,o);let p=this._sub(o,l);const v=Math.cos(Math.PI/18),w=Math.sin(Math.PI/18),j=Math.sqrt((1+v)/2),G=Math.sqrt((1-v)/2),Z=[];let tt;this._crossProduct(p,this._sub(m,l))>0?(Z.push(l),p=this._sub(l,h),tt=o):(Z.push(o),p=this._sub(o,h),tt=l),this._rotateDirect(p,j,G),p[0]/=j,p[1]/=j;for(let dt=1;dt<=18;dt++)Z.push(this._add(h,p)),this._rotateDirect(p,v,w);Z.push(tt),t.push(Z);break}case k.Em.HalfCircleSecondSegment:{const o=this._cp2(i,0,-1),m=this._cp3(i,o,1,-1);let h=this._sub(l,o);this._normalize(h);const p=this._crossProduct(h,this._sub(m,o))/2;this._leftPerpendicular(h);const v=[o[0]+h[0]*p,o[1]+h[1]*p];h=this._sub(o,v);const w=Math.cos(Math.PI/18);let j=Math.sin(Math.PI/18);p>0&&(j=-j);const G=[o];for(let Z=1;Z<=18;Z++)this._rotateDirect(h,w,j),G.push(this._add(v,h));t.push(G);break}case k.Em.HalfCircleExtended:{const o=this._cp2(i,0,-2),m=this._cp3(i,o,1,-1);let h;if(f>=4)h=i[3];else{const Z=this._sub(l,o);h=this._add(m,Z)}const p=this._dist(o,m)/2/.75,v=this._sub(o,l);this._normalize(v,p);const w=this._sub(m,h);this._normalize(w,p),t.push([h,m]);const G=[this._clone(m)];this._addBezier3(G,m,this._add(m,w),this._add(o,v),o,4),G.push(l),t.push(G);break}case k.Em.OpenCircle:{const o=this._cp2(i,-2,0),m=this._sub(o,l),h=Math.cos(Math.PI/18),p=-Math.sin(Math.PI/18),v=[o];for(let w=1;w<=33;w++)this._rotateDirect(m,h,p),v.push(this._add(l,m));t.push(v);break}case k.Em.CoverageEdgesWithTicks:{const o=this._cp2(i,0,-1);let m,h;if(f>=3)m=i[2];else{const j=this._sub(o,l),G=this._leftPerp(j);m=[l[0]+G[0]-.25*j[0],l[1]+G[1]-.25*j[1]]}if(f>=4)h=i[3];else{const j=this._mid(l,o),G=this._sub(l,o);this._normalize(G),this._leftPerpendicular(G);const Z=this._crossProduct(G,this._sub(m,j));this._rightPerpendicular(G),h=[m[0]+G[0]*Z*2,m[1]+G[1]*Z*2]}const p=this._sub(o,l);let v,w;v=this._crossProduct(p,this._sub(m,l))>0?this._rightPerp(p):this._leftPerp(p),w=[],w.push(m),w.push(l),w.push([l[0]+(v[0]-p[0])/3,l[1]+(v[1]-p[1])/3]),t.push(w),v=this._crossProduct(p,this._sub(h,o))>0?this._rightPerp(v):this._leftPerp(p),w=[],w.push([o[0]+(v[0]+p[0])/3,o[1]+(v[1]+p[1])/3]),w.push(o),w.push(h),t.push(w);break}case k.Em.GapExtentWithDoubleTicks:{const o=this._cp2(i,0,2),m=this._cp3(i,o,0,1);let h;if(f>=4)h=i[3];else{const p=this._sub(o,l);h=this._add(m,p)}this._addAngledTicks(t,l,o,this._mid(m,h)),this._addAngledTicks(t,m,h,this._mid(l,o));break}case k.Em.GapExtentMidline:{const o=this._cp2(i,2,0),m=this._cp3(i,o,0,1);let h;if(f>=4)h=i[3];else{const v=this._sub(o,l);h=this._add(m,v)}const p=[];p.push(this._mid(l,m)),p.push(this._mid(o,h)),t.push(p);break}case k.Em.Chevron:{const o=this._cp2(i,-1,-1);let m;if(f>=3)m=i[2];else{const h=this._sub(o,l);this._leftPerpendicular(h),m=this._add(l,h)}t.push([o,this._makeCtrlPt(l),m]);break}case k.Em.PerpendicularWithArc:{const o=this._cp2(i,0,-2),m=this._cp3(i,o,.5,-1);let h=this._sub(o,l);const p=this._norm(h);h[0]/=p,h[1]/=p;const v=this._crossProduct(h,this._sub(m,l));let w=this._dotProduct(h,this._sub(m,l));w<.05*p?w=.05*p:w>.95*p&&(w=.95*p);const j=[l[0]+h[0]*w,l[1]+h[1]*w];this._leftPerpendicular(h);let G=[];G.push([j[0]-h[0]*v,j[1]-h[1]*v]),G.push([j[0]+h[0]*v,j[1]+h[1]*v]),t.push(G);const Z=[o[0]+h[0]*v,o[1]+h[1]*v];h=this._sub(o,Z);const tt=Math.cos(Math.PI/18);let dt=Math.sin(Math.PI/18);v<0&&(dt=-dt),G=[l,o];for(let zt=1;zt<=9;zt++)this._rotateDirect(h,tt,dt),G.push(this._add(Z,h));t.push(G);break}case k.Em.ClosedHalfCircle:{const o=this._cp2(i,2,0),m=this._mid(l,o),h=this._sub(o,m),p=Math.cos(Math.PI/18),v=Math.sin(Math.PI/18),w=[l,o];for(let j=1;j<=18;j++)this._rotateDirect(h,p,v),w.push(this._add(m,h));t.push(w);break}case k.Em.TripleParallelExtended:{const o=this._cp2(i,0,-2),m=this._cp3(i,o,1,-2),h=this._mid(l,o),p=this._sub(m,o);this._normalize(p);const v=Math.abs(this._crossProduct(p,this._sub(h,o)))/2,w=this._dist(o,m),j=[o,l];j.push([l[0]+p[0]*w*.5,l[1]+p[1]*w*.5]),t.push(j);const G=[];G.push([h[0]-p[0]*v,h[1]-p[1]*v]),G.push([h[0]+p[0]*w*.375,h[1]+p[1]*w*.375]),nt(G[G.length-1],1),G.push([h[0]+p[0]*w*.75,h[1]+p[1]*w*.75]),t.push(G),t.push([o,m]);break}case k.Em.ParallelWithTicks:{const o=this._cp2(i,3,0),m=this._cp3(i,o,.5,-1),h=this._sub(m,o);this._normalize(h);const p=this._crossProduct(h,this._sub(m,l));this._leftPerpendicular(h),this._addAngledTicks(t,l,o,m),this._addAngledTicks(t,this._mix(l,1,h,p),this._mix(o,1,h,p),this._mid(l,o));break}case k.Em.Parallel:{const o=this._cp2(i,3,0),m=this._cp3(i,o,.5,-1),h=this._sub(o,l);this._normalize(h);const p=this._leftPerp(h),v=this._crossProduct(h,this._sub(m,l));let w=[l,o];t.push(w),w=[],w.push([l[0]+p[0]*v,l[1]+p[1]*v]),w.push([o[0]+p[0]*v,o[1]+p[1]*v]),t.push(w);break}case k.Em.PerpendicularToFirstSegment:{const o=this._cp2(i,3,0),m=this._cp3(i,o,.5,-1),h=this._mid(l,o),p=this._sub(o,l);this._normalize(p);const v=this._crossProduct(p,this._sub(m,l));this._leftPerpendicular(p);const w=[];w.push([h[0]-p[0]*v*.25,h[1]-p[1]*v*.25]),w.push([h[0]+p[0]*v*1.25,h[1]+p[1]*v*1.25]),t.push(w);break}case k.Em.ParallelOffset:{const o=this._cp2(i,3,0),m=this._cp3(i,o,.5,-1),h=this._sub(o,l);this._normalize(h);const p=this._crossProduct(h,this._sub(m,l));this._leftPerpendicular(h);const v=[];v.push([l[0]-h[0]*p,l[1]-h[1]*p]),v.push([o[0]-h[0]*p,o[1]-h[1]*p]),t.push(v);const w=[];w.push([l[0]+h[0]*p,l[1]+h[1]*p]),w.push([o[0]+h[0]*p,o[1]+h[1]*p]),t.push(w);break}case k.Em.OffsetOpposite:{const o=this._cp2(i,3,0),m=this._cp3(i,o,.5,-1),h=this._sub(o,l);this._normalize(h);const p=this._crossProduct(h,this._sub(m,l));this._leftPerpendicular(h);const v=[];v.push([l[0]-h[0]*p,l[1]-h[1]*p]),v.push([o[0]-h[0]*p,o[1]-h[1]*p]),t.push(v);break}case k.Em.OffsetSame:{const o=this._cp2(i,3,0),m=this._cp3(i,o,.5,-1),h=this._sub(o,l);this._normalize(h);const p=this._crossProduct(h,this._sub(m,l));this._leftPerpendicular(h);const v=[];v.push([l[0]+h[0]*p,l[1]+h[1]*p]),v.push([o[0]+h[0]*p,o[1]+h[1]*p]),t.push(v);break}case k.Em.CircleWithArc:{let o=this._cp2(i,3,0);const m=this._cp3(i,o,.5,-1);let h,p;if(f>=4)h=i[3],p=this._crossProduct(this._sub(h,o),this._sub(m,o))>0;else{h=o,p=this._crossProduct(this._sub(h,l),this._sub(m,l))>0;const Z=24*this._geomUnitsPerPoint,tt=this._sub(h,l);this._normalize(tt,Z);const dt=Math.sqrt(2)/2;this._rotateDirect(tt,dt,p?dt:-dt),o=this._add(l,tt)}const v=this._sub(o,l),w=Math.cos(Math.PI/18),j=Math.sin(Math.PI/18),G=[o];for(let Z=1;Z<=36;Z++)this._rotateDirect(v,w,j),G.push(this._add(l,v));this._add90DegArc(G,o,h,m,p),nt(G[G.length-8],1),t.push(G);break}case k.Em.DoubleJog:{let o,m,h=this._cp2(i,-3,1);if(o=f>=3?i[2]:this._add(l,this._sub(l,h)),f>=4)m=i[3];else{const zt=l;l=h,m=o;const kt=this._dist(l,zt),Lt=this._dist(m,zt);let St=30*this._geomUnitsPerPoint;.5*kt<St&&(St=.5*kt),.5*Lt<St&&(St=.5*Lt),h=this._mix(l,St/kt,zt,(kt-St)/kt),o=this._mix(m,St/Lt,zt,(Lt-St)/Lt)}const p=this._mid(l,h),v=this._mid(m,o),w=this._dist(l,h),j=this._dist(o,m);let G=Math.min(w,j)/8;G=Math.min(G,24*this._geomUnitsPerPoint);const Z=Math.cos(Math.PI/4);let tt=this._sub(l,h);this._normalize(tt,G),this._crossProduct(tt,this._sub(m,h))>0?this._rotateDirect(tt,Z,-Z):this._rotateDirect(tt,Z,Z);let dt=[];dt.push(h),dt.push(this._add(p,tt)),dt.push(this._sub(p,tt)),dt.push(l),t.push(dt),tt=this._sub(m,o),this._normalize(tt,G),this._crossProduct(tt,this._sub(l,o))<0?this._rotateDirect(tt,Z,Z):this._rotateDirect(tt,Z,-Z),dt=[],dt.push(o),dt.push(this._add(v,tt)),dt.push(this._sub(v,tt)),dt.push(m),t.push(dt);break}case k.Em.PerpendicularOffset:{const o=this._cp2(i,-4,1),m=this._cp3(i,o,.882353,-1.94),h=this._sub(m,o);this._crossProduct(h,this._sub(l,o))>0?this._rightPerpendicular(h):this._leftPerpendicular(h);const p=[h[0]/8,h[1]/8],v=this._sub(this._mid(o,m),p);t.push([v,l]);break}case k.Em.LineExcludingLastSegment:{const o=this._arrowPath(i),m=[];let h=o.length-2;for(;h--;)m.push(o[h]);t.push(m);break}case k.Em.MultivertexArrow:{const o=this._arrowPath(i),m=[];this._addArrow(m,o,!1),t.push(m);break}case k.Em.CrossedArrow:{const o=this._arrowPath(i),m=[];this._addArrow(m,o,!0),t.push(m);break}case k.Em.ChevronArrow:{const[o,m]=this._arrowLastSeg(i),h=10*this._geomUnitsPerPoint,p=this._sub(l,o);this._normalize(p);const v=this._crossProduct(p,this._sub(m,o)),w=this._leftPerp(p),j=[m[0]-w[0]*v*2,m[1]-w[1]*v*2],G=[];G.push([m[0]+p[0]*h,m[1]+p[1]*h]),G.push(l),G.push([j[0]+p[0]*h,j[1]+p[1]*h]),t.push(G);break}case k.Em.ChevronArrowOffset:{const[o,m]=this._arrowLastSeg(i),h=this._sub(l,o);this._normalize(h);const p=this._crossProduct(h,this._sub(m,o));this._leftPerpendicular(h);const v=[m[0]-h[0]*p,m[1]-h[1]*p],w=[];w.push([v[0]+h[0]*p*.5,v[1]+h[1]*p*.5]),w.push(this._mid(v,l)),w.push([v[0]-h[0]*p*.5,v[1]-h[1]*p*.5]),t.push(w);break}case k.Em.PartialFirstSegment:{const[o,m]=this._arrowLastSeg(i),h=this._sub(l,o);this._normalize(h);const p=this._crossProduct(h,this._sub(m,o));this._leftPerpendicular(h),t.push([o,[m[0]-h[0]*p,m[1]-h[1]*p]]);break}case k.Em.Arch:{const o=this._cp2(i,0,-1),m=this._cp3(i,o,.5,1),h=this._sub(l,o),p=this._mix(m,1,h,.55),v=this._mix(m,1,h,-.55),w=[l];this._addBezier2(w,l,p,m,4),this._addBezier2(w,m,v,o,4),t.push(w);break}case k.Em.CurvedParallelTicks:{const o=this._cp2(i,-4,1),m=this._cp3(i,o,.882353,-1.94),h=this._sub(m,o);this._crossProduct(h,this._sub(l,o))>0?this._rightPerpendicular(h):this._leftPerpendicular(h);const p=[h[0]/8,h[1]/8],v=this._sub(this._mid(o,m),p),w=this._sub(this._mix(o,.75,m,.25),p),j=this._sub(this._mix(o,.25,m,.75),p),G=[o];this._addBezier2(G,o,w,v,3),this._addBezier2(G,v,j,m,3),t.push(G);for(let Z=0;Z<8;Z++){const tt=G[2*Z+1],dt=[this._clone(tt)];dt.push(this._add(tt,[h[0]/4,h[1]/4])),t.push(dt)}break}case k.Em.Arc90Degrees:{const o=this._cp2(i,0,-1),m=this._cp3(i,o,.5,1),h=[o];this._add90DegArc(h,o,l,m),t.push(h);break}default:t.push(i)}}return t}}let Ot=(()=>{class g{static local(){return null===g.instance&&(g.instance=new g),g.instance}execute(t,i,f,l,o){return new wt(t,i,f)}}return g.instance=null,g})();class wt extends W{constructor(e,t,i){super(e,!0,!0),this._curveHelper=new ht,this._beginCut=(void 0!==t.beginCut?t.beginCut:1)*i,this._endCut=(void 0!==t.endCut?t.endCut:1)*i,this._middleCut=(void 0!==t.middleCut?t.middleCut:0)*i,this._invert=void 0!==t.invert&&t.invert,this._beginCut<0&&(this._beginCut=0),this._endCut<0&&(this._endCut=0),this._middleCut<0&&(this._middleCut=0)}processPath(e){const{_beginCut:t,_endCut:i,_middleCut:f}=this,l=e.pathLength(),o=ft.z.createEmptyOptimizedCIM("esriGeometryPolyline");if(this._invert){if(0!==t||0!==i||0!==f)if(t+i+f>=l)for(o.startPath();e.nextPoint();)o.pushXY(e.x,e.y);else this._curveHelper.appendSubCurve(o,e,0,t),this._curveHelper.appendSubCurve(o,e,.5*(l-f),.5*(l+f)),this._curveHelper.appendSubCurve(o,e,l-i,i)}else if(0===t&&0===i&&0===f)for(o.startPath();e.nextPoint();)o.pushXY(e.x,e.y);else t+i+f<l&&(0===f?this._curveHelper.appendSubCurve(o,e,t,l-i):(this._curveHelper.appendSubCurve(o,e,t,.5*(l-f)),this._curveHelper.appendSubCurve(o,e,.5*(l+f),l-i)));return 0===o.totalSize?null:o}}class Mt{constructor(){this._values=[],this.extPtGap=0,this.ctrlPtGap=0,this._length=0,this._currentValue=0}isEmpty(){return 0===this._values.length}size(){return this._values.length}init(e,t,i=!0){if(this._setEmpty(),!e||0===e.length)return!1;for(let f=0;f<e.length;f++){let l=Math.abs(e[f]);i&&l<1e-7&&(l=1e-7),this._values.push(l),this._length+=l}return t&&1&e.length&&(this._length*=2),0!==this._length&&(this.ctrlPtGap=this.extPtGap=0,this._currentValue=-1,!0)}scale(e){const t=this._values?this._values.length:0;for(let i=0;i<t;++i)this._values[i]*=e;this._length*=e,this.extPtGap*=e,this.ctrlPtGap*=e}addValue(e){this._length+=e,this._values.push(e)}firstValue(){return this._values[0]}lastValue(){return this._values[this._values.length-1]}nextValue(){return this._currentValue++,this._currentValue===this._values.length&&(this._currentValue=0),this._values[this._currentValue]}reset(){this._currentValue=-1}length(){return this._length}_setEmpty(){this.extPtGap=this.ctrlPtGap=this._length=0,this._currentValue=-1,this._values.length=0}}class rt{constructor(){this.pt=null,this.ca=0,this.sa=0}}var H,g;(g=H||(H={}))[g.FAIL=0]="FAIL",g[g.END=1]="END",g[g.CONTINUE=2]="CONTINUE";class V{constructor(){this.reset()}reset(){this.segment=null,this.segmentLength=0,this.abscissa=0,this.isPathEnd=!1,this.isPartEnd=!1}isValid(){return null!==this.segment}copyTo(e){e.segment=this.segment,e.segmentLength=this.segmentLength,e.abscissa=this.abscissa,e.isPathEnd=this.isPathEnd,e.isPartEnd=this.isPartEnd}}class J extends ht{constructor(e=0,t=!1){super(e,t),this._tolerance=X,this._currentPosition=new V}updateTolerance(e){this._tolerance=X*e}init(e,t,i=!0){return i?(this._patternLength=t.length(),this._partExtPtGap=t.extPtGap,this._partCtrlPtGap=t.ctrlPtGap):(this._patternLength=0,this._partExtPtGap=0,this._partCtrlPtGap=0),this._currentPosition.reset(),this._partSegCount=0,this._pathCursor=e,this._seg=-1,this._setPosAtNextPart()}curPositionIsValid(){return this._currentPosition.isValid()}nextPosition(e,t=H.FAIL){const i=new V;return!!this._nextPosition(e,i,null,t)&&(i.copyTo(this._currentPosition),!0)}curPointAndAngle(e){e.pt=this._getPoint(this._currentPosition);const[t,i]=this._getAngleCS(this._currentPosition);e.ca=t,e.sa=i}nextPointAndAngle(e,t,i=H.FAIL){const f=new V;if(!this._nextPosition(e,f,null,i))return!1;f.copyTo(this._currentPosition),t.pt=this._getPoint(f);const[l,o]=this._getAngleCS(f);return t.ca=l,t.sa=o,!0}nextCurve(e){if(0===e)return null;const t=ft.z.createEmptyOptimizedCIM("esriGeometryPolyline");t.startPath(),t.nextPath();const i=new V;return this._nextPosition(e,i,t,H.END)?(i.copyTo(this._currentPosition),t):null}isPathEnd(){return this._currentPosition.isPathEnd}getPathEnd(){return this._currentPosition.segment[1]}getPt(e){return this._pathCursor.seekInPath(e),[this._pathCursor.x,this._pathCursor.y]}getSeg(e){return[this.getPt(e),this.getPt(e+1)]}_nextPosition(e,t,i,f){if(this._currentPosition.isPathEnd)return!1;let l=this._currentPosition.abscissa;for(this._currentPosition.segmentLength>0&&(l/=this._currentPosition.segmentLength),this._currentPosition.copyTo(t);t.abscissa+e*this._partLengthRatio>t.segmentLength+this._tolerance;){if(i){if(0===i.pathSize)if(0===l){const m=t.segment[0];i.pushXY(m[0],m[1])}else i.pushPoint(this.getSegCoord2D(t.segment,l));const o=t.segment[1];i.pushXY(o[0],o[1])}if(l=0,e-=(t.segmentLength-t.abscissa)/this._partLengthRatio,this._partSegCount)t.segment=this._nextSegment(),t.segmentLength=this.getSegLength(t.segment),t.abscissa=0,this._partSegCount--;else{if(!this._setPosAtNextPart())return f!==H.FAIL&&(t.segmentLength=this.getSegLength(t.segment),t.isPartEnd=!0,f===H.END?(t.abscissa=t.segmentLength,t.isPathEnd=!0):t.abscissa=t.segmentLength+e,!0);this._currentPosition.copyTo(t)}}if(t.abscissa+=e*this._partLengthRatio,i){0===i.pathSize&&i.pushPoint(0===l?t.segment[0]:this.getSegCoord2D(t.segment,l));const o=t.abscissa/t.segmentLength;i.pushPoint(1===o?t.segment[1]:this.getSegCoord2D(t.segment,o))}return this._partSegCount||Math.abs(t.abscissa-t.segmentLength)<this._tolerance&&(t.isPathEnd=this._partIsLast,t.isPartEnd=!0),!0}_getPoint(e){return this.getSegCoord2D(this._currentPosition.segment,e.segmentLength<=0?0:e.abscissa/e.segmentLength)}_getAngleCS(e){return this.getSegAngleCS(this._currentPosition.segment,e.segmentLength<=0?0:e.abscissa/e.segmentLength)}_setPosAtNextPart(){for(;this._partSegCount;)this._hasNextSegment()&&this._nextSegment(),this._partSegCount--;if(!this._hasNextSegment())return!1;for(this._partLength=0,this._partIsLast=!0,this._partSegCount=0;this._hasNextSegment();)if(this._partLength+=this.getSegLength(this._nextSegment()),this._partSegCount++,this._pathCursor.getControlPointAt(this._getEndPointIndex())){this._partIsLast=!this._hasNextSegment();break}let e=this._partSegCount;for(;e;)this._previousSegment(),--e;this._currentPosition.segment=this._nextSegment(),this._currentPosition.segmentLength=this.getSegLength(this._currentPosition.segment),this._currentPosition.abscissa=0,this._currentPosition.isPathEnd=this._currentPosition.isPartEnd=!1,--this._partSegCount;const t=this._getStartPointIndex();this._ctrlPtBegin=this._pathCursor.getControlPointAt(t);let i=t+this._partSegCount+1;if(i>=this._pathCursor.pathSize&&(i=0),this._ctrlPtEnd=this._pathCursor.getControlPointAt(i),this._patternLength>0){const f=this._ctrlPtBegin?this._partCtrlPtGap:this._partExtPtGap,l=this._ctrlPtEnd?this._partCtrlPtGap:this._partExtPtGap;let o=Math.round((this._partLength-(f+l))/this._patternLength);o<=0&&(o=f+l>0?0:1),this._partLengthRatio=this._partLength/(f+l+o*this._patternLength),this._partLengthRatio<.01&&(this._partLengthRatio=1)}else this._partLengthRatio=1;return!0}_hasNextSegment(){return this._seg<this._pathCursor.pathSize-2}_previousSegment(){return this.getSeg(--this._seg)}_nextSegment(){return this.getSeg(++this._seg)}_getStartPointIndex(){return this._seg}_getEndPointIndex(){return this._seg+1}}let T=(()=>{class g{static local(){return null===g.instance&&(g.instance=new g),g.instance}execute(t,i,f,l,o){return new a(t,i,f)}}return g.instance=null,g})();class a extends W{constructor(e,t,i){super(e,!0,!0),this._firstCurve=null,this._walker=new J,this._walker.updateTolerance(i),this._endings=t.lineDashEnding,this._customDashPos=-(t.offsetAlongLine??0)*i,this._offsetAtEnd=(t.customEndingOffset??0)*i,this._pattern=new Mt,this._pattern.init(t.dashTemplate,!0),this._pattern.scale(i)}processPath(e){if(0===this._pattern.length()){this.iteratePath=!1;const f=(0,ot.l)(e);return ft.z.fromJSONCIM({paths:[f]})}if(!this.iteratePath){let f=!0;switch(this._endings){case k.sj.HalfPattern:case k.sj.HalfGap:default:this._pattern.extPtGap=0;break;case k.sj.FullPattern:this.isClosed||(this._pattern.extPtGap=.5*this._pattern.firstValue());break;case k.sj.FullGap:this.isClosed||(this._pattern.extPtGap=.5*this._pattern.lastValue());break;case k.sj.NoConstraint:this.isClosed||(f=!1);break;case k.sj.Custom:this.isClosed||(this._pattern.extPtGap=.5*this._offsetAtEnd)}const l=e.pathLength();if(this._pattern.isEmpty()||l<.1*this._pattern.length()){const o=(0,ot.l)(e);return ft.z.fromJSONCIM({paths:[o]})}if(!this._walker.init(e,this._pattern,f)){const o=(0,ot.l)(e);return ft.z.fromJSONCIM({paths:[o]})}}let t;if(this.iteratePath)t=this._pattern.nextValue();else{let f;switch(this._endings){case k.sj.HalfPattern:default:f=.5*this._pattern.firstValue();break;case k.sj.HalfGap:f=.5*-this._pattern.lastValue();break;case k.sj.FullGap:f=-this._pattern.lastValue();break;case k.sj.FullPattern:f=0;break;case k.sj.NoConstraint:case k.sj.Custom:f=-this._customDashPos}let l=f/this._pattern.length();l-=Math.floor(l),f=l*this._pattern.length(),this._pattern.reset(),t=this._pattern.nextValue();let o=!1;for(;f>=t;)f-=t,t=this._pattern.nextValue(),o=!o;t-=f,o?(this._walker.nextPosition(t),t=this._pattern.nextValue()):this.isClosed&&(this._firstCurve=this._walker.nextCurve(t),t=this._pattern.nextValue(),this._walker.nextPosition(t),t=this._pattern.nextValue())}let i=this._walker.nextCurve(t);if(i)if(this._walker.isPathEnd()){if(this.iteratePath=!1,this._firstCurve){for(this._firstCurve.nextPath();this._firstCurve.nextPoint();)i.pushXY(this._firstCurve.x,this._firstCurve.y);this._firstCurve=null}}else t=this._pattern.nextValue(),!this._walker.nextPosition(t)||this._walker.isPathEnd()?(this.iteratePath=!1,this._firstCurve&&(i.pushCursor(this._firstCurve),this._firstCurve=null)):this.iteratePath=!0;else this.iteratePath=!1,i=this._firstCurve,this._firstCurve=null;return i?.reset(),i}}let C=(()=>{class g{static local(){return null===g.instance&&(g.instance=new g),g.instance}execute(t,i,f,l,o,m){return new L(t,i,f,l,o,m)}}return g.instance=null,g})();class L{constructor(e,t,i,f,l,o){this._inputGeometries=e,this._tileKey=f,this._geometryEngine=l,this._maxInflateSize=o*i,this._width=(void 0!==t.width?t.width:2)*i,this._option=t.option}next(){let e;for(;e=this._inputGeometries.next();){if("esriGeometryEnvelope"===e.geometryType&&this._width>0){const t=e.asJSON();return Math.min(t.xmax-t.xmin,t.ymax-t.ymin)-2*this._width<0?e:ft.z.fromJSONCIM({paths:[[[t.xmin+this._width,t.ymin+this._width],[t.xmax-this._width,t.ymin+this._width],[t.xmax-this._width,t.ymax-this._width],[t.xmin+this._width,t.ymax-this._width],[t.xmin+this._width,t.ymin+this._width]],[[t.xmin,t.ymin],[t.xmin,t.ymax],[t.xmax,t.ymax],[t.xmax,t.ymin],[t.xmin,t.ymin]]]})}if("esriGeometryPolygon"===e.geometryType){if(0===this._width)return e.clone();const t=this._geometryEngine;if(null==t)return null;const i=this._tileKey?(0,ut.L)(e,this._maxInflateSize):e.clone();if(!i)continue;const f=t.buffer(st.Z.WebMercator,i.asJSON(),-this._width,1);if(f)for(const l of f.rings)l&&i.pushPath(l.reverse());return i}}return null}}let E=(()=>{class g{static local(){return null===g.instance&&(g.instance=new g),g.instance}execute(t,i,f,l,o){return new I(t,i,f)}}return g.instance=null,g})();class I extends W{constructor(e,t,i){super(e,!1,!0),this._curveHelper=new ht,this._length=(void 0!==t.length?t.length:20)*i,this._angle=void 0!==t.angle?t.angle:225,this._position=void 0!==t.position?t.position:50,this._length<0&&(this._length=-this._length),this._position<20&&(this._position=20),this._position>80&&(this._position=80),this._mirror=!1}processPath(e){const t=ft.z.createEmptyOptimizedCIM("esriGeometryPolyline");if(this._curveHelper.isEmpty(e))return null;e.seekInPath(0);const i=e.x,f=e.y;e.seekInPath(e.pathSize-1);const l=e.x,o=e.y;this._curveHelper.normalize([l-i,o-f]);const h=i+(l-i)*this._position/100,p=f+(o-f)*this._position/100,v=Math.cos((90-this._angle)/180*Math.PI);let w=Math.sin((90-this._angle)/180*Math.PI);return this._mirror&&(w=-w),this._mirror=!this._mirror,t.pushPath([[i,f],[h-this._length/2*v,p-this._length/2*w],[h+this._length/2*v,p+this._length/2*w],[l,o]]),t}}let A=(()=>{class g{static local(){return null===g.instance&&(g.instance=new g),g.instance}execute(t,i,f,l,o){return new U(t,i,f)}}return g.instance=null,g})();class U{constructor(e,t,i){this._inputGeometries=e,this._offsetX=void 0!==t.offsetX?t.offsetX*i:0,this._offsetY=void 0!==t.offsetY?t.offsetY*i:0}next(){let e=this._inputGeometries.next();for(;e;){if(e.totalSize>0)return this._move(e.clone(),this._offsetX,this._offsetY);e=this._inputGeometries.next()}return null}_move(e,t,i){for(;e.nextPath();)for(;e.nextPoint();)e.x=e.x+t,e.y=e.y+i;return e.reset(),e}}var K=B(91179);let D=(()=>{class g{static local(){return null===g.instance&&(g.instance=new g),g.instance}execute(t,i,f,l,o,m){return new q(t,i,f,l,o,m)}}return g.instance=null,g})();class q{constructor(e,t,i,f,l,o){this._inputGeometries=e,this._tileKey=f,this._geometryEngine=l,this._curveHelper=new ht,this._offset=(t.offset??1)*i,this._method=t.method,this._maxInflateSize=o*i,this._option=t.option,this._offsetFlattenError=X*i}next(){let e;for(;e=this._inputGeometries.next();){if(0===this._offset)return e.clone();if("esriGeometryEnvelope"===e.geometryType){if(this._method===k.id.Rounded&&this._offset>0){const o=(0,ot.l)(e),m=this._curveHelper.offset(o,-this._offset,this._method,4,this._offsetFlattenError);if(m){const h=ft.z.createEmptyOptimizedCIM(e.geometryType);return h.pushPath(m),h}return null}const l=e.asJSON();if((0,K.YX)(l)&&Math.min(l.xmax-l.xmin,l.ymax-l.ymin)+2*this._offset>0)return ft.z.fromJSONCIM({xmin:l.xmin-this._offset,xmax:l.xmax+this._offset,ymin:l.ymin-this._offset,ymax:l.ymax+this._offset})}const t=this._geometryEngine;if(null==t)continue;const i=this._tileKey?(0,ut.L)(e,this._maxInflateSize):e.clone();if(!i)continue;const f=t.offset(st.Z.WebMercator,i.asJSON(),-this._offset,1,this._method,4,this._offsetFlattenError);return f?ft.z.fromJSONCIM(f):null}return null}}let et=(()=>{class g{static local(){return null===g.instance&&(g.instance=new g),g.instance}execute(t,i,f,l,o){return new z(t,i,f)}}return g.instance=null,g})();class z{constructor(e,t,i){this._inputGeometries=e,this._reverse=void 0===t.reverse||t.reverse}next(){let e=this._inputGeometries.next();for(;e;){if(!this._reverse)return e;if("esriGeometryPolyline"===e.geometryType)return s(e.clone());e=this._inputGeometries.next()}return null}}function s(g){for(;g.nextPath();)for(let e=0;e<g.pathSize/2;e++){g.seekInPath(e);const t=g.x,i=g.y;g.seekInPath(g.pathSize-e-1);const f=g.x,l=g.y;g.x=t,g.y=i,g.seekInPath(e),g.x=f,g.y=l}return g.reset(),g}var u=B(32442);let M=(()=>{class g{static local(){return null===g.instance&&(g.instance=new g),g.instance}execute(t,i,f,l,o){return new P(t,i,f)}}return g.instance=null,g})();class P{constructor(e,t,i){this._inputGeometries=e,this._rotateAngle=void 0!==t.angle?t.angle*Math.PI/180:0}next(){let e=this._inputGeometries.next();for(;e;){if(0===this._rotateAngle||"esriGeometryPoint"===e.geometryType)return e;if(e.totalSize>0){const t=(0,u.Cs)(e),i=(t[2]+t[0])/2,f=(t[3]+t[1])/2;return e.reset(),this._rotate(e.clone(),i,f)}e=this._inputGeometries.next()}return null}_rotate(e,t,i){const f=Math.cos(this._rotateAngle),l=Math.sin(this._rotateAngle);for(;e.nextPath();)for(;e.nextPoint();){const o=e.x-t,m=e.y-i;e.x=t+o*f-m*l,e.y=i+o*l+m*f}return e.reset(),e}}let c=(()=>{class g{static local(){return null===g.instance&&(g.instance=new g),g.instance}execute(t,i,f,l,o){return new r(t,i,f)}}return g.instance=null,g})();class r{constructor(e,t,i){this._inputGeometries=e,this._xFactor=void 0!==t.XScaleFactor?t.XScaleFactor:1.15,this._yFactor=void 0!==t.YScaleFactor?t.YScaleFactor:1.15}next(){const e=this._inputGeometries.next();if(e){if(1===this._xFactor&&1===this._yFactor||"esriGeometryPoint"===e.geometryType)return e;if(e.totalSize>0){const t=(0,u.Cs)(e),i=(t[2]+t[0])/2,f=(t[3]+t[1])/2;return e.reset(),this._scaleCursor(e.clone(),i,f)}}return null}_scaleCursor(e,t,i){for(;e.nextPath();)for(;e.nextPoint();)e.x=t+(e.x-t)*this._xFactor,e.y=i+(e.y-i)*this._yFactor;return e.reset(),e}}let n=(()=>{class g{static local(){return null===g.instance&&(g.instance=new g),g.instance}execute(t,i,f,l,o){return new _(t,i,f)}}return g.instance=null,g})();class _{constructor(e,t,i){this._inputGeometries=e,this._height=(void 0!==t.amplitude?t.amplitude:2)*i,this._period=(void 0!==t.period?t.period:3)*i,this._style=t.waveform,this._height<=0&&(this._height=Math.abs(this._height)),this._period<=0&&(this._period=Math.abs(this._period)),this._pattern=new Mt,this._pattern.addValue(this._period),this._pattern.addValue(this._period),this._walker=new J,this._walker.updateTolerance(i)}next(){let e=this._inputGeometries.next();for(;e;){if(0===this._height||0===this._period)return e;const t=this._processGeom(e);if(t)return t;e=this._inputGeometries.next()}return null}_processGeom(e){const t=ft.z.createEmptyOptimizedCIM(e.geometryType);for(;e.nextPath();){t.startPath();const i=e.pathLength();if(this._walker.init(e,this._pattern))switch(this._style){case k.zQ.Sinus:default:this._constructCurve(t,i,!1);break;case k.zQ.Square:this._constructSquare(t,i);break;case k.zQ.Triangle:this._constructTriangle(t,i);break;case k.zQ.Random:this._constructCurve(t,i,!0)}else for(;e.nextPoint();)t.pushXY(e.x,e.y)}return t}_constructCurve(e,t,i){let f=Math.round(t/this._period);0===f&&(f=1);const m=this._period/16,h=1/(16*f+1),p=2*Math.PI*t/(t/f),v=2*Math.PI*Math.random(),w=2*Math.PI*Math.random(),j=2*Math.PI*Math.random(),G=.75-Math.random()/2,Z=.75-Math.random()/2,tt=new rt;this._walker.curPointAndAngle(tt),e.pushPoint(tt.pt);let dt=0;for(;;){if(!this._walker.nextPointAndAngle(m,tt)){e.pushPoint(this._walker.getPathEnd());break}{const zt=dt;let kt;if(dt+=h,i){const Lt=this._height/2*(1+.3*Math.sin(G*p*zt+v));kt=Lt*Math.sin(p*zt+w),kt+=Lt*Math.sin(Z*p*zt+j),kt/=2}else kt=.5*this._height*Math.sin(.5*p*zt);e.pushXY(tt.pt[0]-kt*tt.sa,tt.pt[1]+kt*tt.ca)}}}_constructSquare(e,t){Math.round(t/this._period);let i=!0;for(;;){let f=!1;if(this._walker.curPositionIsValid()){const l=new rt;this._walker.curPointAndAngle(l);const o=new rt;if(this._walker.nextPointAndAngle(this._period,o)){const m=new rt;this._walker.nextPointAndAngle(this._period,m)&&(i?(e.pushPoint(l.pt),i=!1):e.pushPoint(l.pt),e.pushXY(l.pt[0]-this._height/2*l.sa,l.pt[1]+this._height/2*l.ca),e.pushXY(o.pt[0]-this._height/2*o.sa,o.pt[1]+this._height/2*o.ca),e.pushXY(o.pt[0]+this._height/2*o.sa,o.pt[1]-this._height/2*o.ca),e.pushXY(m.pt[0]+this._height/2*m.sa,m.pt[1]-this._height/2*m.ca),f=!0)}}if(!f){e.pushPoint(this._walker.getPathEnd());break}}}_constructTriangle(e,t){Math.round(t/this._period);let i=!0;for(;;){let f=!1;if(this._walker.curPositionIsValid()){const l=new rt;this._walker.curPointAndAngle(l);const o=new rt;if(this._walker.nextPointAndAngle(this._period/2,o)){const m=new rt;this._walker.nextPointAndAngle(this._period,m)&&(this._walker.nextPosition(this._period/2)&&(i?(e.pushPoint(l.pt),i=!1):e.pushPoint(l.pt),e.pushXY(o.pt[0]-this._height/2*o.sa,o.pt[1]+this._height/2*o.ca),e.pushXY(m.pt[0]+this._height/2*m.sa,m.pt[1]-this._height/2*m.ca)),f=!0)}}if(!f){e.pushPoint(this._walker.getPathEnd());break}}}}let d=(()=>{class g{static local(){return null===g.instance&&(g.instance=new g),g.instance}execute(t,i,f,l,o){return new y(t,i,f)}}return g.instance=null,g})();class y extends Q{constructor(e,t,i){super(e),this._geometryWalker=new J,this._geometryWalker.updateTolerance(i),this._angleToLine=t.angleToLine??!0,this._offset=(t.offset?t.offset:0)*i,this._originalEndings=t.endings,this._offsetAtEnd=(t.customEndingOffset?t.customEndingOffset:0)*i,this._position=-(t.offsetAlongLine?t.offsetAlongLine:0)*i,this._pattern=new Mt,this._pattern.init(t.placementTemplate,!1),this._pattern.scale(i),this._endings=this._originalEndings}processPath(e){if(this._pattern.isEmpty())return null;let t;if(this.iteratePath)t=this._pattern.nextValue();else{this._endings=this._originalEndings===k.JS.WithFullGap&&this.isClosed?k.JS.WithMarkers:this._originalEndings,this._pattern.extPtGap=0;let f,l=!0;switch(this._endings){case k.JS.NoConstraint:f=-this._position,f=this._adjustPosition(f),l=!1;break;case k.JS.WithHalfGap:default:f=-this._pattern.lastValue()/2;break;case k.JS.WithFullGap:f=-this._pattern.lastValue(),this._pattern.extPtGap=this._pattern.lastValue();break;case k.JS.WithMarkers:f=0;break;case k.JS.Custom:f=-this._position,f=this._adjustPosition(f),this._pattern.extPtGap=.5*this._offsetAtEnd}if(!this._geometryWalker.init(e,this._pattern,l))return null;this._pattern.reset();let o=0;for(;f>o;)f-=o,o=this._pattern.nextValue();o-=f,t=o,this.iteratePath=!0}const i=new rt;return this._geometryWalker.nextPointAndAngle(t,i)?this._endings===k.JS.WithFullGap&&this._geometryWalker.isPathEnd()?(this.iteratePath=!1,null):this._endings===k.JS.WithMarkers&&this._geometryWalker.isPathEnd()&&(this.iteratePath=!1,this.isClosed)?null:(this.internalPlacement.setTranslate(i.pt[0]-this._offset*i.sa,i.pt[1]+this._offset*i.ca),this._angleToLine&&this.internalPlacement.setRotateCS(i.ca,i.sa),this.internalPlacement):(this.iteratePath=!1,null)}_adjustPosition(e){let t=e/this._pattern.length();return t-=Math.floor(t),t*this._pattern.length()}}let S=(()=>{class g{static local(){return null===g.instance&&(g.instance=new g),g.instance}execute(t,i,f,l,o){return new O(t,i,f)}}return g.instance=null,g})();class O extends Q{constructor(e,t,i){super(e,!1,!0),this._curveHelper=new ht,this._angleToLine=void 0===t.angleToLine||t.angleToLine,this._offset=void 0!==t.offset?t.offset*i:0,this._type=t.extremityPlacement,this._position=void 0!==t.offsetAlongLine?t.offsetAlongLine*i:0,this._beginProcessed=!1}processPath(e){let t;switch(this._type){case k.Tx.Both:default:this._beginProcessed?(t=this._atExtremities(e,this._position,!1),this._beginProcessed=!1,this.iteratePath=!1):(t=this._atExtremities(e,this._position,!0),this._beginProcessed=!0,this.iteratePath=!0);break;case k.Tx.JustBegin:t=this._atExtremities(e,this._position,!0);break;case k.Tx.JustEnd:t=this._atExtremities(e,this._position,!1);case k.Tx.None:}return t}_atExtremities(e,t,i){if(i||e.seekPathEnd(),i?e.nextPoint():e.prevPoint()){let f=0,[l,o]=[0,0],[m,h]=[e.x,e.y];for(;i?e.nextPoint():e.prevPoint();){l=m,o=h,m=e.x,h=e.y;const p=this._curveHelper.getLength(l,o,m,h);if(f+p>t){const v=(t-f)/p,[w,j]=this._curveHelper.getAngleCS(l,o,m,h,v),G=this._curveHelper.getCoord2D(l,o,m,h,v);return this.internalPlacement.setTranslate(G[0]-this._offset*j,G[1]+this._offset*w),this._angleToLine&&this.internalPlacement.setRotateCS(-w,-j),this.internalPlacement}f+=p}}return null}}let x=(()=>{class g{static local(){return null===g.instance&&(g.instance=new g),g.instance}execute(t,i,f,l,o){return new Y(t,i,f)}}return g.instance=null,g})();class Y extends Q{constructor(e,t,i){super(e),this._walker=new J,this._walker.updateTolerance(i),this._angleToLine=void 0===t.angleToLine||t.angleToLine,this._offset=void 0!==t.offset?t.offset*i:0,this._beginGap=void 0!==t.beginPosition?t.beginPosition*i:0,this._endGap=void 0!==t.endPosition?t.endPosition*i:0,this._flipFirst=void 0===t.flipFirst||t.flipFirst,this._pattern=new Mt,this._pattern.init(t.positionArray,!1,!1),this._subPathLen=0,this._posCount=this._pattern.size(),this._isFirst=!0,this._prevPos=0}processPath(e){if(this._pattern.isEmpty())return null;let t;if(this.iteratePath){const m=this._pattern.nextValue()*this._subPathLen,h=this._beginGap+m;t=h-this._prevPos,this._prevPos=h}else{if(this._posCount=this._pattern.size(),this._isFirst=!0,this._prevPos=0,this._subPathLen=e.pathLength()-this._beginGap-this._endGap,this._subPathLen<0)return this.iteratePath=!1,null;if(!this._walker.init(e,this._pattern,!1))return null;this._pattern.reset();const m=this._pattern.nextValue()*this._subPathLen,h=this._beginGap+m;t=h-this._prevPos,this._prevPos=h,this.iteratePath=!0}const i=new rt;if(!this._walker.nextPointAndAngle(t,i,H.END))return this.iteratePath=!1,null;let l,o;return this.internalPlacement.setTranslate(i.pt[0]-this._offset*i.sa,i.pt[1]+this._offset*i.ca),this._angleToLine?(l=i.ca,o=i.sa):(l=1,o=0),this._isFirst&&this._flipFirst&&(l=-l,o=-o),this.internalPlacement.setRotateCS(l,o),this._isFirst=!1,this._posCount--,0===this._posCount&&(this.iteratePath=!1),this.internalPlacement}}var R=B(4619);const $=512,mt=1e-6;let lt=(()=>{class g{static local(){return null===g.instance&&(g.instance=new g),g.instance}execute(t,i,f,l,o){return new gt(t,i,f,l,o)}}return g.instance=null,g})();class gt{constructor(e,t,i,f,l){if(this._xMin=0,this._xMax=0,this._yMin=0,this._yMax=0,this._currentX=0,this._currentY=0,this._accelerationMap=null,this._testInsidePolygon=!1,this._verticalSubdivision=!0,this._stepX=Math.abs(t.stepX??16)*i,this._stepY=Math.abs(t.stepY??16)*i,this._stepX=Math.round(128*this._stepX)/128,this._stepY=Math.round(128*this._stepY)/128,0!==this._stepX&&0!==this._stepY){if(this._gridType=t.gridType??k.bj.Fixed,this._gridType===k.bj.Random)this._randomLCG=new R.Z(1*(t.seed??13)),this._randomness=(t.randomness??100)/100,this._gridAngle=0,this._shiftOddRows=!1,this._cosAngle=1,this._sinAngle=0,this._offsetX=0,this._offsetY=0,this._buildRandomValues();else{if(this._randomness=0,this._gridAngle=t.gridAngle??0,this._shiftOddRows=t.shiftOddRows??!1,this._offsetX=(t.offsetX??0)*i,this._offsetY=(t.offsetY??0)*i,this._cosAngle=Math.cos(this._gridAngle/180*Math.PI),this._sinAngle=-Math.sin(this._gridAngle/180*Math.PI),this._stepX)if(this._offsetX<0)for(;this._offsetX<-.5*this._stepX;)this._offsetX+=this._stepX;else for(;this._offsetX>=.5*this._stepX;)this._offsetX-=this._stepX;if(this._stepY)if(this._offsetY<0)for(;this._offsetY<-.5*this._stepY;)this._offsetY+=this._stepY;else for(;this._offsetY>=.5*this._stepY;)this._offsetY-=this._stepY}if(this._graphicOriginX=0,this._graphicOriginY=0,null!=f){const[o,m,h,p]=f.split("/"),v=parseFloat(o),w=parseFloat(m),j=parseFloat(h),G=parseFloat(p);this._graphicOriginX=-(G*2**v+j)*$,this._graphicOriginY=w*$,this._testInsidePolygon=!0}this._internalPlacement=new xt.u,this._calculateMinMax(e),this._geometryCursor=e}}next(){return this._geometryCursor?this._nextInside():null}_buildRandomValues(){if(!gt._randValues){gt._randValues=[];for(let e=0;e<24;e++)for(let t=0;t<24;t++)gt._randValues.push(this._randomLCG.getFloat()),gt._randValues.push(this._randomLCG.getFloat())}}_calculateMinMax(e){let t,i,f,l,o,m,h,p,v,w,j,G,Z,tt;this._xMin=0,this._xMax=0,this._yMin=0,this._yMax=0,h=p=Z=j=Number.MAX_VALUE,v=w=tt=G=-Number.MAX_VALUE;const dt=1!==this._cosAngle;for(e.reset();e.nextPath();)for(;e.nextPoint();)m=e.x,o=e.y,t=m-this._graphicOriginX-this._offsetX,i=o-this._graphicOriginY-this._offsetY,dt?(f=this._cosAngle*t-this._sinAngle*i,l=this._sinAngle*t+this._cosAngle*i):(f=t,l=i),h=Math.min(h,f),v=Math.max(v,f),p=Math.min(p,l),w=Math.max(w,l),j=Math.min(j,o),G=Math.max(G,o),Z=Math.min(Z,m),tt=Math.max(tt,m);if(j=j!==Number.MAX_VALUE?j:-$-this._stepY,G=G!==-Number.MAX_VALUE?G:this._stepY,Z=Z!==Number.MAX_VALUE?Z:-this._stepX,tt=tt!==-Number.MAX_VALUE?tt:$+this._stepX,this._verticalSubdivision=G-j>=tt-Z,this._polygonMin=this._verticalSubdivision?j:Z,this._testInsidePolygon){let Lt=0-this._graphicOriginX-this._offsetX-this._stepX,St=$-this._graphicOriginX-this._offsetX+this._stepX,Wt=-$-this._graphicOriginY-this._offsetY-this._stepY,Yt=0-this._graphicOriginY-this._offsetY+this._stepY;if(dt){const se=[[Lt,Wt],[Lt,Yt],[St,Wt],[St,Yt]];Lt=Wt=Number.MAX_VALUE,St=Yt=-Number.MAX_VALUE;for(const Zt of se){const Qt=this._cosAngle*Zt[0]-this._sinAngle*Zt[1],qt=this._sinAngle*Zt[0]+this._cosAngle*Zt[1];Lt=Math.min(Lt,Qt),St=Math.max(St,Qt),Wt=Math.min(Wt,qt),Yt=Math.max(Yt,qt)}}h=h!==Number.MAX_VALUE?Math.max(h,Lt):Lt,p=p!==Number.MAX_VALUE?Math.max(p,Wt):Wt,v=v!==-Number.MAX_VALUE?Math.min(v,St):St,w=w!==-Number.MAX_VALUE?Math.min(w,Yt):Yt}this._xMin=Math.round(h/this._stepX),this._xMax=Math.round(v/this._stepX),this._yMin=Math.round(p/this._stepY),this._yMax=Math.round(w/this._stepY),this._currentX=this._xMax+1,this._currentY=this._yMin-1,this._buildAccelerationMap(e,Z,tt,j,G)}_buildAccelerationMap(e,t,i,f,l){e.reset();const o=new Map,m=this._verticalSubdivision,h=m?l-f:i-t;let p=Math.ceil(h/10);if(p<=1)return;const v=Math.floor(h/p);let w,j,G,Z,tt,dt,zt,kt,Lt,St,Wt;for(p++,this._delta=v,m?(Lt=-$-this._stepY,St=this._stepY,Wt=f):(Lt=-this._stepX,St=$+this._stepX,Wt=t);e.nextPath();)if(!(e.pathSize<2)&&e.nextPoint())for(w=e.x,j=e.y;e.nextPoint();w=G,j=Z){if(G=e.x,Z=e.y,m){if(j===Z||j<Lt&&Z<Lt||j>St&&Z>St)continue;tt=Math.min(j,Z),dt=Math.max(j,Z)}else{if(w===G||w<Lt&&G<Lt||w>St&&G>St)continue;tt=Math.min(w,G),dt=Math.max(w,G)}for(;tt<dt;)zt=Math.floor((tt-Wt)/v),vt(zt,w,j,G,Z,o),tt+=v;kt=Math.floor((dt-Wt)/v),kt>zt&&vt(kt,w,j,G,Z,o)}this._accelerationMap=o}_nextInside(){for(;;){if(this._currentX>this._xMax){if(this._currentY++,this._currentY>this._yMax)return null;this._currentX=this._xMin,this._shiftOddRows&&this._currentY%2&&this._currentX--}let e=this._currentX*this._stepX+this._offsetX;this._shiftOddRows&&this._currentY%2&&(e+=.5*this._stepX);const t=this._currentY*this._stepY+this._offsetY;let i,f;if(this._currentX++,this._gridType===k.bj.Random){const l=(this._currentX%24+24)%24,o=(this._currentY%24+24)%24;i=this._graphicOriginX+e+this._stepX*this._randomness*(.5-gt._randValues[24*o+l])*2/3,f=this._graphicOriginY+t+this._stepY*this._randomness*(.5-gt._randValues[24*o+l+1])*2/3}else i=this._graphicOriginX+this._cosAngle*e+this._sinAngle*t,f=this._graphicOriginY-this._sinAngle*e+this._cosAngle*t;if(!this._testInsidePolygon||this._isInsidePolygon(i,f,this._geometryCursor))return this._internalPlacement.setTranslate(i,f),this._internalPlacement}}_isInsidePolygon(e,t,i){if(null==this._accelerationMap)return function It(g,e,t){let i,f,l,o,m=0;for(g+=mt,e+=mt,t.reset();t.nextPath();)if(t.nextPoint())for(i=t.x,f=t.y;t.nextPoint();i=l,f=o)l=t.x,o=t.y,f>e!=o>e&&((l-i)*(e-f)-(o-f)*(g-i)>0?m++:m--);return 0!==m}(e,t,i);e+=mt,t+=mt;const f=this._verticalSubdivision,o=Math.floor(((f?t:e)-this._polygonMin)/this._delta),m=this._accelerationMap.get(o);if(!m)return!1;let h,p,v,w=0;for(const j of m){if(h=j[0],p=j[1],f){if(h[1]>t==p[1]>t)continue;v=(p[0]-h[0])*(t-h[1])-(p[1]-h[1])*(e-h[0])}else{if(h[0]>e==p[0]>e)continue;v=(p[1]-h[1])*(e-h[0])-(p[0]-h[0])*(t-h[1])}v>0?w++:w--}return 0!==w}}function vt(g,e,t,i,f,l){let o=l.get(g);o||(o=[],l.set(g,o)),o.push([[e,t],[i,f]])}let Gt=(()=>{class g{static local(){return null===g.instance&&(g.instance=new g),g.instance}execute(t,i,f,l,o){return new Bt(t,i,f)}}return g.instance=null,g})();class Bt extends Q{constructor(e,t,i){super(e),this._curveHelper=new ht,this._angleToLine=void 0===t.angleToLine||t.angleToLine,this._offset=void 0!==t.offset?t.offset*i:0,this._relativeTo=t.relativeTo,this._position=void 0!==t.startPointOffset?t.startPointOffset*i:0,this._epsilon=.001*i}processPath(e){const t=this._position;if(this._relativeTo===k.CS.SegmentMidpoint){if(this.iteratePath||(this.iteratePath=!0),e.nextPoint()){let[f,l]=[e.x,e.y],[o,m]=[0,0];for(;e.nextPoint();){o=e.x,m=e.y;const h=this._curveHelper.getLength(f,l,o,m);if(h<this._epsilon){f=o,l=m;continue}const p=.5+this._position/h,[v,w]=this._curveHelper.getAngleCS(f,l,o,m,p),j=this._curveHelper.getCoord2D(f,l,o,m,p);return this.internalPlacement.setTranslate(j[0]-this._offset*w,j[1]+this._offset*v),this._angleToLine&&this.internalPlacement.setRotateCS(v,w),this.internalPlacement}}return this.iteratePath=!1,null}return this.onLine(e,t,this._relativeTo===k.CS.LineEnd)}onLine(e,t,i){let f,l=!1;switch(this._relativeTo){case k.CS.LineMiddle:default:e.seekPathStart(),f=e.pathLength()/2+t;break;case k.CS.LineBeginning:f=t;break;case k.CS.LineEnd:f=t,l=!0}i?e.seekPathEnd():e.seekPathStart();let o=0;if(i?e.prevPoint():e.nextPoint()){let[m,h]=[e.x,e.y],[p,v]=[0,0];for(;i?e.prevPoint():e.nextPoint();){p=e.x,v=e.y;const w=this._curveHelper.getLength(m,h,p,v);if(o+w>f){const j=(f-o)/w,[G,Z]=this._curveHelper.getAngleCS(m,h,p,v,j),tt=this._curveHelper.getCoord2D(m,h,p,v,j),dt=l?-this._offset:this._offset;return this.internalPlacement.setTranslate(tt[0]-dt*Z,tt[1]+dt*G),this._angleToLine&&(l?this.internalPlacement.setRotateCS(-G,-Z):this.internalPlacement.setRotateCS(G,Z)),this.internalPlacement}m=p,h=v,o+=w}}return null}}const Xt=1e-15;let Rt=(()=>{class g{static local(){return null===g.instance&&(g.instance=new g),g.instance}execute(t,i,f,l,o){return new jt(t,i,f)}}return g.instance=null,g})();class jt extends Q{constructor(e,t,i){super(e),this._curveHelper=new ht,this._angleToLine=void 0===t.angleToLine||t.angleToLine,this._offset=void 0!==t.offset?t.offset*i:0,this._endPoints=void 0===t.placeOnEndPoints||t.placeOnEndPoints,this._controlPoints=void 0===t.placeOnControlPoints||t.placeOnControlPoints,this._regularVertices=void 0===t.placeOnRegularVertices||t.placeOnRegularVertices,this._tags=[],this._tagIterator=0}processPath(e){if(this.iteratePath||(this._preparePath(e),this.iteratePath=!0),this._tagIterator>=this._tags.length)return this._tags.length=0,this._tagIterator=0,this.iteratePath=!1,null;const t=this._tags[this._tagIterator];this._angleToLine&&this.internalPlacement.setRotate(t[2]);let i=t[0],f=t[1];if(0!==this._offset){const l=Math.cos(t[2]),o=Math.sin(t[2]);i-=this._offset*o,f+=this._offset*l}return this.internalPlacement.setTranslate(i,f),this._tagIterator++,this.internalPlacement}_preparePath(e){this._tags.length=0,this._tagIterator=0,e.seekPathStart();const t=e.isClosed();let i=0,f=!1,l=0,o=0;if(e.seekPathStart(),e.nextPoint()){let m=e.x,h=e.y,p=e.getControlPoint(),v=!0,w=e.nextPoint();for(;w;){const j=e.x,G=e.y,Z=e.getControlPoint();(this._angleToLine||0!==this._offset)&&(l=this._curveHelper.getAngle(m,h,j,G,0)),v?(v=!1,t?(i=l,f=p):(this._endPoints||this._controlPoints&&p)&&this._tags.push([m,h,l])):p?this._controlPoints&&this._tags.push([m,h,Vt(o,l)]):this._regularVertices&&this._tags.push([m,h,Vt(o,l)]),(this._angleToLine||0!==this._offset)&&(o=this._curveHelper.getAngle(m,h,j,G,1)),w=e.nextPoint(),w||(t?Z||f?this._controlPoints&&this._tags.push([j,G,Vt(o,i)]):this._regularVertices&&this._tags.push([j,G,Vt(o,i)]):(this._endPoints||this._controlPoints&&Z)&&this._tags.push([j,G,o])),m=j,h=G,p=Z}}this._tagIterator=0}}function Vt(g,e){const t=Math.PI;for(;Math.abs(e-g)>t+2*Xt;)e-g>t?e-=2*t:e+=2*t;return(g+e)/2}var $t=B(27105),Ht=B(21164);let Kt=(()=>{class g{static local(){return null===g.instance&&(g.instance=new g),g.instance}execute(t,i,f,l,o){return new Jt(t,i,f)}}return g.instance=null,g})();class Jt{constructor(e,t,i){this._geometryCursor=e,this._offsetX=void 0!==t.offsetX?t.offsetX*i:0,this._offsetY=void 0!==t.offsetY?t.offsetY*i:0,this._method=void 0!==t.method?t.method:k.Lh.OnPolygon,this._internalPlacement=new xt.u}next(){const e=this._geometryCursor;return this._geometryCursor=null,e?this._polygonCenter(e):null}_polygonCenter(e){let t=!1;switch(this._method){case k.Lh.CenterOfMass:{const i=(0,$t.NA)(e);i&&(this._internalPlacement.setTranslate(i[0]+this._offsetX,i[1]+this._offsetY),t=!0)}break;case k.Lh.BoundingBoxCenter:{const i=(0,u.Cs)(e);i&&(this._internalPlacement.setTranslate((i[2]+i[0])/2+this._offsetX,(i[3]+i[1])/2+this._offsetY),t=!0)}break;default:{const i=(0,Ht.r)(e);null!==i&&(this._internalPlacement.setTranslate(i[0]+this._offsetX,i[1]+this._offsetY),t=!0)}}return t?this._internalPlacement:null}}function te(g){if(!g)return null;switch(g.type){case"CIMGeometricEffectAddControlPoints":return Tt.local();case"CIMGeometricEffectArrow":return N.local();case"CIMGeometricEffectBuffer":return _t.local();case"CIMGeometricEffectControlMeasureLine":return At.local();case"CIMGeometricEffectCut":return Ot.local();case"CIMGeometricEffectDashes":return T.local();case"CIMGeometricEffectDonut":return C.local();case"CIMGeometricEffectJog":return E.local();case"CIMGeometricEffectMove":return A.local();case"CIMGeometricEffectOffset":return D.local();case"CIMGeometricEffectReverse":return et.local();case"CIMGeometricEffectRotate":return M.local();case"CIMGeometricEffectScale":return c.local();case"CIMGeometricEffectWave":return n.local()}return null}function ee(g){if(!g)return null;switch(g.type){case"CIMMarkerPlacementAlongLineSameSize":return d.local();case"CIMMarkerPlacementAtExtremities":return S.local();case"CIMMarkerPlacementAtRatioPositions":return x.local();case"CIMMarkerPlacementInsidePolygon":return lt.local();case"CIMMarkerPlacementOnLine":return Gt.local();case"CIMMarkerPlacementOnVertices":return Rt.local();case"CIMMarkerPlacementPolygonCenter":return Kt.local()}return null}},97373:(Ut,Ft,B)=>{B.d(Ft,{u:()=>Tt});class Tt{constructor(){this.setIdentity()}getAngle(){return(null==this.rz||0===this.rz&&1!==this.rzCos&&0!==this.rzSin)&&(this.rz=Math.atan2(this.rzSin,this.rzCos)),this.rz}setIdentity(){this.tx=0,this.ty=0,this.tz=0,this.s=1,this.rx=0,this.ry=0,this.rz=0,this.rzCos=1,this.rzSin=0}setTranslate(ot,xt){this.tx=ot,this.ty=xt}setTranslateZ(ot){this.tz=ot}setRotateCS(ot,xt){this.rz=void 0,this.rzCos=ot,this.rzSin=xt}setRotate(ot){this.rz=ot,this.rzCos=void 0,this.rzSin=void 0}setRotateY(ot){this.ry=ot}setScale(ot){this.s=ot}setMeasure(ot){this.m=ot}}},26933:(Ut,Ft,B)=>{B.d(Ft,{cD:()=>L,uQ:()=>a,Tu:()=>C,zA:()=>J,rC:()=>rt,w7:()=>bt,v$:()=>Mt,KM:()=>wt,zV:()=>H,x1:()=>A,et:()=>K,g:()=>U});var Tt=B(986),Ct=B(17002),ft=B(58817),ot=B(63290),xt=B(27899),Nt=B(23841),nt=B(33359),Q=B(65401),W=B(32442),k=B(27105),X=B(91179),ht=B(29214);class pt{applyColorSubstituition(s,u){if(!u)return s;this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas"));const{width:M,height:P}=s,c=this._rasterizationCanvas,r=c.getContext("2d",{willReadFrequently:!0});s!==c&&(c.width=M,c.height=P,r.drawImage(s,0,0,M,P));const n=r.getImageData(0,0,M,P).data;if(u)for(const d of u)if(d&&d.oldColor&&4===d.oldColor.length&&d.newColor&&4===d.newColor.length){const[y,S,O,x]=d.oldColor,[Y,R,$,at]=d.newColor;if(y===Y&&S===R&&O===$&&x===at)continue;for(let it=0;it<n.length;it+=4)y===n[it]&&S===n[it+1]&&O===n[it+2]&&x===n[it+3]&&(n[it]=Y,n[it+1]=R,n[it+2]=$,n[it+3]=at)}const _=new ImageData(n,M,P);return r.putImageData(_,0,0),c}tintImageData(s,u){if(!u||u.length<4)return s;this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas"));const{width:M,height:P}=s,c=this._rasterizationCanvas,r=c.getContext("2d",{willReadFrequently:!0});s!==c&&(c.width=M,c.height=P,r.drawImage(s,0,0,M,P));const n=r.getImageData(0,0,M,P),_=new Uint8Array(n.data),d=[u[0]/255,u[1]/255,u[2]/255,u[3]/255];for(let S=0;S<_.length;S+=4)_[S]*=d[0],_[S+1]*=d[1],_[S+2]*=d[2],_[S+3]*=d[3];const y=new ImageData(new Uint8ClampedArray(_.buffer),M,P);return r.putImageData(y,0,0),c}}var Pt=B(43080),F=B(97373),N=B(7547);function b(z){const s=z.getFrame(0);if(s instanceof HTMLImageElement||s instanceof HTMLCanvasElement)return s;const u=document.createElement("canvas");u.width=z.width,u.height=z.height;const M=u.getContext("2d");return s instanceof ImageData?M.putImageData(s,0,0):M.drawImage(s,0,0),u}var ct=B(31375),ut=B(68937),st=B(80991),_t=B(61261),Et=B(39351),At=B(25797);const yt=Math.PI/180,Ot=ot.Z.getLogger("esri.symbols.cim.CIMSymbolDrawHelper"),wt=4,bt=10,Mt=10,rt=4,H=10;class J{constructor(s){this._t=s}static createIdentity(){return new J([1,0,0,0,1,0])}clone(){return new J(this._t.slice())}transform(s){const u=this._t;return[u[0]*s[0]+u[1]*s[1]+u[2],u[3]*s[0]+u[4]*s[1]+u[5]]}static createScale(s,u){return new J([s,0,0,0,u,0])}scale(s,u){const M=this._t;return M[0]*=s,M[1]*=s,M[2]*=s,M[3]*=u,M[4]*=u,M[5]*=u,this}scaleRatio(){return Math.sqrt(this._t[0]*this._t[0]+this._t[1]*this._t[1])}static createTranslate(s,u){return new J([0,0,s,0,0,u])}translate(s,u){const M=this._t;return M[2]+=s,M[5]+=u,this}static createRotate(s){const u=Math.cos(s),M=Math.sin(s);return new J([u,-M,0,M,u,0])}rotate(s){return J.multiply(this,J.createRotate(s),this)}angle(){const s=this._t[0],u=this._t[3],M=Math.sqrt(s*s+u*u);return[s/M,u/M]}static multiply(s,u,M){const P=s._t,c=u._t,n=P[1]*c[0]+P[4]*c[1],_=P[2]*c[0]+P[5]*c[1]+c[2],d=P[0]*c[3]+P[3]*c[4],y=P[1]*c[3]+P[4]*c[4],S=P[2]*c[3]+P[5]*c[4]+c[5],O=M._t;return O[0]=P[0]*c[0]+P[3]*c[1],O[1]=n,O[2]=_,O[3]=d,O[4]=y,O[5]=S,M}invert(){const s=this._t;let u=s[0]*s[4]-s[1]*s[3];return 0===u?new J([0,0,0,0,0,0]):(u=1/u,new J([s[4]*u,-s[1]*u,(s[1]*s[5]-s[2]*s[4])*u,-s[3]*u,s[0]*u,(s[2]*s[3]-s[0]*s[5])*u]))}}class T{constructor(s,u){this._resourceManager=s,this._transfos=[],this._sizeTransfos=[],this._geomUnitsPerPoint=1,this._placementPool=new xt.Z(F.u,void 0,void 0,100),this._earlyReturn=!1,this._mapRotation=0,this._transfos.push(u||J.createIdentity()),this._sizeTransfos.push(u?u.scaleRatio():1)}setTransform(s,u){this._transfos=[s||J.createIdentity()],this._sizeTransfos=[u||(s?s.scaleRatio():1)]}setGeomUnitsPerPoint(s){this._geomUnitsPerPoint=s}transformPt(s){return this._transfos[this._transfos.length-1].transform(s)}transformSize(s){return s*this._sizeTransfos[this._sizeTransfos.length-1]}reverseTransformPt(s){return this._transfos[this._transfos.length-1].invert().transform(s)}reverseTransformSize(s){return s/this._sizeTransfos[this._sizeTransfos.length-1]}getTransformAngle(){return this._transfos[this._transfos.length-1].angle()}geomUnitsPerPoint(){return this.isEmbedded()?1:this._geomUnitsPerPoint}isEmbedded(){return this._transfos.length>1}back(){return this._transfos[this._transfos.length-1]}push(s,u){const M=u?s.scaleRatio():1;J.multiply(s,this.back(),s),this._transfos.push(s),this._sizeTransfos.push(this._sizeTransfos[this._sizeTransfos.length-1]*M)}pop(){this._transfos.splice(-1,1),this._sizeTransfos.splice(-1,1)}drawSymbol(s,u,M){if(s)switch(s.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":this.drawMultiLayerSymbol(s,u);break;case"CIMTextSymbol":this.drawTextSymbol(s,u,M)}}drawMultiLayerSymbol(s,u){if(!s||!u)return;const M=s.symbolLayers;if(!M)return;const P=s.effects;if(P&&P.length>0){const c=this.executeEffects(P,u);if(c){let r=c.next();for(;r;)this.drawSymbolLayers(M,r.asJSON()),r=c.next()}}else this.drawSymbolLayers(M,u)}executeEffects(s,u){const M=this._resourceManager.geometryEngine;let P=new ht.z(nt.z.fromJSONCIM(u));for(const c of s){const r=(0,Pt.h)(c);r&&(P=r.execute(P,c,this.geomUnitsPerPoint(),null,M))}return P}drawSymbolLayers(s,u){let M=s.length;for(;M--;){const P=s[M];if(!P||!1===P.enable)continue;const c=P.effects;if(c&&c.length>0){const r=this.executeEffects(c,u);if(r){let n=null;for(;(n=r.next())&&(this.drawSymbolLayer(P,n.asJSON()),!this._earlyReturn););}}else this.drawSymbolLayer(P,u);if(this._earlyReturn)return}}drawSymbolLayer(s,u){switch(s.type){case"CIMSolidFill":this.drawSolidFill(u,s.color);break;case"CIMHatchFill":this.drawHatchFill(u,s);break;case"CIMPictureFill":this.drawPictureFill(u,s);break;case"CIMGradientFill":this.drawGradientFill(u,s);break;case"CIMSolidStroke":this.drawSolidStroke(u,s.color,s.width,s.capStyle,s.joinStyle,s.miterLimit);break;case"CIMPictureStroke":this.drawPictureStroke(u,s);break;case"CIMGradientStroke":this.drawGradientStroke(u,s);break;case"CIMCharacterMarker":case"CIMPictureMarker":case"CIMVectorMarker":this.drawMarkerLayer(s,u)}}drawHatchFill(s,u){const M=this._buildHatchPolyline(u,s,this.geomUnitsPerPoint());M&&(this.pushClipPath(s),this.drawMultiLayerSymbol(u.lineSymbol,M),this.popClipPath())}drawPictureFill(s,u){}drawGradientFill(s,u){}drawPictureStroke(s,u){}drawGradientStroke(s,u){}drawMarkerLayer(s,u){const M=s.markerPlacement;if(M){const P=(0,Pt.W)(M);if(P){const c="CIMMarkerPlacementInsidePolygon"===M.type||"CIMMarkerPlacementPolygonCenter"===M.type&&M.clipAtBoundary;c&&this.pushClipPath(u);const r=P.execute(nt.z.fromJSONCIM(u),M,this.geomUnitsPerPoint(),null,this._resourceManager.geometryEngine);if(r){let n=null;for(;(n=r.next())&&(this.drawMarker(s,n),!this._earlyReturn););}c&&this.popClipPath()}}else{const P=this._placementPool.acquire();if((0,X.wp)(u))P.tx=u.x,P.ty=u.y,this.drawMarker(s,P);else if((0,X.oU)(u)){const c=(0,k.tO)(u);c&&([P.tx,P.ty]=c,this.drawMarker(s,P))}else for(const c of u.points)if(P.tx=c[0],P.ty=c[1],this.drawMarker(s,P),this._earlyReturn)break;this._placementPool.release(P)}}drawMarker(s,u){switch(s.type){case"CIMCharacterMarker":case"CIMPictureMarker":this.drawPictureMarker(s,u);break;case"CIMVectorMarker":this.drawVectorMarker(s,u)}}drawPictureMarker(s,u){if(!s)return;const M=this._resourceManager.getResource(s.url),P=(0,st.NA)(s.size,bt);if(null==M||P<=0)return;const c=M.width,r=M.height;if(!c||!r)return;const n=c/r,_=(0,st.NA)(s.scaleX,1),d=J.createIdentity(),y=s.anchorPoint;if(y){let $=y.x,at=y.y;"Absolute"!==s.anchorPointUnits&&($*=P*n*_,at*=P),d.translate(-$,-at)}let S=(0,st.NA)(s.rotation);s.rotateClockwise&&(S=-S),this._mapRotation&&(S+=this._mapRotation),S&&d.rotate(S*yt);let O=(0,st.NA)(s.offsetX),x=(0,st.NA)(s.offsetY);if(O||x){if(this._mapRotation){const $=yt*this._mapRotation,at=Math.cos($),it=Math.sin($),mt=O*it+x*at;O=O*at-x*it,x=mt}d.translate(O,x)}const Y=this.geomUnitsPerPoint();1!==Y&&d.scale(Y,Y);const R=u.getAngle();R&&d.rotate(R),d.translate(u.tx,u.ty),this.push(d,!1),this.drawImage(s,P),this.pop()}drawVectorMarker(s,u){if(!s)return;const M=s.markerGraphics;if(!M)return;const P=(0,st.NA)(s.size,bt),c=s.frame,r=c?c.ymax-c.ymin:0,n=P&&r?P/r:1,_=J.createIdentity();c&&_.translate(.5*-(c.xmax+c.xmin),.5*-(c.ymax+c.ymin));const d=s.anchorPoint;if(d){let R=d.x,$=d.y;"Absolute"!==s.anchorPointUnits?c&&(R*=c.xmax-c.xmin,$*=c.ymax-c.ymin):(R/=n,$/=n),_.translate(-R,-$)}1!==n&&_.scale(n,n);let y=(0,st.NA)(s.rotation);s.rotateClockwise&&(y=-y),this._mapRotation&&(y+=this._mapRotation),y&&_.rotate(y*yt);let S=(0,st.NA)(s.offsetX),O=(0,st.NA)(s.offsetY);if(S||O){if(this._mapRotation){const R=yt*this._mapRotation,$=Math.cos(R),at=Math.sin(R),it=S*at+O*$;S=S*$-O*at,O=it}_.translate(S,O)}const x=this.geomUnitsPerPoint();1!==x&&_.scale(x,x);const Y=u.getAngle();Y&&_.rotate(Y),_.translate(u.tx,u.ty),this.push(_,s.scaleSymbolsProportionally);for(const R of M)if(R?.symbol&&R.geometry||Ot.error("Invalid marker graphic",R),this.drawSymbol(R.symbol,R.geometry,R.textString),this._earlyReturn)break;this.pop()}drawTextSymbol(s,u,M){if(!s||!(0,X.wp)(u)||(0,st.NA)(s.height,H)<=0)return;const P=J.createIdentity();let c=(0,st.NA)(s.angle);c=-c,c&&P.rotate(c*yt);const r=(0,st.NA)(s.offsetX),n=(0,st.NA)(s.offsetY);(r||n)&&P.translate(r,n);const _=this.geomUnitsPerPoint();1!==_&&P.scale(_,_),P.translate(u.x,u.y),this.push(P,!1),this.drawText(s,M),this.pop()}_buildHatchPolyline(s,u,M){let P=(0,st.NA)(s.separation,rt)*M,c=(0,st.NA)(s.rotation);if(0===P)return null;P<0&&(P=-P);let r=0;const n=.5*P;for(;r>n;)r-=P;for(;r<-n;)r+=P;const _=(0,Q.Ue)();(0,W.$P)(_,u),_[0]-=n,_[1]-=n,_[2]+=n,_[3]+=n;const d=[[_[0],_[1]],[_[0],_[3]],[_[2],_[3]],[_[2],_[1]]];for(;c>180;)c-=180;for(;c<0;)c+=180;const y=Math.cos(c*yt),S=Math.sin(c*yt),O=-P*S,x=P*y;let Y,R,$,at;r=(0,st.NA)(s.offsetX)*M*S-(0,st.NA)(s.offsetY)*M*y,Y=$=Number.MAX_VALUE,R=at=-Number.MAX_VALUE;for(const Dt of d){const Gt=Dt[0],Bt=Dt[1],Xt=y*Gt+S*Bt,Rt=-S*Gt+y*Bt;Y=Math.min(Y,Xt),$=Math.min($,Rt),R=Math.max(R,Xt),at=Math.max(at,Rt)}$=Math.floor($/P)*P;let it=y*Y-S*$-O*r/P,mt=S*Y+y*$-x*r/P,lt=y*R-S*$-O*r/P,gt=S*R+y*$-x*r/P;const It=1+Math.round((at-$)/P),vt=[];for(let Dt=0;Dt<It;Dt++)it+=O,mt+=x,lt+=O,gt+=x,vt.push([[it,mt],[lt,gt]]);return{paths:vt}}}class a extends T{constructor(s,u){super(s,u),this.reset()}reset(){this._xmin=this._ymin=1/0,this._xmax=this._ymax=-1/0,this._clipCount=0}envelope(){return new ct.Z(this._xmin,this._ymin,this._xmax-this._xmin,this._ymax-this._ymin)}bounds(){return(0,Q.al)(this._xmin,this._ymin,this._xmax,this._ymax)}drawSolidFill(s){if(s&&!(this._clipCount>0))if((0,X.oU)(s))this._processPath(s.rings,0);else if((0,X.l9)(s))this._processPath(s.paths,0);else if((0,X.YX)(s)){const u=I(s);u&&this._processPath(u.rings,0)}else console.error("drawSolidFill Unexpected geometry type!")}drawSolidStroke(s,u,M){if(!s||this._clipCount>0)return;const P=.5*this.transformSize((0,st.NA)(M,wt));if((0,X.oU)(s))this._processPath(s.rings,P);else if((0,X.l9)(s))this._processPath(s.paths,P);else if((0,X.YX)(s)){const c=I(s);c&&this._processPath(c.rings,P)}else console.error("drawSolidStroke unexpected geometry type!")}drawMarkerLayer(s,u){(0,X.oU)(u)&&s.markerPlacement&&("CIMMarkerPlacementInsidePolygon"===s.markerPlacement.type||"CIMMarkerPlacementPolygonCenter"===s.markerPlacement.type&&s.markerPlacement.clipAtBoundary)?this._processPath(u.rings,0):super.drawMarkerLayer(s,u)}drawHatchFill(s,u){this.drawSolidFill(s)}drawPictureFill(s,u){this.drawSolidFill(s)}drawGradientFill(s,u){this.drawSolidFill(s)}drawPictureStroke(s,u){this.drawSolidStroke(s,null,u.width)}drawGradientStroke(s,u){this.drawSolidStroke(s,null,u.width)}pushClipPath(s){this.drawSolidFill(s),this._clipCount++}popClipPath(){this._clipCount--}drawImage(s,u){const{url:M}=s,P=(0,st.NA)(s.scaleX,1);let c=P*u,r=u;const n=this._resourceManager.getResource(M);u||null==n||(c=P*n.width,r=n.height),this._merge(this.transformPt([-c/2,-r/2]),0),this._merge(this.transformPt([-c/2,r/2]),0),this._merge(this.transformPt([c/2,-r/2]),0),this._merge(this.transformPt([c/2,r/2]),0)}drawText(s,u){if(!u||0===u.length)return;this._textRasterizer||(this._textRasterizer=new ut.Z);const M=D(s),[P,c]=this._textRasterizer.computeTextSize(u,M);let r=0;switch(s.horizontalAlignment){case"Left":r=P/2;break;case"Right":r=-P/2}let n=0;switch(s.verticalAlignment){case"Bottom":n=c/2;break;case"Top":n=-c/2;break;case"Baseline":n=c/6}this._merge(this.transformPt([-P/2+r,-c/2+n]),0),this._merge(this.transformPt([-P/2+r,c/2+n]),0),this._merge(this.transformPt([P/2+r,-c/2+n]),0),this._merge(this.transformPt([P/2+r,c/2+n]),0)}_processPath(s,u){if(s)for(const M of s){const P=M?M.length:0;if(P>1){this._merge(this.transformPt(M[0]),u);for(let c=1;c<P;c++)this._merge(this.transformPt(M[c]),u)}}}_merge(s,u){s[0]-u<this._xmin&&(this._xmin=s[0]-u),s[0]+u>this._xmax&&(this._xmax=s[0]+u),s[1]-u<this._ymin&&(this._ymin=s[1]-u),s[1]+u>this._ymax&&(this._ymax=s[1]+u)}}class C extends T{constructor(){super(...arguments),this._searchPoint=[0,0],this._searchDistPoint=0,this._textInfo=null}hitTest(s,u,M,P,c,r){const n=r*(0,Nt.F2)(1);return this.setTransform(),this.setGeomUnitsPerPoint(n),this._searchPoint=[(s[0]+s[2])/2,(s[1]+s[3])/2],this._searchDistPoint=(s[2]-s[0])/2/n,this._textInfo=P,this._mapRotation=u&&("CIMPointSymbol"===u.type&&"Map"!==u.angleAlignment||"CIMTextSymbol"===u.type)?c:0,this._earlyReturn=!1,this.drawSymbol(u,M),this._earlyReturn}drawSolidFill(s,u){this._hitTestFill(s)}drawHatchFill(s,u){this._hitTestFill(s)}drawPictureFill(s,u){this._hitTestFill(s)}drawGradientFill(s,u){this._hitTestFill(s)}drawSolidStroke(s,u,M,P,c,r){this._hitTestStroke(s,M)}drawPictureStroke(s,u){this._hitTestStroke(s,u.width)}drawGradientStroke(s,u){this._hitTestStroke(s,u.width)}drawMarkerLayer(s,u){s.markerPlacement&&("CIMMarkerPlacementInsidePolygon"===s.markerPlacement.type||"CIMMarkerPlacementPolygonCenter"===s.markerPlacement.type&&s.markerPlacement.clipAtBoundary)?this._hitTestFill(u):super.drawMarkerLayer(s,u)}pushClipPath(s){}popClipPath(){}drawImage(s,u){const{url:M}=s,P=(0,st.NA)(s.scaleX,1),c=this._resourceManager.getResource(M);if(null==c||0===c.height||0===u)return;const r=u*this.geomUnitsPerPoint(),n=r*P*(c.width/c.height),_=this.reverseTransformPt(this._searchPoint),d=this._searchDistPoint;Math.abs(_[0])<n/2+d&&Math.abs(_[1])<r/2+d&&(this._earlyReturn=!0)}drawText(s,u){const M=this._textInfo;if(!M)return;const P=M.get(s);if(!P)return;const{text:c,mosaicItem:r}=P;if(!r?.glyphMosaicItems?.length)return;const n=(0,st.NA)(s.height,H),{lineGapType:_,lineGap:d}=s,y=_?K(_,(0,st.NA)(d),n):0,S=(0,Tt.E)(c)[1],x="CIMBackgroundCallout"===s.callout?.type,Y=(0,At.Nr)(r.glyphMosaicItems,S,{scale:n/Et.iD,angle:0,xOffset:0,yOffset:0,hAlign:A(s.horizontalAlignment),vAlign:U(s.verticalAlignment),maxLineWidth:512,lineHeight:Et.uk*Math.max(.25,Math.min(y||1,4)),decoration:s.font.decoration||"none",isCIM:!0,hasBackground:x}),R=this.reverseTransformPt(this._searchPoint),$=R[0],at=R[1];for(const it of Y.glyphs)if($>it.xTopLeft&&$<it.xBottomRight&&at>-it.yBottomRight&&at<-it.yTopLeft){this._earlyReturn=!0;break}}_hitTestFill(s){let u=null;if((0,X.YX)(s))u=[[[s.xmin,s.ymin],[s.xmin,s.ymax],[s.xmax,s.ymax],[s.xmax,s.ymin],[s.xmin,s.ymin]]];else if((0,X.oU)(s))u=s.rings;else{if(!(0,X.l9)(s))return;u=s.paths}const M=this.reverseTransformPt(this._searchPoint);if(this._pointInPolygon(M,u)&&(this._earlyReturn=!0),!this._earlyReturn){const P=this.reverseTransformSize(this._searchDistPoint)*this.geomUnitsPerPoint();this._nearLine(M,u,P)&&(this._earlyReturn=!0)}}_hitTestStroke(s,u){let M=null;if((0,X.YX)(s))M=[[[s.xmin,s.ymin],[s.xmin,s.ymax],[s.xmax,s.ymax],[s.xmax,s.ymin],[s.xmin,s.ymin]]];else if((0,X.oU)(s))M=s.rings;else{if(!(0,X.l9)(s))return;M=s.paths}const P=this.reverseTransformPt(this._searchPoint),c=(0,st.NA)(u,wt)*this.geomUnitsPerPoint(),r=this.reverseTransformSize(this._searchDistPoint)*this.geomUnitsPerPoint();this._nearLine(P,M,c/2+r)&&(this._earlyReturn=!0)}_pointInPolygon(s,u){let M=0;for(const P of u){const c=P.length;for(let r=1;r<c;r++){const n=P[r-1],_=P[r];n[1]>s[1]!=_[1]>s[1]&&((_[0]-n[0])*(s[1]-n[1])-(_[1]-n[1])*(s[0]-n[0])>0?M++:M--)}}return 0!==M}_nearLine(s,u,M){for(const P of u){const c=P.length;for(let r=1;r<c;r++){const n=P[r-1],_=P[r];let d=(_[0]-n[0])*(_[0]-n[0])+(_[1]-n[1])*(_[1]-n[1]);if(0!==d&&(d=Math.sqrt(d),Math.abs(((_[0]-n[0])*(s[1]-n[1])-(_[1]-n[1])*(s[0]-n[0]))/d)<M)){const S=((_[0]-n[0])*(s[0]-n[0])+(_[1]-n[1])*(s[1]-n[1]))/d;if(S>-M&&S<d+M)return!0}}}return!1}}class L extends T{constructor(s,u,M,P){super(u,M),this._applyAdditionalRenderProps=P,this._colorSubstitutionHelper=new pt,this._ctx=s}drawSolidFill(s,u){if(!s)return;if((0,X.oU)(s))this._buildPath(s.rings,!0);else if((0,X.l9)(s))this._buildPath(s.paths,!0);else if((0,X.YX)(s))this._buildPath(I(s).rings,!0);else{if(!(0,X.aW)(s))return;console.log("CanvasDrawHelper.drawSolidFill - No implementation!")}const M=this._ctx;M.fillStyle="string"==typeof u?u:"rgba("+Math.round(u[0])+","+Math.round(u[1])+","+Math.round(u[2])+","+(u[3]??255)/255+")",M.fill("evenodd")}drawSolidStroke(s,u,M,P,c,r){if(!s||!u||0===M)return;if((0,X.oU)(s))this._buildPath(s.rings,!0);else if((0,X.l9)(s))this._buildPath(s.paths,!1);else{if(!(0,X.YX)(s))return void console.log("CanvasDrawHelper.drawSolidStroke isn't implemented!");this._buildPath(I(s).rings,!0)}const n=this._ctx;n.strokeStyle="string"==typeof u?u:"rgba("+Math.round(u[0])+","+Math.round(u[1])+","+Math.round(u[2])+","+(u[3]??255)/255+")",n.lineWidth=Math.max(this.transformSize(M),.5),this._setCapStyle(P),this._setJoinStyle(c),n.miterLimit=r,n.stroke()}pushClipPath(s){if(this._ctx.save(),(0,X.oU)(s))this._buildPath(s.rings,!0);else if((0,X.l9)(s))this._buildPath(s.paths,!0);else{if(!(0,X.YX)(s))return;this._buildPath(I(s).rings,!0)}this._ctx.clip("evenodd")}popClipPath(){this._ctx.restore()}drawImage(s,u){const{colorSubstitutions:M,url:P,tintColor:c}=s,r=(0,st.NA)(s.scaleX,1),n=this._resourceManager.getResource(P);if(null==n)return;let _=u*(n.width/n.height),d=u;u||(_=n.width,d=n.height);const y=(0,st.TB)(P)||"src"in n&&(0,st.TB)(n.src);let S="getFrame"in n?b(n):n;M&&(S=this._colorSubstitutionHelper.applyColorSubstituition(S,M)),this._applyAdditionalRenderProps&&!y&&c&&(S=this._colorSubstitutionHelper.tintImageData(S,c));const O=this.transformPt([0,0]),[x,Y]=this.getTransformAngle(),R=this.transformSize(1),$=this._ctx;$.save(),$.setTransform({m11:r*R*x,m12:r*R*Y,m21:-R*Y,m22:R*x,m41:O[0],m42:O[1]}),$.drawImage(S,-_/2,-d/2,_,d),$.restore()}drawText(s,u){if(!u||0===u.length)return;this._textRasterizer||(this._textRasterizer=new ut.Z);const M=D(s);M.size*=this.transformSize((0,Nt.Wz)(1));const P=this._textRasterizer.rasterizeText(u,M);if(!P)return;const{size:c,anchorX:r,anchorY:n,canvas:_}=P,d=c[0]*(r+.5),y=c[1]*(n-.5),S=this._ctx,O=this.transformPt([0,0]),[x,Y]=this.getTransformAngle();S.save(),S.setTransform({m11:1*x,m12:1*Y,m21:-1*Y,m22:1*x,m41:O[0]-1*d,m42:O[1]+1*y}),S.drawImage(_,0,0),S.restore()}drawPictureFill(s,u){if(!s)return;let{colorSubstitutions:M,height:P,offsetX:c,offsetY:r,rotation:n,scaleX:_,tintColor:d,url:y}=u;const S=this._resourceManager.getResource(y);if(null==S)return;if((0,X.oU)(s))this._buildPath(s.rings,!0);else if((0,X.l9)(s))this._buildPath(s.paths,!0);else if((0,X.YX)(s))this._buildPath(I(s).rings,!0);else{if(!(0,X.aW)(s))return;console.log("CanvasDrawHelper.drawPictureFill - No implementation!")}const O=this._ctx,x=(0,st.TB)(y)||"src"in S&&(0,st.TB)(S.src);let Y,R="getFrame"in S?b(S):S;if(M&&(R=this._colorSubstitutionHelper.applyColorSubstituition(R,M)),this._applyAdditionalRenderProps){x||d&&(R=this._colorSubstitutionHelper.tintImageData(R,d)),Y=O.createPattern(R,"repeat");const $=this.transformSize(1);n||(n=0),c?c*=$:c=0,r?r*=$:r=0,P&&(P*=$);const at=P?P/S.height:1,it=_&&P?_*P/S.width:1;if(0!==n||1!==at||1!==it||0!==c||0!==r){const mt=new DOMMatrix;mt.rotateSelf(0,0,-n).translateSelf(c,r).scaleSelf(it,at,1),Y.setTransform(mt)}}else Y=O.createPattern(R,"repeat");O.save(),O.fillStyle=Y,O.fill("evenodd"),O.restore()}drawPictureStroke(s,u){if(!s)return;let{colorSubstitutions:M,capStyle:P,joinStyle:c,miterLimit:r,tintColor:n,url:_,width:d}=u;const y=this._resourceManager.getResource(_);if(null==y)return;let S;if((0,X.oU)(s))S=s.rings;else if((0,X.l9)(s))S=s.paths;else{if(!(0,X.YX)(s))return(0,X.aW)(s)?void console.log("CanvasDrawHelper.drawPictureStroke - No implementation!"):void 0;S=I(s).rings}d||(d=y.width);const O=(0,st.TB)(_)||"src"in y&&(0,st.TB)(y.src);let x="getFrame"in y?b(y):y;M&&(x=this._colorSubstitutionHelper.applyColorSubstituition(x,M)),this._applyAdditionalRenderProps&&(O||n&&(x=this._colorSubstitutionHelper.tintImageData(x,n)));const Y=Math.max(this.transformSize((0,Nt.F2)(d)),.5),R=Y/x.width,$=this._ctx,at=$.createPattern(x,"repeat-y");let it,mt;$.save(),this._setCapStyle(P),this._setJoinStyle(c),void 0!==r&&($.miterLimit=r),$.lineWidth=Y;for(let lt of S)if(lt=(0,ft.d9)(lt),et(lt),lt&&!(lt.length<=1)){it=this.transformPt(lt[0]);for(let gt=1;gt<lt.length;gt++){mt=this.transformPt(lt[gt]);const It=E(it,mt),vt=new DOMMatrix;vt.translateSelf(0,it[1]-Y/2).scaleSelf(R,R,1).rotateSelf(0,0,90-It),at.setTransform(vt),$.strokeStyle=at,$.beginPath(),$.moveTo(it[0],it[1]),$.lineTo(mt[0],mt[1]),$.stroke(),it=mt}}$.restore()}_buildPath(s,u){const M=this._ctx;if(M.beginPath(),s)for(const P of s){const c=P?P.length:0;if(c>1){let r=this.transformPt(P[0]);M.moveTo(r[0],r[1]);for(let n=1;n<c;n++)r=this.transformPt(P[n]),M.lineTo(r[0],r[1]);u&&M.closePath()}}}_setCapStyle(s){switch(s){case N.kP.Butt:this._ctx.lineCap="butt";break;case N.kP.Round:this._ctx.lineCap="round";break;case N.kP.Square:this._ctx.lineCap="square"}}_setJoinStyle(s){switch(s){case N.r4.Bevel:this._ctx.lineJoin="bevel";break;case N.r4.Round:this._ctx.lineJoin="round";break;case N.r4.Miter:this._ctx.lineJoin="miter"}}}function E(z,s){return 180/Math.PI*Math.atan2(s[1]-z[1],s[0]-z[0])}const I=z=>z?{spatialReference:z.spatialReference,rings:[[[z.xmin,z.ymin],[z.xmin,z.ymax],[z.xmax,z.ymax],[z.xmax,z.ymin],[z.xmin,z.ymin]]]}:null,A=z=>{switch(z){case"Left":return _t.M7.Left;case"Right":return _t.M7.Right;case"Center":return _t.M7.Center;case"Justify":return Ot.warnOnce("Horizontal alignment 'justify' is not implemented. Falling back to 'center'."),_t.M7.Center}},U=z=>{switch(z){case"Top":return _t.TR.Top;case"Center":return _t.TR.Center;case"Bottom":return _t.TR.Bottom;case"Baseline":return _t.TR.Baseline}},K=(z,s,u)=>{switch(z){case"ExtraLeading":return 1+s/u;case"Multiple":return s;case"Exact":return s/u}};function D(z,s=1){const u=(0,st.BX)(z),M=(0,st.wi)(z.fontStyleName),P=z.fontFamilyName??Ct.em,{weight:c,style:r}=M,n=s*(z.height||5),_=(0,st.X_)(z.horizontalAlignment),d=(0,st.FG)(z.verticalAlignment),y=(0,st.W7)(z),S=(0,st.W7)(z.haloSymbol),O=S?s*(0|z.haloSize):0,x="CIMBackgroundCallout"===z.callout?.type?z.callout.backgroundSymbol:null,Y=(0,st.W7)(x),R=(0,st.F)(x),$=(0,st.$Z)(x);return{color:y,size:n,horizontalAlignment:_,verticalAlignment:d,font:{family:P,style:(0,st.pJ)(r),weight:(0,st.On)(c),decoration:u},halo:{size:O||0,color:S,style:r},backgroundColor:Y,borderLine:null!=R&&null!=$?{size:R,color:$}:null,pixelRatio:1,premultiplyColors:!0}}const q=1e-4;function et(z){let s,u,M,P,c,r=z[0],n=1;for(;n<z.length;)s=z[n][0]-r[0],u=z[n][1]-r[1],P=0!==s?u/s:Math.PI/2,void 0!==M&&P-M<=q?(z.splice(n-1,1),r=c):(c=r,r=z[n],n++),M=P}},35909:(Ut,Ft,B)=>{B.d(Ft,{B$:()=>T,E0:()=>a,Tg:()=>V,U1:()=>q,bP:()=>J,rW:()=>bt});var Tt=B(15861),Ct=B(91558),ft=B(986),ot=B(8314),xt=B(58817),Nt=B(63290),nt=B(4619),Q=B(23841),W=B(65401),k=B(32442),X=B(46679),ht=B(11472),pt=B(97373),Pt=B(26933),F=B(7547),N=B(80991),b=B(39236),ct=B(86575),ut=B(39351),st=B(25797);const _t=Math.PI,Et=_t/2,At=Math.PI/180,yt=96/72,wt=Nt.Z.getLogger("esri.symbols.cim.CIMSymbolHelper");function bt(c){if(!c?.type)return null;let r;switch(c.type){case"cim":return c.data;case"web-style":return c;case"simple-marker":{const n=T.fromSimpleMarker(c);if(!n)return null;r=n;break}case"picture-marker":r=T.fromPictureMarker(c);break;case"simple-line":r=T.fromSimpleLineSymbol(c);break;case"simple-fill":r=T.fromSimpleFillSymbol(c);break;case"picture-fill":r=T.fromPictureFillSymbol(c);break;case"text":r=T.fromTextSymbol(c)}return{type:"CIMSymbolReference",symbol:r}}function Mt(c,r,n){switch(r.type){case"CIMSymbolReference":return Mt(c,r.symbol,n);case"CIMPointSymbol":null==n&&(n={x:0,y:0}),c.drawSymbol(r,n);break;case"CIMLineSymbol":null==n&&(n={paths:[[[0,0],[10,0]]]}),c.drawSymbol(r,n);break;case"CIMPolygonSymbol":null==n&&(n={rings:[[[0,0],[0,10],[10,10],[10,0],[0,0]]]}),c.drawSymbol(r,n);break;case"CIMTextSymbol":c.drawSymbol(r,{x:0,y:0});break;case"CIMVectorMarker":{const _=new pt.u;c.drawMarker(r,_);break}}return c.envelope()}function rt(c){if(!c)return 0;switch(c.type){case"CIMMarkerPlacementAlongLineSameSize":case"CIMMarkerPlacementAlongLineRandomSize":case"CIMMarkerPlacementAtExtremities":case"CIMMarkerPlacementAtMeasuredUnits":case"CIMMarkerPlacementAtRatioPositions":case"CIMMarkerPlacementOnLine":case"CIMMarkerPlacementOnVertices":return Math.abs(c.offset);default:return 0}}function H(c){if(!c)return 0;switch(c.type){case"CIMGeometricEffectArrow":return Math.abs(.5*c.width);case"CIMGeometricEffectBuffer":return Math.abs(c.size);case"CIMGeometricEffectExtension":case"CIMGeometricEffectRadial":return Math.abs(c.length);case"CIMGeometricEffectJog":return Math.abs(.5*c.length);case"CIMGeometricEffectMove":return Math.max(Math.abs((0,N.NA)(c.offsetX)),Math.abs((0,N.NA)(c.offsetY)));case"CIMGeometricEffectOffset":case"CIMGeometricEffectOffsetTangent":return Math.abs(c.offset);case"CIMGeometricEffectRegularPolygon":return Math.abs(c.radius);case"CIMGeometricEffectRotate":case"CIMGeometricEffectScale":default:return 0;case"CIMGeometricEffectTaperedPolygon":return.5*Math.max(Math.abs(c.fromWidth),Math.abs(c.toWidth));case"CIMGeometricEffectWave":return Math.abs(c.amplitude);case"CIMGeometricEffectDonut":return Math.abs(c.width)}}function V(c){if(!c)return 0;let r=0;for(const n of c)r+=H(n);return r}class J{getSymbolInflateSize(r,n,_,d,y){return r||(r=[0,0,0,0]),n?this._getInflateSize(r,n,_,d,y):r}static safeSize(r){const n=Math.max(Math.abs(r[0]),Math.abs(r[2])),_=Math.max(Math.abs(r[1]),Math.abs(r[3]));return Math.sqrt(n*n+_*_)}_vectorMarkerBounds(r,n,_,d){let y=!0;const S=(0,W.Ue)();if(n?.markerGraphics)for(const O of n.markerGraphics){const x=[0,0,0,0];O.geometry&&((0,k.$P)(S,O.geometry),x[0]=0,x[1]=0,x[2]=0,x[3]=0,this.getSymbolInflateSize(x,O.symbol,_,0,d),S[0]+=x[0],S[1]+=x[1],S[2]+=x[2],S[3]+=x[3],y?(r[0]=S[0],r[1]=S[1],r[2]=S[2],r[3]=S[3],y=!1):(r[0]=Math.min(r[0],S[0]),r[1]=Math.min(r[1],S[1]),r[2]=Math.max(r[2],S[2]),r[3]=Math.max(r[3],S[3])))}return r}_getInflateSize(r,n,_,d,y){if(function et(c){return void 0!==c.symbolLayers}(n)){const S=this._getLayersInflateSize(r,n.symbolLayers,_,d,y),O=V(n.effects);return O>0&&(S[0]-=O,S[1]-=O,S[2]+=O,S[3]+=O),S}return this._getTextInflatedSize(r,n,y)}_getLayersInflateSize(r,n,_,d,y){let S=!0;if(!n)return r;for(const O of n){if(!O)continue;let x=[0,0,0,0];switch(O.type){case"CIMSolidFill":case"CIMPictureFill":case"CIMHatchFill":case"CIMGradientFill":break;case"CIMSolidStroke":case"CIMPictureStroke":case"CIMGradientStroke":{let $=O.width;null!=$&&($/=O.capStyle===F.kP.Square||O.joinStyle===F.r4.Miter?1.4142135623730951:2,x[0]=-$,x[1]=-$,x[2]=$,x[3]=$);break}case"CIMCharacterMarker":case"CIMVectorMarker":case"CIMPictureMarker":{const R=O;if("CIMVectorMarker"===O.type){const lt=O;if(x=this._vectorMarkerBounds(x,lt,_,y),lt.frame){const gt=(lt.frame.xmin+lt.frame.xmax)/2,It=(lt.frame.ymin+lt.frame.ymax)/2;if(x[0]-=gt,x[1]-=It,x[2]-=gt,x[3]-=It,null!=lt.size){const vt=lt.size/(lt.frame.ymax-lt.frame.ymin);x[0]*=vt,x[1]*=vt,x[2]*=vt,x[3]*=vt}}}else if("CIMPictureMarker"===O.type){const lt=O,gt=_.getResource(lt.url);let It=1;if(null!=gt&&gt.height&&(It=gt.width/gt.height),null!=R.size){const vt=R.size/2,Dt=R.size*It*lt.scaleX/2;x=[-Dt,-vt,Dt,vt]}}else if(null!=R.size){const lt=R.size/2;x=[-lt,-lt,lt,lt]}if(R.anchorPoint){let lt,gt;"Absolute"===R.anchorPointUnits?(lt=R.anchorPoint.x,gt=R.anchorPoint.y):(lt=R.anchorPoint.x*(x[2]-x[0]),gt=R.anchorPoint.y*(x[3]-x[1])),x[0]-=lt,x[1]-=gt,x[2]-=lt,x[3]-=gt}let $=(0,N.NA)(R.rotation);if(R.rotateClockwise&&($=-$),d&&($-=d),$){const lt=At*$,gt=Math.cos(lt),It=Math.sin(lt),vt=(0,W.Ue)([ct.FM,ct.FM,-ct.FM,-ct.FM]);(0,W.Ho)(vt,[x[0]*gt-x[1]*It,x[0]*It+x[1]*gt]),(0,W.Ho)(vt,[x[0]*gt-x[3]*It,x[0]*It+x[3]*gt]),(0,W.Ho)(vt,[x[2]*gt-x[1]*It,x[2]*It+x[1]*gt]),(0,W.Ho)(vt,[x[2]*gt-x[3]*It,x[2]*It+x[3]*gt]),x=vt}let at=(0,N.NA)(R.offsetX),it=(0,N.NA)(R.offsetY);if(d){const lt=At*d,gt=Math.cos(lt),It=Math.sin(lt),vt=at*It+it*gt;at=at*gt-it*It,it=vt}x[0]+=at,x[1]+=it,x[2]+=at,x[3]+=it;const mt=rt(R.markerPlacement);mt>0&&(x[0]-=mt,x[1]-=mt,x[2]+=mt,x[3]+=mt);break}}const Y=V(O.effects);Y>0&&(x[0]-=Y,x[1]-=Y,x[2]+=Y,x[3]+=Y),S?(r[0]=x[0],r[1]=x[1],r[2]=x[2],r[3]=x[3],S=!1):(r[0]=Math.min(r[0],x[0]),r[1]=Math.min(r[1],x[1]),r[2]=Math.max(r[2],x[2]),r[3]=Math.max(r[3],x[3]))}return r}_getTextInflatedSize(r,n,_){const d=n.height??Pt.zV;if(r[0]=-d/2,r[1]=-d/2,r[2]=d/2,r[3]=d/2,!_)return r;const y=_.get(n);if(!y)return r;const{text:S,mosaicItem:O}=y;if(!O?.glyphMosaicItems?.length)return r;const{lineGapType:x,lineGap:Y}=n,R=x?(0,Pt.et)(x,Y??0,d):0,$=(0,ft.E)(S)[1],it="CIMBackgroundCallout"===n.callout?.type,mt=(0,st.Nr)(O.glyphMosaicItems,$,{scale:d/ut.iD,angle:(0,N.NA)(n.angle),xOffset:(0,N.NA)(n.offsetX),yOffset:(0,N.NA)(n.offsetY),hAlign:(0,Pt.x1)(n.horizontalAlignment),vAlign:(0,Pt.g)(n.verticalAlignment),maxLineWidth:512,lineHeight:ut.uk*Math.max(.25,Math.min(R||1,4)),decoration:n.font.decoration||"none",isCIM:!0,hasBackground:it}).boundsT;return r[0]=mt.x-mt.halfWidth,r[1]=-mt.y-mt.halfHeight,r[2]=mt.x+mt.halfWidth,r[3]=-mt.y+mt.halfHeight,r}}class T{static getEnvelope(r,n,_){if(!r)return null;const d=new Pt.uQ(_);if(Array.isArray(r)){let y;for(const S of r)y?y.union(Mt(d,S,n)):y=Mt(d,S,n);return y}return Mt(d,r,n)}static getTextureAnchor(r,n){const _=this.getEnvelope(r,null,n);if(!_)return[0,0,0];const O=_.height*yt+2;return[-(_.x+.5*_.width)*yt/(_.width*yt+2),-(_.y+.5*_.height)*yt/O,O]}static rasterize(r,n,_,d,y=!0){const S=_||this.getEnvelope(n,null,d);if(!S)return[null,0,0,0,0];const O=(S.x+.5*S.width)*yt,x=(S.y+.5*S.height)*yt;r.width=S.width*yt,r.height=S.height*yt,_||(r.width+=2,r.height+=2);const Y=r.getContext("2d"),R=Pt.zA.createScale(yt,-yt);R.translate(.5*r.width-O,.5*r.height+x);const $=new Pt.cD(Y,d,R);switch(n.type){case"CIMPointSymbol":$.drawSymbol(n,{type:"point",x:0,y:0});break;case"CIMVectorMarker":{const mt=new pt.u;$.drawMarker(n,mt);break}}const at=Y.getImageData(0,0,r.width,r.height),it=new Uint8Array(at.data);if(y){let mt;for(let lt=0;lt<it.length;lt+=4)mt=it[lt+3]/255,it[lt]=it[lt]*mt,it[lt+1]=it[lt+1]*mt,it[lt+2]=it[lt+2]*mt}return[it,r.width,r.height,-O/r.width,-x/r.height]}static fromTextSymbol(r){const{angle:n,color:_,font:d,haloColor:y,haloSize:S,horizontalAlignment:O,kerning:x,text:Y,verticalAlignment:R,xoffset:$,yoffset:at,backgroundColor:it,borderLineColor:mt,borderLineSize:lt}=r;let gt,It,vt,Dt,Gt,Bt;d&&(gt=d.family,It=d.style,vt=d.weight,Dt=d.size,Gt=d.decoration);let Xt=!1;return Y&&(Xt=(0,ft.E)(Y)[1]),(it||lt)&&(Bt={type:"CIMBackgroundCallout",margin:null,backgroundSymbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",color:A(it)},{type:"CIMSolidStroke",color:A(mt),width:lt}]},accentBarSymbol:null,gap:null,leaderLineSymbol:null,lineStyle:null}),{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,anchorPointUnits:"Relative",dominantSizeAxis3D:"Y",size:10,billboardMode3D:"FaceNearPlane",frame:{xmin:-5,ymin:-5,xmax:5,ymax:5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{x:0,y:0},symbol:{type:"CIMTextSymbol",angle:n,blockProgression:F.zV.BTT,depth3D:1,extrapolateBaselines:!0,fontEffects:F.eZ.Normal,fontEncoding:F.DD.Unicode,fontFamilyName:gt||"Arial",fontStyleName:U(It,vt),fontType:F.Ky.Unspecified,haloSize:S,height:Dt,hinting:F.Dd.Default,horizontalAlignment:E(O??"center"),kerning:x,letterWidth:100,ligatures:!0,lineGapType:"Multiple",offsetX:(0,N.NA)($),offsetY:(0,N.NA)(at),strikethrough:"line-through"===Gt,underline:"underline"===Gt,symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:A(_)}]},haloSymbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:A(y)}]},shadowColor:[0,0,0,255],shadowOffsetX:1,shadowOffsetY:1,textCase:"Normal",textDirection:Xt?F.UX.RTL:F.UX.LTR,verticalAlignment:I(R??"baseline"),verticalGlyphOrientation:F.RS.Right,wordSpacing:100,billboardMode3D:F.UR.FaceNearPlane,callout:Bt},textString:Y}],scaleSymbolsProportionally:!0,respectFrame:!0}],scaleX:1,angleAlignment:"Display"}}static fromPictureFillSymbol(r){const{height:n,outline:_,width:d,xoffset:y,xscale:S,yoffset:O,yscale:x}=r,Y=[],R={type:"CIMPolygonSymbol",symbolLayers:Y};if(_){const lt=P(_);lt&&Y.push(lt)}let $=r.url;"esriPFS"===r.type&&r.imageData&&($=r.imageData);const at="angle"in r?r.angle??0:0;return Y.push({type:"CIMPictureFill",invertBackfaceTexture:!1,scaleX:1,textureFilter:F.Qb.Picture,tintColor:null,url:$,height:(n??0)*(x||1),width:(d??0)*(S||1),offsetX:(0,N.NA)(y),offsetY:(0,N.NA)(O),rotation:(0,N.NA)(-at),colorSubstitutions:null}),R}static fromSimpleFillSymbol(r){const{color:n,style:_,outline:d}=r,y=[],S={type:"CIMPolygonSymbol",symbolLayers:y};if(d){const O=P(d);O&&y.push(O)}if(_&&"solid"!==_&&"none"!==_&&"esriSFSSolid"!==_&&"esriSFSNull"!==_){const O={type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",color:A(n),capStyle:F.kP.Butt,joinStyle:F.r4.Miter,width:.75}]};let x=0;const Y=(0,Q.Wz)(s(_)?8:10);switch(_){case"vertical":case"esriSFSVertical":x=90;break;case"forward-diagonal":case"esriSFSForwardDiagonal":case"diagonal-cross":case"esriSFSDiagonalCross":x=-45;break;case"backward-diagonal":case"esriSFSBackwardDiagonal":x=45;break;case"cross":case"esriSFSCross":x=0}y.push({type:"CIMHatchFill",lineSymbol:O,offsetX:0,offsetY:0,rotation:x,separation:Y}),"cross"===_||"esriSFSCross"===_?y.push({type:"CIMHatchFill",lineSymbol:(0,xt.d9)(O),offsetX:0,offsetY:0,rotation:90,separation:Y}):"diagonal-cross"!==_&&"esriSFSDiagonalCross"!==_||y.push({type:"CIMHatchFill",lineSymbol:(0,xt.d9)(O),offsetX:0,offsetY:0,rotation:45,separation:Y})}else!_||"solid"!==_&&"esriSFSSolid"!==_||y.push({type:"CIMSolidFill",enable:!0,color:A(n)});return S}static fromSimpleLineSymbol(r){const{cap:n,color:_,join:d,marker:y,miterLimit:S,style:O,width:x}=r;let Y=null;"solid"!==O&&"none"!==O&&"esriSLSSolid"!==O&&"esriSLSNull"!==O&&(Y=[{type:"CIMGeometricEffectDashes",dashTemplate:q(O,n),lineDashEnding:"NoConstraint",scaleDash:!0,offsetAlongLine:null}]);const R=[];if(y){let $;switch(y.placement){case"begin-end":$=F.Tx.Both;break;case"begin":$=F.Tx.JustBegin;break;case"end":$=F.Tx.JustEnd;break;default:$=F.Tx.None}const at=T.fromSimpleMarker(y,x,_).symbolLayers[0];at.markerPlacement={type:"CIMMarkerPlacementAtExtremities",angleToLine:!0,offset:0,extremityPlacement:$,offsetAlongLine:0},R.push(at)}return R.push({type:"CIMSolidStroke",color:"none"!==O&&"esriSLSNull"!==O?A(_):[0,0,0,0],capStyle:C(n),joinStyle:L(d),miterLimit:S,width:x,effects:Y}),{type:"CIMLineSymbol",symbolLayers:R}}static fromPictureMarker(r){const{angle:n,height:_,width:d,xoffset:y,yoffset:S}=r;let O=r.url;return"esriPMS"===r.type&&r.imageData&&(O=r.imageData),{type:"CIMPointSymbol",symbolLayers:[{type:"CIMPictureMarker",invertBackfaceTexture:!1,scaleX:1,textureFilter:F.Qb.Picture,tintColor:null,url:O,size:_,width:d,offsetX:(0,N.NA)(y),offsetY:(0,N.NA)(S),rotation:(0,N.NA)(-n)}]}}static fromSimpleMarker(r,n,_){const{style:d}=r,y=r.color??_;if("path"===d){const R=[];if("outline"in r&&r.outline){const it=r.outline;R.push({type:"CIMSolidStroke",enable:!0,width:(0,Q.F2)(Math.round((0,Q.Wz)(it.width))),color:A(it.color),path:r.path})}R.push({type:"CIMSolidFill",enable:!0,color:A(y),path:r.path});const[$,at]=z("square");return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,rotation:(0,N.NA)(-r.angle),size:(0,N.NA)(r.size||6),offsetX:(0,N.NA)(r.xoffset),offsetY:(0,N.NA)(r.yoffset),frame:$,markerGraphics:[{type:"CIMMarkerGraphic",geometry:at,symbol:{type:"CIMPolygonSymbol",symbolLayers:R}}]}]}}const S=[];let O,x;if("outline"in r&&r.outline&&"none"!==r.outline.style&&"esriSLSNull"!==r.outline.style){const R=r.outline,$="solid"!==R.style&&"esriSLSSolid"!==R.style;[O,x]=$?z(d,r.size):z(d);const at="cross"!==r.style&&"x"!==r.style||"dot"===r?.outline.style||"short-dot"===r?.outline.style?F.sj.HalfGap:F.sj.FullPattern,it=$?[{type:"CIMGeometricEffectAddControlPoints"},{type:"CIMGeometricEffectDashes",dashTemplate:q(R.style,null).map(mt=>R.width&&R.width>0?mt*R.width:mt),lineDashEnding:at,controlPointEnding:F.sj.FullPattern}]:void 0;S.push({type:"CIMSolidStroke",capStyle:$?F.kP.Round:F.kP.Butt,enable:!0,width:null!=R.width&&R.width>.667?(0,Q.F2)(Math.round((0,Q.Wz)(R.width))):R.width,color:A(R.color),effects:it})}else!n||"line-marker"!==r.type||"cross"!==r.style&&"x"!==r.style?[O,x]=z(d):([O,x]=z(d),S.push({type:"CIMSolidStroke",enable:!0,width:n,color:A(y)}));S.push({type:"CIMSolidFill",enable:!0,color:A(y)});const Y={type:"CIMPolygonSymbol",symbolLayers:S};return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,rotation:(0,N.NA)(-r.angle),size:(0,N.NA)(r.size||6*n),offsetX:(0,N.NA)(r.xoffset),offsetY:(0,N.NA)(r.yoffset),frame:O,markerGraphics:[{type:"CIMMarkerGraphic",geometry:x,symbol:Y}]}]}}static fromCIMHatchFill(r,n){const _=n*(r.separation??Pt.rC),d=_/2,y=(0,xt.d9)(r.lineSymbol);y.symbolLayers?.forEach(x=>{switch(x.type){case"CIMSolidStroke":null!=x.width&&(x.width*=n),x.effects?.forEach(Y=>{"CIMGeometricEffectDashes"===Y.type&&(Y.dashTemplate=Y.dashTemplate.map(R=>R*n))});break;case"CIMVectorMarker":{null!=x.size&&(x.size*=n);const Y=x.markerPlacement;null!=Y&&"placementTemplate"in Y&&(Y.placementTemplate=Y.placementTemplate.map(R=>R*n));break}}});let S=this._getLineSymbolPeriod(y)||4;for(;S<4;)S*=2;const O=S/2;return{type:"CIMVectorMarker",frame:{xmin:-O,xmax:O,ymin:-d,ymax:d},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{paths:[[[-O,0],[O,0]]]},symbol:y}],size:_}}static fetchResources(r,n,_){if(r&&n)switch(r.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":{const d=r.symbolLayers;if(!d)return;for(const y of d)switch(M(y,n,_),y.type){case"CIMPictureFill":case"CIMHatchFill":case"CIMGradientFill":case"CIMPictureStroke":case"CIMGradientStroke":case"CIMCharacterMarker":case"CIMPictureMarker":"url"in y&&y.url&&_.push(n.fetchResource(y.url,null));break;case"CIMVectorMarker":{const S=y.markerGraphics;if(!S)continue;for(const O of S)if(O){const x=O.symbol;x&&T.fetchResources(x,n,_)}}}break}}}static fetchFonts(r,n,_){if(r&&n)if("symbolLayers"in r&&r.symbolLayers){for(const d of r.symbolLayers)if("CIMVectorMarker"===d.type&&d.markerGraphics)for(const y of d.markerGraphics)y?.symbol&&T.fetchFonts(y.symbol,n,_)}else if("CIMTextSymbol"===r.type){const{fontFamilyName:d,fontStyleName:y}=r;if(!d||"calcitewebcoreicons"===d.toLowerCase())return;const{style:S,weight:O}=(0,N.wi)(y),x=(0,N.BX)(r),Y=new ht.Z({family:d,style:S,weight:O,decoration:x});_.push(n.loadFont(Y).catch(()=>{wt.error(`Unsupported font ${d} in CIM symbol`)}))}}static _getLineSymbolPeriod(r){if(r){const n=this._getEffectsRepeat(r.effects);if(n)return n;if(r.symbolLayers)for(const _ of r.symbolLayers)if(_){const d=this._getEffectsRepeat(_.effects);if(d)return d;switch(_.type){case"CIMCharacterMarker":case"CIMPictureMarker":case"CIMVectorMarker":case"CIMObjectMarker3D":case"CIMglTFMarker3D":{const y=this._getPlacementRepeat(_.markerPlacement);if(y)return y}}}}return 0}static _getEffectsRepeat(r){if(r)for(const n of r)if(n)switch(n.type){case"CIMGeometricEffectDashes":{const _=n.dashTemplate;if(_&&_.length){let d=0;for(const y of _)d+=y;return 1&_.length&&(d*=2),d}break}case"CIMGeometricEffectWave":return n.period;default:wt.error(`unsupported geometric effect type ${n.type}`)}return 0}static _getPlacementRepeat(r){if(r)switch(r.type){case"CIMMarkerPlacementAlongLineSameSize":case"CIMMarkerPlacementAlongLineRandomSize":case"CIMMarkerPlacementAlongLineVariableSize":{const n=r.placementTemplate;if(n&&n.length){let _=0;for(const d of n)_+=+d;return 1&n.length&&(_*=2),_}break}}return 0}static fromCIMInsidePolygon(r){const n=r.markerPlacement,_={...r};_.markerPlacement=null,_.anchorPoint=null;const d=Math.abs(n.stepX),y=Math.abs(n.stepY),S=(n.randomness??100)/100;let O,x,Y,R;if("Random"===n.gridType){const $=(0,Q.Wz)(ut.KA),at=Math.max(Math.floor($/d),1),it=Math.max(Math.floor($/y),1);O=at*d/2,x=it*y/2,Y=2*x;const mt=new nt.Z(n.seed),lt=S*d/1.5,gt=S*y/1.5;R=[];for(let It=0;It<at;It++)for(let vt=0;vt<it;vt++){const Dt=It*d-O+lt*(.5-mt.getFloat()),Gt=vt*y-x+gt*(.5-mt.getFloat());R.push({x:Dt,y:Gt}),0===It&&R.push({x:Dt+2*O,y:Gt}),0===vt&&R.push({x:Dt,y:Gt+2*x})}}else!0===n.shiftOddRows?(O=d/2,x=y,Y=2*y,R=[{x:-O,y:0},{x:O,y:0},{x:0,y:x},{x:0,y:-x}]):(O=d/2,x=y/2,Y=y,R=[{x:-d,y:0},{x:0,y:-y},{x:-d,y:-y},{x:0,y:0},{x:d,y:0},{x:0,y},{x:d,y},{x:-d,y},{x:d,y:-y}]);return{type:"CIMVectorMarker",frame:{xmin:-O,xmax:O,ymin:-x,ymax:x},markerGraphics:R.map($=>({type:"CIMMarkerGraphic",geometry:$,symbol:{type:"CIMPointSymbol",symbolLayers:[_]}})),size:Y}}static getSize(r){if(r)switch(r.type){case"CIMTextSymbol":return r.height;case"CIMPointSymbol":{let n=0;if(r.symbolLayers)for(const _ of r.symbolLayers)if(_)switch(_.type){case"CIMCharacterMarker":case"CIMPictureMarker":case"CIMVectorMarker":case"CIMObjectMarker3D":case"CIMglTFMarker3D":{const d=_.size;null!=d&&d>n&&(n=d);break}}return n}case"CIMLineSymbol":case"CIMPolygonSymbol":{let n=0;if(r.symbolLayers)for(const _ of r.symbolLayers)if(_)switch(_.type){case"CIMSolidStroke":case"CIMPictureStroke":case"CIMGradientStroke":{const d=_.width;null!=d&&d>n&&(n=d);break}case"CIMCharacterMarker":case"CIMPictureMarker":case"CIMVectorMarker":case"CIMObjectMarker3D":case"CIMglTFMarker3D":if(_.markerPlacement&&(0,N.gJ)(_.markerPlacement)){const d=_.size;null!=d&&d>n&&(n=d)}}return n}}}static getMarkerScaleRatio(r){return r&&"CIMVectorMarker"===r.type&&!1!==r.scaleSymbolsProportionally&&r.frame&&null!=r.size?r.size/(r.frame.ymax-r.frame.ymin):1}}class a{static findApplicableOverrides(r,n,_){if(r&&n){if(r.primitiveName){let d=!1;for(const y of _)if(y.primitiveName===r.primitiveName){d=!0;break}if(!d)for(const y of n)y.primitiveName===r.primitiveName&&_.push(y)}switch(r.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":if(r.effects)for(const d of r.effects)a.findApplicableOverrides(d,n,_);if(r.symbolLayers)for(const d of r.symbolLayers)a.findApplicableOverrides(d,n,_);break;case"CIMTextSymbol":break;case"CIMSolidStroke":case"CIMPictureStroke":case"CIMGradientStroke":case"CIMSolidFill":case"CIMPictureFill":case"CIMHatchFill":case"CIMGradientFill":case"CIMVectorMarker":case"CIMCharacterMarker":case"CIMPictureMarker":if(r.effects)for(const d of r.effects)a.findApplicableOverrides(d,n,_);if(r.markerPlacement&&a.findApplicableOverrides(r.markerPlacement,n,_),"CIMVectorMarker"===r.type){if(r.markerGraphics)for(const d of r.markerGraphics)a.findApplicableOverrides(d,n,_),a.findApplicableOverrides(d.symbol,n,_)}else"CIMCharacterMarker"===r.type?a.findApplicableOverrides(r.symbol,n,_):"CIMHatchFill"===r.type?a.findApplicableOverrides(r.lineSymbol,n,_):"CIMPictureMarker"===r.type&&a.findApplicableOverrides(r.animatedSymbolProperties,n,_)}}}static findEffectOverrides(r,n,_){if(!n||!r)return;const d=r.length;for(let y=0;y<d;y++){const O=r[y]?.primitiveName;if(O){let x=!1;for(const Y of _)if(Y.primitiveName===O){x=!0;break}if(!x)for(const Y of n)Y.primitiveName===O&&_.push(Y)}}}static resolveSymbolOverrides(r,n,_,d,y,S,O){return(0,Tt.Z)(function*(){if(!r?.symbol)return null;let{symbol:x,primitiveOverrides:Y}=r;const R=!!Y;if(!R&&!d)return x;x=(0,xt.d9)(x);let $=!0;if(n||(n={attributes:{}},$=!1),R){if($||(Y=Y.filter(at=>!at.valueExpressionInfo?.expression.includes("$feature"))),O||(Y=Y.filter(at=>!at.valueExpressionInfo?.expression.includes("$view"))),Y.length>0){const at=(0,N.Qf)(n.attributes);yield a.evaluateOverrides(Y,n,{spatialReference:_,fields:at,geometryType:y},S,O)}a.applyOverrides(x,Y)}return d&&a.applyDictionaryTextOverrides(x,n,d),x})()}static evaluateOverrides(r,n,_,d,y){return(0,Tt.Z)(function*(){if(!n)return;let S;for(const O of r){const x=O.valueExpressionInfo;if(x&&_?.geometryType){S||(S=[]),O.value=void 0;const Y=(0,X.Yi)(x.expression,_.spatialReference,_.fields).then(R=>{O.value=(0,b.Z)(R,n,{$view:y},_.geometryType,d)});S.push(Y)}}void 0!==S&&S.length>0&&(yield Promise.all(S))})()}static applyDictionaryTextOverrides(r,n,_,d="Normal"){if(r?.type)switch(r.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":case"CIMTextSymbol":{const y=r.symbolLayers;if(!y)return;for(const S of y)S&&"CIMVectorMarker"===S.type&&a.applyDictionaryTextOverrides(S,n,_,"CIMTextSymbol"===r.type?r.textCase:d)}break;case"CIMVectorMarker":{const y=r.markerGraphics;if(!y)return;for(const S of y)S&&a.applyDictionaryTextOverrides(S,n,_)}break;case"CIMMarkerGraphic":{const y=r.textString;if(y&&y.includes("[")){const S=(0,N.H1)(y,_);r.textString=(0,N.E_)(n,S,d)}}}}static applyOverrides(r,n,_,d){if(r.primitiveName)for(const y of n)if(y.primitiveName===r.primitiveName){const S=u(y.propertyName);if(d&&d.push({cim:r,nocapPropertyName:S,value:r[S]}),y.expression&&(y.value=a.toValue(y.propertyName,y.expression)),_){let O=!1;for(const x of _)x.primitiveName===r.primitiveName&&(O=!0);O||_.push(y)}null!=y.value&&(r[S]=y.value)}switch(r.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":if(r.effects)for(const y of r.effects)a.applyOverrides(y,n,_,d);if(r.symbolLayers)for(const y of r.symbolLayers)a.applyOverrides(y,n,_,d);break;case"CIMTextSymbol":break;case"CIMSolidStroke":case"CIMSolidFill":case"CIMVectorMarker":if(r.effects)for(const y of r.effects)a.applyOverrides(y,n,_,d);if("CIMVectorMarker"===r.type&&r.markerGraphics)for(const y of r.markerGraphics)a.applyOverrides(y,n,_,d),a.applyOverrides(y.symbol,n,_,d)}}static restoreOverrides(r){for(const n of r)n.cim[n.nocapPropertyName]=n.value}static buildOverrideKey(r){let n="";for(const _ of r)void 0!==_.value&&(n+=`${_.primitiveName}${_.propertyName}${JSON.stringify(_.value)}`);return n}static toValue(r,n){if("DashTemplate"===r)return n.split(" ").map(_=>Number(_));if("Color"===r){const _=new Ct.Z(n).toRgba();return _[3]*=255,_}return n}}const C=c=>{if(!c)return F.kP.Butt;switch(c){case"butt":return F.kP.Butt;case"square":return F.kP.Square;case"round":return F.kP.Round}},L=c=>{if(!c)return F.r4.Miter;switch(c){case"miter":return F.r4.Miter;case"round":return F.r4.Round;case"bevel":return F.r4.Bevel}},E=c=>{if(null==c)return"Center";switch(c){case"left":return"Left";case"right":return"Right";case"center":return"Center"}},I=c=>{if(null==c)return"Center";switch(c){case"baseline":return"Baseline";case"top":return"Top";case"middle":return"Center";case"bottom":return"Bottom"}},A=c=>{if(!c)return[0,0,0,0];const{r,g:n,b:_,a:d}=c;return[r,n,_,255*d]},U=(c,r)=>{const n=K(r),_=D(c);return n&&_?`${n}-${_}`:`${n}${_}`},K=c=>{if(!c)return"";switch(c.toLowerCase()){case"bold":case"bolder":return"bold"}return""},D=c=>{if(!c)return"";switch(c.toLowerCase()){case"italic":case"oblique":return"italic"}return""},q=(c,r)=>{const n=(0,ot.Z)("safari")?.001:0,_="butt"===r;switch(c){case"dash":case"esriSLSDash":return _?[4,3]:[3,4];case"dash-dot":case"esriSLSDashDot":return _?[4,3,1,3]:[3,4,n,4];case"dot":case"esriSLSDot":return _?[1,3]:[n,4];case"long-dash":case"esriSLSLongDash":return _?[8,3]:[7,4];case"long-dash-dot":case"esriSLSLongDashDot":return _?[8,3,1,3]:[7,4,n,4];case"long-dash-dot-dot":case"esriSLSDashDotDot":return _?[8,3,1,3,1,3]:[7,4,n,4,n,4];case"short-dash":case"esriSLSShortDash":return _?[4,1]:[3,2];case"short-dash-dot":case"esriSLSShortDashDot":return _?[4,1,1,1]:[3,2,n,2];case"short-dash-dot-dot":case"esriSLSShortDashDotDot":return _?[4,1,1,1,1,1]:[3,2,n,2,n,2];case"short-dot":case"esriSLSShortDot":return _?[1,1]:[n,2];case"solid":case"esriSLSSolid":case"none":return wt.error("Unexpected: style does not require rasterization"),[0,0];default:return wt.error(`Tried to rasterize SLS, but found an unexpected style: ${c}!`),[0,0]}},z=(c,r=100)=>{const n=r/2;let _,d;const y=c;if("circle"===y||"esriSMSCircle"===y){let O=Math.acos(1-.25/n),x=Math.ceil(_t/O/4);0===x&&(x=1),O=Et/x,x*=4;const Y=[];Y.push([n,0]);for(let R=1;R<x;R++)Y.push([n*Math.cos(R*O),-n*Math.sin(R*O)]);Y.push([n,0]),_={rings:[Y]},d={xmin:-n,ymin:-n,xmax:n,ymax:n}}else if("cross"===y||"esriSMSCross"===y)_={paths:[[[0,n],[0,-n]],[[n,0],[-n,0]]]},d={xmin:-n,ymin:-n,xmax:n,ymax:n};else if("diamond"===y||"esriSMSDiamond"===y)_={rings:[[[-n,0],[0,n],[n,0],[0,-n],[-n,0]]]},d={xmin:-n,ymin:-n,xmax:n,ymax:n};else if("square"===y||"esriSMSSquare"===y)_={rings:[[[-n,-n],[-n,n],[n,n],[n,-n],[-n,-n]]]},d={xmin:-n,ymin:-n,xmax:n,ymax:n};else if("x"===y||"esriSMSX"===y)_={paths:[[[n,n],[-n,-n]],[[n,-n],[-n,n]]]},d={xmin:-n,ymin:-n,xmax:n,ymax:n};else if("triangle"===y||"esriSMSTriangle"===y){const S=.5773502691896257*r,O=-S,x=2/3*r,Y=x-r;_={rings:[[[O,Y],[0,x],[S,Y],[O,Y]]]},d={xmin:O,ymin:Y,xmax:S,ymax:x}}else"arrow"===y&&(_={rings:[[[-50,50],[50,0],[-50,-50],[-33,-20],[-33,20],[-50,50]]]},d={xmin:-n,ymin:-n,xmax:n,ymax:n});return[d,_]},s=c=>"vertical"===c||"horizontal"===c||"cross"===c||"esriSFSCross"===c||"esriSFSVertical"===c||"esriSFSHorizontal"===c,u=c=>c&&c.charAt(0).toLowerCase()+c.substr(1);function M(c,r,n){if(c.effects&&null==r.geometryEngine){if(r.geometryEnginePromise)return void n.push(r.geometryEnginePromise);(0,N.Cc)(c.effects)&&(r.geometryEnginePromise=(0,N.RI)(),n.push(r.geometryEnginePromise),r.geometryEnginePromise.then(_=>r.geometryEngine=_))}}function P(c){if(!c)return null;let r=null;const{cap:n,color:_,join:d,miterLimit:y,style:S,width:O}=c;return"solid"!==S&&"none"!==S&&"esriSLSSolid"!==S&&"esriSLSNull"!==S&&(r=[{type:"CIMGeometricEffectDashes",dashTemplate:q(S,n),lineDashEnding:"NoConstraint",scaleDash:!0,offsetAlongLine:null}]),{type:"CIMSolidStroke",color:"esriSLSNull"!==S&&"none"!==S?A(_):[0,0,0,0],capStyle:C(n),joinStyle:L(d),miterLimit:y,width:O,effects:r}}},31375:(Ut,Ft,B)=>{B.d(Ft,{Z:()=>Tt});class Tt{constructor(ft=0,ot=0,xt=0,Nt=0){this.x=ft,this.y=ot,this.width=xt,this.height=Nt}get isEmpty(){return this.width<=0||this.height<=0}union(ft){this.x=Math.min(this.x,ft.x),this.y=Math.min(this.y,ft.y),this.width=Math.max(this.width,ft.width),this.height=Math.max(this.height,ft.height)}}},47139:(Ut,Ft,B)=>{B.d(Ft,{Fp:()=>xt,RL:()=>X,UV:()=>k,bk:()=>W});var Tt=B(36161),Ct=B(91179),ft=B(31375),ot=B(39351);function xt(F){if(!F)return null;switch(F.type){case"CIMPointSymbol":{const N=F.symbolLayers;return N&&1===N.length?xt(N[0]):null}case"CIMVectorMarker":{const N=F.markerGraphics;if(!N||1!==N.length)return null;const b=N[0];if(!b)return null;const ct=b.geometry;if(!ct)return null;const ut=b.symbol;return!ut||"CIMPolygonSymbol"!==ut.type&&"CIMLineSymbol"!==ut.type||ut.symbolLayers?.some(st=>!!st.effects)?null:{geom:ct,asFill:"CIMPolygonSymbol"===ut.type}}case"sdf":return{geom:F.geom,asFill:F.asFill}}return null}function Q(F){let N=1/0,b=-1/0,ct=1/0,ut=-1/0;for(const st of F)for(const _t of st)_t[0]<N&&(N=_t[0]),_t[0]>b&&(b=_t[0]),_t[1]<ct&&(ct=_t[1]),_t[1]>ut&&(ut=_t[1]);return[N,ct,b,ut]}function W(F){return F?F.rings?Q(F.rings):F.paths?Q(F.paths):(0,Ct.YX)(F)?[F.xmin,F.ymin,F.xmax,F.ymax]:null:null}function k(F,N,b,ct,ut){const[st,_t,Et,At]=F;if(Et<st||At<_t)return[0,0,0];const yt=Et-st,Ot=At-_t,bt=ot.s4,Mt=Math.floor(.5*(64-bt)),rt=(128-2*(Mt+bt))/Math.max(yt,Ot),H=Math.round(yt*rt)+2*Mt,V=Math.round(Ot*rt)+2*Mt;let J=1;N&&(J=V/rt/(N.ymax-N.ymin));let T=0,a=0,C=1;ct&&(ut?N&&b&&N.ymax-N.ymin>0&&(C=(N.xmax-N.xmin)/(N.ymax-N.ymin),T=ct.x/(b*C),a=ct.y/b):(T=ct.x,a=ct.y)),N&&(T=.5*(N.xmax+N.xmin)+T*(N.xmax-N.xmin),a=.5*(N.ymax+N.ymin)+a*(N.ymax-N.ymin)),T-=st,a-=_t,T*=rt,a*=rt,T+=Mt,a+=Mt;let L=T/H-.5,E=a/V-.5;return ut&&b&&(L*=b*C,E*=b),[J,L,E]}function X(F){const N=function Nt(F){return F?F.rings?F.rings:F.paths?F.paths:void 0!==F.xmin&&void 0!==F.ymin&&void 0!==F.xmax&&void 0!==F.ymax?[[[F.xmin,F.ymin],[F.xmin,F.ymax],[F.xmax,F.ymax],[F.xmax,F.ymin],[F.xmin,F.ymin]]]:null:null}(F.geom),b=function nt(F){let N=1/0,b=-1/0,ct=1/0,ut=-1/0;for(const st of F)for(const _t of st)_t[0]<N&&(N=_t[0]),_t[0]>b&&(b=_t[0]),_t[1]<ct&&(ct=_t[1]),_t[1]>ut&&(ut=_t[1]);return new ft.Z(N,ct,b-N,ut-ct)}(N),ut=ot.s4,st=Math.floor(.5*(64-ut)),_t=(128-2*(st+ut))/Math.max(b.width,b.height),Et=Math.round(b.width*_t)+2*st,At=Math.round(b.height*_t)+2*st,yt=[];for(const wt of N)if(wt&&wt.length>1){const bt=[];for(const Mt of wt){let[rt,H]=Mt;rt-=b.x,H-=b.y,rt*=_t,H*=_t,rt+=st-.5,H+=st-.5,bt.push(F.asFill?[rt,H]:[Math.round(rt),Math.round(H)])}if(F.asFill){const Mt=bt.length-1;bt[0][0]===bt[Mt][0]&&bt[0][1]===bt[Mt][1]||bt.push(bt[0])}yt.push(bt)}const Ot=function ht(F,N,b,ct){const ut=N*b,st=new Array(ut),_t=ct*ct+1;for(let Et=0;Et<ut;++Et)st[Et]=_t;for(const Et of F){const At=Et.length;for(let yt=1;yt<At;++yt){const Ot=Et[yt-1],wt=Et[yt];let bt,Mt,rt,H;Ot[0]<wt[0]?(bt=Ot[0],Mt=wt[0]):(bt=wt[0],Mt=Ot[0]),Ot[1]<wt[1]?(rt=Ot[1],H=wt[1]):(rt=wt[1],H=Ot[1]);let V=Math.floor(bt)-ct,J=Math.floor(Mt)+ct,T=Math.floor(rt)-ct,a=Math.floor(H)+ct;V<0&&(V=0),J>N&&(J=N),T<0&&(T=0),a>b&&(a=b);const C=wt[0]-Ot[0],L=wt[1]-Ot[1],E=C*C+L*L;for(let I=V;I<J;I++)for(let A=T;A<a;A++){let U,K,D=(I-Ot[0])*C+(A-Ot[1])*L;D<0?(U=Ot[0],K=Ot[1]):D>E?(U=wt[0],K=wt[1]):(D/=E,U=Ot[0]+D*C,K=Ot[1]+D*L);const q=(I-U)*(I-U)+(A-K)*(A-K),et=(b-A-1)*N+I;q<st[et]&&(st[et]=q)}}}for(let Et=0;Et<ut;++Et)st[Et]=Math.sqrt(st[Et]);return st}(yt,Et,At,st);return F.asFill&&function pt(F,N,b,ct,ut){for(const st of F){const _t=st.length;for(let Et=1;Et<_t;++Et){const At=st[Et-1],yt=st[Et];let Ot,wt,bt,Mt;At[0]<yt[0]?(Ot=At[0],wt=yt[0]):(Ot=yt[0],wt=At[0]),At[1]<yt[1]?(bt=At[1],Mt=yt[1]):(bt=yt[1],Mt=At[1]);let rt=Math.floor(Ot),H=Math.floor(wt)+1,V=Math.floor(bt),J=Math.floor(Mt)+1;rt<ct&&(rt=ct),H>N-ct&&(H=N-ct),V<ct&&(V=ct),J>b-ct&&(J=b-ct);for(let T=V;T<J;++T){if(At[1]>T==yt[1]>T)continue;const a=(b-T-1)*N;for(let C=rt;C<H;++C)C<(yt[0]-At[0])*(T-At[1])/(yt[1]-At[1])+At[0]&&(ut[a+C]=-ut[a+C]);for(let C=ct;C<rt;++C)ut[a+C]=-ut[a+C]}}}}(yt,Et,At,st,Ot),[Pt(Ot,st),Et,At]}function Pt(F,N){const b=2*N,ct=F.length,ut=new Uint8Array(4*ct);for(let st=0;st<ct;++st)(0,Tt.I)(.5-F[st]/b,ut,4*st);return ut}},68937:(Ut,Ft,B)=>{B.d(Ft,{Z:()=>xt});var Tt=B(23841),Ct=B(50369);function ot(nt){return`rgba(${nt.slice(0,3).toString()},${nt[3]})`}class xt{constructor(Q){Q&&(this._textRasterizationCanvas=Q)}rasterizeText(Q,W){this._textRasterizationCanvas||(this._textRasterizationCanvas=document.createElement("canvas"));const k=this._textRasterizationCanvas,X=k.getContext("2d");this._setFontProperties(X,W),this._parameters=W,this._textLines=Q.split(/\r?\n/),this._lineHeight=this._computeLineHeight();const{decoration:ht,weight:pt}=W.font;this._lineThroughWidthOffset=ht&&"line-through"===ht?.1*this._lineHeight:0;const Pt=null!=W.backgroundColor||null!=W.borderLine,F=Pt?Ct.c9:0,N=this._computeTextWidth(X,W)+2*F,b=this._lineHeight*this._textLines.length+2*F;if(k.width=N+2*this._lineThroughWidthOffset,k.height=b,0===k.width||0===k.height)return k.width=k.height=1,{size:[0,0],image:new Uint32Array(0),sdf:!1,simplePattern:!1,anchorX:0,anchorY:0,canvas:k};this._renderedLineHeight=Math.round(this._lineHeight*W.pixelRatio),this._renderedHaloSize=(0,Tt.F2)(W.halo.size)*W.pixelRatio,this._renderedWidth=N*W.pixelRatio,this._renderedHeight=b*W.pixelRatio,this._lineThroughWidthOffset*=W.pixelRatio;const ut=W.halo&&W.halo.color?W.halo.color:[0,0,0,0];this._fillStyle=ot(W.color??[0,0,0,0]),this._haloStyle=function ft(nt){return`rgb(${nt.slice(0,3).toString()})`}(ut);const st=this._renderedLineHeight,_t=this._renderedHaloSize;X.save(),X.clearRect(0,0,k.width,k.height),this._setFontProperties(X,W);const Et=F*W.pixelRatio,At=function Nt(nt,Q){return"center"===nt?.5*Q:"right"===nt?Q:0}(X.textAlign,this._renderedWidth-2*Et)+_t+Et,yt=_t+Et,Ot=_t>0;let wt=this._lineThroughWidthOffset,bt=0;if(Pt){X.save();const a=W.backgroundColor??[0,0,0,0],C=W.borderLine?.color??[0,0,0,0],L=2*(0,Tt.F2)(W.borderLine?.size??0);X.fillStyle=ot(a),X.strokeStyle=ot(C),X.lineWidth=L,X.fillRect(0,0,k.width,k.height),X.strokeRect(0,0,k.width,k.height),X.restore()}Ot&&this._renderHalo(X,At,yt,wt,bt,W),bt+=yt,wt+=At;for(const a of this._textLines)Ot?(X.globalCompositeOperation="destination-out",X.fillStyle="rgb(0, 0, 0)",X.fillText(a,wt,bt),X.globalCompositeOperation="source-over",X.fillStyle=this._fillStyle,X.fillText(a,wt,bt)):(X.fillStyle=this._fillStyle,X.fillText(a,wt,bt)),ht&&"none"!==ht&&this._renderDecoration(X,wt,bt,ht,pt),bt+=st;X.restore();const Mt=this._renderedWidth+2*this._lineThroughWidthOffset,rt=this._renderedHeight,H=X.getImageData(0,0,Mt,rt),V=new Uint8Array(H.data);if(W.premultiplyColors){let a;for(let C=0;C<V.length;C+=4)a=V[C+3]/255,V[C]=V[C]*a,V[C+1]=V[C+1]*a,V[C+2]=V[C+2]*a}let J,T;switch(W.horizontalAlignment){case"left":J=-.5;break;case"right":J=.5;break;default:J=0}switch(W.verticalAlignment){case"bottom":T=-.5;break;case"top":T=.5;break;default:T=0}return{size:[Mt,rt],image:new Uint32Array(V.buffer),sdf:!1,simplePattern:!1,anchorX:J,anchorY:T,canvas:k}}_renderHalo(Q,W,k,X,ht,pt){const Pt=this._renderedWidth,F=this._renderedHeight;this._haloRasterizationCanvas||(this._haloRasterizationCanvas=document.createElement("canvas")),this._haloRasterizationCanvas.width=Pt,this._haloRasterizationCanvas.height=F;const N=this._haloRasterizationCanvas,b=N.getContext("2d");b.clearRect(0,0,Pt,F),this._setFontProperties(b,pt);const{decoration:ct,weight:ut}=pt.font;b.fillStyle=this._haloStyle,b.strokeStyle=this._haloStyle,b.lineJoin="round",this._renderHaloNative(b,W,k,ct,ut),Q.globalAlpha=this._parameters.halo.color[3],Q.drawImage(N,0,0,Pt,F,X,ht,Pt,F),Q.globalAlpha=1}_renderHaloNative(Q,W,k,X,ht){const pt=this._renderedLineHeight,Pt=this._renderedHaloSize;for(const F of this._textLines){const N=2*Pt,b=5,ct=.1;for(let ut=0;ut<b;ut++){const st=(1-(b-1)*ct+ut*ct)*N;Q.lineWidth=st,Q.strokeText(F,W,k),X&&"none"!==X&&this._renderDecoration(Q,W,k,X,ht,st)}k+=pt}}_setFontProperties(Q,W){const k=Math.max(W.size,.5),X=W.font,ht=`${X.style} ${X.weight} ${(0,Tt.F2)(k*W.pixelRatio).toFixed(1)}px ${X.family}, sans-serif`;let pt;switch(Q.font=ht,Q.textBaseline="top",W.horizontalAlignment){case"left":default:pt="left";break;case"right":pt="right";break;case"center":pt="center"}Q.textAlign=pt}computeTextSize(Q,W){this._textRasterizationCanvas||(this._textRasterizationCanvas=document.createElement("canvas"));const k=this._textRasterizationCanvas,X=k.getContext("2d");this._setFontProperties(X,W),this._parameters=W,this._textLines=Q.split(/\r?\n/),this._lineHeight=this._computeLineHeight();const ht=this._computeTextWidth(X,W),pt=this._lineHeight*this._textLines.length;return k.width=ht,k.height=pt,[ht*W.pixelRatio,pt*W.pixelRatio]}_computeTextWidth(Q,W){let k=0;for(const ht of this._textLines)k=Math.max(k,Q.measureText(ht).width);const X=W.font;return("italic"===X.style||"oblique"===X.style||"string"==typeof X.weight&&("bold"===X.weight||"bolder"===X.weight)||"number"==typeof X.weight&&X.weight>600)&&(k+=.3*Q.measureText("w").width),k+=2*(0,Tt.F2)(this._parameters.halo.size),Math.round(k)}_computeLineHeight(){let Q=1.275*this._parameters.size;const W=this._parameters.font.decoration;return W&&"underline"===W&&(Q*=1.3),Math.round(Q+2*(0,Tt.F2)(this._parameters.halo.size))}_renderDecoration(Q,W,k,X,ht,pt){const Pt=.9*this._lineHeight,F="bold"===ht?.06:"bolder"===ht?.09:.04;switch(Q.textAlign){case"center":W-=this._renderedWidth/2;break;case"right":W-=this._renderedWidth}const N=Q.textBaseline;if("underline"===X)switch(N){case"top":k+=Pt;break;case"middle":k+=Pt/2}else if("line-through"===X)switch(N){case"top":k+=Pt/1.5;break;case"middle":k+=Pt/3}const b=pt?1.5*pt:Math.ceil(Pt*F);Q.save(),Q.beginPath(),Q.strokeStyle=Q.fillStyle,Q.lineWidth=b,Q.moveTo(W-this._lineThroughWidthOffset,k),Q.lineTo(W+this._renderedWidth+2*this._lineThroughWidthOffset,k),Q.stroke(),Q.restore()}}},13871:(Ut,Ft,B)=>{B.d(Ft,{_:()=>wt,S:()=>H});var Tt=B(15861),Ct=B(91558),ft=B(17002),ot=B(58817),xt=B(63290),Nt=B(23841),nt=B(77275),Q=B(46679),W=B(26933),k=B(35909),X=B(7547);const ht=.05,Pt=new Set(["StartTimeOffset","Duration","RepeatDelay"]);function F(T,a){return Pt.has(a)?function pt(T){return Math.max(Math.round(T/ht),1)*ht}(T):T}var N=B(47139),b=B(80991),ct=B(73608),ut=B(39236),st=B(39351),_t=B(3959);const Et=xt.Z.getLogger("esri.symbols.cim.cimAnalyzer");function At(T){switch(T){case"Butt":return X.RL.BUTT;case"Square":return X.RL.SQUARE;default:return X.RL.ROUND}}function yt(T){switch(T){case"Bevel":return X.AH.BEVEL;case"Miter":return X.AH.MITER;default:return X.AH.ROUND}}function Ot(T){const a=T.markerPlacement;return a&&a.angleToLine?X.v2.MAP:X.v2.SCREEN}class wt{constructor(a,C){this._cimLayers=[],this._poMap={},this._primitiveOverrides=[],this._resourceManager=a,this._info=C}analyzeSymbolReference(a,C,L){var E=this;return(0,Tt.Z)(function*(){if(E._cimLayers=L??[],!a)return E._cimLayers;if(a.primitiveOverrides){E._primitiveOverrides=a.primitiveOverrides,E._poMap={};const U=[],K=E._info;for(const D of E._primitiveOverrides){const q=D.valueExpressionInfo;if(q&&K){const z=(0,Q.Yi)(q.expression,K.spatialReference,K.fields).then(s=>{null!=s&&E._setPoMap(D.primitiveName,D.propertyName,s)});U.push(z)}else null!=D.value&&E._setPoMap(D.primitiveName,D.propertyName,D.value);U.length>0&&(yield Promise.all(U))}}const I=a.symbol,A=[];return k.B$.fetchResources(I,E._resourceManager,A),A.length>0&&(yield Promise.all(A)),E._analyzeSymbol(I,C),E._cimLayers})()}_analyzeSymbol(a,C){switch(a?.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":this._analyzeMultiLayerSymbol(a,C,1,0,0,0)}}_analyzeMultiLayerSymbol(a,C,L,E,I,A){const U=a?.symbolLayers;if(!U)return;const K=a.effects;let D=X.v2.SCREEN;const q=k.B$.getSize(a)??0;"CIMPointSymbol"===a.type&&"Map"===a.angleAlignment&&(D=X.v2.MAP);const et="CIMPolygonSymbol"===a.type;let z=U.length;for(;z--;){const s=U[z];if(!s||!1===s.enable)continue;let u;K?.length&&(u=[...K]);const M=s.effects;M?.length&&(K?u.push(...M):u=[...M]);const P=[];let c;switch(k.E0.findEffectOverrides(u,this._primitiveOverrides,P),c=P.length>0?this._createEffectsOverrideFunction(u,P):u,k.E0.findApplicableOverrides(s,this._primitiveOverrides,[]),s.type){case"CIMSolidFill":this._analyzeSolidFill(s,c);break;case"CIMPictureFill":this._analyzePictureFill(s,c);break;case"CIMHatchFill":this._analyzeHatchFill(s,c);break;case"CIMGradientFill":this._analyzeGradientFill(s,c);break;case"CIMSolidStroke":this._analyzeSolidStroke(s,c,et,q);break;case"CIMPictureStroke":this._analyzePictureStroke(s,c,et,q);break;case"CIMGradientStroke":this._analyzeGradientStroke(s,c,et,q);break;case"CIMCharacterMarker":case"CIMPictureMarker":case"CIMVectorMarker":{"CIMLineSymbol"===a.type&&(D=Ot(s));const n=[],_=s.primitiveName;_&&n.push(_),this._analyzeMarker(s,c,null,n,D,q,1,C,L,E,I,A);break}default:Et.error("Cannot analyze CIM layer",s.type)}}}_analyzeSolidFill(a,C){const L=a.primitiveName,E=(0,b.NO)(a.color),[I,A]=this._analyzePrimitiveOverrides(L,C,null,null),U=(0,nt.hP)(JSON.stringify(a)+A).toString();this._cimLayers.push({type:"fill",templateHash:U,materialHash:I?()=>U:U,cim:a,materialOverrides:null,colorLocked:!!a.colorLocked,color:this._createOverrideFunction(L,"Color",E,Mt),height:0,angle:0,offsetX:0,offsetY:0,scaleX:1,effects:C,applyRandomOffset:!1,sampleAlphaOnly:!0})}_analyzePictureFill(a,C){const L=a.primitiveName,E=(0,b.cO)(a),[I,A]=this._analyzePrimitiveOverrides(L,C,null,null),U=(0,nt.hP)(JSON.stringify(a)+A).toString(),K=(0,nt.hP)(`${a.url}${JSON.stringify(a.colorSubstitutions)}`).toString(),D=(0,b.NA)(a.height,W.v$);let q=(0,b.NA)(a.scaleX,1);if("width"in a&&"number"==typeof a.width){const et=a.width;let z=1;const s=this._resourceManager.getResource(a.url);null!=s&&(z=s.width/s.height),q/=z*(D/et)}this._cimLayers.push({type:"fill",templateHash:U,materialHash:I?()=>K:K,cim:a,materialOverrides:null,colorLocked:!!a.colorLocked,effects:C,color:this._createOverrideFunction(L,"TintColor",E,Mt),height:this._createOverrideFunction(L,"Height",D),scaleX:this._createOverrideFunction(L,"ScaleX",q),angle:this._createOverrideFunction(L,"Rotation",(0,b.NA)(a.rotation)),offsetX:this._createOverrideFunction(L,"OffsetX",(0,b.NA)(a.offsetX)),offsetY:this._createOverrideFunction(L,"OffsetY",(0,b.NA)(a.offsetY)),url:a.url,applyRandomOffset:!1,sampleAlphaOnly:!1})}_analyzeHatchFill(a,C){const L=a.primitiveName,E=this._analyzeMaterialOverrides(L,["Rotation","OffsetX","OffsetY"]);let[I,A]=this._analyzePrimitiveOverrides(L,C,null,null);const U=(0,nt.hP)(JSON.stringify(a)+A).toString(),K=(0,nt.hP)(`${a.separation}${JSON.stringify(a.lineSymbol)}`).toString();let D={r:255,g:255,b:255,a:1},q=!1;const et=a.lineSymbol?.symbolLayers?.find(z=>"CIMSolidStroke"===z.type&&null!=this._poMap[z.primitiveName]?.Color);if(et){D=(0,b.NO)(et.color),D=this._createOverrideFunction(et.primitiveName,"Color",D,Mt);const z="function"==typeof D;I=I||z,q=null!=et.color||z}this._cimLayers.push({type:"fill",templateHash:U,materialHash:I&&E?this._createMaterialHashFunction(K,E):K,cim:a,materialOverrides:E,colorLocked:!!a.colorLocked,effects:C,color:D,height:this._createOverrideFunction(L,"Separation",(0,b.NA)(a.separation,W.rC)),scaleX:1,angle:this._createOverrideFunction(L,"Rotation",(0,b.NA)(a.rotation)),offsetX:this._createOverrideFunction(L,"OffsetX",(0,b.NA)(a.offsetX)),offsetY:this._createOverrideFunction(L,"OffsetY",(0,b.NA)(a.offsetY)),applyRandomOffset:!1,sampleAlphaOnly:!0,hasUnresolvedReplacementColor:!q})}_analyzeGradientFill(a,C){const L=a.primitiveName,[E,I]=this._analyzePrimitiveOverrides(L,C,null,null),A=(0,nt.hP)(JSON.stringify(a)+I).toString();this._cimLayers.push({type:"fill",templateHash:A,materialHash:E?()=>A:A,cim:a,materialOverrides:null,colorLocked:!!a.colorLocked,effects:C,color:{r:128,g:128,b:128,a:1},height:0,angle:0,offsetX:0,offsetY:0,scaleX:1,applyRandomOffset:!1,sampleAlphaOnly:!1})}_analyzeSolidStroke(a,C,L,E){const I=a.primitiveName,A=(0,b.NO)(a.color),U=(0,b.NA)(a.width,W.KM),K=At(a.capStyle),D=yt(a.joinStyle),q=a.miterLimit,[et,z]=this._analyzePrimitiveOverrides(I,C,null,null),s=(0,nt.hP)(JSON.stringify(a)+z).toString();let u,M;if(C&&C instanceof Array&&C.length>0){const P=C[C.length-1];if("CIMGeometricEffectDashes"===P.type&&"NoConstraint"===P.lineDashEnding&&null===P.offsetAlongLine){const c=(C=[...C]).pop();u=c.dashTemplate,M=c.scaleDash}}this._cimLayers.push({type:"line",templateHash:s,materialHash:et?()=>s:s,cim:a,materialOverrides:null,isOutline:L,colorLocked:!!a.colorLocked,effects:C,color:this._createOverrideFunction(I,"Color",A,Mt),width:this._createOverrideFunction(I,"Width",U),cap:this._createOverrideFunction(I,"CapStyle",K),join:this._createOverrideFunction(I,"JoinStyle",D),miterLimit:q&&this._createOverrideFunction(I,"MiterLimit",q),referenceWidth:E,zOrder:bt(a.name),dashTemplate:u,scaleDash:M,sampleAlphaOnly:!0})}_analyzePictureStroke(a,C,L,E){const I=(0,nt.hP)(`${a.url}${JSON.stringify(a.colorSubstitutions)}`).toString(),A=a.primitiveName,U=(0,b.cO)(a),K=(0,b.NA)(a.width,W.KM),D=At(a.capStyle),q=yt(a.joinStyle),et=a.miterLimit,[z,s]=this._analyzePrimitiveOverrides(A,C,null,null),u=(0,nt.hP)(JSON.stringify(a)+s).toString();this._cimLayers.push({type:"line",templateHash:u,materialHash:z?()=>I:I,cim:a,materialOverrides:null,isOutline:L,colorLocked:!!a.colorLocked,effects:C,color:this._createOverrideFunction(A,"TintColor",U,Mt),width:this._createOverrideFunction(A,"Width",K),cap:this._createOverrideFunction(A,"CapStyle",D),join:this._createOverrideFunction(A,"JoinStyle",q),miterLimit:et&&this._createOverrideFunction(A,"MiterLimit",et),referenceWidth:E,zOrder:bt(a.name),dashTemplate:null,scaleDash:!1,url:a.url,sampleAlphaOnly:!1})}_analyzeGradientStroke(a,C,L,E){const I=a.primitiveName,A=(0,b.NA)(a.width,W.KM),U=At(a.capStyle),K=yt(a.joinStyle),D=a.miterLimit,[q,et]=this._analyzePrimitiveOverrides(I,C,null,null),z=(0,nt.hP)(JSON.stringify(a)+et).toString();this._cimLayers.push({type:"line",templateHash:z,materialHash:q?()=>z:z,cim:a,materialOverrides:null,isOutline:L,colorLocked:!!a.colorLocked,effects:C,color:{r:128,g:128,b:128,a:1},width:this._createOverrideFunction(I,"Width",A),cap:this._createOverrideFunction(I,"CapStyle",U),join:this._createOverrideFunction(I,"JoinStyle",K),miterLimit:D&&this._createOverrideFunction(I,"MiterLimit",D),referenceWidth:E,zOrder:bt(a.name),dashTemplate:null,scaleDash:!1,sampleAlphaOnly:!1})}_analyzeMarker(a,C,L,E,I,A,U,K,D,q,et,z,s=!1){if(this._analyzeMarkerInsidePolygon(a,C))return;const u=(0,b.NA)(a.size,W.w7),M=(0,b.NA)(a.rotation),P=(0,b.NA)(a.offsetX),c=(0,b.NA)(a.offsetY);let r=this._createOverrideFunction(a.primitiveName,"Size",u),n=this._createOverrideFunction(a.primitiveName,"Rotation",M),_=this._createOverrideFunction(a.primitiveName,"OffsetX",P),d=this._createOverrideFunction(a.primitiveName,"OffsetY",c);r=this._transformSize(r,U),n=this._transformRotation(n,!!a.rotateClockwise,q);const y=this._transformOffsetX(_,d,q,U,et),S=this._transformOffsetY(_,d,q,U,z);switch(_=y,d=S,a.type){case"CIMPictureMarker":this._analyzePictureMarker(a,C,L,E,I,A,r,n,_,d,a.colorLocked||s);break;case"CIMVectorMarker":this._analyzeVectorMarker(a,C,L,E,I,A,U,K,r,n,_,d,a.colorLocked||s)}}_analyzeMarkerInsidePolygon(a,C){const{markerPlacement:L,type:E}=a;if(!L||"CIMMarkerPlacementInsidePolygon"!==L.type)return!1;if("CIMVectorMarker"===E||"CIMPictureMarker"===E){const P=a.primitiveName;if(P){const[r,n]=this._analyzePrimitiveOverrides([P],C,null,null);if(r)return!1}const c=L.primitiveName;if(c){const[r,n]=this._analyzePrimitiveOverrides([c],C,null,null);if(r)return!1}if("CIMVectorMarker"===E){const{markerGraphics:r}=a;if(r)for(const n of r){const{symbol:_}=n;if("CIMPolygonSymbol"===_?.type&&_.symbolLayers){const{symbolLayers:d}=_;for(const y of d)if("CIMSolidStroke"===y.type)return!1}}}else{const{animatedSymbolProperties:r}=a;if(r)return!1}}const I=L,A=Math.abs(I.stepX),U=Math.abs(I.stepY);if(0===A||0===U)return!0;const K=new Set(["Rotation","OffsetX","OffsetY"]),D=this._primitiveOverrides.filter(P=>P.primitiveName!==a.primitiveName||!K.has(P.propertyName)),q="url"in a&&"string"==typeof a.url?a.url:void 0,et=(0,nt.hP)(JSON.stringify(a)).toString();let z,s,u=null;if("Random"===L.gridType){const P=(0,Nt.Wz)(st.KA),c=Math.max(Math.floor(P/A),1),r=Math.max(Math.floor(P/U),1);z=U*r,u=n=>n?n*r:0,s=c*A/z}else L.shiftOddRows?(z=2*U,u=P=>P?2*P:0,s=A/U*.5):(z=U,u=null,s=A/U);const M=(0,b.cO)(a);return this._cimLayers.push({type:"fill",templateHash:et,materialHash:et,cim:a,materialOverrides:D,colorLocked:!!a.colorLocked,effects:C,color:M,height:this._createOverrideFunction(I.primitiveName,"StepY",z,u),scaleX:s,angle:I.gridAngle,offsetX:(0,b.NA)(I.offsetX),offsetY:(0,b.NA)(I.offsetY),url:q,applyRandomOffset:"Random"===L.gridType,sampleAlphaOnly:!q,hasUnresolvedReplacementColor:!0}),!0}_analyzePictureMarker(a,C,L,E,I,A,U,K,D,q,et){let z=(0,b.NA)(a.scaleX,1);const s=(0,b.cO)(a),u=(0,nt.hP)(`${a.url}${JSON.stringify(a.colorSubstitutions)}${JSON.stringify(a.animatedSymbolProperties)}`).toString();L||(L=this._createMarkerPlacementOverrideFunction(a.markerPlacement));const M=this._createAnimatedSymbolPropertiesOverrideFunction(a.animatedSymbolProperties),[P,c]=this._analyzePrimitiveOverrides(E,C,L,M),r=(0,nt.hP)(JSON.stringify(a)+c).toString(),n=a.anchorPoint??{x:0,y:0};if("width"in a&&"number"==typeof a.width){const y=a.width;let S=1;const O=this._resourceManager.getResource(a.url);null!=O&&(S=O.width/O.height),z/=S*((0,b.NA)(a.size)/y)}function _(y,S){return null!=M?(0,b.hf)(M,y,S):null}this._cimLayers.push({type:"marker",templateHash:r,materialHash:a.animatedSymbolProperties&&!0===a.animatedSymbolProperties.randomizeStartTime?(y,S,O,x)=>{const Y=(0,_t.$)(x??0),R=_(y,S);return u+`-MATERIALGROUP(${Y})-ASP(${JSON.stringify(R)})`}:P?(y,S)=>{const O=_(y,S);return u+`-ASP(${JSON.stringify(O)})`}:u,cim:a,materialOverrides:null,colorLocked:!!a.colorLocked||!!et,effects:C,scaleSymbolsProportionally:!1,alignment:I,size:U,scaleX:this._createOverrideFunction(a.primitiveName,"ScaleX",z),rotation:K,offsetX:D,offsetY:q,color:this._createOverrideFunction(a.primitiveName,"TintColor",s,Mt),anchorPoint:{x:n.x,y:n.y},isAbsoluteAnchorPoint:"Relative"!==a.anchorPointUnits,outlineColor:{r:0,g:0,b:0,a:0},outlineWidth:0,frameHeight:0,rotateClockwise:!1,referenceSize:A,sizeRatio:1,markerPlacement:L,url:a.url,animatedSymbolProperties:M})}_analyzeVectorMarker(a,C,L,E,I,A,U,K,D,q,et,z,s){const u=a.markerGraphics;if(!u)return;const M=a.frame;let P=0,c=1;a.scaleSymbolsProportionally&&M&&(P=M.ymax-M.ymin,c=this._transformSize(D,1/P)),c=this._transformSize(c,U),L||(L=this._createMarkerPlacementOverrideFunction(a.markerPlacement));for(const r of u)if(r){const n=r.symbol;if(!n)continue;const _=r.primitiveName;_&&E.push(_);let d=et,y=z;if(("CIMPointSymbol"===n.type||"CIMTextSymbol"===n.type)&&M){let S=0,O=0;const x=r.geometry;"x"in x&&"y"in x&&(S+=x.x-.5*(M.xmin+M.xmax),O+=x.y-.5*(M.ymin+M.ymax));const Y=a.anchorPoint;Y&&("Absolute"===a.anchorPointUnits?(S-=Y.x,O-=Y.y):M&&(S-=(M.xmax-M.xmin)*Y.x,O-=(M.ymax-M.ymin)*Y.y)),d=this._transformOffsetX(S,O,q,c,et),y=this._transformOffsetY(S,O,q,c,z)}switch(n.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":K||J(n)?this._analyzeMultiLayerGraphicNonSDF(a,C,L,null,r,E,I,A,P,!!s||!!a.colorLocked):this._analyzeMultiLayerGraphic(a,C,L,null,r,E,I,A,P,c,D,q,d,y,!!s||!!a.colorLocked);break;case"CIMTextSymbol":this._analyzeTextGraphic(a,C,L,r,E,I,A,P,c,D,q,d,y,!!s||!!a.colorLocked)}_&&E.pop()}}_analyzeMultiLayerGraphic(a,C,L,E,I,A,U,K,D,q,et,z,s,u,M){const P=I.symbol,c=P.symbolLayers;if(!c)return;let r=c.length;if(V(c))return void this._analyzeCompositeMarkerGraphic(a,C,L,E,I,c,A,U,K,D,et,z,s,u,!!M||!!a.colorLocked);const n=this._resourceManager.geometryEngine,_=ct.j.applyEffects(P.effects,I.geometry,n);if(_)for(;r--;){const d=c[r];if(!d||!1===d.enable)continue;const y=d.primitiveName;switch(y&&A.push(y),d.type){case"CIMSolidFill":case"CIMSolidStroke":{const S=ct.j.applyEffects(d.effects,_,n),O=(0,N.bk)(S);if(!O)continue;const x="Relative"!==a.anchorPointUnits,[Y,R,$]=(0,N.UV)(O,a.frame,a.size,a.anchorPoint,x),at="CIMSolidFill"===d.type,it={type:"sdf",geom:S,asFill:at},mt=d.path,lt=at?(0,b.NO)((0,b.W7)(d)):null==mt?(0,b.NO)((0,b.$Z)(d)):{r:0,g:0,b:0,a:0},gt=at?{r:0,g:0,b:0,a:0}:(0,b.NO)((0,b.$Z)(d)),It=(0,b.F)(d)??0;if(!at&&!It)break;const vt=I.primitiveName;let Dt=null;at&&!d.colorLocked&&(Dt=this._createOverrideFunction(vt,"FillColor",lt,Mt));let Gt=null;at||d.colorLocked||(Gt=this._createOverrideFunction(vt,"StrokeColor",gt,Mt));const Bt=this._createOverrideFunction(vt,"StrokeWidth",It);let Xt=!1,Rt="";for(const Ht of this._primitiveOverrides)A.includes(Ht.primitiveName)&&(null!=Ht.value?Rt+=`-${Ht.primitiveName}-${Ht.propertyName}-${JSON.stringify(Ht.value)}`:Ht.valueExpressionInfo&&(Xt=!0));(null!=C&&"function"==typeof C||null!=L&&"function"==typeof L)&&(Xt=!0),((0,b.wO)(et)||(0,b.wO)(z)||(0,b.wO)(s)||(0,b.wO)(u))&&(Xt=!0);const jt=JSON.stringify({...a,markerGraphics:null}),Vt=(0,nt.hP)(JSON.stringify(it)+mt).toString(),$t=(0,nt.hP)(JSON.stringify(I)+JSON.stringify(d)+jt+Rt).toString();this._cimLayers.push({type:"marker",templateHash:$t,materialHash:Xt?()=>Vt:Vt,cim:it,materialOverrides:null,colorLocked:!!d.colorLocked||!!M,effects:C,scaleSymbolsProportionally:!!a.scaleSymbolsProportionally,alignment:U,anchorPoint:{x:R,y:$},isAbsoluteAnchorPoint:x,size:et,rotation:z,offsetX:s,offsetY:u,scaleX:1,frameHeight:D,rotateClockwise:!1,referenceSize:K,sizeRatio:Y,color:(0,b.wO)(Dt)?Dt:this._createOverrideFunction(y,"Color",lt,Mt),outlineColor:(0,b.wO)(Gt)?Gt:this._createOverrideFunction(y,"Color",gt,Mt),outlineWidth:(0,b.wO)(Bt)?Bt:this._createOverrideFunction(y,"Width",It),markerPlacement:L,animatedSymbolProperties:E,path:mt});break}case"CIMVectorMarker":d.markerPlacement?this._analyzeMultiLayerGraphicNonSDF(a,C,L,E,I,A,U,K,D,!!M||!!d.colorLocked):this._analyzeMarker(d,C,L,A,U,K,q,!1,et,z,s,u,!!M||!!a.colorLocked);break;default:this._analyzeMultiLayerGraphicNonSDF(a,C,L,E,I,A,U,K,D,!!M||!!a.colorLocked)}y&&A.pop()}}_analyzeTextGraphic(a,C,L,E,I,A,U,K,D,q,et,z,s,u){k.E0.findApplicableOverrides(E,this._primitiveOverrides,[]);const P=E.geometry;if(!("x"in P)||!("y"in P))return;const c=E.symbol,r=(0,b.BX)(c),n=(0,b.wi)(c.fontStyleName),_=(0,ft.BN)(c.fontFamilyName);c.font={family:_,decoration:r,...n};let d=(0,b.NA)(c.height,W.zV),y=(0,b.NA)(c.angle),S=(0,b.NA)(c.offsetX),O=(0,b.NA)(c.offsetY);d=this._transformSize(d,D),y=this._transformRotation(y,!1,et);const x=this._transformOffsetX(S,O,et,D,z),Y=this._transformOffsetY(S,O,et,D,s);S=x,O=Y;const R=(0,b.NO)((0,b.W7)(c));let $=(0,b.NO)((0,b.$Z)(c)),at=(0,b.F)(c)??0;at||($=(0,b.NO)((0,b.W7)(c.haloSymbol)),at=(0,b.NA)(c.haloSize)),at=this._transformSize(at,D);let it=!1;if(c.symbol?.symbolLayers)for(const Ht of c.symbol.symbolLayers)null!=(0,b.W7)(Ht)&&(it=!!Ht.colorLocked);let lt=null;it||(lt=this._createOverrideFunction(E.primitiveName,"Color",R,Mt));let gt=null,It=null,vt=0;if(c.callout&&"CIMBackgroundCallout"===c.callout.type){const Ht=c.callout;if(Ht.backgroundSymbol){const Kt=Ht.backgroundSymbol.symbolLayers;if(Kt)for(const Jt of Kt)"CIMSolidFill"===Jt.type?gt=(0,b.NO)(Jt.color):"CIMSolidStroke"===Jt.type&&(It=(0,b.NO)(Jt.color),vt=(0,b.NA)(Jt.width,W.KM))}}const[Dt,Gt]=this._analyzePrimitiveOverrides(I,C,L,null),Bt=JSON.stringify(a.effects)+Number(a.colorLocked||u).toString()+JSON.stringify(a.anchorPoint)+a.anchorPointUnits+JSON.stringify(a.markerPlacement)+a.size.toString(),Xt=(0,nt.hP)(JSON.stringify(E)+Bt+Gt).toString();let Rt=this._createOverrideFunction(E.primitiveName,"TextString",E.textString??"",b.QI,c.textCase);if(null==Rt)return;const{fontStyleName:jt}=c,Vt=_+(jt?"-"+jt.toLowerCase():"-regular"),$t=Vt;"string"==typeof Rt&&Rt.includes("[")&&c.fieldMap&&(Rt=(0,b.Qs)(c.fieldMap,Rt,c.textCase)),this._cimLayers.push({type:"text",templateHash:Xt,materialHash:Dt||"function"==typeof Rt||/\[(.*?)\]/.test(Rt)?(Ht,Kt,Jt)=>$t+"-"+(0,b.hf)(Rt,Ht,Kt,Jt):$t+"-"+(0,nt.hP)(Rt),cim:c,materialOverrides:null,colorLocked:!!u||!!it,effects:C,alignment:A,anchorPoint:{x:0,y:0},isAbsoluteAnchorPoint:"Relative"!==a.anchorPointUnits,fontName:Vt,decoration:r,weight:n.weight,style:n.style,size:d,angle:y,offsetX:S,offsetY:O,horizontalAlignment:(0,b.X_)(c.horizontalAlignment),verticalAlignment:(0,b.FG)(c.verticalAlignment),text:Rt,color:(0,b.wO)(lt)?lt:R,outlineColor:$,outlineSize:at,backgroundColor:gt,borderLineColor:It,borderLineWidth:vt,lineWidth:null,referenceSize:U,sizeRatio:1,markerPlacement:L})}_analyzeMultiLayerGraphicNonSDF(a,C,L,E,I,A,U,K,D,q){const et=this._buildSimpleMarker(a,I),z=a.primitiveName,s=this._analyzeMaterialOverrides(z,["Rotation","OffsetX","OffsetY"]),[u,M]=this._analyzePrimitiveOverrides(A,null,null,null),[P,c,r]=k.B$.getTextureAnchor(et,this._resourceManager),n=(0,b.NA)(a.rotation),_=(0,b.NA)(a.offsetX),d=(0,b.NA)(a.offsetY),y=(0,nt.hP)(JSON.stringify(et)+M).toString();this._cimLayers.push({type:"marker",templateHash:y,materialHash:(s&&s.length>0||null!=C&&"function"==typeof C)&&s?this._createMaterialHashFunction(y,s):y,cim:et,materialOverrides:s,colorLocked:!!a.colorLocked||!!q,effects:C,scaleSymbolsProportionally:!!a.scaleSymbolsProportionally,alignment:U,anchorPoint:{x:P,y:c},isAbsoluteAnchorPoint:!1,size:(0,b.NA)(a.size,W.w7),rotation:this._createOverrideFunction(z,"Rotation",n),offsetX:this._createOverrideFunction(z,"OffsetX",_),offsetY:this._createOverrideFunction(z,"OffsetY",d),color:{r:255,g:255,b:255,a:1},outlineColor:{r:0,g:0,b:0,a:0},outlineWidth:0,scaleX:1,frameHeight:D,rotateClockwise:!!a.rotateClockwise,referenceSize:K,sizeRatio:r/(0,Nt.F2)(a.size),markerPlacement:L,animatedSymbolProperties:E,avoidSDFRasterization:!0})}_buildSimpleMarker(a,C){return{type:a.type,enable:!0,name:a.name,colorLocked:a.colorLocked,primitiveName:a.primitiveName,anchorPoint:a.anchorPoint,anchorPointUnits:a.anchorPointUnits,offsetX:0,offsetY:0,rotateClockwise:a.rotateClockwise,rotation:0,size:a.size,billboardMode3D:a.billboardMode3D,depth3D:a.depth3D,frame:a.frame,markerGraphics:[C],scaleSymbolsProportionally:a.scaleSymbolsProportionally,respectFrame:a.respectFrame,clippingPath:a.clippingPath}}_analyzeCompositeMarkerGraphic(a,C,L,E,I,A,U,K,D,q,et,z,s,u,M){const P=I.geometry,c=A[0],r=A[1],n=(0,N.bk)(P);if(!n)return;const _="Relative"!==a.anchorPointUnits,[d,y,S]=(0,N.UV)(n,a.frame,a.size,a.anchorPoint,_),O={type:"sdf",geom:P,asFill:!0},x=r.path,Y=r.primitiveName,R=c.primitiveName,$=(0,b.NO)(r.color),at=(0,b.NO)(c.color),it=(0,b.NA)(c.width,W.KM),mt=I.primitiveName;let lt=null;r.colorLocked||M||(lt=this._createOverrideFunction(mt,"FillColor",$,Mt));let gt=null;c.colorLocked||M||(gt=this._createOverrideFunction(mt,"StrokeColor",at,Mt));const It=this._createOverrideFunction(mt,"StrokeWidth",it);let vt=!1,Dt="";for(const Rt of this._primitiveOverrides)(Rt.primitiveName===Y||Rt.primitiveName===R||U.includes(Rt.primitiveName))&&(null!=Rt.value?Dt+=`-${Rt.primitiveName}-${Rt.propertyName}-${JSON.stringify(Rt.value)}`:Rt.valueExpressionInfo&&(vt=!0));null!=L&&"function"==typeof L&&(vt=!0),((0,b.wO)(et)||(0,b.wO)(z)||(0,b.wO)(s)||(0,b.wO)(u))&&(vt=!0);const Gt=JSON.stringify({...a,markerGraphics:null}),Bt=(0,nt.hP)(JSON.stringify(O)+x).toString(),Xt=(0,nt.hP)(JSON.stringify(I)+JSON.stringify(r)+JSON.stringify(c)+Gt+Dt).toString();this._cimLayers.push({type:"marker",templateHash:Xt,materialHash:vt?()=>Bt:Bt,cim:O,materialOverrides:null,colorLocked:!!M,effects:C,scaleSymbolsProportionally:!!a.scaleSymbolsProportionally,alignment:K,anchorPoint:{x:y,y:S},isAbsoluteAnchorPoint:_,size:et,rotation:z,offsetX:s,offsetY:u,scaleX:1,frameHeight:q,rotateClockwise:!1,referenceSize:D,sizeRatio:d,color:(0,b.wO)(lt)?lt:this._createOverrideFunction(Y,"Color",$,Mt),outlineColor:(0,b.wO)(gt)?gt:this._createOverrideFunction(R,"Color",at,Mt),outlineWidth:(0,b.wO)(It)?It:this._createOverrideFunction(R,"Width",it),markerPlacement:L,path:x,animatedSymbolProperties:E})}_createMaterialHashFunction(a,C){const L=this._info?.geometryType;if(L){const E=this._poMap;for(const I of C)if(I.valueExpressionInfo){const A=E[I.primitiveName]&&E[I.primitiveName][I.propertyName];A instanceof Q.mz&&(I.fn=(U,K,D)=>(0,ut.Z)(A,U,{$view:D},L,K))}}return(E,I,A)=>{for(const U of C)U.fn&&(U.value=U.fn(E,I,A));return(0,nt.hP)(a+k.E0.buildOverrideKey(C)).toString()}}_setPoMap(a,C,L){let E;this._poMap[a]?E=this._poMap[a]:(E={},this._poMap[a]=E),E[C]=L}_createOverrideFunction(a,C,L,E,I){if(null==a)return L;const A=this._poMap[a];if(null==A)return L;const U=A[C];if("string"==typeof U||"number"==typeof U||U instanceof Array)return E?E.call(null,U,I):U;const K=this._info?.geometryType;return null!=U&&U instanceof Q.mz&&null!=K?(D,q,et)=>{let z=(0,ut.Z)(U,D,{$view:et},K,q);return null!==z&&E&&(z=E.call(null,z,I)),null!==z?z:L}:L}_createEffectsOverrideFunction(a,C){const L=this._poMap,E=this._info?.geometryType;for(const I of C)if(I.valueExpressionInfo&&E){const A=L[I.primitiveName]&&L[I.primitiveName][I.propertyName];A instanceof Q.mz&&(I.fn=(U,K,D)=>(0,ut.Z)(A,U,{$view:D},E,K))}return(I,A,U)=>{for(const D of C)D.fn&&(D.value=D.fn(I,A,U));const K=[];for(let D of a){const q=D?.primitiveName;if(q){let et=!1;for(const z of C)if(z.primitiveName===q){const s=rt(z.propertyName);null!=z.value&&z.value!==D[s]&&(et||(D=(0,ot.d9)(D),et=!0),D[s]=z.value)}}K.push(D)}return K}}_createMarkerPlacementOverrideFunction(a){const C=[];if(k.E0.findApplicableOverrides(a,this._primitiveOverrides,C),null==a||0===C.length)return a;const L=this._poMap,E=this._info?.geometryType;for(const I of C)if(I.valueExpressionInfo&&E){const A=L[I.primitiveName]&&L[I.primitiveName][I.propertyName];A instanceof Q.mz&&(I.fn=(U,K,D)=>(0,ut.Z)(A,U,{$view:D},E,K))}return(I,A,U)=>{for(const q of C)q.fn&&(q.value=q.fn(I,A,U));const K=(0,ot.d9)(a),D=a.primitiveName;for(const q of C)if(q.primitiveName===D){const et=rt(q.propertyName);null!=q.value&&q.value!==K[et]&&(K[et]=q.value)}return K}}_createAnimatedSymbolPropertiesOverrideFunction(a){const C=[];if(k.E0.findApplicableOverrides(a,this._primitiveOverrides,C),null==a||0===C.length)return a;const L=this._info?.geometryType;if(L){const E=this._poMap;for(const I of C)if(I.valueExpressionInfo){const A=E[I.primitiveName]&&E[I.primitiveName][I.propertyName];A instanceof Q.mz&&(I.fn=(U,K,D)=>(0,ut.Z)(A,U,{$view:D},L,K))}}return(E,I,A)=>{for(const D of C)D.fn&&(D.value=D.fn(E,I,A));const U=(0,ot.d9)(a),K=a.primitiveName;for(const D of C)if(D.primitiveName===K){const q=rt(D.propertyName);if(null!=D.value){const et=F(D.value,D.propertyName);et!==U[q]&&(U[q]=et)}}return U}}_analyzePrimitiveOverrides(a,C,L,E){let I=!1,A="";"string"==typeof a&&(a=[a]);for(const U of this._primitiveOverrides)a?.includes(U.primitiveName)&&(null!=U.value?A+=`-${U.primitiveName}-${U.propertyName}-${JSON.stringify(U.value)}`:U.valueExpressionInfo&&(I=!0));return null!=C&&"function"==typeof C&&(I=!0),null!=L&&"function"==typeof L&&(I=!0),null!=E&&"function"==typeof E&&(I=!0),[I,A]}_analyzeMaterialOverrides(a,C){return this._primitiveOverrides.filter(L=>L.primitiveName!==a||!C.includes(L.propertyName))}_transformSize(a,C){return(0,b.wO)(a)||(0,b.wO)(C)?(L,E,I)=>((0,b.wO)(a)?a(L,E,I):a)*((0,b.wO)(C)?C(L,E,I):C):a*C}_transformRotation(a,C,L){return(0,b.wO)(a)||(0,b.wO)(L)?(E,I,A)=>{const U=(0,b.wO)(a)?a(E,I,A):a,K=(0,b.wO)(L)?L(E,I,A):L;return C?K-U:K+U}:C?L-a:L+a}_transformOffsetX(a,C,L,E,I){if(!((0,b.wO)(a)||(0,b.wO)(C)||(0,b.wO)(L)||(0,b.wO)(E)||(0,b.wO)(I))){const A=L*Math.PI/180;if(A){const U=Math.cos(A),K=Math.sin(A);return(U*a-K*C)*E+I}return a*E+I}return(A,U,K)=>{let D=(0,b.wO)(L)?L(A,U,K):L;const q=(0,b.wO)(E)?E(A,U,K):E,et=(0,b.wO)(a)?a(A,U,K):a,z=(0,b.wO)(I)?I(A,U,K):I;return D?(D*=Math.PI/180,(Math.cos(D)*et-Math.sin(D)*((0,b.wO)(C)?C(A,U,K):C))*q+z):et*q+z}}_transformOffsetY(a,C,L,E,I){if(!((0,b.wO)(a)||(0,b.wO)(C)||(0,b.wO)(L)||(0,b.wO)(E)||(0,b.wO)(I))){const A=L*Math.PI/180;if(A){const U=Math.cos(A);return(Math.sin(A)*a+U*C)*E+I}return C*E+I}return(A,U,K)=>{let D=(0,b.wO)(L)?L(A,U,K):L;const q=(0,b.wO)(E)?E(A,U,K):E,et=(0,b.wO)(C)?C(A,U,K):C,z=(0,b.wO)(I)?I(A,U,K):I;if(D){D*=Math.PI/180;const s=Math.cos(D);return(Math.sin(D)*((0,b.wO)(a)?a(A,U,K):a)+s*et)*q+z}return et*q+z}}}function bt(T){if(T&&0===T.indexOf("Level_")){const a=parseInt(T.substr(6),10);if(!isNaN(a))return a}return 0}function Mt(T){if(!T||0===T.length)return null;const a=new Ct.Z(T).toRgba();return{r:a[0],g:a[1],b:a[2],a:a[3]}}function rt(T){return T&&T.charAt(0).toLowerCase()+T.substr(1)}function H(T,a){if(!a||0===a.length)return T;const C=(0,ot.d9)(T);return k.E0.applyOverrides(C,a),C}const V=T=>T&&2===T.length&&T[0].enable&&T[1].enable&&"CIMSolidStroke"===T[0].type&&"CIMSolidFill"===T[1].type&&null==T[0].path&&null==T[1].path&&!T[0].effects&&!T[1].effects;function J(T){const a=T.symbolLayers;if(!a||2!==a.length)return!1;const C=a.find(E=>E.effects?.find(I=>"CIMGeometricEffectDashes"===I.type)),L=a.find(E=>E.effects?.find(I=>"CIMGeometricEffectAddControlPoints"===I.type));return!!C&&!!L}},73608:(Ut,Ft,B)=>{B.d(Ft,{j:()=>nt});var Tt=B(33359),Ct=B(2362),ft=B(29214),ot=B(43080),xt=B(35909);class nt{static executeEffects(W,k,X,ht){const Pt=(0,xt.Tg)(W);let F=new ft.z(k);for(const N of W){const b=(0,ot.h)(N);b&&(F=b.execute(F,N,1.3333333333333333,X,ht,Pt))}return F}static applyEffects(W,k,X){if(!W)return k;const ht=(0,xt.Tg)(W);let pt,Pt=new ft.z(Tt.z.fromJSONCIM(k));for(const b of W){const ct=(0,ot.h)(b);ct&&(Pt=ct.execute(Pt,b,1,null,X,ht))}const F=[];let N=null;for(;pt=Pt.next();)F.push(...(0,Ct.M)(pt)),N=pt.geometryType;return 0===F.length||null===N?null:"esriGeometryPolygon"===N?{rings:F}:{paths:F}}}},39236:(Ut,Ft,B)=>{B.d(Ft,{Z:()=>ot});var Tt=B(26584),Ct=B(63290),ft=B(7848);function ot(Q,W,k,X,ht){if(null==Q)return null;const pt=Q.referencesGeometry()&&ht?function Nt(Q,W,k){const{transform:X,hasZ:ht,hasM:pt}=k;xt.has(W)||xt.set(W,function nt(Q){const W={};switch(Q){case"esriGeometryPoint":return(k,X,ht,pt)=>(0,ft.U1)(X,W,k,ht,pt);case"esriGeometryPolygon":return(k,X,ht,pt)=>(0,ft.Ie)(X,W,k,ht,pt);case"esriGeometryPolyline":return(k,X,ht,pt)=>(0,ft.G6)(X,W,k,ht,pt);case"esriGeometryMultipoint":return(k,X,ht,pt)=>(0,ft.J9)(X,W,k,ht,pt);default:return Ct.Z.getLogger("esri.views.2d.support.arcadeOnDemand").error(new Tt.Z("mapview-arcade",`Unable to handle geometryType: ${Q}`)),k=>k}}(W));const Pt=xt.get(W)(Q.geometry,X,ht,pt);return{...Q,geometry:Pt}}(W,X,ht):W,Pt=Q.repurposeFeature(pt);try{return Q.evaluate({...k,$feature:Pt},Q.services)}catch(F){return Ct.Z.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",F),null}}const xt=new Map},3959:(Ut,Ft,B)=>{B.d(Ft,{$:()=>ft,f:()=>Ct});var Tt=B(77275);function Ct(Nt,nt){let Q;if("string"==typeof Nt)Q=(0,Tt.hP)(Nt+`-seed(${nt})`);else{let W=12;Q=Nt^nt;do{Q=107*(Q>>8^Q)+W|0}while(0!=--W)}return(1+Q/(1<<31))/2}function ft(Nt){return Math.floor(Ct(Nt,ot)*xt)}const ot=53290320,xt=10},25797:(Ut,Ft,B)=>{B.d(Ft,{Nr:()=>Mt});var Tt=B(23841),Ct=B(31478),ft=B(12225),ot=B(67831),xt=B(9545),Nt=B(61261),nt=B(5254),Q=B(84439);class W{constructor(H,V,J,T){this.center=(0,xt.f)(H,V),this.centerT=(0,xt.c)(),this.halfWidth=J/2,this.halfHeight=T/2,this.width=J,this.height=T}get x(){return this.center[0]}get y(){return this.center[1]}get blX(){return this.center[0]+this.halfWidth}get blY(){return this.center[1]+this.halfHeight}get trX(){return this.center[0]-this.halfWidth}get trY(){return this.center[1]-this.halfHeight}get xmin(){return this.x-this.halfWidth}get xmax(){return this.x+this.halfWidth}get ymin(){return this.y-this.halfHeight}get ymax(){return this.y+this.halfHeight}set x(H){this.center[0]=H}set y(H){this.center[1]=H}clone(){return new W(this.x,this.y,this.width,this.height)}serialize(H){return H.writeF32(this.center[0]),H.writeF32(this.center[1]),H.push(this.width),H.push(this.height),H}findCollisionDelta(H,V=4){const J=Math.abs(H.centerT[0]-this.centerT[0]),T=Math.abs(H.centerT[1]-this.centerT[1]),L=Math.min((H.halfWidth+this.halfWidth+V)/J,(H.halfHeight+this.halfHeight+V)/T);return Math.log2(L)}extend(H){const V=Math.min(this.xmin,H.xmin),J=Math.min(this.ymin,H.ymin),T=Math.max(this.xmax,H.xmax)-V,a=Math.max(this.ymax,H.ymax)-J,C=V+T/2,L=J+a/2;this.width=T,this.height=a,this.halfWidth=T/2,this.halfHeight=a/2,this.x=C,this.y=L}static deserialize(H){const V=H.readF32(),J=H.readF32(),T=H.readInt32(),a=H.readInt32();return new W(V,J,T,a)}}const k=26,X=4,ht=k+X,pt=k-6,Pt=3,F=8,N=Math.PI/180;class ut{constructor(H,V,J,T){this._rotationT=(0,ft.c)(),this._xBounds=0,this._yBounds=0,this.minZoom=0,this.maxZoom=255,this._bounds=null;const a=J.rect,C=new Float32Array(8);H*=T,V*=T;const L=J.code?a.width*T:J.metrics.width,E=J.code?a.height*T:J.metrics.height;this.width=L,this.height=E,C[0]=H,C[1]=V,C[2]=H+L,C[3]=V,C[4]=H,C[5]=V+E,C[6]=H+L,C[7]=V+E,this._data=C,this._setTextureCoords(a),this._scale=T,this._mosaic=J,this.x=H,this.y=V,this.maxOffset=Math.max(H+L,V+E)}get mosaic(){return this._mosaic}set angle(H){this._angle=H,(0,Ct.b)(this._rotationT,-H),this._setOffsets(this._data)}get angle(){return this._angle}get xTopLeft(){return this._data[0]}get yTopLeft(){return this._data[1]}get xBottomRight(){return this._data[6]}get yBottomRight(){return this._data[7]}get texcoords(){return this._texcoords}get textureBinding(){return this._mosaic.textureBinding}get offsets(){return this._offsets||this._setOffsets(this._data),this._offsets}get char(){return String.fromCharCode(this._mosaic.code)}get code(){return this._mosaic.code}get bounds(){if(!this._bounds){const{height:H,width:V}=this._mosaic.metrics,J=V*this._scale,T=Math.abs(H)*this._scale,a=new Float32Array(8);a[0]=this.x,a[1]=this.y,a[2]=this.x+J,a[3]=this.y,a[4]=this.x,a[5]=this.y+T,a[6]=this.x+J,a[7]=this.y+T;const C=(0,Ct.m)((0,ft.c)(),this._rotationT,this._transform);(0,ft.t)(a,a,C);let L=1/0,E=1/0,I=0,A=0;for(let et=0;et<4;et++){const z=a[2*et],s=a[2*et+1];L=Math.min(L,z),E=Math.min(E,s),I=Math.max(I,z),A=Math.max(A,s)}const U=I-L,K=A-E;this._bounds=new W(L+U/2,E+K/2,U,K)}return this._bounds}setTransform(H){this._transform=H,this._offsets=null}_setOffsets(H){this._offsets||(this._offsets={upperLeft:0,upperRight:0,lowerLeft:0,lowerRight:0});const V=this._offsets,J=new Float32Array(8),T=(0,Ct.m)((0,ft.c)(),this._rotationT,this._transform);(0,ft.t)(J,H,T),V.upperLeft=(0,nt.UJ)(J[0]*F,J[1]*F),V.upperRight=(0,nt.UJ)(J[2]*F,J[3]*F),V.lowerLeft=(0,nt.UJ)(J[4]*F,J[5]*F),V.lowerRight=(0,nt.UJ)(J[6]*F,J[7]*F)}_setTextureCoords({x:H,y:V,width:J,height:T}){this._texcoords={upperLeft:(0,nt.UJ)(H,V),upperRight:(0,nt.UJ)(H+J,V),lowerLeft:(0,nt.UJ)(H,V+T),lowerRight:(0,nt.UJ)(H+J,V+T)}}}const st=(rt,H)=>({code:0,page:0,sdf:!0,rect:new Q.Z(0,0,11,8),textureBinding:H,metrics:{advance:0,height:4,width:rt,left:0,top:0}});function _t(rt,H){return rt.forEach(V=>(0,ot.t)(V,V,H)),{upperLeft:(0,nt.UJ)(F*rt[0][0],F*rt[0][1]),upperRight:(0,nt.UJ)(F*rt[1][0],F*rt[1][1]),lowerLeft:(0,nt.UJ)(F*rt[2][0],F*rt[2][1]),lowerRight:(0,nt.UJ)(F*rt[3][0],F*rt[3][1])}}class Et{constructor(H,V,J){this._rotation=0,this._decorate(H,V,J),this.glyphs=H,this.bounds=this._createBounds(H),this.isMultiline=V.length>1,this._hasRotation=0!==J.angle,this._transform=this._createGlyphTransform(this.bounds,J),this._borderLineSize=J.borderLineSize,(J.borderLineSize||J.hasBackground)&&([this.bounds,this.background]=this.shapeBackground(this._transform));for(const T of H)T.setTransform(this._transform)}setRotation(H){if(0===H&&0===this._rotation)return;this._rotation=H;const V=this._transform,J=(0,Ct.b)((0,ft.c)(),H);(0,Ct.m)(V,J,V);for(const T of this.glyphs)T.setTransform(this._transform)}_decorate(H,V,J){if(!J.decoration||"none"===J.decoration||!H.length)return;const T=J.scale,a="underline"===J.decoration?ht:pt,C=H[0].textureBinding;for(const L of V)H.push(new ut(L.startX*T,L.startY*T+a*T,st((L.width+L.glyphWidthEnd)*T,C),1))}shapeBackground(H){const{xmin:J,ymin:T,xmax:a,ymax:C,x:L,y:E,width:I,height:A}=this.bounds,U=Math.min(I,A)+16-1.5,D=(1.5+Math.min((0,Tt.F2)(this._borderLineSize||0),U))/2,q=this._borderLineSize?D:0,et=[J-8,T-8],z=[a+8,T-8],s=[J-8,C+8],u=[a+8,C+8],M=_t([[et[0]-D,et[1]-D],[z[0]+D,z[1]-D],[et[0]+q,et[1]+q],[z[0]-q,z[1]+q]],H),P=_t([[s[0]+q,s[1]-q],[u[0]-q,u[1]-q],[s[0]-D,s[1]+D],[u[0]+D,u[1]+D]],H),c=_t([[et[0]-D,et[1]-D],[et[0]+q,et[1]+q],[s[0]-D,s[1]+D],[s[0]+q,s[1]-q]],H),r=_t([[z[0]-q,z[1]+q],[z[0]+D,z[1]-D],[u[0]-q,u[1]-q],[u[0]+D,u[1]+D]],H),n={main:_t([et,z,s,u],H),top:M,bot:P,left:c,right:r};return[new W(L,E,I+2*D,A+2*D),n]}get boundsT(){const H=this.bounds,V=(0,ot.s)((0,xt.c)(),H.x,H.y);if((0,ot.t)(V,V,this._transform),this._hasRotation){const J=Math.max(H.width,H.height);return new W(V[0],V[1],J,J)}return new W(V[0],V[1],H.width,H.height)}_createBounds(H){let V=1/0,J=1/0,T=0,a=0;for(const E of H)V=Math.min(V,E.xTopLeft),J=Math.min(J,E.yTopLeft),T=Math.max(T,E.xBottomRight),a=Math.max(a,E.yBottomRight);const C=T-V,L=a-J;return new W(V+C/2,J+L/2,C,L)}_createGlyphTransform(H,V){const J=N*V.angle,T=(0,ft.c)(),a=(0,xt.c)();return(0,Ct.t)(T,T,(0,ot.s)(a,V.xOffset,-V.yOffset)),V.isCIM?(0,Ct.r)(T,T,J):((0,Ct.t)(T,T,(0,ot.s)(a,H.x,H.y)),(0,Ct.r)(T,T,J),(0,Ct.t)(T,T,(0,ot.s)(a,-H.x,-H.y))),T}}class At{constructor(H,V,J,T,a,C){this.glyphWidthEnd=0,this.startX=0,this.startY=0,this.start=Math.max(0,Math.min(V,J)),this.end=Math.max(0,Math.max(V,J)),this.end<H.length&&(this.glyphWidthEnd=H[this.end].metrics.width),this.width=T,this.yMin=a,this.yMax=C}}const yt=rt=>10===rt,Ot=rt=>32===rt;function Mt(rt,H,V){const J=V.scale,T=new Array,a=function wt(rt,H,V){const J=new Array,a=V.maxLineWidth*(1/V.scale),C=H?rt.length-1:0,L=H?-1:rt.length,E=H?-1:1;let I=C,A=0,U=0,K=I,D=K,q=0,et=1/0,z=0;for(;I!==L;){const{code:u,metrics:M}=rt[I],P=Math.abs(M.top);yt(u)||Ot(u)||(et=Math.min(et,P),z=Math.max(z,P+M.height)),yt(u)?(I!==C&&(J.push(new At(rt,K,I-E,A,et,z)),et=1/0,z=0),A=0,K=I+E,D=I+E,U=0):Ot(u)?(D=I+E,U=0,q=M.advance,A+=M.advance):A>a?(D!==K?(A-=q,J.push(new At(rt,K,D-2*E,A-U,et,z)),et=1/0,z=0,K=D,A=U):(J.push(new At(rt,K,I-E,A,et,z)),et=1/0,z=0,K=I,D=I,A=0),A+=M.advance,U+=M.advance):(A+=M.advance,U+=M.advance),I+=E}const s=new At(rt,K,I-E,A,et,z);return s.start>=0&&s.end<rt.length&&J.push(s),J}(rt,H,V),C=function bt(rt,H){let V=0;for(let a=0;a<rt.length;a++){const{width:C}=rt[a];V=Math.max(C,V)}const T=rt[0].yMin;return{x:0,y:T,height:rt[rt.length-1].yMax+H.lineHeight*(rt.length-1)+("underline"===H.decoration?X:0)-T,width:V}}(a,V),{vAlign:L,hAlign:E}=V,I=L===Nt.TR.Baseline?1:0,U=(1-I)*-C.y+C.height/2*(I?0:L-1)+(I?1:0)*-k;for(let K=0;K<a.length;K++){const{start:D,end:q,width:et}=a[K];let z=-1*(E+1)*(et/2)-Pt;const s=K*V.lineHeight+U-Pt;a[K].startX=z,a[K].startY=s;for(let u=D;u<=q;u++){const M=rt[u];if(yt(M.code))continue;const P=new ut(z+M.metrics.left,s-M.metrics.top,M,J);z+=M.metrics.advance,T.push(P)}}return new Et(T,a,V)}}}]);