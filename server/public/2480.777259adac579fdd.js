"use strict";(self.webpackChunkCRIS=self.webpackChunkCRIS||[]).push([[2480],{82480:(le,W,E)=>{E.r(W),E.d(W,{registerFunctions:()=>De});var P=E(15861),j=E(91365),H=E(37780),A=E(6729),l=E(25919),oe=E(42275),Q=E(90512),v=E(20057),ue=E(98362),a=E(47562),fe=E(16309),g=E(52724),J=E(53997),ce=E(95896),de=E(79429),me=E(62074),ye=E(16776),_e=E(57366),b=E(77132),Y=E(83947),$=E(50818),he=E(10699),F=E(80774),V=E(80415),Z=E(36255),q=E(31099);function B(s,n,i){return K.apply(this,arguments)}function K(){return(K=(0,P.Z)(function*(s,n,i){const y=s.getVariables();if(y.length>0){const h=[];for(let e=0;e<y.length;e++){const t={name:y[e]};h.push(yield n.evaluateIdentifier(i,t))}const f={};for(let e=0;e<y.length;e++)f[y[e]]=h[e];return s.parameters=f,s}return s})).apply(this,arguments)}function m(s,n,i=null){for(const y in s)if(y.toLowerCase()===n.toLowerCase())return s[y];return i}function ee(s){if(null===s)return null;const n={type:m(s,"type",""),name:m(s,"name","")};if("range"===n.type)n.range=m(s,"range",[]);else{n.codedValues=[];for(const i of m(s,"codedValues",[]))n.codedValues.push({name:m(i,"name",""),code:m(i,"code",null)})}return n}function z(s){if(null===s)return null;const n={},i=m(s,"wkt",null);null!==i&&(n.wkt=i);const y=m(s,"wkid",null);return null!==y&&(n.wkid=y),n}function ne(s){if(null===s)return null;const n={hasZ:m(s,"hasz",!1),hasM:m(s,"hasm",!1)},i=m(s,"spatialreference",null);i&&(n.spatialReference=z(i));const y=m(s,"x",null);if(null!==y)return n.x=y,n.y=m(s,"y",null),n;const h=m(s,"rings",null);if(null!==h)return n.rings=h,n;const f=m(s,"paths",null);if(null!==f)return n.paths=f,n;const e=m(s,"points",null);if(null!==e)return n.points=e,n;for(const t of["xmin","xmax","ymin","ymax","zmin","zmax","mmin","mmax"]){const u=m(s,t,null);null!==u&&(n[t]=u)}return n}function N(s){return"utc"===s?.toLowerCase()?"UTC":"unknown"===s?.toLowerCase()?"Unknown":s}function De(s){"async"===s.mode&&(s.functions.timezone=function(n,i){return s.standardFunctionAsync(n,i,function(){var y=(0,P.Z)(function*(h,f,e){if((0,a.E)(e,1,2,n,i),(0,a.n)(e[0])||(0,a.m)(e[0]))return"Unknown";if((0,a.u)(e[0])){if(yield e[0].load(),1===e.length||null===e[1])return N(e[0].datesInUnknownTimezone?"unknown":e[0].dateFieldsTimeZone);if(!(e[1]instanceof A.Z)||!1===e[1].hasField("type"))throw new l.aV(n,l.rH.InvalidParameter,i);const _=e[1].field("type");if(!1===(0,a.c)(_))throw new l.aV(n,l.rH.InvalidParameter,i);switch((0,a.j)(_).toLowerCase()){case"preferredtimezone":return N(e[0].preferredTimeZone);case"editfieldsinfo":return N(e[0].editFieldsInfo?.timeZone??null);case"timeinfo":return N(e[0].timeInfo?.timeZone??null);case"field":if(e[1].hasField("fieldname")&&(0,a.c)(e[1].field("fieldname")))return N(e[0].fieldTimeZone((0,a.j)(e[1].field("fieldname"))))}throw new l.aV(n,l.rH.InvalidParameter,i)}const t=(0,a.l)(e[0],(0,a.L)(n));if(null===t)return null;const u=t.timeZone;return"system"===u?j.iG.systemTimeZoneCanonicalName:"utc"===u.toLowerCase()?"UTC":"unknown"===u.toLowerCase()?"Unknown":u});return function(h,f,e){return y.apply(this,arguments)}}())},s.functions.sqltimestamp=function(n,i){return s.standardFunctionAsync(n,i,function(){var y=(0,P.Z)(function*(h,f,e){(0,a.E)(e,1,3,n,i);const t=e[0];if((0,a.k)(t)){if(1===e.length)return t.toSQLWithKeyword();if(2===e.length)return t.changeTimeZone((0,a.j)(e[1])).toSQLWithKeyword();throw new l.aV(n,l.rH.InvalidParameter,i)}if((0,a.m)(t))return t.toSQLWithKeyword();if((0,a.u)(t)){if(3!==e.length)throw new l.aV(n,l.rH.InvalidParameter,i);yield t.load();const u=(0,a.j)(e[1]);if((0,a.m)(e[2]))return e[2].toSQLWithKeyword();if(!1===(0,a.k)(e[2]))throw new l.aV(n,l.rH.InvalidParameter,i);const _=t.fieldTimeZone(u);return null===_?e[2].toSQLWithKeyword():e[2].changeTimeZone(_).toSQLWithKeyword()}throw new l.aV(n,l.rH.InvalidParameter,i)});return function(h,f,e){return y.apply(this,arguments)}}())},s.signatures.push({name:"sqltimestamp",min:2,max:4}),s.functions.featuresetbyid=function(n,i){return s.standardFunctionAsync(n,i,(y,h,f)=>{if((0,a.E)(f,2,4,n,i),f[0]instanceof Q.Z){const e=(0,a.j)(f[1]);let t=(0,a.H)(f[2],null);const u=(0,a.h)((0,a.H)(f[3],!0));if(null===t&&(t=["*"]),!1===(0,a.o)(t))throw new l.aV(n,l.rH.InvalidParameter,i);return f[0].featureSetById(e,u,t)}throw new l.aV(n,l.rH.InvalidParameter,i)})},s.signatures.push({name:"featuresetbyid",min:2,max:4}),s.functions.getfeatureset=function(n,i){return s.standardFunctionAsync(n,i,(y,h,f)=>{if((0,a.E)(f,1,2,n,i),(0,a.r)(f[0])){let e=(0,a.H)(f[1],"datasource");return null===e&&(e="datasource"),e=(0,a.j)(e).toLowerCase(),(0,v.convertToFeatureSet)(f[0].fullSchema(),e,n.lrucache,n.interceptor,n.spatialReference)}throw new l.aV(n,l.rH.InvalidParameter,i)})},s.signatures.push({name:"getfeatureset",min:1,max:2}),s.functions.featuresetbyportalitem=function(n,i){return s.standardFunctionAsync(n,i,(y,h,f)=>{if((0,a.E)(f,2,5,n,i),null===f[0])throw new l.aV(n,l.rH.PortalRequired,i);if(f[0]instanceof H.Z){const p=(0,a.j)(f[1]),c=(0,a.j)(f[2]);let r=(0,a.H)(f[3],null);const o=(0,a.h)((0,a.H)(f[4],!0));if(null===r&&(r=["*"]),!1===(0,a.o)(r))throw new l.aV(n,l.rH.InvalidParameter,i);let d=null;return d=n.services?.portal?n.services.portal:q.Z.getDefault(),d=(0,fe._)(f[0],d),(0,v.constructFeatureSetFromPortalItem)(p,c,n.spatialReference,r,o,d,n.lrucache,n.interceptor)}if(!1===(0,a.c)(f[0]))throw new l.aV(n,l.rH.PortalRequired,i);const e=(0,a.j)(f[0]),t=(0,a.j)(f[1]);let u=(0,a.H)(f[2],null);const _=(0,a.h)((0,a.H)(f[3],!0));if(null===u&&(u=["*"]),!1===(0,a.o)(u))throw new l.aV(n,l.rH.InvalidParameter,i);return(0,v.constructFeatureSetFromPortalItem)(e,t,n.spatialReference,u,_,n.services?.portal??q.Z.getDefault(),n.lrucache,n.interceptor)})},s.signatures.push({name:"featuresetbyportalitem",min:2,max:5}),s.functions.featuresetbyname=function(n,i){return s.standardFunctionAsync(n,i,(y,h,f)=>{if((0,a.E)(f,2,4,n,i),f[0]instanceof Q.Z){const e=(0,a.j)(f[1]);let t=(0,a.H)(f[2],null);const u=(0,a.h)((0,a.H)(f[3],!0));if(null===t&&(t=["*"]),!1===(0,a.o)(t))throw new l.aV(n,l.rH.InvalidParameter,i);return f[0].featureSetByName(e,u,t)}throw new l.aV(n,l.rH.InvalidParameter,i)})},s.signatures.push({name:"featuresetbyname",min:2,max:4}),s.functions.featureset=function(n,i){return s.standardFunction(n,i,(y,h,f)=>{(0,a.E)(f,1,1,n,i);let e=f[0];const t={layerDefinition:{geometryType:"",objectIdField:"",hasM:!1,hasZ:!1,globalIdField:"",typeIdField:"",fields:[]},featureSet:{geometryType:"",features:[]}};if((0,a.c)(e))e=JSON.parse(e),void 0!==e.layerDefinition?(t.layerDefinition=e.layerDefinition,t.featureSet=e.featureSet,e.layerDefinition.spatialReference&&(t.layerDefinition.spatialReference=e.layerDefinition.spatialReference)):(t.featureSet.features=e.features,t.featureSet.geometryType=e.geometryType,t.layerDefinition.geometryType=t.featureSet.geometryType,t.layerDefinition.objectIdField=e.objectIdFieldName??"",t.layerDefinition.typeIdField=e.typeIdFieldName,t.layerDefinition.globalIdField=e.globalIdFieldName,t.layerDefinition.fields=e.fields,e.spatialReference&&(t.layerDefinition.spatialReference=e.spatialReference));else{if(!(f[0]instanceof A.Z))throw new l.aV(n,l.rH.InvalidParameter,i);{e=JSON.parse(f[0].castToText(!0));const u=m(e,"layerdefinition");if(null!==u){t.layerDefinition.geometryType=m(u,"geometrytype",""),t.featureSet.geometryType=t.layerDefinition.geometryType,t.layerDefinition.globalIdField=m(u,"globalidfield",""),t.layerDefinition.objectIdField=m(u,"objectidfield",""),t.layerDefinition.typeIdField=m(u,"typeidfield",""),t.layerDefinition.hasZ=!0===m(u,"hasz",!1),t.layerDefinition.hasM=!0===m(u,"hasm",!1);const _=m(u,"spatialreference",null);_&&(t.layerDefinition.spatialReference=z(_));for(const c of m(u,"fields",[])){const r={name:m(c,"name",""),alias:m(c,"alias",""),type:m(c,"type",""),nullable:m(c,"nullable",!0),editable:m(c,"editable",!0),length:m(c,"length",null),domain:ee(m(c,"domain"))};t.layerDefinition.fields.push(r)}const p=m(e,"featureset",null);if(p){const c={};for(const r of t.layerDefinition.fields)c[r.name.toLowerCase()]=r.name;for(const r of m(p,"features",[])){const o={},d=m(r,"attributes",{});for(const x in d)o[c[x.toLowerCase()]]=d[x];t.featureSet.features.push({attributes:o,geometry:ne(m(r,"geometry",null))})}}}else{t.layerDefinition.hasZ=!0===m(e,"hasz",!1),t.layerDefinition.hasM=!0===m(e,"hasm",!1),t.layerDefinition.geometryType=m(e,"geometrytype",""),t.featureSet.geometryType=t.layerDefinition.geometryType,t.layerDefinition.objectIdField=m(e,"objectidfieldname",""),t.layerDefinition.typeIdField=m(e,"typeidfieldname","");const _=m(e,"spatialreference",null);_&&(t.layerDefinition.spatialReference=z(_));let p=m(e,"fields",null);if((0,a.o)(p))for(const o of p){const d={name:m(o,"name",""),alias:m(o,"alias",""),type:m(o,"type",""),nullable:m(o,"nullable",!0),editable:m(o,"editable",!0),length:m(o,"length",null),domain:ee(m(o,"domain"))};t.layerDefinition.fields.push(d)}else p=null,t.layerDefinition.fields=p;const c={};for(const o of t.layerDefinition.fields)c[o.name.toLowerCase()]=o.name;let r=m(e,"features",null);if((0,a.o)(r))for(const o of r){const d={},x=m(o,"attributes",{});for(const C in x)d[c[C.toLowerCase()]]=x[C];t.featureSet.features.push({attributes:d,geometry:ne(m(o,"geometry",null))})}else r=null,t.featureSet.features=r}}}if(!1===function ge(s){return!!s.layerDefinition&&!!s.featureSet&&!1!==function Ee(s,n){for(const i of n)if(i===s)return!0;return!1}(s.layerDefinition.geometryType,["",null,"esriGeometryNull","esriGeometryPoint","esriGeometryPolyline","esriGeometryPolygon","esriGeometryMultipoint","esriGeometryEnvelope"])&&!1!==(0,a.o)(s.layerDefinition.fields)&&!1!==(0,a.o)(s.featureSet.features)}(t))throw new l.aV(n,l.rH.InvalidParameter,i);return t.layerDefinition.geometryType||(t.layerDefinition.geometryType="esriGeometryNull"),ye.Z.create(t,n.spatialReference)})},s.signatures.push({name:"featureset",min:1,max:1}),s.functions.filter=function(n,i){return s.standardFunctionAsync(n,i,function(){var y=(0,P.Z)(function*(h,f,e){if((0,a.E)(e,2,2,n,i),(0,a.o)(e[0])||(0,a.q)(e[0])){const t=[];let u=e[0];u instanceof ue.Z&&(u=u.toArray());let _=null;if(!(0,a.i)(e[1]))throw new l.aV(n,l.rH.InvalidParameter,i);_=e[1].createFunction(n);for(const p of u){const c=_(p);(0,he.y8)(c)?!0===(yield c)&&t.push(p):!0===c&&t.push(p)}return t}if((0,a.u)(e[0])){const t=yield e[0].load(),u=F.WhereClause.create(e[1],t.getFieldsIndex(),t.dateFieldsTimeZoneDefaultUTC),_=u.getVariables();if(_.length>0){const p=[];for(let r=0;r<_.length;r++){const o={name:_[r]};p.push(yield s.evaluateIdentifier(n,o))}const c={};for(let r=0;r<_.length;r++)c[_[r]]=p[r];return u.parameters=c,new J.Z({parentfeatureset:e[0],whereclause:u})}return new J.Z({parentfeatureset:e[0],whereclause:u})}throw new l.aV(n,l.rH.InvalidParameter,i)});return function(h,f,e){return y.apply(this,arguments)}}())},s.signatures.push({name:"filter",min:2,max:2}),s.functions.orderby=function(n,i){return s.standardFunctionAsync(n,i,function(){var y=(0,P.Z)(function*(h,f,e){if((0,a.E)(e,2,2,n,i),(0,a.u)(e[0])){const t=new _e.Z(e[1]);return new ce.Z({parentfeatureset:e[0],orderbyclause:t})}throw new l.aV(n,l.rH.InvalidParameter,i)});return function(h,f,e){return y.apply(this,arguments)}}())},s.signatures.push({name:"orderby",min:2,max:2}),s.functions.top=function(n,i){return s.standardFunctionAsync(n,i,function(){var y=(0,P.Z)(function*(h,f,e){if((0,a.E)(e,2,2,n,i),(0,a.u)(e[0]))return new de.Z({parentfeatureset:e[0],topnum:e[1]});if((0,a.o)(e[0]))return(0,a.g)(e[1])>=e[0].length?e[0].slice(0):e[0].slice(0,(0,a.g)(e[1]));if((0,a.q)(e[0]))return(0,a.g)(e[1])>=e[0].length()?e[0].slice(0):e[0].slice(0,(0,a.g)(e[1]));throw new l.aV(n,l.rH.InvalidParameter,i)});return function(h,f,e){return y.apply(this,arguments)}}())},s.signatures.push({name:"top",min:2,max:2}),s.functions.first=function(n,i){return s.standardFunctionAsync(n,i,function(){var y=(0,P.Z)(function*(h,f,e){if((0,a.E)(e,1,1,n,i),(0,a.u)(e[0])){const t=yield e[0].first(h.abortSignal);if(null!==t){const u=oe.Z.createFromGraphicLikeObject(t.geometry,t.attributes,e[0],n.timeZone);return u._underlyingGraphic=t,u}return t}return(0,a.o)(e[0])?0===e[0].length?null:e[0][0]:(0,a.q)(e[0])?0===e[0].length()?null:e[0].get(0):null});return function(h,f,e){return y.apply(this,arguments)}}())},s.signatures.push({name:"first",min:1,max:1}),s.functions.attachments=function(n,i){return s.standardFunctionAsync(n,i,function(){var y=(0,P.Z)(function*(h,f,e){(0,a.E)(e,1,2,n,i);const t={minsize:-1,maxsize:-1,types:null,returnMetadata:!1};if(e.length>1)if(e[1]instanceof A.Z){if(e[1].hasField("minsize")&&(t.minsize=(0,a.g)(e[1].field("minsize"))),e[1].hasField("metadata")&&(t.returnMetadata=(0,a.h)(e[1].field("metadata"))),e[1].hasField("maxsize")&&(t.maxsize=(0,a.g)(e[1].field("maxsize"))),e[1].hasField("types")){const u=(0,a.a2)(e[1].field("types"),!1);u.length>0&&(t.types=u)}}else if(null!==e[1])throw new l.aV(n,l.rH.InvalidParameter,i);if((0,a.r)(e[0])){let u=e[0]._layer;return u instanceof V.default&&(u=(0,v.constructFeatureSet)(u,n.spatialReference,["*"],!0,n.lrucache,n.interceptor)),null===u||!1===(0,a.u)(u)?[]:(yield u.load(),u.queryAttachments(e[0].field(u.objectIdField),t.minsize,t.maxsize,t.types,t.returnMetadata))}if(null===e[0])return[];throw new l.aV(n,l.rH.InvalidParameter,i)});return function(h,f,e){return y.apply(this,arguments)}}())},s.signatures.push({name:"attachments",min:1,max:2}),s.functions.featuresetbyrelationshipname=function(n,i){return s.standardFunctionAsync(n,i,function(){var y=(0,P.Z)(function*(h,f,e){(0,a.E)(e,2,4,n,i);const t=e[0],u=(0,a.j)(e[1]);let _=(0,a.H)(e[2],null);const p=(0,a.h)((0,a.H)(e[3],!0));if(null===_&&(_=["*"]),!1===(0,a.o)(_))throw new l.aV(n,l.rH.InvalidParameter,i);if(null===e[0])return null;if(!(0,a.r)(e[0]))throw new l.aV(n,l.rH.InvalidParameter,i);let c=t._layer;if(c instanceof V.default&&(c=(0,v.constructFeatureSet)(c,n.spatialReference,["*"],!0,n.lrucache,n.interceptor)),null===c||!1===(0,a.u)(c))return null;c=yield c.load();const r=c.relationshipMetaData().filter(T=>T.name===u);if(0===r.length)return null;if(null!=r[0].relationshipTableId&&r[0].relationshipTableId>-1)return(0,v.constructFeatureSetFromRelationship)(c,r[0],t.field(c.objectIdField),c.spatialReference,_,p,n.lrucache,n.interceptor);let o=c.serviceUrl();if(!o)return null;o="/"===o.charAt(o.length-1)?o+r[0].relatedTableId.toString():o+"/"+r[0].relatedTableId.toString();const d=yield(0,v.constructFeatureSetFromUrl)(o,c.spatialReference,_,p,n.lrucache,n.interceptor);yield d.load();let x=d.relationshipMetaData();if(x=x.filter(T=>T.id===r[0].id),!1===t.hasField(r[0].keyField)||null===t.field(r[0].keyField)){const T=yield c.getFeatureByObjectId(t.field(c.objectIdField),[r[0].keyField]);if(T){const w=F.WhereClause.create(x[0].keyField+"= @id",d.getFieldsIndex(),d.dateFieldsTimeZoneDefaultUTC);return w.parameters={id:T.attributes[r[0].keyField]},d.filter(w)}return new me.Z({parentfeatureset:d})}const C=F.WhereClause.create(x[0].keyField+"= @id",d.getFieldsIndex(),d.dateFieldsTimeZoneDefaultUTC);return C.parameters={id:t.field(r[0].keyField)},d.filter(C)});return function(h,f,e){return y.apply(this,arguments)}}())},s.signatures.push({name:"featuresetbyrelationshipname",min:2,max:4}),s.functions.featuresetbyassociation=function(n,i){return s.standardFunctionAsync(n,i,function(){var y=(0,P.Z)(function*(h,f,e){(0,a.E)(e,2,3,n,i);const t=e[0],u=(0,a.j)((0,a.H)(e[1],"")).toLowerCase(),_=(0,a.c)(e[2])?(0,a.j)(e[2]):null;if(null===e[0])return null;if(!(0,a.r)(e[0]))throw new l.aV(n,l.rH.InvalidParameter,i);let p=t._layer;if(p instanceof V.default&&(p=(0,v.constructFeatureSet)(p,n.spatialReference,["*"],!0,n.lrucache,n.interceptor)),null===p||!1===(0,a.u)(p))return null;yield p.load();const c=p.serviceUrl(),r=yield(0,v.constructAssociationMetaDataFeatureSetFromUrl)(c,n.spatialReference);let o=null,d=null,x=!1;if(null!==_&&""!==_&&void 0!==_){for(const I of r.terminals)I.terminalName===_&&(d=I.terminalId);null===d&&(x=!0)}const C=r.associations.getFieldsIndex(),T=C.get("TOGLOBALID").name,w=C.get("FROMGLOBALID").name,X=C.get("TOTERMINALID").name,G=C.get("FROMTERMINALID").name,R=C.get("FROMNETWORKSOURCEID").name,U=C.get("TONETWORKSOURCEID").name,S=C.get("ASSOCIATIONTYPE").name,Ie=C.get("ISCONTENTVISIBLE").name,Fe=C.get("OBJECTID").name;for(const I of p.fields)if("global-id"===I.type){o=t.field(I.name);break}let M=null,te=new g.yN(new Z.Z({name:"percentalong",alias:"percentalong",type:"double"}),F.WhereClause.create("0",r.associations.getFieldsIndex(),r.associations.dateFieldsTimeZoneDefaultUTC)),ae=new g.yN(new Z.Z({name:"side",alias:"side",type:"string"}),F.WhereClause.create("''",r.associations.getFieldsIndex(),r.associations.dateFieldsTimeZoneDefaultUTC));const L="globalid",re="globalId",ie={};for(const I in r.lkp)ie[I]=r.lkp[I].sourceId;const O=new g.TO(new Z.Z({name:"classname",alias:"classname",type:"string"}),null,ie);let D="";switch(u){case"midspan":{D=`((${T}='${o}') OR ( ${w}='${o}')) AND (${S} IN (5))`,O.codefield=F.WhereClause.create(`CASE WHEN (${T}='${o}') THEN ${R} ELSE ${U} END`,r.associations.getFieldsIndex(),r.associations.dateFieldsTimeZoneDefaultUTC);const I=(0,b.JW)(g.Xx.findField(r.associations.fields,w));I.name=L,I.alias=L,M=new g.yN(I,F.WhereClause.create(`CASE WHEN (${w}='${o}') THEN ${T} ELSE ${w} END`,r.associations.getFieldsIndex(),r.associations.dateFieldsTimeZoneDefaultUTC)),te=r.unVersion>=4?new g.$X(g.Xx.findField(r.associations.fields,C.get("PERCENTALONG").name)):new g.yN(new Z.Z({name:"percentalong",alias:"percentalong",type:"double"}),F.WhereClause.create("0",r.associations.getFieldsIndex(),r.associations.dateFieldsTimeZoneDefaultUTC));break}case"junctionedge":{D=`((${T}='${o}') OR ( ${w}='${o}')) AND (${S} IN (4,6))`,O.codefield=F.WhereClause.create(`CASE WHEN (${T}='${o}') THEN ${R} ELSE ${U} END`,r.associations.getFieldsIndex(),r.associations.dateFieldsTimeZoneDefaultUTC);const I=(0,b.JW)(g.Xx.findField(r.associations.fields,w));I.name=L,I.alias=L,M=new g.yN(I,F.WhereClause.create(`CASE WHEN (${w}='${o}') THEN ${T} ELSE ${w} END`,r.associations.getFieldsIndex(),r.associations.dateFieldsTimeZoneDefaultUTC)),ae=new g.yN(new Z.Z({name:"side",alias:"side",type:"string"}),F.WhereClause.create(`CASE WHEN (${S}=4) THEN 'from' ELSE 'to' END`,r.associations.getFieldsIndex(),r.associations.dateFieldsTimeZoneDefaultUTC));break}case"connected":{let I=`${T}='@T'`,se=`${w}='@T'`;null!==d&&(I+=` AND ${X}=@A`,se+=` AND ${G}=@A`),D="(("+I+") OR ("+se+"))",D=(0,a.S)(D,"@T",o??""),I=(0,a.S)(I,"@T",o??""),null!==d&&(I=(0,a.S)(I,"@A",d.toString()),D=(0,a.S)(D,"@A",d.toString())),O.codefield=F.WhereClause.create("CASE WHEN "+I+` THEN ${R} ELSE ${U} END`,r.associations.getFieldsIndex(),r.associations.dateFieldsTimeZoneDefaultUTC);const k=(0,b.JW)(g.Xx.findField(r.associations.fields,w));k.name=L,k.alias=L,M=new g.yN(k,F.WhereClause.create("CASE WHEN "+I+` THEN ${w} ELSE ${T} END`,r.associations.getFieldsIndex(),r.associations.dateFieldsTimeZoneDefaultUTC));break}case"container":D=`${T}='${o}' AND ${S} = 2`,null!==d&&(D+=` AND ${X} = `+d.toString()),O.codefield=R,D="( "+D+" )",M=new g.QP(g.Xx.findField(r.associations.fields,w),L,L);break;case"content":D=`(${w}='${o}' AND ${S} = 2)`,null!==d&&(D+=` AND ${G} = `+d.toString()),O.codefield=U,D="( "+D+" )",M=new g.QP(g.Xx.findField(r.associations.fields,T),L,L);break;case"structure":D=`(${T}='${o}' AND ${S} = 3)`,null!==d&&(D+=` AND ${X} = `+d.toString()),O.codefield=R,D="( "+D+" )",M=new g.QP(g.Xx.findField(r.associations.fields,w),L,re);break;case"attached":D=`(${w}='${o}' AND ${S} = 3)`,null!==d&&(D+=` AND ${G} = `+d.toString()),O.codefield=U,D="( "+D+" )",M=new g.QP(g.Xx.findField(r.associations.fields,T),L,re);break;default:throw new l.aV(n,l.rH.InvalidParameter,i)}return x&&(D="1 <> 1"),new g.Xx({parentfeatureset:r.associations,adaptedFields:[new g.$X(g.Xx.findField(r.associations.fields,Fe)),new g.$X(g.Xx.findField(r.associations.fields,Ie)),M,ae,O,te],extraFilter:D?F.WhereClause.create(D,r.associations.getFieldsIndex(),r.associations.dateFieldsTimeZoneDefaultUTC):null})});return function(h,f,e){return y.apply(this,arguments)}}())},s.signatures.push({name:"featuresetbyassociation",min:2,max:6}),s.functions.groupby=function(n,i){return s.standardFunctionAsync(n,i,function(){var y=(0,P.Z)(function*(h,f,e){if((0,a.E)(e,3,3,n,i),!(0,a.u)(e[0]))throw new l.aV(n,l.rH.InvalidParameter,i);const t=yield e[0].load(),u=[],_=[];let p=!1,c=[];if((0,a.c)(e[1]))c.push(e[1]);else if(e[1]instanceof A.Z)c.push(e[1]);else if((0,a.o)(e[1]))c=e[1];else{if(!(0,a.q)(e[1]))throw new l.aV(n,l.rH.InvalidParameter,i);c=e[1].toArray()}for(const r of c)if((0,a.c)(r)){const o=F.WhereClause.create((0,a.j)(r),t.getFieldsIndex(),t.dateFieldsTimeZoneDefaultUTC),d=!0===(0,Y.y5)(o)?(0,a.j)(r):"%%%%FIELDNAME";u.push({name:d,expression:o}),"%%%%FIELDNAME"===d&&(p=!0)}else{if(!(r instanceof A.Z))throw new l.aV(n,l.rH.InvalidParameter,i);{const o=r.hasField("name")?r.field("name"):"%%%%FIELDNAME",d=r.hasField("expression")?r.field("expression"):"";if("%%%%FIELDNAME"===o&&(p=!0),!o)throw new l.aV(n,l.rH.InvalidParameter,i);u.push({name:o,expression:F.WhereClause.create(d||o,t.getFieldsIndex(),t.dateFieldsTimeZoneDefaultUTC)})}}if(c=[],(0,a.c)(e[2]))c.push(e[2]);else if((0,a.o)(e[2]))c=e[2];else if((0,a.q)(e[2]))c=e[2].toArray();else{if(!(e[2]instanceof A.Z))throw new l.aV(n,l.rH.InvalidParameter,i);c.push(e[2])}for(const r of c){if(!(r instanceof A.Z))throw new l.aV(n,l.rH.InvalidParameter,i);{const o=r.hasField("name")?r.field("name"):"",d=r.hasField("statistic")?r.field("statistic"):"",x=r.hasField("expression")?r.field("expression"):"";if(!o||!d||!x)throw new l.aV(n,l.rH.InvalidParameter,i);_.push({name:o,statistic:d.toLowerCase(),expression:F.WhereClause.create(x,t.getFieldsIndex(),t.dateFieldsTimeZoneDefaultUTC)})}}if(p){const r={};for(const d of t.fields)r[d.name.toLowerCase()]=1;for(const d of u)"%%%%FIELDNAME"!==d.name&&(r[d.name.toLowerCase()]=1);for(const d of _)"%%%%FIELDNAME"!==d.name&&(r[d.name.toLowerCase()]=1);let o=0;for(const d of u)if("%%%%FIELDNAME"===d.name){for(;1===r["field_"+o.toString()];)o++;r["field_"+o.toString()]=1,d.name="FIELD_"+o.toString()}}for(const r of u)yield B(r.expression,s,n);for(const r of _)yield B(r.expression,s,n);return e[0].groupby(u,_)});return function(h,f,e){return y.apply(this,arguments)}}())},s.signatures.push({name:"groupby",min:3,max:3}),s.functions.distinct=function(n,i){return s.standardFunctionAsync(n,i,function(){var y=(0,P.Z)(function*(h,f,e){if((0,a.u)(e[0])){(0,a.E)(e,2,2,n,i);const t=yield e[0].load(),u=[];let _=[];if((0,a.c)(e[1]))_.push(e[1]);else if(e[1]instanceof A.Z)_.push(e[1]);else if((0,a.o)(e[1]))_=e[1];else{if(!(0,a.q)(e[1]))throw new l.aV(n,l.rH.InvalidParameter,i);_=e[1].toArray()}let p=!1;for(const c of _)if((0,a.c)(c)){const r=F.WhereClause.create((0,a.j)(c),t.getFieldsIndex(),t.dateFieldsTimeZoneDefaultUTC),o=!0===(0,Y.y5)(r)?(0,a.j)(c):"%%%%FIELDNAME";u.push({name:o,expression:r}),"%%%%FIELDNAME"===o&&(p=!0)}else{if(!(c instanceof A.Z))throw new l.aV(n,l.rH.InvalidParameter,i);{const r=c.hasField("name")?c.field("name"):"%%%%FIELDNAME",o=c.hasField("expression")?c.field("expression"):"";if("%%%%FIELDNAME"===r&&(p=!0),!r)throw new l.aV(n,l.rH.InvalidParameter,i);u.push({name:r,expression:F.WhereClause.create(o||r,t.getFieldsIndex(),t.dateFieldsTimeZoneDefaultUTC)})}}if(p){const c={};for(const o of t.fields)c[o.name.toLowerCase()]=1;for(const o of u)"%%%%FIELDNAME"!==o.name&&(c[o.name.toLowerCase()]=1);let r=0;for(const o of u)if("%%%%FIELDNAME"===o.name){for(;1===c["field_"+r.toString()];)r++;c["field_"+r.toString()]=1,o.name="FIELD_"+r.toString()}}for(const c of u)yield B(c.expression,s,n);return e[0].groupby(u,[])}return function pe(s,n,i,y){if(1===y.length){if((0,a.o)(y[0]))return(0,$.t)(s,y[0],-1);if((0,a.q)(y[0]))return(0,$.t)(s,y[0].toArray(),-1)}return(0,$.t)(s,y,-1)}("distinct",0,0,e)});return function(h,f,e){return y.apply(this,arguments)}}())}),s.functions.getfeaturesetinfo=function(n,i){return s.standardFunctionAsync(n,i,function(){var y=(0,P.Z)(function*(h,f,e){if((0,a.E)(e,1,1,n,i),!(0,a.u)(e[0]))return null;const t=yield e[0].getFeatureSetInfo();return t?A.Z.convertObjectToArcadeDictionary({layerId:t.layerId,layerName:t.layerName,itemId:t.itemId,serviceLayerUrl:t.serviceLayerUrl,webMapLayerId:t.webMapLayerId??null,webMapLayerTitle:t.webMapLayerTitle??null,className:null,objectClassId:null},(0,a.L)(n),!1,!1):null});return function(h,f,e){return y.apply(this,arguments)}}())},s.signatures.push({name:"getfeaturesetinfo",min:1,max:1})}},16309:(le,W,E)=>{E.d(W,{_:()=>j});var P=E(31099);function j(H,A){return null===H?A:new P.Z({url:H.field("url")})}}}]);