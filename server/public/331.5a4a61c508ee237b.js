"use strict";(self.webpackChunkCRIS=self.webpackChunkCRIS||[]).push([[331],{60331:(Te,ce,c)=>{c.d(ce,{q:()=>lt});var h=c(15861),se=c(85931),U=c(26584),he=c(86810),re=c(58817),w=c(62208),de=c(1036),Z=c(10699),O=c(16730),D=c(5464),A=c(5548),S=c(65401),F=c(32442),E=c(91179),P=c(93555),V=c(37053),j=c(82054),ne=c(93961),ee=c(80774),le=c(85);const m=new class pe{constructor(e,t){this._cache=new ne.z(e),this._invalidCache=new ne.z(t)}get(e,t){const i=`${t.uid}:${e}`,s=this._cache.get(i);if(s)return s;if(null!=this._invalidCache.get(i))return null;try{const r=ee.WhereClause.create(e,t);return this._cache.put(i,r),r}catch(r){return this._invalidCache.put(i,r),null}}getError(e,t){return this._invalidCache.get(`${t.uid}:${e}`)??null}}(50,500),G="unsupported-query",q=" as ",$=new Set(["esriFieldTypeOID","esriFieldTypeSmallInteger","esriFieldTypeBigInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeLong"]),Q=new Set(["esriFieldTypeDate","esriFieldTypeDateOnly","esriFieldTypeTimeOnly","esriFieldTypeTimestampOffset"]),te=new Set(["esriFieldTypeString","esriFieldTypeGUID","esriFieldTypeGlobalID",...$,...Q]);function y(o,e,t={}){const i=M(e,o);if(!i){const r=m.getError(e,o);throw new U.Z(G,"invalid SQL expression",{expression:e,error:r})}const s=t.expressionName||"expression";if(t.validateStandardized&&!i.isStandardized)throw new U.Z(G,`${s} is not standard`,{expression:e});if(t.validateAggregate&&!i.isAggregate)throw new U.Z(G,`${s} does not contain a valid aggregate function`,{expression:e});return i.fieldNames}function M(o,e){return o?m.get(o,e):null}function K(o){return/\((.*?)\)/.test(o)?o:o.split(q)[0]}function z(o,e,t,i={}){const s=new Map;if(function ue(o,e,t,i,s){for(const r of s)if("*"!==r)if(e.get(r))ie(o,e,t,i,r);else try{const n=y(e,K(r),{validateStandardized:!0});for(const a of n)ie(o,e,t,i,a)}catch(n){o.set(r,{type:"expression-error",expression:r,error:n})}}(s,o,e,i.allowedFieldTypes??te,t),s.size)throw new U.Z(G,`${i.expressionName??"expression"} contains invalid or missing fields`,{errors:Array.from(s.values()),query:i.query})}function ie(o,e,t,i,s){if("*"===s)return;const r=e.get(s);r?t.has(r.name)?!1===i?.has(r.type)&&o.set(s,{type:"invalid-type",fieldName:r.name,fieldType:le.v.fromJSON(r.type),allowedFieldTypes:Array.from(i,n=>le.v.fromJSON(n))}):o.set(s,{type:"missing-field",fieldName:r.name}):o.set(s,{type:"invalid-field",fieldName:s})}var b=c(16983),J=c(82959),Ce=c(87757),ve=c(27105),Ee=c(15176),Re=c(7848),oe=c(90194),Je=c(29466),k=c(26072),ze=c(46679);class Me{constructor(e,t,i){this._fieldDataCache=new Map,this._returnDistinctMap=new Map,this.returnDistinctValues=e.returnDistinctValues??!1,this.fieldsIndex=i,this.featureAdapter=t;const s=e.outFields;if(s&&!s.includes("*")){this.outFields=s;let r=0;for(const n of s){const a=K(n),l=this.fieldsIndex.get(a),u=l?null:M(a,i),d=l?l.name:n.split(q)[1]||"FIELD_EXP_"+r++;this._fieldDataCache.set(n,{alias:d,clause:u})}}}countDistinctValues(e){return this.returnDistinctValues?(e.forEach(t=>this.getAttributes(t)),this._returnDistinctMap.size):e.length}getAttributes(e){const t=this._processAttributesForOutFields(e);return this._processAttributesForDistinctValues(t)}getFieldValue(e,t,i){const s=i?i.name:t;let r=null;return this._fieldDataCache.has(s)?r=this._fieldDataCache.get(s)?.clause:i||(r=M(t,this.fieldsIndex),this._fieldDataCache.set(s,{alias:s,clause:r})),i?this.featureAdapter.getAttribute(e,s):r?.calculateValue(e,this.featureAdapter)}getDataValues(e,t,i=!0){const s=t.normalizationType,r=t.normalizationTotal,n=this.fieldsIndex.get(t.field),a=(0,oe.UQ)(n)||(0,oe.ig)(n),l=(0,oe.sX)(n);return e.map(u=>{let d=t.field&&this.getFieldValue(u,t.field,this.fieldsIndex.get(t.field));if(t.field2?(d=`${(0,k.wk)(d)}${t.fieldDelimiter}${(0,k.wk)(this.getFieldValue(u,t.field2,this.fieldsIndex.get(t.field2)))}`,t.field3&&(d=`${d}${t.fieldDelimiter}${(0,k.wk)(this.getFieldValue(u,t.field3,this.fieldsIndex.get(t.field3)))}`)):"string"==typeof d&&i&&(a?d=d?new Date(d).getTime():null:l&&(d=d?(0,Je.yO)(d):null)),s&&Number.isFinite(d)){const p="field"===s&&t.normalizationField?this.getFieldValue(u,t.normalizationField,this.fieldsIndex.get(t.normalizationField)):null;d=(0,k.fk)(d,s,p,r)}return d})}getExpressionValues(e,t,i,s,r){var n=this;return(0,h.Z)(function*(){const{arcadeUtils:a}=yield(0,ze.LC)(),l=a.hasGeometryOperations(t);l&&(yield a.enableGeometryOperations());const u=a.createFunction(t),d=a.getViewInfo(i),p={fields:n.fieldsIndex.fields};return e.map(g=>{const R={attributes:n.featureAdapter.getAttributes(g),layer:p,geometry:l?{...(0,b.Op)(s.geometryType,s.hasZ,s.hasM,n.featureAdapter.getGeometry(g)),spatialReference:i?.spatialReference}:null},_=a.createExecContext(R,d,r);return a.executeFunction(u,_)})})()}validateItem(e,t){return this._fieldDataCache.has(t)||this._fieldDataCache.set(t,{alias:t,clause:M(t,this.fieldsIndex)}),this._fieldDataCache.get(t)?.clause?.testFeature(e,this.featureAdapter)??!1}validateItems(e,t){return this._fieldDataCache.has(t)||this._fieldDataCache.set(t,{alias:t,clause:M(t,this.fieldsIndex)}),this._fieldDataCache.get(t)?.clause?.testSet(e,this.featureAdapter)??!1}_processAttributesForOutFields(e){const t=this.outFields;if(!t?.length)return this.featureAdapter.getAttributes(e);const i={};for(const s of t){const{alias:r,clause:n}=this._fieldDataCache.get(s);i[r]=n?n.calculateValue(e,this.featureAdapter):this.featureAdapter.getAttribute(e,r)}return i}_processAttributesForDistinctValues(e){if(null==e||!this.returnDistinctValues)return e;const t=this.outFields,i=[];if(t)for(const n of t){const{alias:a}=this._fieldDataCache.get(n);i.push(e[a])}else for(const n in e)i.push(e[n]);const s=`${(t||["*"]).join(",")}=${i.join(",")}`;let r=this._returnDistinctMap.get(s)||0;return this._returnDistinctMap.set(s,++r),r>1?null:e}}function Ue(o,e,t){return{objectId:o,target:e,distance:t,type:"vertex"}}function He(o,e,t,i,s,r=!1){return{objectId:o,target:e,distance:t,type:"edge",start:i,end:s,draped:r}}class ae{constructor(e,t,i){this.items=e,this.query=t,this.geometryType=i.geometryType,this.hasM=i.hasM,this.hasZ=i.hasZ,this.fieldsIndex=i.fieldsIndex,this.objectIdField=i.objectIdField,this.spatialReference=i.spatialReference,this.featureAdapter=i.featureAdapter}get size(){return this.items.length}createQueryResponseForCount(){const e=new Me(this.query,this.featureAdapter,this.fieldsIndex);if(!this.query.outStatistics)return e.countDistinctValues(this.items);const{groupByFieldsForStatistics:t,having:i,outStatistics:s}=this.query;if(!t?.length)return 1;const n=new Map,a=new Map,l=new Set;for(const u of s){const{statisticType:d}=u,p="exceedslimit"!==d?u.onStatisticField:void 0;if(!a.has(p)){const R=[];for(const _ of t){const I=this._getAttributeValues(e,_,n);R.push(I)}a.set(p,this._calculateUniqueValues(R,e.returnDistinctValues))}const g=a.get(p);for(const R in g){const{data:_,items:I}=g[R],x=_.join(",");i&&!e.validateItems(I,i)||l.add(x)}}return l.size}createQueryResponse(){var e=this;return(0,h.Z)(function*(){let t;if(t=e.query.outStatistics?e.query.outStatistics.some(i=>"exceedslimit"===i.statisticType)?e._createExceedsLimitQueryResponse(e.query):yield e._createStatisticsQueryResponse(e.query):e._createFeatureQueryResponse(e.query),e.query.returnQueryGeometry){const i=e.query.geometry;t.queryGeometry=(0,V.JY)(e.query.outSR)&&!(0,V.fS)(i.spatialReference,e.query.outSR)?(0,b.S2)({spatialReference:e.query.outSR,...(0,J.iV)(i,i.spatialReference,e.query.outSR)}):(0,b.S2)({spatialReference:e.query.outSR,...i})}return t})()}createSnappingResponse(e,t){const i=this.featureAdapter,s=we(this.hasZ,this.hasM),{point:r,mode:n}=e,a="number"==typeof e.distance?e.distance:e.distance.x,l="number"==typeof e.distance?e.distance:e.distance.y,u={candidates:[]},d="esriGeometryPolygon"===this.geometryType,p=this._getPointCreator(n,this.spatialReference,t),g=new je(null,0),R=new je(null,0),_={x:0,y:0,z:0};for(const I of this.items){const x=i.getGeometry(I);if(null==x)continue;const{coords:C,lengths:H}=x;if(g.coords=C,R.coords=C,e.returnEdge){let B=0;for(let W=0;W<H.length;W++){const T=H[W];for(let v=0;v<T;v++,B+=s){const L=g;if(L.coordsIndex=B,v!==T-1){const Y=R;Y.coordsIndex=B+s;const fe=_;Xe(_,r,L,Y);const ge=(r.x-fe.x)/a,Fe=(r.y-fe.y)/l,Pe=ge*ge+Fe*Fe;Pe<=1&&u.candidates.push(He(i.getObjectId(I),p(fe),Math.sqrt(Pe),p(L),p(Y)))}}}}if("none"!==e.vertexMode){const B=d?C.length-s:C.length;if("all"===e.vertexMode)for(let W=0;W<B;W+=s){const T=g;T.coordsIndex=W;const v=(r.x-T.x)/a,L=(r.y-T.y)/l,Y=v*v+L*L;Y<=1&&u.candidates.push(Ue(i.getObjectId(I),p(T),Math.sqrt(Y)))}else if("ends"===e.vertexMode){const W=[0];d||W.push(C.length-s);for(const T of W){const v=g;v.coordsIndex=T;const L=(r.x-v.x)/a,Y=(r.y-v.y)/l,fe=L*L+Y*Y;fe<=1&&u.candidates.push(Ue(i.getObjectId(I),p(v),Math.sqrt(fe)))}}}}return u.candidates.sort((I,x)=>I.distance-x.distance),u}_getPointCreator(e,t,i){const s=null==i||(0,V.fS)(t,i)?a=>a:a=>(0,J.iV)(a,t,i),{hasZ:r}=this;return"3d"===e?r?({x:a,y:l,z:u})=>s({x:a,y:l,z:u}):({x:a,y:l})=>s({x:a,y:l,z:0}):({x:a,y:l})=>s({x:a,y:l})}createSummaryStatisticsResponse(e){var t=this;return(0,h.Z)(function*(){const{field:i,valueExpression:s,normalizationField:r,normalizationType:n,normalizationTotal:a,minValue:l,maxValue:u,scale:d,timeZone:p}=e,g=t.fieldsIndex.get(i),R=(0,oe.y2)(g)||(0,oe.UQ)(g)||(0,oe.ig)(g),_=yield t._getDataValues({field:i,valueExpression:s,normalizationField:r,normalizationType:n,normalizationTotal:a,scale:d,timeZone:p}),I=(0,k.S5)({normalizationType:n,normalizationField:r,minValue:l,maxValue:u}),x={value:.5,fieldType:g?.type},C=(0,oe.qN)(g)?(0,k.H0)({values:_,supportsNullCount:I,percentileParams:x}):(0,k.i5)({values:_,minValue:l,maxValue:u,useSampleStdDev:!n,supportsNullCount:I,percentileParams:x});return(0,k.F_)(C,R)})()}createUniqueValuesResponse(e){var t=this;return(0,h.Z)(function*(){const{field:i,valueExpression:s,domains:r,returnAllCodedValues:n,scale:a,timeZone:l}=e,u=yield t._getDataValues({field:i,field2:e.field2,field3:e.field3,fieldDelimiter:e.fieldDelimiter,valueExpression:s,scale:a,timeZone:l},!1),d=(0,k.eT)(u);return(0,k.Qm)(d,r,n,e.fieldDelimiter)})()}createClassBreaksResponse(e){var t=this;return(0,h.Z)(function*(){const{field:i,valueExpression:s,normalizationField:r,normalizationType:n,normalizationTotal:a,classificationMethod:l,standardDeviationInterval:u,minValue:d,maxValue:p,numClasses:g,scale:R,timeZone:_}=e,I=yield t._getDataValues({field:i,valueExpression:s,normalizationField:r,normalizationType:n,normalizationTotal:a,scale:R,timeZone:_}),x=(0,k.G2)(I,{field:i,normalizationField:r,normalizationType:n,normalizationTotal:a,classificationMethod:l,standardDeviationInterval:u,minValue:d,maxValue:p,numClasses:g});return(0,k.DL)(x,l)})()}createHistogramResponse(e){var t=this;return(0,h.Z)(function*(){const{field:i,valueExpression:s,normalizationField:r,normalizationType:n,normalizationTotal:a,classificationMethod:l,standardDeviationInterval:u,minValue:d,maxValue:p,numBins:g,scale:R,timeZone:_}=e,I=yield t._getDataValues({field:i,valueExpression:s,normalizationField:r,normalizationType:n,normalizationTotal:a,scale:R,timeZone:_});return(0,k.oF)(I,{field:i,normalizationField:r,normalizationType:n,normalizationTotal:a,classificationMethod:l,standardDeviationInterval:u,minValue:d,maxValue:p,numBins:g})})()}_sortFeatures(e,t,i){if(e.length>1&&t?.length)for(const s of t.reverse()){const r=s.split(" "),n=r[0],a=this.fieldsIndex.get(n),l=!!r[1]&&"desc"===r[1].toLowerCase(),u=(0,k.Lq)(a?.type,l);e.sort((d,p)=>{const g=i(d,n,a),R=i(p,n,a);return u(g,R)})}}_createFeatureQueryResponse(e){const t=this.items,{geometryType:i,hasM:s,hasZ:r,objectIdField:n,spatialReference:a}=this,{outFields:l,outSR:u,quantizationParameters:d,resultRecordCount:p,resultOffset:g,returnZ:R,returnM:_}=e,I=null!=p&&t.length>(g||0)+p,x=l&&(l.includes("*")?[...this.fieldsIndex.fields]:l.map(C=>this.fieldsIndex.get(C)));return{exceededTransferLimit:I,features:this._createFeatures(e,t),fields:x,geometryType:i,hasM:s&&_,hasZ:r&&R,objectIdFieldName:n,spatialReference:(0,b.S2)(u||a),transform:d&&(0,Re.vY)(d)||null}}_createFeatures(e,t){const i=new Me(e,this.featureAdapter,this.fieldsIndex),{hasM:s,hasZ:r}=this,{orderByFields:n,quantizationParameters:a,returnGeometry:l,returnCentroid:u,maxAllowableOffset:d,resultOffset:p,resultRecordCount:g,returnZ:R=!1,returnM:_=!1}=e,I=r&&R,x=s&&_;let C=[],H=0;const B=[...t];if(this._sortFeatures(B,n,(T,v,L)=>i.getFieldValue(T,v,L)),this.geometryType&&(l||u)){const T=(0,Re.vY)(a)??void 0;if(l&&!u)for(const v of B)C[H++]={attributes:i.getAttributes(v),geometry:(0,b.Op)(this.geometryType,this.hasZ,this.hasM,this.featureAdapter.getGeometry(v),d,T,I,x)};else if(!l&&u)for(const v of B)C[H++]={attributes:i.getAttributes(v),centroid:(0,b.EG)(this,this.featureAdapter.getCentroid(v,this),T)};else for(const v of B)C[H++]={attributes:i.getAttributes(v),centroid:(0,b.EG)(this,this.featureAdapter.getCentroid(v,this),T),geometry:(0,b.Op)(this.geometryType,this.hasZ,this.hasM,this.featureAdapter.getGeometry(v),d,T,I,x)}}else for(const T of B){const v=i.getAttributes(T);v&&(C[H++]={attributes:v})}const W=p||0;return null!=g&&(C=C.slice(W,Math.min(C.length,W+g))),C}_createExceedsLimitQueryResponse(e){let t=!1,i=Number.POSITIVE_INFINITY,s=Number.POSITIVE_INFINITY,r=Number.POSITIVE_INFINITY;for(const n of e.outStatistics??[])if("exceedslimit"===n.statisticType){i=null!=n.maxPointCount?n.maxPointCount:Number.POSITIVE_INFINITY,s=null!=n.maxRecordCount?n.maxRecordCount:Number.POSITIVE_INFINITY,r=null!=n.maxVertexCount?n.maxVertexCount:Number.POSITIVE_INFINITY;break}if("esriGeometryPoint"===this.geometryType)t=this.items.length>i;else if(this.items.length>s)t=!0;else{const n=we(this.hasZ,this.hasM),a=this.featureAdapter;t=this.items.reduce((l,u)=>{const d=a.getGeometry(u);return l+(null!=d&&d.coords.length||0)},0)/n>r}return{fields:[{name:"exceedslimit",type:"esriFieldTypeInteger",alias:"exceedslimit",sqlType:"sqlTypeInteger",domain:null,defaultValue:null}],features:[{attributes:{exceedslimit:Number(t)}}]}}_createStatisticsQueryResponse(e){var t=this;return(0,h.Z)(function*(){const i={attributes:{}},s=[],r=new Map,n=new Map,a=new Map,l=new Map,u=new Me(e,t.featureAdapter,t.fieldsIndex),d=e.outStatistics,{groupByFieldsForStatistics:p,having:g,orderByFields:R,resultRecordCount:_}=e,I=p?.length,x=!!I,C=x?p[0]:null,H=x&&!t.fieldsIndex.get(C);for(const W of d??[]){const{outStatisticFieldName:T,statisticType:v}=W,L=W,Y="exceedslimit"!==v?W.onStatisticField:void 0,fe="percentile_disc"===v||"percentile_cont"===v,ge="EnvelopeAggregate"===v||"CentroidAggregate"===v||"ConvexHullAggregate"===v,Fe=x&&1===I&&(Y===C||H)&&"count"===v;if(x){if(!a.has(Y)){const Ze=[];for(const Ne of p){const Oe=t._getAttributeValues(u,Ne,r);Ze.push(Oe)}a.set(Y,t._calculateUniqueValues(Ze,!ge&&u.returnDistinctValues))}const xe=a.get(Y);if(!xe)continue;const Qe=Object.keys(xe);for(const Ze of Qe){const{count:Ne,data:Oe,items:Ye,itemPositions:ot}=xe[Ze],qe=Oe.join(",");if(!g||u.validateItems(Ye,g)){const _e=l.get(qe)||{attributes:{}};if(ge){_e.aggregateGeometries||(_e.aggregateGeometries={});const{aggregateGeometries:Se,outStatisticFieldName:Ae}=yield t._getAggregateGeometry(L,Ye);_e.aggregateGeometries[Ae]=Se}else{let Se=null;if(Fe)Se=Ne;else{const Ae=t._getAttributeValues(u,Y,r),$e=ot.map(ct=>Ae[ct]);Se=fe&&"statisticParameters"in L?t._getPercentileValue(L,$e):t._getStatisticValue(L,$e,null,u.returnDistinctValues)}_e.attributes[T]=Se}let ut=0;p.forEach((Se,Ae)=>_e.attributes[t.fieldsIndex.get(Se)?Se:"EXPR_"+ ++ut]=Oe[Ae]),l.set(qe,_e)}}}else if(ge){i.aggregateGeometries||(i.aggregateGeometries={});const{aggregateGeometries:xe,outStatisticFieldName:Qe}=yield t._getAggregateGeometry(L,t.items);i.aggregateGeometries[Qe]=xe}else{const xe=t._getAttributeValues(u,Y,r);i.attributes[T]=fe&&"statisticParameters"in L?t._getPercentileValue(L,xe):t._getStatisticValue(L,xe,n,u.returnDistinctValues)}const Pe="min"!==v&&"max"!==v||!(0,oe.qN)(t.fieldsIndex.get(Y))&&!t._isAnyDateField(Y)?null:t.fieldsIndex.get(Y)?.type;s.push({name:T,alias:T,type:Pe||"esriFieldTypeDouble"})}const B=x?Array.from(l.values()):[i];return t._sortFeatures(B,R,(W,T)=>W.attributes[T]),_&&(B.length=Math.min(_,B.length)),{fields:s,features:B}})()}_isAnyDateField(e){const t=this.fieldsIndex.get(e);return(0,oe.y2)(t)||(0,oe.UQ)(t)||(0,oe.ig)(t)||(0,oe.sX)(t)}_getAggregateGeometry(e,t){var i=this;return(0,h.Z)(function*(){const{convexHull:s,union:r}=yield Promise.all([c.e(4918),c.e(8592)]).then(c.bind(c,32825)),{statisticType:n,outStatisticFieldName:a}=e,{featureAdapter:l,spatialReference:u,geometryType:d,hasZ:p,hasM:g}=i,R=t.map(x=>(0,b.Op)(d,p,g,l.getGeometry(x))),_=s(u,R,!0)[0],I={aggregateGeometries:null,outStatisticFieldName:null};if("EnvelopeAggregate"===n){const x=_?(0,Ee._w)(_):(0,Ee.aO)(r(u,R));I.aggregateGeometries={...x,spatialReference:u},I.outStatisticFieldName=a||"extent"}else if("CentroidAggregate"===n){const x=_?(0,ve.tO)(_):(0,ve.$G)((0,Ee.aO)(r(u,R)));I.aggregateGeometries={x:x[0],y:x[1],spatialReference:u},I.outStatisticFieldName=a||"centroid"}else"ConvexHullAggregate"===n&&(I.aggregateGeometries=_,I.outStatisticFieldName=a||"convexHull");return I})()}_getStatisticValue(e,t,i,s){const{onStatisticField:r,statisticType:n}=e;let a=null;return a=i?.has(r)?i.get(r):(0,oe.qN)(this.fieldsIndex.get(r))||this._isAnyDateField(r)?(0,k.H0)({values:t,returnDistinct:s}):(0,k.i5)({values:s?[...new Set(t)]:t,minValue:null,maxValue:null,useSampleStdDev:!0}),i&&i.set(r,a),a["var"===n?"variance":n]}_getPercentileValue(e,t){const{onStatisticField:i,statisticParameters:s,statisticType:r}=e,{value:n,orderBy:a}=s,l=this.fieldsIndex.get(i);return(0,k.XL)(t,{value:n,orderBy:a,fieldType:l?.type,isDiscrete:"percentile_disc"===r})}_getAttributeValues(e,t,i){if(i.has(t))return i.get(t);const s=this.fieldsIndex.get(t),r=this.items.map(n=>e.getFieldValue(n,t,s));return i.set(t,r),r}_calculateUniqueValues(e,t){const i={},s=this.items,r=s.length;for(let n=0;n<r;n++){const a=s[n],l=[];for(const d of e)l.push(d[n]);const u=l.join(",");null==i[u]?i[u]={count:1,data:l,items:[a],itemPositions:[n]}:(t||i[u].count++,i[u].items.push(a),i[u].itemPositions.push(n))}return i}_getDataValues(e,t=!0){var i=this;return(0,h.Z)(function*(){const s=new Me(i.query,i.featureAdapter,i.fieldsIndex),{valueExpression:r,scale:n,timeZone:a}=e;return r?s.getExpressionValues(i.items,r,{viewingMode:"map",scale:n,spatialReference:i.query.outSR||i.spatialReference},{geometryType:i.geometryType,hasZ:i.hasZ,hasM:i.hasM},a):s.getDataValues(i.items,(0,re.d9)(e),t)})()}}function Xe(o,e,t,i){const s=i.x-t.x,r=i.y-t.y,l=Math.min(1,Math.max(0,((e.x-t.x)*s+(e.y-t.y)*r)/(s*s+r*r)));o.x=t.x+s*l,o.y=t.y+r*l}function we(o,e){return o?e?4:3:e?3:2}class je{constructor(e,t){this.coords=e,this.coordsIndex=t}get x(){return this.coords[this.coordsIndex]}get y(){return this.coords[this.coordsIndex+1]}get z(){return this.coords[this.coordsIndex+2]}}var me=c(56541),ye=c(53023);const Ie="unsupported-query";function be(o,e){return De.apply(this,arguments)}function De(){return(De=(0,h.Z)(function*(o,{fieldsIndex:e,geometryType:t,spatialReference:i,availableFields:s}){if((o.distance??0)<0||null!=o.geometryPrecision||o.multipatchOption&&"xyFootprint"!==o.multipatchOption||o.pixelSize||o.relationParam||o.text)throw new U.Z(Ie,"Unsupported query options",{query:o});return Be(e,s,o),function ke(o,e,t){const{outStatistics:i,groupByFieldsForStatistics:s,having:r}=t,n=s?.length,a=i?.length;if(r){if(!n||!a)throw new U.Z(Ie,"outStatistics and groupByFieldsForStatistics should be specified with having",{query:t});!function N(o,e,t,i,s){if(!t)return!0;const r="having clause",n=y(o,t,{validateAggregate:!0,expressionName:r});if(z(o,e,n,{expressionName:r,query:s}),!M(t,o)?.getExpressions().every(u=>{const{aggregateType:d,field:p}=u,g=o.get(p)?.name;return i.some(R=>{const{onStatisticField:_,statisticType:I}=R;return o.get(_)?.name===g&&I.toLowerCase().trim()===d})}))throw new U.Z(G,"expressions in having clause should also exist in outStatistics",{having:t})}(o,e,r,i,t)}if(a){if(!function it(o){return null!=o&&o.every(e=>"exceedslimit"!==e.statisticType)}(i))return;z(o,e,i.map(u=>u.onStatisticField).filter(Boolean),{expressionName:"onStatisticFields",query:t}),n&&z(o,e,s,{expressionName:"groupByFieldsForStatistics",query:t});for(const u of i){const{onStatisticField:d,statisticType:p}=u;if("percentile_disc"!==p&&"percentile_cont"!==p||!("statisticParameters"in u))o.get(d)&&"count"!==p&&"min"!==p&&"max"!==p&&z(o,e,[d],{expressionName:`outStatistics with '${p}' statistic type`,allowedFieldTypes:Ke,query:t});else{const{statisticParameters:g}=u;if(!g)throw new U.Z(Ie,"statisticParameters should be set for percentile type",{definition:u,query:t})}}}}(e,s,o),Promise.all([(0,ye.P0)(o,t,i),(0,J._W)(i,o.outSR)]).then(()=>o)})).apply(this,arguments)}function Be(o,e,t){const{outFields:i,orderByFields:s,returnDistinctValues:r,outStatistics:n}=t,a=n?n.map(l=>l.outStatisticFieldName&&l.outStatisticFieldName.toLowerCase()).filter(Boolean):[];if(s&&s.length>0){const l=" asc",u=" desc";z(o,e,s.map(p=>{const g=p.toLowerCase();return g.includes(l)?g.split(l)[0]:g.includes(u)?g.split(u)[0]:p}).filter(p=>!a.includes(p)),{expressionName:"orderByFields",query:t})}if(i&&i.length>0)z(o,e,i,{expressionName:"outFields",query:t});else if(r)throw new U.Z(Ie,"outFields should be specified for returnDistinctValues",{query:t});!function f(o,e,t,i){if(!t)return!0;const s="where clause";z(o,e,y(o,t,{validateStandardized:!0,expressionName:s}),{expressionName:s,query:i})}(o,e,t.where,t)}const Ke=new Set([...$,...Q]);function Ve(){return(Ve=(0,h.Z)(function*(o,e,{fieldsIndex:t,geometryType:i,spatialReference:s,availableFields:r}){if((o.distance??0)<0||null!=o.geometryPrecision||o.multipatchOption||o.pixelSize||o.relationParam||o.text||o.outStatistics||o.groupByFieldsForStatistics||o.having||o.orderByFields)throw new U.Z(Ie,"Unsupported query options",{query:o});return Be(t,r,o),Promise.all([tt(t,r,e,o),(0,ye.P0)(o,i,s),(0,J._W)(s,o.outSR)]).then(()=>o)})).apply(this,arguments)}function tt(o,e,t,i){return Ge.apply(this,arguments)}function Ge(){return(Ge=(0,h.Z)(function*(o,e,t,i){let s=[];if(t.valueExpression){const{arcadeUtils:r}=yield(0,ze.LC)();s=r.extractFieldNames(t.valueExpression)}if(t.field&&s.push(t.field),t.field2&&s.push(t.field2),t.field3&&s.push(t.field3),t.normalizationField&&s.push(t.normalizationField),!s.length&&!t.valueExpression)throw new U.Z(Ie,"field or valueExpression is required",{params:t});z(o,e,s,{expressionName:"statistics",query:i})})).apply(this,arguments)}var We=c(76530),st=c(60466),Le=c(74447);const nt=new de.WJ(2e6);let at=0;class lt{constructor(e){this._geometryQueryCache=null,this._changeHandle=null,this.capabilities={query:Ce.g},this.geometryType=e.geometryType,this.hasM=!!e.hasM,this.hasZ=!!e.hasZ,this.objectIdField=e.objectIdField,this.spatialReference=e.spatialReference,this.definitionExpression=e.definitionExpression,this.featureStore=e.featureStore,this.aggregateAdapter=e.aggregateAdapter,this._changeHandle=this.featureStore.events.on("changed",()=>this.clearCache()),this.timeInfo=e.timeInfo,e.cacheSpatialQueries&&(this._geometryQueryCache=new de.Xq(at+++"$$",nt)),this.fieldsIndex=(0,he.AK)(e.fieldsIndex)?e.fieldsIndex:st.Z.fromJSON(e.fieldsIndex),this.availableFields=null==e.availableFields?new Set(this.fieldsIndex.fields.map(t=>t.name)):new Set(e.availableFields.map(t=>this.fieldsIndex.get(t)?.name).filter(t=>null!=t)),e.scheduler&&e.priority&&(this._frameTask=e.scheduler.registerTask(e.priority))}destroy(){this._frameTask=(0,w.hw)(this._frameTask),this.clearCache(),(0,w.SC)(this._geometryQueryCache),this._changeHandle=(0,w.hw)(this._changeHandle)}get featureAdapter(){return this.featureStore.featureAdapter}clearCache(){this._geometryQueryCache?.clear(),this._allFeaturesPromise=null,this._timeExtentPromise=null,this._fullExtentPromise=null}executeQuery(e,t){var i=this;return(0,h.Z)(function*(){try{return(yield i._executeQuery(e,{},t)).createQueryResponse()}catch(s){if(s!==me.Ti)throw s;return new ae([],e,i).createQueryResponse()}})()}executeQueryForCount(e={},t){var i=this;return(0,h.Z)(function*(){try{return(yield i._executeQuery(e,{returnGeometry:!1,returnCentroid:!1,outSR:null},t)).createQueryResponseForCount()}catch(s){if(s!==me.Ti)throw s;return 0}})()}executeQueryForExtent(e,t){var i=this;return(0,h.Z)(function*(){const s=e.outSR;try{const r=yield i._executeQuery(e,{returnGeometry:!0,returnCentroid:!1,outSR:null},t),n=r.size;return n?{count:n,extent:yield i._getBounds(r.items,r.spatialReference,s||i.spatialReference)}:{count:0,extent:null}}catch(r){if(r===me.Ti)return{count:0,extent:null};throw r}})()}executeQueryForIds(e,t){var i=this;return(0,h.Z)(function*(){return i.executeQueryForIdSet(e,t).then(s=>Array.from(s))})()}executeQueryForIdSet(e,t){var i=this;return(0,h.Z)(function*(){try{const s=yield i._executeQuery(e,{returnGeometry:!0,returnCentroid:!1,outSR:null},t),r=s.items,n=new Set;return yield i._reschedule(()=>{for(const a of r)n.add(s.featureAdapter.getObjectId(a))},t),n}catch(s){if(s===me.Ti)return new Set;throw s}})()}executeQueryForSnapping(e,t){var i=this;return(0,h.Z)(function*(){const{point:s,distance:r,returnEdge:n,vertexMode:a}=e;if(!n&&"none"===a)return{candidates:[]};let l=(0,re.d9)(e.query);l=yield i._schedule(()=>(0,me.j6)(l,i.definitionExpression,i.spatialReference),t),l=yield i._reschedule(()=>be(l,{availableFields:i.availableFields,fieldsIndex:i.fieldsIndex,geometryType:i.geometryType,spatialReference:i.spatialReference}),t);const u=!(0,V.fS)(s.spatialReference,i.spatialReference);u&&(yield(0,J._W)(s.spatialReference,i.spatialReference));const d="number"==typeof r?r:r.x,p="number"==typeof r?r:r.y,g={xmin:s.x-d,xmax:s.x+d,ymin:s.y-p,ymax:s.y+p,spatialReference:s.spatialReference},R=u?(0,J.iV)(g,i.spatialReference):g;if(!R)return{candidates:[]};const _=(yield(0,P.aX)((0,E.im)(s),null,{signal:t}))[0],I=(yield(0,P.aX)((0,E.im)(R),null,{signal:t}))[0];if(null==_||null==I)return{candidates:[]};const x=new ae(yield i._reschedule(()=>i._searchFeatures(i._getQueryBBoxes(I.toJSON())),t),l,i);yield i._reschedule(()=>i._executeObjectIdsQuery(x),t),yield i._reschedule(()=>i._executeTimeQuery(x),t),yield i._reschedule(()=>i._executeAttributesQuery(x),t),yield i._reschedule(()=>i._executeGeometryQueryForSnapping(x,t),t);const C=_.toJSON(),H=u?(0,J.iV)(C,i.spatialReference):C,B=u?Math.max(R.xmax-R.xmin,R.ymax-R.ymin)/2:r;return x.createSnappingResponse({...e,point:H,distance:B},s.spatialReference)})()}executeQueryForLatestObservations(e,t){var i=this;return(0,h.Z)(function*(){if(!i.timeInfo?.trackIdField)throw new U.Z("unsupported-query","Missing timeInfo or timeInfo.trackIdField",{query:e,timeInfo:i.timeInfo});try{const s=yield i._executeQuery(e,{},t);return yield i._reschedule(()=>i._filterLatest(s),t),s.createQueryResponse()}catch(s){if(s!==me.Ti)throw s;return new ae([],e,i).createQueryResponse()}})()}executeQueryForSummaryStatistics(e={},t,i){var s=this;return(0,h.Z)(function*(){const{field:r,normalizationField:n,valueExpression:a}=t;return(yield s._executeQueryForStatistics(e,{field:r,normalizationField:n,valueExpression:a},i)).createSummaryStatisticsResponse(t)})()}executeQueryForUniqueValues(e={},t,i){var s=this;return(0,h.Z)(function*(){const{field:r,field2:n,field3:a,valueExpression:l}=t;return(yield s._executeQueryForStatistics(e,{field:r,field2:n,field3:a,valueExpression:l},i)).createUniqueValuesResponse(t)})()}executeQueryForClassBreaks(e={},t,i){var s=this;return(0,h.Z)(function*(){const{field:r,normalizationField:n,valueExpression:a}=t;return(yield s._executeQueryForStatistics(e,{field:r,normalizationField:n,valueExpression:a},i)).createClassBreaksResponse(t)})()}executeQueryForHistogram(e={},t,i){var s=this;return(0,h.Z)(function*(){const{field:r,normalizationField:n,valueExpression:a}=t;return(yield s._executeQueryForStatistics(e,{field:r,normalizationField:n,valueExpression:a},i)).createHistogramResponse(t)})()}fetchRecomputedExtents(e){var t=this;return(0,h.Z)(function*(){t._timeExtentPromise||=(0,We.R)(t.timeInfo,t.featureStore);const[i,s]=yield Promise.all([t._getFullExtent(),t._timeExtentPromise]);return(0,Z.k_)(e),{fullExtent:i,timeExtent:s}})()}_getBounds(e,t,i){var s=this;return(0,h.Z)(function*(){const r=(0,A.t8)((0,A.Ue)(),A.G_);yield s.featureStore.forEachBounds(e,l=>(0,A.TC)(r,l));const n={xmin:r[0],ymin:r[1],xmax:r[3],ymax:r[4],spatialReference:(0,b.S2)(s.spatialReference)};s.hasZ&&isFinite(r[2])&&isFinite(r[5])&&(n.zmin=r[2],n.zmax=r[5]);const a=(0,J.iV)(n,t,i);if(a.spatialReference=(0,b.S2)(i),a.xmax-a.xmin==0){const l=(0,O.c9)(a.spatialReference);a.xmin-=l,a.xmax+=l}if(a.ymax-a.ymin==0){const l=(0,O.c9)(a.spatialReference);a.ymin-=l,a.ymax+=l}if(s.hasZ&&null!=a.zmin&&null!=a.zmax&&a.zmax-a.zmin==0){const l=(0,O.c9)(a.spatialReference);a.zmin-=l,a.zmax+=l}return a})()}_getFullExtent(){return this._fullExtentPromise||="getFullExtent"in this.featureStore&&this.featureStore.getFullExtent?Promise.resolve(this.featureStore.getFullExtent(this.spatialReference)):this._getAllFeatures().then(e=>this._getBounds(e,this.spatialReference,this.spatialReference)),this._fullExtentPromise}_schedule(e,t){var i=this;return(0,h.Z)(function*(){return null!=i._frameTask?i._frameTask.schedule(e,t):e(Le.G5)})()}_reschedule(e,t){var i=this;return(0,h.Z)(function*(){return null!=i._frameTask?i._frameTask.reschedule(e,t):e(Le.G5)})()}_getAllFeaturesQueryEngineResult(e){var t=this;return(0,h.Z)(function*(){return new ae(yield t._getAllFeatures(),e,t)})()}_getAllFeatures(){var e=this;return(0,h.Z)(function*(){if(null==e._allFeaturesPromise){const s=[];e._allFeaturesPromise=(0,h.Z)(function*(){yield e.featureStore.forEach(r=>s.push(r))})().then(()=>s)}const t=e._allFeaturesPromise,i=yield t;return t===e._allFeaturesPromise?i.slice():e._getAllFeatures()})()}_executeQuery(e,t,i){var s=this;return(0,h.Z)(function*(){e=(0,re.d9)(e),e=yield s._schedule(()=>(0,me.Up)(e,s.definitionExpression,s.spatialReference),i),e=yield s._reschedule(()=>be(e,{availableFields:s.availableFields,fieldsIndex:s.fieldsIndex,geometryType:s.geometryType,spatialReference:s.spatialReference}),i),e={...e,...t};const r=yield s._reschedule(()=>s._executeSceneFilterQuery(e,i),i),n=yield s._reschedule(()=>s._executeGeometryQuery(e,r,i),i);return yield s._reschedule(()=>s._executeAggregateIdsQuery(n),i),yield s._reschedule(()=>s._executeObjectIdsQuery(n),i),yield s._reschedule(()=>s._executeTimeQuery(n),i),yield s._reschedule(()=>s._executeAttributesQuery(n),i),n})()}_executeSceneFilterQuery(e,t){var i=this;return(0,h.Z)(function*(){if(null==e.sceneFilter)return null;const{outSR:s,returnGeometry:r,returnCentroid:n}=e,a=i.featureStore.featureSpatialReference,l=e.sceneFilter.geometry,u=null==a||(0,V.fS)(a,l.spatialReference)?l:(0,J.iV)(l,a);if(!u)return null;const d=r||n,p=(0,V.JY)(s)&&!(0,V.fS)(i.spatialReference,s)&&d?function(){var x=(0,h.Z)(function*(C){return i._project(C,s)});return function(C){return x.apply(this,arguments)}}():x=>x,g=i.featureAdapter,R=yield i._reschedule(()=>i._searchFeatures(i._getQueryBBoxes(u)),t);if("disjoint"===e.sceneFilter.spatialRelationship){if(!R.length)return null;const x=new Set;for(const B of R)x.add(g.getObjectId(B));const C=yield i._reschedule(()=>i._getAllFeatures(),t);return p(yield i._reschedule((0,h.Z)(function*(){const B=yield(0,ye.cW)("esriSpatialRelDisjoint",u,i.geometryType,i.hasZ,i.hasM),T=yield i._runSpatialFilter(C,v=>!x.has(g.getObjectId(v))||B(g.getGeometry(v)),t);return new ae(T,e,i)}),t))}if(!R.length)return new ae([],e,i);if(i._canExecuteSinglePass(u,e))return p(new ae(R,e,i));const _=yield(0,ye.cW)("esriSpatialRelContains",u,i.geometryType,i.hasZ,i.hasM),I=yield i._runSpatialFilter(R,x=>_(g.getGeometry(x)),t);return p(new ae(I,e,i))})()}_executeGeometryQuery(e,t,i){var s=this;return(0,h.Z)(function*(){if(null!=t&&0===t.items.length)return t;e=null!=t?t.query:e;const{geometry:r,outSR:n,spatialRel:a,returnGeometry:l,returnCentroid:u}=e,d=s.featureStore.featureSpatialReference,p=!r||null==d||(0,V.fS)(d,r.spatialReference)?r:(0,J.iV)(r,d),g=l||u,R=(0,V.JY)(n)&&!(0,V.fS)(s.spatialReference,n),_=s._geometryQueryCache&&null==t?JSON.stringify(R&&g?{originalFilterGeometry:r,spatialRelationship:a,outSpatialReference:n}:{originalFilterGeometry:r,spatialRelationship:a}):null,I=_?s._geometryQueryCache.get(_):null;if(null!=I)return new ae(I,e,s);const x=function(){var T=(0,h.Z)(function*(v){return R&&g&&(yield s._project(v,n)),_&&s._geometryQueryCache.put(_,v.items,v.items.length+1),v});return function(L){return T.apply(this,arguments)}}();if(!p)return x(t??(yield s._getAllFeaturesQueryEngineResult(e)));const C=s.featureAdapter;let H=yield s._reschedule(()=>s._searchFeatures(s._getQueryBBoxes(r)),i);if("esriSpatialRelDisjoint"===a){if(!H.length)return x(t??(yield s._getAllFeaturesQueryEngineResult(e)));const T=new Set;for(const Y of H)T.add(C.getObjectId(Y));const v=null!=t?t.items:yield s._reschedule(()=>s._getAllFeatures(),i);return x(yield s._reschedule((0,h.Z)(function*(){const Y=yield(0,ye.cW)(a,p,s.geometryType,s.hasZ,s.hasM),ge=yield s._runSpatialFilter(v,Fe=>!T.has(C.getObjectId(Fe))||Y(C.getGeometry(Fe)),i);return new ae(ge,e,s)}),i))}if(null!=t){const T=new se.SO;H=H.filter(v=>(0,se.cq)(t.items,v,t.items.length,T)>=0)}if(!H.length){const T=new ae([],e,s);return _&&s._geometryQueryCache.put(_,T.items,1),T}if(s._canExecuteSinglePass(p,e))return x(new ae(H,e,s));const B=yield(0,ye.cW)(a,p,s.geometryType,s.hasZ,s.hasM),W=yield s._runSpatialFilter(H,T=>B(C.getGeometry(T)),i);return x(new ae(W,e,s))})()}_executeGeometryQueryForSnapping(e,t){var i=this;return(0,h.Z)(function*(){const{query:s}=e,{spatialRel:r}=s;if(!e?.items?.length||!s.geometry||!r)return;const n=yield(0,ye.cW)(r,s.geometry,i.geometryType,i.hasZ,i.hasM),a=yield i._runSpatialFilter(e.items,l=>n(l.geometry),t);e.items=a})()}_executeAggregateIdsQuery(e){if(0===e.items.length||!e.query.aggregateIds?.length||null==this.aggregateAdapter)return;const t=new Set;for(const s of e.query.aggregateIds)this.aggregateAdapter.getFeatureObjectIds(s).forEach(r=>t.add(r));const i=this.featureAdapter.getObjectId;e.items=e.items.filter(s=>t.has(i(s)))}_executeObjectIdsQuery(e){if(0===e.items.length||!e.query.objectIds?.length)return;const t=new Set(e.query.objectIds),i=this.featureAdapter.getObjectId;e.items=e.items.filter(s=>t.has(i(s)))}_executeTimeQuery(e){if(0===e.items.length)return;const t=(0,We.y)(this.timeInfo,e.query.timeExtent,this.featureAdapter);null!=t&&(e.items=e.items.filter(t))}_executeAttributesQuery(e){if(0===e.items.length)return;const t=M(e.query.where,this.fieldsIndex);if(t){if(!t.isStandardized)throw new TypeError("Where clause is not standardized");e.items=e.items.filter(i=>t.testFeature(i,this.featureAdapter))}}_runSpatialFilter(e,t,i){var s=this;return(0,h.Z)(function*(){if(!t)return e;if(null==s._frameTask)return e.filter(l=>t(l));let r=0;const n=new Array,a=function(){var l=(0,h.Z)(function*(u){for(;r<e.length;){const d=e[r++];t(d)&&(n.push(d),u.madeProgress()),u.done&&(yield s._reschedule(p=>a(p),i))}});return function(d){return l.apply(this,arguments)}}();return s._reschedule(l=>a(l),i).then(()=>n)})()}_filterLatest(e){const{trackIdField:t,startTimeField:i,endTimeField:s}=this.timeInfo,r=s||i,n=new Map,a=this.featureAdapter.getAttribute;for(const l of e.items){const u=a(l,t),d=a(l,r),p=n.get(u);(!p||d>a(p,r))&&n.set(u,l)}e.items=Array.from(n.values())}_canExecuteSinglePass(e,t){const{spatialRel:i}=t;return(0,ye.hN)(e)&&("esriSpatialRelEnvelopeIntersects"===i||"esriGeometryPoint"===this.geometryType&&("esriSpatialRelIntersects"===i||"esriSpatialRelContains"===i))}_project(e,t){var i=this;return(0,h.Z)(function*(){if(!t||(0,V.fS)(i.spatialReference,t))return e;const s=i.featureAdapter;let r;try{const a=yield i._getFullExtent();r=(0,D.getTransformation)(i.spatialReference,t,a)}catch{}const n=yield(0,J.oj)(e.items.map(a=>(0,b.Op)(i.geometryType,i.hasZ,i.hasM,s.getGeometry(a))),i.spatialReference,t,r);return e.items=n.map((a,l)=>s.cloneWithGeometry(e.items[l],(0,j.GH)(a,i.hasZ,i.hasM))),e})()}_getQueryBBoxes(e){if((0,ye.hN)(e)){if((0,E.YX)(e))return[(0,S.al)(Math.min(e.xmin,e.xmax),Math.min(e.ymin,e.ymax),Math.max(e.xmin,e.xmax),Math.max(e.ymin,e.ymax))];if((0,E.oU)(e))return e.rings.map(t=>(0,S.al)(Math.min(t[0][0],t[2][0]),Math.min(t[0][1],t[2][1]),Math.max(t[0][0],t[2][0]),Math.max(t[0][1],t[2][1])))}return[(0,F.$P)((0,S.Ue)(),e)]}_searchFeatures(e){var t=this;return(0,h.Z)(function*(){const i=new Set;yield Promise.all(e.map(r=>t.featureStore.forEachInBounds(r,n=>i.add(n))));const s=Array.from(i.values());return i.clear(),s})()}_executeQueryForStatistics(e,t,i){var s=this;return(0,h.Z)(function*(){e=(0,re.d9)(e);try{e=yield s._schedule(()=>(0,me.Up)(e,s.definitionExpression,s.spatialReference),i),e=yield s._reschedule(()=>function et(o,e,t){return Ve.apply(this,arguments)}(e,t,{availableFields:s.availableFields,fieldsIndex:s.fieldsIndex,geometryType:s.geometryType,spatialReference:s.spatialReference}),i);const r=yield s._reschedule(()=>s._executeSceneFilterQuery(e,i),i),n=yield s._reschedule(()=>s._executeGeometryQuery(e,r,i),i);return yield s._reschedule(()=>s._executeAggregateIdsQuery(n),i),yield s._reschedule(()=>s._executeObjectIdsQuery(n),i),yield s._reschedule(()=>s._executeTimeQuery(n),i),yield s._reschedule(()=>s._executeAttributesQuery(n),i),n}catch(r){if(r!==me.Ti)throw r;return new ae([],e,s)}})()}}},87757:(Te,ce,c)=>{c.d(ce,{g:()=>h});const h={supportsStatistics:!0,supportsPercentileStatistics:!0,supportsSpatialAggregationStatistics:!1,supportedSpatialAggregationStatistics:{envelope:!1,centroid:!1,convexHull:!1},supportsCentroid:!0,supportsCacheHint:!1,supportsDistance:!0,supportsDistinct:!0,supportsExtent:!0,supportsGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQuantization:!0,supportsQuantizationEditMode:!1,supportsQueryGeometry:!0,supportsResultType:!1,supportsSqlExpression:!0,supportsMaxRecordCountFactor:!1,supportsStandardizedQueriesOnly:!0,supportsTopFeaturesQuery:!1,supportsQueryByAnonymous:!0,supportsQueryByOthers:!0,supportsHistoricMoment:!1,supportsFormatPBF:!1,supportsDisjointSpatialRelationship:!0,supportsDefaultSpatialReference:!1,supportsFullTextSearch:!1,supportsCompactGeometry:!1,maxRecordCountFactor:void 0,maxRecordCount:void 0,standardMaxRecordCount:void 0,tileMaxRecordCount:void 0}},16983:(Te,ce,c)=>{c.d(ce,{EG:()=>de,Op:()=>Z,S2:()=>O});var h=c(82054),se=c(88071);const U=new se.Z,he=new se.Z,re=new se.Z,w={esriGeometryPoint:h.fQ,esriGeometryPolyline:h.J6,esriGeometryPolygon:h.eG,esriGeometryMultipoint:h.Iv};function de(S,F,E,P=S.hasZ,V=S.hasM){if(null==F)return null;const j=S.hasZ&&P,ne=S.hasM&&V;if(E){const ee=(0,h.Nh)(re,F,S.hasZ,S.hasM,"esriGeometryPoint",E,P,V);return(0,h.fQ)(ee,j,ne)}return(0,h.fQ)(F,j,ne)}function Z(S,F,E,P,V,j,ne=F,ee=E){const pe=F&&ne,le=E&&ee,m=null!=P?"coords"in P?P:P.geometry:null;if(null==m)return null;if(V){let G=(0,h.zj)(he,m,F,E,S,V,ne,ee);return j&&(G=(0,h.Nh)(re,G,pe,le,S,j)),w[S]?.(G,pe,le)??null}if(j){const G=(0,h.Nh)(re,m,F,E,S,j,ne,ee);return w[S]?.(G,pe,le)??null}return(0,h.hY)(U,m,F,E,ne,ee),w[S]?.(U,pe,le)??null}function O(S){return S&&D in S?JSON.parse(JSON.stringify(S,A)):S}const D="_geVersion",A=(S,F)=>S!==D?F:void 0},56541:(Te,ce,c)=>{c.d(ce,{Ti:()=>A,Up:()=>S,j6:()=>E});var h=c(15861),se=c(2076),U=c(16730),he=c(5464),re=c(15176),w=c(91179),de=c(93555),Z=c(37053),O=c(82959);const D=new se.X({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"}),A=Object.freeze({});function S(m,G,q){return F.apply(this,arguments)}function F(){return(F=(0,h.Z)(function*(m,G,q){const{outFields:$,orderByFields:Q,groupByFieldsForStatistics:te,outStatistics:y}=m;if($)for(let f=0;f<$.length;f++)$[f]=$[f].trim();if(Q)for(let f=0;f<Q.length;f++)Q[f]=Q[f].trim();if(te)for(let f=0;f<te.length;f++)te[f]=te[f].trim();if(y)for(let f=0;f<y.length;f++)y[f].onStatisticField&&(y[f].onStatisticField=y[f].onStatisticField.trim());return m.geometry&&!m.outSR&&(m.outSR=m.geometry.spatialReference),E(m,G,q)})).apply(this,arguments)}function E(m,G,q){return P.apply(this,arguments)}function P(){return P=(0,h.Z)(function*(m,G,q){if(!m)return null;let{where:$}=m;if(m.where=$=$?.trim(),(!$||/^1 *= *1$/.test($)||G&&G===$)&&(m.where=null),!m.geometry)return m;let Q=yield function ne(m){return ee.apply(this,arguments)}(m);if(m.distance=0,m.units=null,"esriSpatialRelEnvelopeIntersects"===m.spatialRel){const{spatialReference:te}=m.geometry;Q=(0,re.aO)(Q),Q.spatialReference=te}if(Q){yield(0,O._W)(Q.spatialReference,q),Q=function j(m,G){const q=m.spatialReference;return V(m,G)&&(0,w.YX)(m)?{spatialReference:q,rings:[[[m.xmin,m.ymin],[m.xmin,m.ymax],[m.xmax,m.ymax],[m.xmax,m.ymin],[m.xmin,m.ymin]]]}:m}(Q,q);const te=(yield(0,de.aX)((0,w.im)(Q)))[0];if(null==te)throw A;const y="quantizationParameters"in m&&m.quantizationParameters?.tolerance||"maxAllowableOffset"in m&&m.maxAllowableOffset||0,f=y&&V(Q,q)?{densificationStep:8*y}:void 0,N=te.toJSON(),M=(0,O.iV)(N,N.spatialReference,q,f);if(!M)throw A;M.spatialReference=q,m.geometry=M}return m}),P.apply(this,arguments)}function V(m,G){if(!m)return!1;const q=m.spatialReference;return((0,w.YX)(m)||(0,w.oU)(m)||(0,w.l9)(m))&&!(0,Z.fS)(q,G)&&!(0,he.canProjectWithoutEngine)(q,G)}function ee(){return ee=(0,h.Z)(function*(m){const{distance:G,units:q}=m,$=m.geometry;if(null==G||"vertexAttributes"in $)return $;const Q=$.spatialReference,te=q?D.fromJSON(q):(0,U.qE)(Q),y=Q&&((0,Z.sT)(Q)||(0,Z.sS)(Q))?$:yield(0,O._W)(Q,Z.Zn).then(()=>(0,O.iV)($,Z.Zn));return(yield function pe(){return le.apply(this,arguments)}())(y.spatialReference,y,G,te)}),ee.apply(this,arguments)}function le(){return(le=(0,h.Z)(function*(){return(yield Promise.all([c.e(4918),c.e(8592)]).then(c.bind(c,32825))).geodesicBuffer})).apply(this,arguments)}},53023:(Te,ce,c)=>{c.d(ce,{hN:()=>te,P0:()=>$,cW:()=>q});var h=c(15861),se=c(26584),U=c(33190),he=c(11519),w=c(91179),de=c(37053);function Z(y,f){return y?f?4:3:f?3:2}function A(y,f,N,M,K){if(!y)return!1;const X=Z(f,N),{coords:z,lengths:ue}=y;let ie=!1,b=0;for(const J of ue)ie=S(ie,z,X,b,J,M,K),b+=J*X;return ie}function S(y,f,N,M,K,X,z){let ue=y,ie=M;for(let b=M,J=M+K*N;b<J;b+=N){ie=b+N,ie===J&&(ie=M);const Ce=f[b],ve=f[b+1],Re=f[ie+1];(ve<z&&Re>=z||Re<z&&ve>=z)&&Ce+(z-ve)/(Re-ve)*(f[ie]-Ce)<X&&(ue=!ue)}return ue}var F=c(82054),E=c(88071),P=c(16983),V=c(82959);const j="unsupported-query",ne={esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"intersects",esriSpatialRelIndexIntersects:null,esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:null},ee={spatialRelationship:{esriSpatialRelIntersects:!0,esriSpatialRelContains:!0,esriSpatialRelWithin:!0,esriSpatialRelCrosses:!0,esriSpatialRelDisjoint:!0,esriSpatialRelTouches:!0,esriSpatialRelOverlaps:!0,esriSpatialRelEnvelopeIntersects:!0,esriSpatialRelIndexIntersects:!1,esriSpatialRelRelation:!1},queryGeometry:{esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!0},layerGeometry:{esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!1}};function q(y,f,N,M,K){if((0,w.oU)(f)&&"esriGeometryPoint"===N&&("esriSpatialRelIntersects"===y||"esriSpatialRelContains"===y)){const X=(0,F.Uy)(new E.Z,f,!1,!1);return Promise.resolve(z=>function O(y,f,N,M){return A(y,f,N,M.coords[0],M.coords[1])}(X,!1,!1,z))}if((0,w.oU)(f)&&"esriGeometryMultipoint"===N){const X=(0,F.Uy)(new E.Z,f,!1,!1);if("esriSpatialRelContains"===y)return Promise.resolve(z=>function D(y,f,N,M,K,X){const z=Z(K,X),{coords:ue,lengths:ie}=M;if(!ie)return!1;for(let b=0,J=0;b<ie.length;b++,J+=z)if(!A(y,f,N,ue[J],ue[J+1]))return!1;return!0}(X,!1,!1,z,M,K))}if((0,w.YX)(f)&&"esriGeometryPoint"===N&&("esriSpatialRelIntersects"===y||"esriSpatialRelContains"===y))return Promise.resolve(X=>(0,U.aV)(f,(0,P.Op)(N,M,K,X)));if((0,w.YX)(f)&&"esriGeometryMultipoint"===N&&"esriSpatialRelContains"===y)return Promise.resolve(X=>(0,U.lQ)(f,(0,P.Op)(N,M,K,X)));if((0,w.YX)(f)&&"esriSpatialRelIntersects"===y){const X=function re(y){return"mesh"===y?he.h_:(0,he.IY)(y)}(N);return Promise.resolve(z=>X(f,(0,P.Op)(N,M,K,z)))}return function G(){return Promise.all([c.e(4918),c.e(8592)]).then(c.bind(c,32825))}().then(X=>{const z=X[ne[y]].bind(null,f.spatialReference,f);return ue=>z((0,P.Op)(N,M,K,ue))})}function $(y,f,N){return Q.apply(this,arguments)}function Q(){return(Q=(0,h.Z)(function*(y,f,N){const{spatialRel:M,geometry:K}=y;if(K){if(!function pe(y){return null!=y&&!0===ee.spatialRelationship[y]}(M))throw new se.Z(j,"Unsupported query spatial relationship",{query:y});if((0,de.JY)(K.spatialReference)&&(0,de.JY)(N)){if(!function le(y){return null!=y&&!0===ee.queryGeometry[(0,w.Ji)(y)]}(K))throw new se.Z(j,"Unsupported query geometry type",{query:y});if(!function m(y){return null!=y&&!0===ee.layerGeometry[y]}(f))throw new se.Z(j,"Unsupported layer geometry type",{query:y});if(y.outSR)return(0,V._W)(y.geometry?.spatialReference,y.outSR)}}})).apply(this,arguments)}function te(y){if((0,w.YX)(y))return!0;if((0,w.oU)(y)){for(const f of y.rings)if(5!==f.length||f[0][0]!==f[1][0]||f[0][0]!==f[4][0]||f[2][0]!==f[3][0]||f[0][1]!==f[3][1]||f[0][1]!==f[4][1]||f[1][1]!==f[2][1])return!1;return!0}return!1}},76530:(Te,ce,c)=>{c.d(ce,{R:()=>se,y:()=>he});var h=c(15861);function se(Z,O){return U.apply(this,arguments)}function U(){return(U=(0,h.Z)(function*(Z,O){if(!Z)return null;const D=O.featureAdapter,{startTimeField:A,endTimeField:S}=Z;let F=Number.POSITIVE_INFINITY,E=Number.NEGATIVE_INFINITY;if(A&&S)yield O.forEach(P=>{const V=D.getAttribute(P,A),j=D.getAttribute(P,S);null==V||isNaN(V)||(F=Math.min(F,V)),null==j||isNaN(j)||(E=Math.max(E,j))});else{const P=A||S;yield O.forEach(V=>{const j=D.getAttribute(V,P);null==j||isNaN(j)||(F=Math.min(F,j),E=Math.max(E,j))})}return{start:F,end:E}})).apply(this,arguments)}function he(Z,O,D){if(!O||!Z)return null;const{startTimeField:A,endTimeField:S}=Z;if(!A&&!S)return null;const{start:F,end:E}=O;if(null===F&&null===E)return null;if(void 0===F&&void 0===E)return()=>!1;const P=D.getAttributeAsTimestamp?.bind(D)??D.getAttribute.bind(D);return A&&S?function re(Z,O,D,A,S){return null!=A&&null!=S?F=>{const E=Z(F,O),P=Z(F,D);return(null==E||E<=S)&&(null==P||P>=A)}:null!=A?F=>{const E=Z(F,D);return null==E||E>=A}:null!=S?F=>{const E=Z(F,O);return null==E||E<=S}:void 0}(P,A,S,F,E):function w(Z,O,D,A){return null!=D&&null!=A&&D===A?S=>Z(S,O)===D:null!=D&&null!=A?S=>{const F=Z(S,O);return null!=F&&F>=D&&F<=A}:null!=D?S=>{const F=Z(S,O);return null!=F&&F>=D}:null!=A?S=>{const F=Z(S,O);return null!=F&&F<=A}:void 0}(P,A||S,F,E)}}}]);