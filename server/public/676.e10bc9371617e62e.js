"use strict";(self.webpackChunkCRIS=self.webpackChunkCRIS||[]).push([[676],{10992:(qt,vt,v)=>{v.d(vt,{Ue:()=>Ot,nF:()=>N,zk:()=>C});var mt=v(21286),jt=v(97535),$=v(84161),ct=v(28093),Dt=v(26242);function Ot(E){return E?{origin:(0,ct.g)(E.origin),vector:(0,ct.g)(E.vector)}:{origin:(0,ct.c)(),vector:(0,ct.c)()}}function C(E,j,F=Ot()){return(0,$.c)(F.origin,E),(0,$.f)(F.vector,j,E),F}function N(E,j,F){return function at(E,j,F,V,q){const{vector:D,origin:tt}=E,W=(0,$.f)(Dt.WM.get(),j,tt),ht=(0,$.j)(D,W)/(0,$.m)(D);return(0,$.i)(q,D,(0,mt.uZ)(ht,F,V)),(0,$.g)(q,q,E.origin)}(E,j,0,1,F)}(0,ct.c)(),(0,ct.c)(),new jt.x(()=>Ot())},60676:(qt,vt,v)=>{v.r(vt),v.d(vt,{default:()=>mn});var rt,p,d,mt=v(15861),jt=v(17626),$=v(10699),Pt=(v(63290),v(90912),v(85931),v(8314),v(26584),v(76898)),C=v(84161),S=v(28093),Mt=v(10992),N=v(97126),Ut=v(27899),at=v(77029),xt=v(97535),J=(v(28347),v(993),v(4794)),w=v(70562);function et(d){return d?{ray:(0,w.Ue)(d.ray),c0:d.c0,c1:d.c1}:{ray:(0,w.Ue)(),c0:0,c1:Number.MAX_VALUE}}function dt(d,s){for(let a=0;a<Et;a++){const h=d[a];if(h[0]*s[0]+h[1]*s[1]+h[2]*s[2]+h[3]>=s[3])return!1}return!0}new xt.x(()=>et()),v(4688),v(26242),(d=rt||(rt={}))[d.LEFT=0]="LEFT",d[d.RIGHT=1]="RIGHT",d[d.BOTTOM=2]="BOTTOM",d[d.TOP=3]="TOP",d[d.NEAR=4]="NEAR",d[d.FAR=5]="FAR",function(d){d[d.NEAR_BOTTOM_LEFT=0]="NEAR_BOTTOM_LEFT",d[d.NEAR_BOTTOM_RIGHT=1]="NEAR_BOTTOM_RIGHT",d[d.NEAR_TOP_RIGHT=2]="NEAR_TOP_RIGHT",d[d.NEAR_TOP_LEFT=3]="NEAR_TOP_LEFT",d[d.FAR_BOTTOM_LEFT=4]="FAR_BOTTOM_LEFT",d[d.FAR_BOTTOM_RIGHT=5]="FAR_BOTTOM_RIGHT",d[d.FAR_TOP_RIGHT=6]="FAR_TOP_RIGHT",d[d.FAR_TOP_LEFT=7]="FAR_TOP_LEFT"}(p||(p={}));const Et=6;(0,J.f)(-1,-1,-1,1),(0,J.f)(1,-1,-1,1),(0,J.f)(1,1,-1,1),(0,J.f)(-1,1,-1,1),(0,J.f)(-1,-1,1,1),(0,J.f)(1,-1,1,1),(0,J.f)(1,1,1,1),(0,J.f)(-1,1,1,1),new xt.x(et),function Ft(){(0,S.c)(),(0,S.c)(),(0,S.c)(),(0,S.c)(),(0,S.c)(),(0,S.c)(),(0,S.c)(),(0,S.c)()}();var Zt=v(2282);class lt{get bounds(){return this._root.bounds}get halfSize(){return this._root.halfSize}get root(){return this._root.node}get maximumObjectsPerNode(){return this._maximumObjectsPerNode}get maximumDepth(){return this._maximumDepth}get objectCount(){return this._objectCount}constructor(s,a){this.objectToBoundingSphere=s,this._maximumObjectsPerNode=10,this._maximumDepth=20,this._degenerateObjects=new Set,this._root=new P,this._objectCount=0,a&&(void 0!==a.maximumObjectsPerNode&&(this._maximumObjectsPerNode=a.maximumObjectsPerNode),void 0!==a.maximumDepth&&(this._maximumDepth=a.maximumDepth))}destroy(){this._degenerateObjects.clear(),P.clearPool(),It[0]=null,ft.prune(),_t.prune()}add(s,a=s.length){this._objectCount+=a,this._grow(s,a);const h=P.acquire();for(let l=0;l<a;l++){const m=s[l];this._isDegenerate(m)?this._degenerateObjects.add(m):(h.init(this._root),this._add(m,h))}P.release(h)}remove(s,a=null){this._objectCount-=s.length;const h=P.acquire();for(const l of s){const m=a??(0,N.h)(this.objectToBoundingSphere(l),un);At(m[3])?(h.init(this._root),this._remove(l,m,h)):this._degenerateObjects.delete(l)}P.release(h),this._shrink()}update(s,a){if(!At(a[3])&&this._isDegenerate(s))return;const h=function dn(d){return It[0]=d,It}(s);this.remove(h,a),this.add(h)}forEachAlongRay(s,a,h){const l=(0,w.re)(s,a);this._forEachNode(this._root,m=>{if(!this._intersectsNode(l,m))return!1;const g=m.node;return g.terminals.forAll(b=>{this._intersectsObject(l,b)&&h(b)}),null!==g.residents&&g.residents.forAll(b=>{this._intersectsObject(l,b)&&h(b)}),!0})}forEachAlongRayWithVerticalOffset(s,a,h,l){const m=(0,w.re)(s,a);this._forEachNode(this._root,g=>{if(!this._intersectsNodeWithOffset(m,g,l))return!1;const b=g.node;return b.terminals.forAll(T=>{this._intersectsObjectWithOffset(m,T,l)&&h(T)}),null!==b.residents&&b.residents.forAll(T=>{this._intersectsObjectWithOffset(m,T,l)&&h(T)}),!0})}forEach(s){this._forEachNode(this._root,a=>{const h=a.node;return h.terminals.forAll(s),null!==h.residents&&h.residents.forAll(s),!0}),this._degenerateObjects.forEach(s)}forEachDegenerateObject(s){this._degenerateObjects.forEach(s)}findClosest(s,a,h,l=(()=>!0),m=1/0){let g=1/0,b=1/0,T=null;const x=Lt(s,a),z=L=>{if(--m,!l(L))return;const K=this.objectToBoundingSphere(L);if(!dt(h,K))return;const Y=it(s,a,(0,N.g)(K)),bt=Y-K[3];bt<g&&(g=bt,b=Y+K[3],T=L)};return this._forEachNodeDepthOrdered(this._root,L=>{if(m<=0||!dt(h,L.bounds)||((0,C.i)(X,x,L.halfSize),(0,C.g)(X,X,L.bounds),it(s,a,X)>b))return!1;const K=L.node;return K.terminals.forAll(Y=>z(Y)),null!==K.residents&&K.residents.forAll(Y=>z(Y)),!0},s,a),T}forEachInDepthRange(s,a,h,l,m,g,b){let T=-1/0,x=1/0;const z={setRange:U=>{h===lt.DepthOrder.FRONT_TO_BACK?(T=Math.max(T,U.near),x=Math.min(x,U.far)):(T=Math.max(T,-U.far),x=Math.min(x,-U.near))}};z.setRange(l);const L=it(a,h,s),K=Lt(a,h),Y=Lt(a,-h),bt=U=>{if(!b(U))return;const st=this.objectToBoundingSphere(U),St=(0,N.g)(st),$t=it(a,h,St)-L;$t-st[3]>x||$t+st[3]<T||!dt(g,st)||m(U,z)};this._forEachNodeDepthOrdered(this._root,U=>{if(!dt(g,U.bounds)||((0,C.i)(X,K,U.halfSize),(0,C.g)(X,X,U.bounds),it(a,h,X)-L>x)||((0,C.i)(X,Y,U.halfSize),(0,C.g)(X,X,U.bounds),it(a,h,X)-L<T))return!1;const st=U.node;return st.terminals.forAll(St=>bt(St)),null!==st.residents&&st.residents.forAll(St=>bt(St)),!0},a,h)}forEachNode(s){this._forEachNode(this._root,a=>s(a.node,a.bounds,a.halfSize,a.depth))}forEachNeighbor(s,a){const h=(0,N.a)(a),l=(0,N.g)(a),m=T=>{const x=this.objectToBoundingSphere(T),z=(0,N.a)(x),L=h+z;return!((0,C.a)((0,N.g)(x),l)-L*L<=0)||s(T)};let g=!0;const b=T=>{g&&(g=m(T))};this._forEachNode(this._root,T=>{const x=(0,N.a)(T.bounds),z=h+x;if((0,C.a)((0,N.g)(T.bounds),l)-z*z>0)return!1;const L=T.node;return L.terminals.forAll(b),g&&null!==L.residents&&L.residents.forAll(b),g}),g&&this.forEachDegenerateObject(b)}_intersectsNode(s,a){return Nt(a.bounds,2*-a.halfSize,Z),Nt(a.bounds,2*a.halfSize,k),(0,Zt.yK)(s.origin,s.direction,Z,k)}_intersectsNodeWithOffset(s,a,h){return Nt(a.bounds,2*-a.halfSize,Z),Nt(a.bounds,2*a.halfSize,k),h.applyToMinMax(Z,k),(0,Zt.yK)(s.origin,s.direction,Z,k)}_intersectsObject(s,a){const h=this.objectToBoundingSphere(a);return!(h[3]>0)||(0,N.j)(h,s)}_intersectsObjectWithOffset(s,a,h){const l=this.objectToBoundingSphere(a);return!(l[3]>0)||(0,N.j)(h.applyToBoundingSphere(l),s)}_forEachNode(s,a){let h=P.acquire().init(s);const l=[h];for(;0!==l.length;){if(h=l.pop(),a(h)&&!h.isLeaf())for(let m=0;m<h.node.children.length;m++)h.node.children[m]&&l.push(P.acquire().init(h).advance(m));P.release(h)}}_forEachNodeDepthOrdered(s,a,h,l=lt.DepthOrder.FRONT_TO_BACK){let m=P.acquire().init(s);const g=[m];for(function hn(d,s,a){if(!_t.length)for(let h=0;h<8;++h)_t.push({index:0,distance:0});for(let h=0;h<8;++h){const l=Jt[h];_t.data[h].index=h,_t.data[h].distance=it(d,s,l)}_t.sort((h,l)=>h.distance-l.distance);for(let h=0;h<8;++h)a[h]=_t.data[h].index}(h,l,Qt);0!==g.length;){if(m=g.pop(),a(m)&&!m.isLeaf())for(let b=7;b>=0;--b){const T=Qt[b];m.node.children[T]&&g.push(P.acquire().init(m).advance(T))}P.release(m)}}_remove(s,a,h){ft.clear();const l=h.advanceTo(a,(m,g)=>{ft.push(m.node),ft.push(g)})?h.node.terminals:h.node.residents;if(l.removeUnordered(s),0===l.length)for(let m=ft.length-2;m>=0&&this._purge(ft.data[m],ft.data[m+1]);m-=2);}_nodeIsEmpty(s){if(0!==s.terminals.length)return!1;if(null!==s.residents)return 0===s.residents.length;for(let a=0;a<s.children.length;a++)if(s.children[a])return!1;return!0}_purge(s,a){return a>=0&&(s.children[a]=null),!!this._nodeIsEmpty(s)&&(null===s.residents&&(s.residents=new at.Z({shrink:!0})),!0)}_add(s,a){a.advanceTo(this.objectToBoundingSphere(s))?a.node.terminals.push(s):(a.node.residents.push(s),a.node.residents.length>this._maximumObjectsPerNode&&a.depth<this._maximumDepth&&this._split(a))}_split(s){const a=s.node.residents;s.node.residents=null;for(let h=0;h<a.length;h++){const l=P.acquire().init(s);this._add(a.at(h),l),P.release(l)}}_grow(s,a){if(0!==a&&(kt(s,a,h=>this.objectToBoundingSphere(h),nt),At(nt[3])&&!this._fitsInsideTree(nt)))if(this._nodeIsEmpty(this._root.node))(0,N.h)(nt,this._root.bounds),this._root.halfSize=1.25*this._root.bounds[3],this._root.updateBoundsRadiusFromHalfSize();else{const h=this._rootBoundsForRootAsSubNode(nt);this._placingRootViolatesMaxDepth(h)?this._rebuildTree(nt,h):this._growRootAsSubNode(h),P.release(h)}}_rebuildTree(s,a){(0,C.c)(Ct,a.bounds),Ct[3]=a.halfSize,kt([s,Ct],2,l=>l,Ht);const h=P.acquire().init(this._root);this._root.initFrom(null,Ht,Ht[3]),this._root.increaseHalfSize(1.25),this._forEachNode(h,l=>(this.add(l.node.terminals.data,l.node.terminals.length),null!==l.node.residents&&this.add(l.node.residents.data,l.node.residents.length),!0)),P.release(h)}_placingRootViolatesMaxDepth(s){const a=Math.log(s.halfSize/this._root.halfSize)*Math.LOG2E;let h=0;return this._forEachNode(this._root,l=>(h=Math.max(h,l.depth),h+a<=this._maximumDepth)),h+a>this._maximumDepth}_rootBoundsForRootAsSubNode(s){const a=s[3],h=s;let l=-1/0;const m=this._root.bounds,g=this._root.halfSize;for(let T=0;T<3;T++){const z=h[T]+a-(m[T]+g),L=Math.max(0,Math.ceil((m[T]-g-(h[T]-a))/(2*g))),K=Math.max(0,Math.ceil(z/(2*g)))+1,Y=2**Math.ceil(Math.log(L+K)*Math.LOG2E);l=Math.max(l,Y),Bt[T].min=L,Bt[T].max=K}for(let T=0;T<3;T++){let x=Bt[T].min,z=Bt[T].max;const L=(l-(x+z))/2;x+=Math.ceil(L),z+=Math.floor(L),yt[T]=m[T]-g-x*g*2+(z+x)*g}const b=l*g;return yt[3]=b*wt,P.acquire().initFrom(null,yt,b,0)}_growRootAsSubNode(s){const a=this._root.node;(0,C.c)(nt,this._root.bounds),nt[3]=this._root.halfSize,this._root.init(s),s.advanceTo(nt,null,!0),s.node.children=a.children,s.node.residents=a.residents,s.node.terminals=a.terminals}_shrink(){for(;;){const s=this._findShrinkIndex();if(-1===s)break;this._root.advance(s),this._root.depth=0}}_findShrinkIndex(){if(0!==this._root.node.terminals.length||this._root.isLeaf())return-1;let s=null;const a=this._root.node.children;let h=0,l=0;for(;l<a.length&&null==s;)h=l++,s=a[h];for(;l<a.length;)if(a[l++])return-1;return h}_isDegenerate(s){return!At(this.objectToBoundingSphere(s)[3])}_fitsInsideTree(s){const a=this._root.bounds,h=this._root.halfSize;return s[3]<=h&&s[0]>=a[0]-h&&s[0]<=a[0]+h&&s[1]>=a[1]-h&&s[1]<=a[1]+h&&s[2]>=a[2]-h&&s[2]<=a[2]+h}toJSON(){const{maximumDepth:s,maximumObjectsPerNode:a,_objectCount:h}=this,l=this._nodeToJSON(this._root.node);return{maximumDepth:s,maximumObjectsPerNode:a,objectCount:h,root:{bounds:this._root.bounds,halfSize:this._root.halfSize,depth:this._root.depth,node:l}}}_nodeToJSON(s){const a=s.children.map(m=>m?this._nodeToJSON(m):null),h=s.residents?.map(m=>this.objectToBoundingSphere(m)),l=s.terminals?.map(m=>this.objectToBoundingSphere(m));return{children:a,residents:h,terminals:l}}static fromJSON(s){const a=new lt(h=>h,{maximumDepth:s.maximumDepth,maximumObjectsPerNode:s.maximumObjectsPerNode});return a._objectCount=s.objectCount,a._root.initFrom(s.root.node,s.root.bounds,s.root.halfSize,s.root.depth),a}}class P{constructor(){this.bounds=(0,N.c)(),this.halfSize=0,this.initFrom(null,null,0,0)}init(s){return this.initFrom(s.node,s.bounds,s.halfSize,s.depth)}initFrom(s,a,h,l=this.depth){return this.node=s??P.createEmptyNode(),null!=a&&(0,N.h)(a,this.bounds),this.halfSize=h,this.depth=l,this}increaseHalfSize(s){this.halfSize*=s,this.updateBoundsRadiusFromHalfSize()}updateBoundsRadiusFromHalfSize(){this.bounds[3]=this.halfSize*wt}advance(s){let a=this.node.children[s];a||(a=P.createEmptyNode(),this.node.children[s]=a),this.node=a,this.halfSize/=2,this.depth++;const h=Jt[s];return this.bounds[0]+=h[0]*this.halfSize,this.bounds[1]+=h[1]*this.halfSize,this.bounds[2]+=h[2]*this.halfSize,this.updateBoundsRadiusFromHalfSize(),this}advanceTo(s,a,h=!1){for(;;){if(this.isTerminalFor(s))return a&&a(this,-1),!0;if(this.isLeaf()){if(!h)return a&&a(this,-1),!1;this.node.residents=null}const l=this._childIndex(s);a&&a(this,l),this.advance(l)}}isLeaf(){return null!=this.node.residents}isTerminalFor(s){return s[3]>this.halfSize/2}_childIndex(s){const a=this.bounds;return(a[0]<s[0]?1:0)+(a[1]<s[1]?2:0)+(a[2]<s[2]?4:0)}static createEmptyNode(){return{children:[null,null,null,null,null,null,null,null],terminals:new at.Z({shrink:!0}),residents:new at.Z({shrink:!0})}}static acquire(){return P._pool.acquire()}static release(s){P._pool.release(s)}static clearPool(){P._pool.prune()}}function cn(d,s){d[0]=Math.min(d[0],s[0]-s[3]),d[1]=Math.min(d[1],s[1]-s[3]),d[2]=Math.min(d[2],s[2]-s[3])}function an(d,s){d[0]=Math.max(d[0],s[0]+s[3]),d[1]=Math.max(d[1],s[1]+s[3]),d[2]=Math.max(d[2],s[2]+s[3])}function Nt(d,s,a){a[0]=d[0]+s,a[1]=d[1]+s,a[2]=d[2]+s}function kt(d,s,a,h){if(1===s){const l=a(d[0]);(0,N.h)(l,h)}else{Z[0]=1/0,Z[1]=1/0,Z[2]=1/0,k[0]=-1/0,k[1]=-1/0,k[2]=-1/0;for(let l=0;l<s;l++){const m=a(d[l]);At(m[3])&&(cn(Z,m),an(k,m))}(0,C.p)(h,Z,k,.5),h[3]=Math.max(k[0]-Z[0],k[1]-Z[1],k[2]-Z[2])/2}}function Lt(d,s){let a,h=1/0;for(let l=0;l<8;++l){const m=it(d,s,Xt[l]);m<h&&(h=m,a=Xt[l])}return a}function it(d,s,a){return s*(d[0]*a[0]+d[1]*a[1]+d[2]*a[2])}function At(d){return!isNaN(d)&&d!==-1/0&&d!==1/0&&d>0}P._pool=new Ut.Z(P),function(d){var s;(s=d.DepthOrder||(d.DepthOrder={}))[s.FRONT_TO_BACK=1]="FRONT_TO_BACK",s[s.BACK_TO_FRONT=-1]="BACK_TO_FRONT"}(lt||(lt={}));const Jt=[(0,S.f)(-1,-1,-1),(0,S.f)(1,-1,-1),(0,S.f)(-1,1,-1),(0,S.f)(1,1,-1),(0,S.f)(-1,-1,1),(0,S.f)(1,-1,1),(0,S.f)(-1,1,1),(0,S.f)(1,1,1)],Xt=[(0,S.f)(-1,-1,-1),(0,S.f)(-1,-1,1),(0,S.f)(-1,1,-1),(0,S.f)(-1,1,1),(0,S.f)(1,-1,-1),(0,S.f)(1,-1,1),(0,S.f)(1,1,-1),(0,S.f)(1,1,1)],wt=Math.sqrt(3),It=[null],yt=(0,N.c)(),X=(0,S.c)(),Z=(0,S.c)(),k=(0,S.c)(),ft=new at.Z,un=(0,N.c)(),nt=(0,N.c)(),Ct=(0,N.c)(),Ht=(0,N.c)(),Bt=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],_t=new at.Z,Qt=[0,0,0,0,0,0,0,0],Yt=lt;var ln=v(91573);function _n(d,s,a){const h=(0,N.c)(),l=(0,N.g)(h);return(0,C.q)(l,l,d,.5),(0,C.q)(l,l,s,.5),h[3]=(0,C.o)(l,d),(0,C.g)(l,l,a),h}let zt=class{constructor(){this._idToComponent=new Map,this._components=new Yt(d=>d.bounds),this._edges=new Yt(d=>d.bounds),this._tmpLineSegment=(0,Mt.Ue)(),this._tmpP1=(0,S.c)(),this._tmpP2=(0,S.c)(),this._tmpP3=(0,S.c)(),this.remoteClient=null}fetchCandidates(d,s){var a=this;return(0,mt.Z)(function*(){yield Promise.resolve(),(0,$.k_)(s),yield a._ensureEdgeLocations(d,s);const h=[];return a._edges.forEachNeighbor(l=>(a._addCandidates(d,l,h),h.length<1e3),d.bounds),{result:{candidates:h}}})()}_ensureEdgeLocations(d,s){var a=this;return(0,mt.Z)(function*(){const h=[];if(a._components.forEachNeighbor(g=>{if(null==g.info){const{id:b,uid:T}=g;h.push({id:b,uid:T})}return!0},d.bounds),!h.length)return;const l={components:h},m=yield a.remoteClient.invoke("fetchAllEdgeLocations",l,s??{});for(const g of m.components)a._setFetchEdgeLocations(g)})()}add(d){var s=this;return(0,mt.Z)(function*(){const a=new On(d.id,d.bounds);return s._idToComponent.set(a.id,a),s._components.add([a]),{result:{}}})()}remove(d){var s=this;return(0,mt.Z)(function*(){const a=s._idToComponent.get(d.id);if(a){const h=[];s._edges.forEachNeighbor(l=>(l.component===a&&h.push(l),!0),a.bounds),s._edges.remove(h),s._components.remove([a]),s._idToComponent.delete(a.id)}return{result:{}}})()}_setFetchEdgeLocations(d){const s=this._idToComponent.get(d.id);if(null==s||d.uid!==s.uid)return;const a=ln.n_.createView(d.locations),h=new Array(a.count),l=(0,S.c)(),m=(0,S.c)();for(let T=0;T<a.count;T++){a.position0.getVec(T,l),a.position1.getVec(T,m);const x=_n(l,m,d.origin),z=new Tn(s,T,x);h[T]=z}this._edges.add(h);const{objectIds:g,origin:b}=d;s.info={locations:a,objectIds:g,origin:b}}_addCandidates(d,s,a){const{info:h}=s.component,{origin:l,objectIds:m}=h,g=h.locations,b=g.position0.getVec(s.index,this._tmpP1),T=g.position1.getVec(s.index,this._tmpP2);(0,C.g)(b,b,l),(0,C.g)(T,T,l);const x=m[g.componentIndex.get(s.index)];this._addEdgeCandidate(d,x,b,T,a),this._addVertexCandidate(d,x,b,a),this._addVertexCandidate(d,x,T,a)}_addEdgeCandidate(d,s,a,h,l){if(!d.returnEdge)return;const m=(0,N.g)(d.bounds),g=(0,Mt.zk)(a,h,this._tmpLineSegment),b=(0,Mt.nF)(g,m,this._tmpP3);(0,N.n)(d.bounds,b)&&l.push({type:"edge",objectId:s,target:(0,S.g)(b),distance:(0,C.o)(m,b),start:(0,S.g)(a),end:(0,S.g)(h)})}_addVertexCandidate(d,s,a,h){if(!d.returnVertex)return;const l=(0,N.g)(d.bounds);(0,N.n)(d.bounds,a)&&h.push({type:"vertex",objectId:s,target:(0,S.g)(a),distance:(0,C.o)(l,a)})}};zt=(0,jt._)([(0,Pt.j)("esri.views.interactive.snapping.featureSources.sceneLayerSource.SceneLayerSnappingSourceWorker")],zt);const mn=zt;let On=(()=>{class d{constructor(a,h){this.id=a,this.bounds=h,this.info=null,this.uid=++d.uid}}return d.uid=0,d})();class Tn{constructor(s,a,h){this.component=s,this.index=a,this.bounds=h}}}}]);