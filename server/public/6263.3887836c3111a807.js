"use strict";(self.webpackChunkCRIS=self.webpackChunkCRIS||[]).push([[6263],{65389:(w,F,s)=>{s.d(F,{Z:()=>d});class d{constructor(p){this.size=0,this._start=0,this.maxSize=p,this._buffer=new Array(p)}get entries(){return this._buffer}enqueue(p){if(this.size===this.maxSize){const T=this._buffer[this._start];return this._buffer[this._start]=p,this._start=(this._start+1)%this.maxSize,T}return this._buffer[(this._start+this.size++)%this.maxSize]=p,null}dequeue(){if(0===this.size)return null;const p=this._buffer[this._start];return this._buffer[this._start]=null,this.size--,this._start=(this._start+1)%this.maxSize,p}peek(){return 0===this.size?null:this._buffer[this._start]}find(p){if(0===this.size)return null;for(const T of this._buffer)if(null!=T&&p(T))return T;return null}clear(p){let T=this.dequeue();for(;null!=T;)p&&p(T),T=this.dequeue()}}},16983:(w,F,s)=>{s.d(F,{EG:()=>b,Op:()=>c,S2:()=>_});var d=s(82054),G=s(88071);const p=new G.Z,T=new G.Z,Z=new G.Z,I={esriGeometryPoint:d.fQ,esriGeometryPolyline:d.J6,esriGeometryPolygon:d.eG,esriGeometryMultipoint:d.Iv};function b(l,o,a,h=l.hasZ,O=l.hasM){if(null==o)return null;const g=l.hasZ&&h,A=l.hasM&&O;if(a){const P=(0,d.Nh)(Z,o,l.hasZ,l.hasM,"esriGeometryPoint",a,h,O);return(0,d.fQ)(P,g,A)}return(0,d.fQ)(o,g,A)}function c(l,o,a,h,O,g,A=o,P=a){const i=o&&A,n=a&&P,t=null!=h?"coords"in h?h:h.geometry:null;if(null==t)return null;if(O){let u=(0,d.zj)(T,t,o,a,l,O,A,P);return g&&(u=(0,d.Nh)(Z,u,i,n,l,g)),I[l]?.(u,i,n)??null}if(g){const u=(0,d.Nh)(Z,t,o,a,l,g,A,P);return I[l]?.(u,i,n)??null}return(0,d.hY)(p,t,o,a,A,P),I[l]?.(p,i,n)??null}function _(l){return l&&m in l?JSON.parse(JSON.stringify(l,f)):l}const m="_geVersion",f=(l,o)=>l!==m?o:void 0},56541:(w,F,s)=>{s.d(F,{Ti:()=>f,Up:()=>l,j6:()=>a});var d=s(15861),G=s(2076),p=s(16730),T=s(5464),Z=s(15176),I=s(91179),b=s(93555),c=s(37053),_=s(82959);const m=new G.X({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"}),f=Object.freeze({});function l(t,u,S){return o.apply(this,arguments)}function o(){return(o=(0,d.Z)(function*(t,u,S){const{outFields:v,orderByFields:y,groupByFieldsForStatistics:U,outStatistics:r}=t;if(v)for(let e=0;e<v.length;e++)v[e]=v[e].trim();if(y)for(let e=0;e<y.length;e++)y[e]=y[e].trim();if(U)for(let e=0;e<U.length;e++)U[e]=U[e].trim();if(r)for(let e=0;e<r.length;e++)r[e].onStatisticField&&(r[e].onStatisticField=r[e].onStatisticField.trim());return t.geometry&&!t.outSR&&(t.outSR=t.geometry.spatialReference),a(t,u,S)})).apply(this,arguments)}function a(t,u,S){return h.apply(this,arguments)}function h(){return h=(0,d.Z)(function*(t,u,S){if(!t)return null;let{where:v}=t;if(t.where=v=v?.trim(),(!v||/^1 *= *1$/.test(v)||u&&u===v)&&(t.where=null),!t.geometry)return t;let y=yield function A(t){return P.apply(this,arguments)}(t);if(t.distance=0,t.units=null,"esriSpatialRelEnvelopeIntersects"===t.spatialRel){const{spatialReference:U}=t.geometry;y=(0,Z.aO)(y),y.spatialReference=U}if(y){yield(0,_._W)(y.spatialReference,S),y=function g(t,u){const S=t.spatialReference;return O(t,u)&&(0,I.YX)(t)?{spatialReference:S,rings:[[[t.xmin,t.ymin],[t.xmin,t.ymax],[t.xmax,t.ymax],[t.xmax,t.ymin],[t.xmin,t.ymin]]]}:t}(y,S);const U=(yield(0,b.aX)((0,I.im)(y)))[0];if(null==U)throw f;const r="quantizationParameters"in t&&t.quantizationParameters?.tolerance||"maxAllowableOffset"in t&&t.maxAllowableOffset||0,e=r&&O(y,S)?{densificationStep:8*r}:void 0,R=U.toJSON(),E=(0,_.iV)(R,R.spatialReference,S,e);if(!E)throw f;E.spatialReference=S,t.geometry=E}return t}),h.apply(this,arguments)}function O(t,u){if(!t)return!1;const S=t.spatialReference;return((0,I.YX)(t)||(0,I.oU)(t)||(0,I.l9)(t))&&!(0,c.fS)(S,u)&&!(0,T.canProjectWithoutEngine)(S,u)}function P(){return P=(0,d.Z)(function*(t){const{distance:u,units:S}=t,v=t.geometry;if(null==u||"vertexAttributes"in v)return v;const y=v.spatialReference,U=S?m.fromJSON(S):(0,p.qE)(y),r=y&&((0,c.sT)(y)||(0,c.sS)(y))?v:yield(0,_._W)(y,c.Zn).then(()=>(0,_.iV)(v,c.Zn));return(yield function i(){return n.apply(this,arguments)}())(r.spatialReference,r,u,U)}),P.apply(this,arguments)}function n(){return(n=(0,d.Z)(function*(){return(yield Promise.all([s.e(4918),s.e(8592)]).then(s.bind(s,32825))).geodesicBuffer})).apply(this,arguments)}},53023:(w,F,s)=>{s.d(F,{hN:()=>U,P0:()=>v,cW:()=>S});var d=s(15861),G=s(26584),p=s(33190),T=s(11519),I=s(91179),b=s(37053);function c(r,e){return r?e?4:3:e?3:2}function f(r,e,R,E,j){if(!r)return!1;const x=c(e,R),{coords:M,lengths:D}=r;let C=!1,B=0;for(const N of D)C=l(C,M,x,B,N,E,j),B+=N*x;return C}function l(r,e,R,E,j,x,M){let D=r,C=E;for(let B=E,N=E+j*R;B<N;B+=R){C=B+R,C===N&&(C=E);const V=e[B],z=e[B+1],W=e[C+1];(z<M&&W>=M||W<M&&z>=M)&&V+(M-z)/(W-z)*(e[C]-V)<x&&(D=!D)}return D}var o=s(82054),a=s(88071),h=s(16983),O=s(82959);const g="unsupported-query",A={esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"intersects",esriSpatialRelIndexIntersects:null,esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:null},P={spatialRelationship:{esriSpatialRelIntersects:!0,esriSpatialRelContains:!0,esriSpatialRelWithin:!0,esriSpatialRelCrosses:!0,esriSpatialRelDisjoint:!0,esriSpatialRelTouches:!0,esriSpatialRelOverlaps:!0,esriSpatialRelEnvelopeIntersects:!0,esriSpatialRelIndexIntersects:!1,esriSpatialRelRelation:!1},queryGeometry:{esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!0},layerGeometry:{esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!1}};function S(r,e,R,E,j){if((0,I.oU)(e)&&"esriGeometryPoint"===R&&("esriSpatialRelIntersects"===r||"esriSpatialRelContains"===r)){const x=(0,o.Uy)(new a.Z,e,!1,!1);return Promise.resolve(M=>function _(r,e,R,E){return f(r,e,R,E.coords[0],E.coords[1])}(x,!1,!1,M))}if((0,I.oU)(e)&&"esriGeometryMultipoint"===R){const x=(0,o.Uy)(new a.Z,e,!1,!1);if("esriSpatialRelContains"===r)return Promise.resolve(M=>function m(r,e,R,E,j,x){const M=c(j,x),{coords:D,lengths:C}=E;if(!C)return!1;for(let B=0,N=0;B<C.length;B++,N+=M)if(!f(r,e,R,D[N],D[N+1]))return!1;return!0}(x,!1,!1,M,E,j))}if((0,I.YX)(e)&&"esriGeometryPoint"===R&&("esriSpatialRelIntersects"===r||"esriSpatialRelContains"===r))return Promise.resolve(x=>(0,p.aV)(e,(0,h.Op)(R,E,j,x)));if((0,I.YX)(e)&&"esriGeometryMultipoint"===R&&"esriSpatialRelContains"===r)return Promise.resolve(x=>(0,p.lQ)(e,(0,h.Op)(R,E,j,x)));if((0,I.YX)(e)&&"esriSpatialRelIntersects"===r){const x=function Z(r){return"mesh"===r?T.h_:(0,T.IY)(r)}(R);return Promise.resolve(M=>x(e,(0,h.Op)(R,E,j,M)))}return function u(){return Promise.all([s.e(4918),s.e(8592)]).then(s.bind(s,32825))}().then(x=>{const M=x[A[r]].bind(null,e.spatialReference,e);return D=>M((0,h.Op)(R,E,j,D))})}function v(r,e,R){return y.apply(this,arguments)}function y(){return(y=(0,d.Z)(function*(r,e,R){const{spatialRel:E,geometry:j}=r;if(j){if(!function i(r){return null!=r&&!0===P.spatialRelationship[r]}(E))throw new G.Z(g,"Unsupported query spatial relationship",{query:r});if((0,b.JY)(j.spatialReference)&&(0,b.JY)(R)){if(!function n(r){return null!=r&&!0===P.queryGeometry[(0,I.Ji)(r)]}(j))throw new G.Z(g,"Unsupported query geometry type",{query:r});if(!function t(r){return null!=r&&!0===P.layerGeometry[r]}(e))throw new G.Z(g,"Unsupported layer geometry type",{query:r});if(r.outSR)return(0,O._W)(r.geometry?.spatialReference,r.outSR)}}})).apply(this,arguments)}function U(r){if((0,I.YX)(r))return!0;if((0,I.oU)(r)){for(const e of r.rings)if(5!==e.length||e[0][0]!==e[1][0]||e[0][0]!==e[4][0]||e[2][0]!==e[3][0]||e[0][1]!==e[3][1]||e[0][1]!==e[4][1]||e[1][1]!==e[2][1])return!1;return!0}return!1}},76530:(w,F,s)=>{s.d(F,{R:()=>G,y:()=>T});var d=s(15861);function G(c,_){return p.apply(this,arguments)}function p(){return(p=(0,d.Z)(function*(c,_){if(!c)return null;const m=_.featureAdapter,{startTimeField:f,endTimeField:l}=c;let o=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY;if(f&&l)yield _.forEach(h=>{const O=m.getAttribute(h,f),g=m.getAttribute(h,l);null==O||isNaN(O)||(o=Math.min(o,O)),null==g||isNaN(g)||(a=Math.max(a,g))});else{const h=f||l;yield _.forEach(O=>{const g=m.getAttribute(O,h);null==g||isNaN(g)||(o=Math.min(o,g),a=Math.max(a,g))})}return{start:o,end:a}})).apply(this,arguments)}function T(c,_,m){if(!_||!c)return null;const{startTimeField:f,endTimeField:l}=c;if(!f&&!l)return null;const{start:o,end:a}=_;if(null===o&&null===a)return null;if(void 0===o&&void 0===a)return()=>!1;const h=m.getAttributeAsTimestamp?.bind(m)??m.getAttribute.bind(m);return f&&l?function Z(c,_,m,f,l){return null!=f&&null!=l?o=>{const a=c(o,_),h=c(o,m);return(null==a||a<=l)&&(null==h||h>=f)}:null!=f?o=>{const a=c(o,m);return null==a||a>=f}:null!=l?o=>{const a=c(o,_);return null==a||a<=l}:void 0}(h,f,l,o,a):function I(c,_,m,f){return null!=m&&null!=f&&m===f?l=>c(l,_)===m:null!=m&&null!=f?l=>{const o=c(l,_);return null!=o&&o>=m&&o<=f}:null!=m?l=>{const o=c(l,_);return null!=o&&o>=m}:null!=f?l=>{const o=c(l,_);return null!=o&&o<=f}:void 0}(h,f||l,o,a)}},8967:(w,F,s)=>{s.r(F),s.d(F,{default:()=>A});var d=s(15861),G=s(26584),p=s(63290),T=s(65401),Z=s(32442),I=s(56541),b=s(53023),c=s(76530),_=s(96854),m=s(55746),f=s(95737);const l=p.Z.getLogger("esri.views.2d.layers.features.support.whereUtils"),o={getAttribute:(P,i)=>P.readAttribute(i)};function h(){return(h=(0,d.Z)(function*(P,i){try{const n=yield(0,f.E)(P,i);if(!n.isStandardized){const t=new G.Z("mapview - bad input","Unable to apply filter's definition expression, as expression is not standardized.",n);l.error(t)}return t=>{const u=t.readArcadeFeature();return n.testFeature(u,o)}}catch{return l.warn("mapview-bad-where-clause","Encountered an error when evaluating where clause",P),t=>!0}})).apply(this,arguments)}class A{constructor(i){this._geometryBounds=(0,T.Ue)(),this._idToVisibility=new Map,this._serviceInfo=i}get hash(){return this._hash}check(i){return this._applyFilter(i)}clear(){const i=this._resetAllHiddenIds();return this.update(),{show:i,hide:[]}}invalidate(){this._idToVisibility.forEach((i,n)=>{this._idToVisibility.set(n,0)})}setKnownIds(i){for(const n of i)this._idToVisibility.set(n,1)}setTrue(i){const n=[],t=[],u=new Set(i);return this._idToVisibility.forEach((S,v)=>{const y=!!(1&this._idToVisibility.get(v)),U=u.has(v);!y&&U?n.push(v):y&&!U&&t.push(v),this._idToVisibility.set(v,U?3:0)}),{show:n,hide:t}}createQuery(){const{geometry:i,spatialRel:n,where:t,timeExtent:u,objectIds:S}=this;return _.Z.fromJSON({geometry:i,spatialRel:n,where:t,timeExtent:u,objectIds:S})}update(i,n){var t=this;return(0,d.Z)(function*(){t._hash=JSON.stringify(i);const u=yield(0,I.j6)(i,null,n);yield Promise.all([t._setGeometryFilter(u),t._setIdFilter(u),t._setAttributeFilter(u),t._setTimeFilter(u)])})()}_setAttributeFilter(i){var n=this;return(0,d.Z)(function*(){if(!i?.where)return n._clause=null,void(n.where=null);n._clause=yield function a(P,i){return h.apply(this,arguments)}(i.where,n._serviceInfo.fieldsIndex),n.where=i.where})()}_setIdFilter(i){this._idsToShow=i?.objectIds&&new Set(i.objectIds),this._idsToHide=i?.hiddenIds&&new Set(i.hiddenIds),this.objectIds=i?.objectIds}_setGeometryFilter(i){var n=this;return(0,d.Z)(function*(){if(!i?.geometry)return n._spatialQueryOperator=null,n.geometry=null,void(n.spatialRel=null);const t=i.geometry,u=i.spatialRel||"esriSpatialRelIntersects",S=yield(0,b.cW)(u,t,n._serviceInfo.geometryType,n._serviceInfo.hasZ,n._serviceInfo.hasM);(0,Z.$P)(n._geometryBounds,t),n._spatialQueryOperator=S,n.geometry=t,n.spatialRel=u})()}_setTimeFilter(i){if(this.timeExtent=this._timeOperator=null,i?.timeExtent)if(this._serviceInfo.timeInfo)this.timeExtent=i.timeExtent,this._timeOperator=(0,c.y)(this._serviceInfo.timeInfo,i.timeExtent,m.k);else{const n=new G.Z("feature-layer-view:time-filter-not-available","Unable to apply time filter, as layer doesn't have time metadata.",i.timeExtent);p.Z.getLogger("esri.views.2d.layers.features.controllers.FeatureFilter").error(n)}}_applyFilter(i){return this._filterByGeometry(i)&&this._filterById(i)&&this._filterByTime(i)&&this._filterByExpression(i)}_filterByExpression(i){return!this.where||this._clause(i)}_filterById(i){return(!this._idsToHide?.size||!this._idsToHide.has(i.getObjectId()))&&(!this._idsToShow?.size||this._idsToShow.has(i.getObjectId()))}_filterByGeometry(i){if(!this.geometry)return!0;const n=i.readHydratedGeometry();return!!n&&this._spatialQueryOperator(n)}_filterByTime(i){return null==this._timeOperator||this._timeOperator(i)}_resetAllHiddenIds(){const i=[];return this._idToVisibility.forEach((n,t)=>{1&n||(this._idToVisibility.set(t,1),i.push(t))}),i}}}}]);