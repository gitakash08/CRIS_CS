"use strict";(self.webpackChunkCRIS=self.webpackChunkCRIS||[]).push([[9733],{78260:(Tt,et,F)=>{F.d(et,{EX:()=>Pe,Y3:()=>We,_Y:()=>oe,sJ:()=>G,xr:()=>pe});var z=F(91558);function N(E){return"h"in E&&"s"in E&&"v"in E}function x(E){return"l"in E&&"a"in E&&"b"in E}function te(E){return"l"in E&&"c"in E&&"h"in E}F(993),F(4794);const je=[[.4124,.3576,.1805],[.2126,.7152,.0722],[.0193,.1192,.9505]],re=[[3.2406,-1.5372,-.4986],[-.9689,1.8758,.0415],[.0557,-.204,1.057]];function ae(E,_){const L=[];let S,Z;if(E[0].length!==_.length)throw new Error("dimensions do not match");const W=E.length,X=E[0].length;let ee=0;for(S=0;S<W;S++){for(ee=0,Z=0;Z<X;Z++)ee+=E[S][Z]*_[Z];L.push(ee)}return L}function Ae(E){const _=[E.r/255,E.g/255,E.b/255].map(S=>S<=.04045?S/12.92:((S+.055)/1.055)**2.4),L=ae(je,_);return{x:100*L[0],y:100*L[1],z:100*L[2]}}function Be(E){const _=ae(re,[E.x/100,E.y/100,E.z/100]).map(L=>Math.min(1,Math.max(L<=.0031308?12.92*L:1.055*L**.4166666666666667-.055,0)));return{r:Math.round(255*_[0]),g:Math.round(255*_[1]),b:Math.round(255*_[2])}}function ke(E){const _=[E.x/95.047,E.y/100,E.z/108.883].map(L=>L>.008856451679035631?L**.3333333333333333:7.787037037037035*L+.13793103448275862);return{l:116*_[1]-16,a:500*(_[0]-_[1]),b:200*(_[1]-_[2])}}function j(E){const _=E.l,L=[(_+16)/116+E.a/500,(_+16)/116,(_+16)/116-E.b/200].map(S=>S>6/29?S**3:3*(6/29)**2*(S-4/29));return{x:95.047*L[0],y:100*L[1],z:108.883*L[2]}}function pe(E){return function Ze(E){return"r"in E&&"g"in E&&"b"in E}(E)?E:te(E)?function ne(E){return Be(j(function Y(E){const L=E.c,S=E.h;return{l:E.l,a:L*Math.cos(S),b:L*Math.sin(S)}}(E)))}(E):x(E)?function K(E){return Be(j(E))}(E):function $e(E){return"x"in E&&"y"in E&&"z"in E}(E)?Be(E):N(E)?function q(E){const _=(E.h+360)%360/60,S=E.v/100*255,Z=S*(E.s/100),W=Z*(1-Math.abs(_%2-1));let X;switch(Math.floor(_)){case 0:X={r:Z,g:W,b:0};break;case 1:X={r:W,g:Z,b:0};break;case 2:X={r:0,g:Z,b:W};break;case 3:X={r:0,g:W,b:Z};break;case 4:X={r:W,g:0,b:Z};break;case 5:case 6:X={r:Z,g:0,b:W};break;default:X={r:0,g:0,b:0}}return X.r=Math.round(X.r+S-Z),X.g=Math.round(X.g+S-Z),X.b=Math.round(X.b+S-Z),X}(E):E}function oe(E){return N(E)?E:function le(E){const _=E.r,L=E.g,S=E.b,Z=Math.max(_,L,S),W=Z-Math.min(_,L,S);let X=Z,ee=0===W?0:Z===_?(L-S)/W%6:Z===L?(S-_)/W+2:(_-L)/W+4,ye=0===W?0:W/X;return ee<0&&(ee+=6),ee*=60,ye*=100,X*=100/255,{h:ee,s:ye,v:X}}(pe(E))}function We(E){return x(E)?E:function $(E){return ke(Ae(E))}(pe(E))}function G(E){return te(E)?E:function Q(E){return function D(E){const _=E.l,L=E.a,S=E.b,Z=Math.sqrt(L*L+S*S);let W=Math.atan2(S,L);return W=W>0?W:W+2*Math.PI,{l:_,c:Z,h:W}}(ke(Ae(E)))}(pe(E))}function Pe(E,_){const{r:L,g:S,b:Z}=_?.ignoreAlpha?E:function he(E){let{r:_,g:L,b:S,a:Z}=E;return Z<1&&(_=Math.round(Z*_+255*(1-Z)),L=Math.round(Z*L+255*(1-Z)),S=Math.round(Z*S+255*(1-Z))),new z.Z({r:_,g:L,b:S})}(E);return.2126*L+.7152*S+.0722*Z}var Ie,E;(E=Ie||(Ie={}))[E.Low=160]="Low",E[E.High=225]="High"},7074:(Tt,et,F)=>{function z(I,Te,Ze,N){let x=null,te=1e3;"number"==typeof Te?(te=Te,N=Ze):(x=Te??null,te=Ze);let $e,je=0;const re=()=>{je=0,I.apply(N,$e)},ae=(...Ae)=>{x&&x.apply(N,Ae),$e=Ae,te?je||(je=setTimeout(re,te)):re()};return ae.remove=()=>{je&&(clearTimeout(je),je=0)},ae.forceUpdate=()=>{je&&(clearTimeout(je),re())},ae.hasPendingUpdates=()=>!!je,ae}F.d(et,{P:()=>z})},87183:(Tt,et,F)=>{F.d(et,{Z:()=>Be});var re,z=F(17626),I=F(86810),Te=F(77712),Ze=F(90912),te=(F(85931),F(8314),F(76898));const ae={1:{id:1,rotation:0,mirrored:!1},2:{id:2,rotation:0,mirrored:!0},3:{id:3,rotation:180,mirrored:!1},4:{id:4,rotation:180,mirrored:!0},5:{id:5,rotation:-90,mirrored:!0},6:{id:6,rotation:90,mirrored:!1},7:{id:7,rotation:90,mirrored:!0},8:{id:8,rotation:-90,mirrored:!1}};let Ae=re=class extends I.wq{constructor(ke){super(ke),this.contentType=null,this.exifInfo=null,this.id=null,this.globalId=null,this.keywords=null,this.name=null,this.parentGlobalId=null,this.parentObjectId=null,this.size=null,this.url=null}get orientationInfo(){const{exifInfo:ke}=this,j=function $e(ke){const{exifInfo:j,exifName:D,tagName:Y}=ke;if(!j||!D||!Y)return null;const $=j.find(K=>K.name===D);return $?function je(ke){const{tagName:j,tags:D}=ke;return D&&j&&D.find($=>$.name===j)?.value||null}({tagName:Y,tags:$.tags}):null}({exifName:"Exif IFD0",tagName:"Orientation",exifInfo:ke});return ae[j]||null}clone(){return new re({contentType:this.contentType,exifInfo:this.exifInfo,id:this.id,globalId:this.globalId,keywords:this.keywords,name:this.name,parentGlobalId:this.parentGlobalId,parentObjectId:this.parentObjectId,size:this.size,url:this.url})}};(0,z._)([(0,Te.Cb)({type:String})],Ae.prototype,"contentType",void 0),(0,z._)([(0,Te.Cb)()],Ae.prototype,"exifInfo",void 0),(0,z._)([(0,Te.Cb)({readOnly:!0})],Ae.prototype,"orientationInfo",null),(0,z._)([(0,Te.Cb)({type:Ze.z8})],Ae.prototype,"id",void 0),(0,z._)([(0,Te.Cb)({type:String})],Ae.prototype,"globalId",void 0),(0,z._)([(0,Te.Cb)({type:String})],Ae.prototype,"keywords",void 0),(0,z._)([(0,Te.Cb)({type:String})],Ae.prototype,"name",void 0),(0,z._)([(0,Te.Cb)({json:{read:!1}})],Ae.prototype,"parentGlobalId",void 0),(0,z._)([(0,Te.Cb)({json:{read:!1}})],Ae.prototype,"parentObjectId",void 0),(0,z._)([(0,Te.Cb)({type:Ze.z8})],Ae.prototype,"size",void 0),(0,z._)([(0,Te.Cb)({json:{read:!1}})],Ae.prototype,"url",void 0),Ae=re=(0,z._)([(0,te.j)("esri.layers.support.AttachmentInfo")],Ae);const Be=Ae},51692:(Tt,et,F)=>{F.d(et,{$8:()=>We,a8:()=>ke});var z=F(88411),I=F(90194),N=(F(46679),F(82157),F(28302));function ke(G){return(0,I.y2)(G)||(0,I.UQ)(G)||(0,I.ig)(G)}function We(G,ge){const{format:he,timeZoneOptions:Pe,fieldType:Ie}=ge??{};let Ge,He;if(Pe&&({timeZone:Ge,timeZoneName:He}=(0,N.Np)(Pe.layerTimeZone,Pe.datesInUnknownTimezone,Pe.viewTimeZone,(0,z.Ze)(he||"short-date-short-time"),Ie)),"string"==typeof G&&isNaN(Date.parse("time-only"===Ie?`1970-01-01T${G}Z`:G)))return G;switch(Ie){case"date-only":{const ze=(0,z.Ze)(he||"short-date");return"string"==typeof G?(0,z.o8)(G,{...ze}):(0,z.p6)(G,{...ze,timeZone:N.pt})}case"time-only":{const ze=(0,z.Ze)(he||"short-time");return"string"==typeof G?(0,z.LJ)(G,ze):(0,z.p6)(G,{...ze,timeZone:N.pt})}case"timestamp-offset":{if(!Ge&&"string"==typeof G&&new Date(G).toISOString()!==G)return G;const ze=he||Pe?(0,z.Ze)(he||"short-date-short-time"):void 0,Pt=ze?{...ze,timeZone:Ge,timeZoneName:He}:void 0;return"string"==typeof G?(0,z.i$)(G,Pt):(0,z.p6)(G,Pt)}default:{const ze=he||Pe?(0,z.Ze)(he||"short-date-short-time"):void 0;return(0,z.p6)("string"==typeof G?new Date(G):G,ze?{...ze,timeZone:Ge,timeZoneName:He}:void 0)}}}},66960:(Tt,et,F)=>{F.r(et),F.d(et,{getPatternDescriptor:()=>We,getSizeFromOptions:()=>ze,getSymbolLayerFill:()=>oe,previewSymbol3D:()=>E});var z=F(15861),I=F(54346),Te=F(78260),N=(F(8314),F(26584)),x=F(63290),te=F(23841),$e=F(74741),je=F(33215),re=F(48521),ae=F(71131),Ae=F(34057),Be=F(86606),ke=F(50998);const j=ae.b_.size,D=ae.b_.maxSize,Y=ae.b_.maxOutlineSize,$=ae.b_.lineWidth,K=ae.b_.tallSymbolWidth;function Q(_){const L=_.outline,S=null!=_.material?_.material.color:null,Z=null!=S?S.toHex():null;if(null==L||"pattern"in L&&null!=L.pattern&&"style"===L.pattern.type&&"none"===L.pattern.style)return"fill"===_.type&&"#ffffff"===Z?{color:"#bdc3c7",width:.75}:null;const W=(0,te.F2)(L.size)||0;return{color:"rgba("+(null!=L.color?L.color.toRgba():"255,255,255,1")+")",width:Math.min(W,Y),style:"pattern"in L&&null!=L.pattern&&"style"===L.pattern.type?(0,$e.Sp)(L.pattern.style):null,join:"butt",cap:"patternCap"in L?L.patternCap:"butt"}}function le(){return(le=(0,z.Z)(function*(_,L){if(_.thumbnail?.url)return _.thumbnail.url;if("icon"===L.type&&L?.resource?.href)return(0,Be.nf)(L);const S=(0,I.V)("esri/images/Legend/legend3dsymboldefault.png");if(_.styleOrigin&&(_.styleOrigin.styleName||_.styleOrigin.styleUrl)){const Z=yield(0,ke.resolveWebStyleSymbol)(_.styleOrigin,{portal:_.styleOrigin.portal},"webRef").catch(()=>null);if(Z&&"thumbnail"in Z&&Z.thumbnail?.url)return Z.thumbnail.url}return S})).apply(this,arguments)}function q(_,L=1){const S=_.a,Z=(0,Te._Y)(_),W=Z.h,X=Z.s/L,ee=100-(100-Z.v)/L,{r:ye,g:Me,b:ve}=(0,Te.xr)({h:W,s:X,v:ee});return[ye,Me,ve,S]}function pe(_){return"water"===_.type?null==_.color?null:_.color:null==_.material?.color?null:_.material.color}function oe(_,L=0){const S=pe(_);if(!S){if("fill"===_.type)return null;const X=(0,ae.uH)($e.Ne.r,L);return[X,X,X,100]}const Z=S.toRgba();for(let W=0;W<3;W++)Z[W]=(0,ae.uH)(Z[W],L);return Z}function We(_,L){return G.apply(this,arguments)}function G(){return(G=(0,z.Z)(function*(_,L){const S=_.style;return"none"===S?null:{type:"pattern",x:0,y:0,src:yield(0,$e.Od)((0,I.V)(`esri/symbols/patterns/${S}.png`),L.toCss(!0)),width:5,height:5}})).apply(this,arguments)}function ge(_){return _.outline?Q(_):{color:"rgba(0, 0, 0, 1)",width:1.5}}function he(_,L){const S=pe(_);if(!S)return null;let Z="rgba(";return Z+=(0,ae.uH)(S.r,L)+",",Z+=(0,ae.uH)(S.g,L)+",",Z+=(0,ae.uH)(S.b,L)+",",Z+S.a+");"}function Pe(_,L){const S=he(_,L);return S?"pattern"in _&&null!=_.pattern&&"style"===_.pattern.type&&"none"===_.pattern.style?null:{color:S,width:Math.min(_.size?(0,te.F2)(_.size):.75,Y),style:"pattern"in _&&null!=_.pattern&&"style"===_.pattern.type?(0,$e.Sp)(_.pattern.style):null,cap:"cap"in _?_.cap:null,join:"join"in _?"miter"===_.join?(0,te.F2)(2):_.join:null}:{}}function Ie(_,L,S){const Z=null!=S?.75*S:0;return{type:"linear",x1:Z?.25*Z:0,y1:Z?.5*Z:0,x2:Z||4,y2:Z?.5*Z:4,colors:[{color:_,offset:0},{color:L,offset:1}]}}function ze(_){const L="number"==typeof _?.size?_?.size:null;return L?(0,te.F2)(L):null}function Zt(){return Zt=(0,z.Z)(function*(_,L){const S=ze(L),Z=L?.maxSize?(0,te.F2)(L.maxSize):null,W=L?.disableUpsampling??!1,X=_.symbolLayers,ee=[];let ye=0,Me=0;const ve=X.at(-1);let xe;ve&&"icon"===ve.type&&(xe=ve.size&&(0,te.F2)(ve.size)),X.forEach(Ce=>{if("icon"!==Ce.type&&"object"!==Ce.type)return;const Re="icon"===Ce.type?Ce.size&&(0,te.F2)(Ce.size):0,Ue=S||Re?Math.ceil(Math.min(S||Re,Z||D)):j;if(Ce?.resource?.href){const fe=function ne(_,L){return le.apply(this,arguments)}(_,Ce).then(me=>{const Le=Ce?.material?.color,Ke=function Pt(_){return"icon"===_.type?"multiply":"tint"}(Ce);return(0,Ae.rG)(me,Ue,Le,Ke,W)}).then(me=>{const Le=me.width,Ke=me.height;return ye=Math.max(ye,Le),Me=Math.max(Me,Ke),[{shape:{type:"image",x:0,y:0,width:Le,height:Ke,src:me.url},fill:null,stroke:null}]});ee.push(fe)}else{let fe=Ue;"icon"===Ce.type&&xe&&S&&(fe=Ue*(Re/xe));const me="tall"===L?.symbolConfig||L?.symbolConfig?.isTall||"object"===Ce.type&&function Ge(_){const L=_.depth,S=_.height,Z=_.width;return 0!==Z&&0!==L&&0!==S&&Z===L&&null!=Z&&null!=S&&Z<S}(Ce);ye=Math.max(ye,me?K:fe),Me=Math.max(Me,fe),ee.push(Promise.resolve(function He(_,L,S){const Z=[];if(!_)return Z;switch(_.type){case"icon":{const ee=L,ye=L;switch(_.resource&&_.resource.primitive||je.S){case"circle":Z.push({shape:{type:"circle",cx:0,cy:0,r:.5*L},fill:oe(_,0),stroke:Q(_)});break;case"square":Z.push({shape:{type:"path",path:[{command:"M",values:[0,ye]},{command:"L",values:[0,0]},{command:"L",values:[ee,0]},{command:"L",values:[ee,ye]},{command:"Z",values:[]}]},fill:oe(_,0),stroke:Q(_)});break;case"triangle":Z.push({shape:{type:"path",path:[{command:"M",values:[0,ye]},{command:"L",values:[.5*ee,0]},{command:"L",values:[ee,ye]},{command:"Z",values:[]}]},fill:oe(_,0),stroke:Q(_)});break;case"cross":Z.push({shape:{type:"path",path:[{command:"M",values:[.5*ee,0]},{command:"L",values:[.5*ee,ye]},{command:"M",values:[0,.5*ye]},{command:"L",values:[ee,.5*ye]}]},stroke:ge(_)});break;case"x":Z.push({shape:{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[ee,ye]},{command:"M",values:[ee,0]},{command:"L",values:[0,ye]}]},stroke:ge(_)});break;case"kite":Z.push({shape:{type:"path",path:[{command:"M",values:[0,.5*ye]},{command:"L",values:[.5*ee,0]},{command:"L",values:[ee,.5*ye]},{command:"L",values:[.5*ee,ye]},{command:"Z",values:[]}]},fill:oe(_,0),stroke:Q(_)})}break}case"object":switch(_.resource&&_.resource.primitive||re.S){case"cone":{const W=Ie(oe(_,0),oe(_,-.6),S?K:L),X=(0,ae.TE)(L,S);Z.push({shape:X[0],fill:W},{shape:X[1],fill:W});break}case"inverted-cone":{const W=oe(_,0),X=Ie(W,oe(_,-.6),L),ee=(0,ae.DY)(L);Z.push({shape:ee[0],fill:X},{shape:ee[1],fill:W});break}case"cube":{const W=(0,ae.Pc)(L,S);Z.push({shape:W[0],fill:oe(_,0)},{shape:W[1],fill:oe(_,-.3)},{shape:W[2],fill:oe(_,-.5)});break}case"cylinder":{const W=Ie(oe(_,0),oe(_,-.6),S?K:L),X=(0,ae.EB)(L,S);Z.push({shape:X[0],fill:W},{shape:X[1],fill:W},{shape:X[2],fill:oe(_,0)});break}case"diamond":{const W=(0,ae.XX)(L);Z.push({shape:W[0],fill:oe(_,-.3)},{shape:W[1],fill:oe(_,0)},{shape:W[2],fill:oe(_,-.3)},{shape:W[3],fill:oe(_,-.7)});break}case"sphere":{const W=Ie(oe(_,0),oe(_,-.6));W.x1=0,W.y1=0,W.x2=.25*L,W.y2=.25*L,Z.push({shape:{type:"circle",cx:0,cy:0,r:.5*L},fill:W});break}case"tetrahedron":{const W=(0,ae.tp)(L);Z.push({shape:W[0],fill:oe(_,-.3)},{shape:W[1],fill:oe(_,0)},{shape:W[2],fill:oe(_,-.6)});break}}}return Z}(Ce,fe,me)))}});const Qe=yield Promise.allSettled(ee),ce=[];return Qe.forEach(Ce=>{"fulfilled"===Ce.status?ce.push(Ce.value):Ce.reason&&x.Z.getLogger("esri.symbols.support.previewSymbol3D").warn("error while building swatchInfo!",Ce.reason)}),(0,Ae.wh)(ce,[ye,Me],{node:L?.node,scale:!1,opacity:L?.opacity,ariaLabel:L?.ariaLabel})}),Zt.apply(this,arguments)}function U(){return(U=(0,z.Z)(function*(_,L){const S="mesh-3d"===_.type,Z=_.symbolLayers,W=ze(L),X=L?.maxSize?(0,te.F2)(L.maxSize):null,ee=W||j,ye=[];let Me=0,ve=0,xe=!1;for(let Qe=0;Qe<Z.length;Qe++){const ce=Z.at(Qe),Ce=[];if(!S||"fill"===ce.type){switch(ce.type){case"fill":{const Re=Math.min(ee,X||D);if(Me=Math.max(Me,Re),ve=Math.max(ve,Re),xe=!0,S){const Ue=ae.JZ.meshSymbol3DFill,fe=he(ce,-.4),me=fe?{color:fe,width:1,join:"round"}:{};Ce.push({shape:Ue[0],fill:oe(ce,0),stroke:me},{shape:Ue[1],fill:oe(ce,-.2),stroke:me},{shape:Ue[2],fill:oe(ce,-.6),stroke:me})}else{let Ue=oe(ce,0);const fe="pattern"in ce?ce.pattern:null,me=Q(ce),Le=pe(ce);null!=fe&&"style"===fe.type&&"solid"!==fe.style&&Le&&(Ue=yield We(fe,Le)),Ce.push({shape:ae.JZ.fill[0],fill:Ue,stroke:me})}break}case"line":{const Re=Pe(ce,0);if(null==Re)break;const Ue={stroke:Re,shape:ae.JZ.fill[0]};Me=Math.max(Me,j),ve=Math.max(ve,j),Ce.push(Ue);break}case"extrude":{const Re={join:"round",width:1,...Pe(ce,-.4)},Ue=oe(ce,0),fe=oe(ce,-.2),me=Math.min(ee,X||D),Le=(0,ae.EV)(me);Re.width=1,Ce.push({shape:Le[0],fill:fe,stroke:Re},{shape:Le[1],fill:fe,stroke:Re},{shape:Le[2],fill:Ue,stroke:Re});const at=.7*j+.5*me;Me=Math.max(Me,j),ve=Math.max(ve,at);break}case"water":{const Re=pe(ce),Ue=q(Re),fe=q(Re,2),me=q(Re,3),Le=(0,ae.ht)();xe=!0,Ce.push({shape:Le[0],fill:Ue},{shape:Le[1],fill:fe},{shape:Le[2],fill:me});const Ke=Math.min(ee,X||D);Me=Math.max(Me,Ke),ve=Math.max(ve,Ke);break}}ye.push(Ce)}}return(0,Ae.wh)(ye,[Me,ve],{node:L?.node,scale:xe,opacity:L?.opacity,ariaLabel:L?.ariaLabel})})).apply(this,arguments)}function E(_,L){if(0===_.symbolLayers.length)return Promise.reject(new N.Z("symbolPreview: renderPreviewHTML3D","No symbolLayers in the symbol."));switch(_.type){case"point-3d":return function ti(_,L){return Zt.apply(this,arguments)}(_,L);case"line-3d":return function ii(_,L){const S=_.symbolLayers,Z=[],W=(0,Be.YW)(_),X=ze(L),ee=(L?.maxSize?(0,te.F2)(L.maxSize):null)||Y;let ye,Me=0,ve=0;return S.forEach((xe,Qe)=>{if(!xe||"line"!==xe.type&&"path"!==xe.type)return;const ce=[];switch(xe.type){case"line":{const Ce=Pe(xe,0);if(null==Ce)break;const Re=Ce?.width||0;0===Qe&&(ye=Re);const Ue=Math.min(X||Re,ee),fe=0===Qe?Ue:X?Ue*(Re/ye):Ue,me=fe>$/2?2*fe:$;ve=Math.max(ve,fe),Me=Math.max(Me,me),Ce.width=fe,ce.push({shape:{type:"path",path:[{command:"M",values:[0,.5*ve]},{command:"L",values:[Me,.5*ve]}]},stroke:Ce});break}case"path":{const Ce=Math.min(X||j,ee),Re=oe(xe,0),Ue=oe(xe,-.2),fe=he(xe,-.4),me=fe?{color:fe,width:1}:{};if("quad"===xe.profile){const Le=xe.width,Ke=xe.height,at=(0,ae.eb)(Le&&Ke?Le/Ke:1,0===Ke,0===Le),lt={...me,join:"bevel"};ce.push({shape:at[0],fill:Ue,stroke:lt},{shape:at[1],fill:Ue,stroke:lt},{shape:at[2],fill:Re,stroke:lt})}else ce.push({shape:ae.JZ.pathSymbol3DLayer[0],fill:Ue,stroke:me},{shape:ae.JZ.pathSymbol3DLayer[1],fill:Re,stroke:me});ve=Math.max(ve,Ce),Me=ve}}Z.push(ce)}),Promise.resolve((0,Ae.wh)(Z,[Me,ve],{node:L?.node,scale:W,opacity:L?.opacity,ariaLabel:L?.ariaLabel}))}(_,L);case"polygon-3d":case"mesh-3d":return function ni(_,L){return U.apply(this,arguments)}(_,L)}return Promise.reject(new N.Z("symbolPreview: swatchInfo3D","symbol not supported."))}},71131:(Tt,et,F)=>{F.d(et,{DY:()=>re,EB:()=>$e,EV:()=>N,JZ:()=>Te,Pc:()=>te,TE:()=>je,XX:()=>ae,b_:()=>I,dc:()=>ke,eb:()=>Ze,ht:()=>x,tp:()=>Ae,uH:()=>Be});var I,j,z=F(91558);(j=I||(I={}))[j.size=22]="size",j[j.lineWidth=50]="lineWidth",j[j.maxSize=120]="maxSize",j[j.maxOutlineSize=80]="maxOutlineSize",j[j.tallSymbolWidth=20]="tallSymbolWidth";const Te={fill:[{type:"path",path:"M -10,-10 L 10,0 L 10,10 L -10,10 L -10,-10 Z"}],squareFill:[{type:"path",path:"M -10,-10 L 10,-10 L 10,10 L -10,10 L -10,-10 Z"}],meshSymbol3DFill:[{type:"path",path:"M -10,-8 L 6,0 L 6,6 L -10,6 L -10,-8 Z"},{type:"path",path:"M -10,-8 L -7,-10 L 9,-2 L 6,0 L -10,-8 Z"},{type:"path",path:"M 6,0 L 9,-2 L 9,4 L 6,6 L 6,0 Z"}],pathSymbol3DLayer:[{type:"path",path:"M 3,12 L 12,0 L 11,-2 L -4,5 L -1,5 L 1,7 L 3,10 L 3,12 Z"},{type:"circle",cx:-2,cy:10,r:5}],extrudeSymbol3DLayer:[{type:"path",path:"M -7,-5 L -2,0 L -2,7 L -7,3 L -7,-5 Z"},{type:"path",path:"M -2,0 L -2,7 L 10,-3 L 10,-10 L -2,0 Z"},{type:"path",path:"M -7,-5 L -2,0 L 10,-10 L -2,-10 L -7,-5 Z"}],cone:[{type:"path",path:"M 0,-10 L -8,5 L -4,6.5 L 0,7 L 4,6.5 L 8,5 Z"}],tallCone:[{type:"path",path:"M 0,-9 L -3.5,7 L -1.5,7.8 L 0,8 L 1.5,7.8 L 3.5,7 L 0,-9 Z"}],invertedCone:[{type:"path",path:"M 0,7 L -8,-8 L 8,-8 Z"},{type:"path",path:"M -8,-8 L -4,-9.5 L 0,-10 L 4,-9.5 L 8,-8 L 4,-6.5 L 0,-6 L -4,-6.5 Z"}],cube:[{type:"path",path:"M -10,-7 L 0,-12 L 10,-7 L 0,-2 L -10,-7 Z"},{type:"path",path:"M -10,-7 L 0,-2 L 0,12 L -10,7 L -10,-7 Z"},{type:"path",path:"M 0,-2 L 10,-7 L 10,7 L 0,12 L 0,-2 Z"}],tallCube:[{type:"path",path:"M -3.5,-8.5 L 0,-9.5 L 3.5,-8.5 L 0,-7.5 L -3.5,-8.5 Z"},{type:"path",path:"M -3.5,-8.5 L 0,-7.5 L 0,9 L -3.5,8 L -3.5,-8.5 Z"},{type:"path",path:"M 0,-7.5 L 3.5,-8.5 L 3.5,8 L 0,9 L 0,-7.5 Z"}],cylinder:[{type:"path",path:"M -8,-9 L -8,7 L -4,8.5 L 0,9 L 4,8.5 L 8,7 L 8,-9 Z"},{type:"ellipse",cx:0,cy:-9,rx:8,ry:2}],tallCylinder:[{type:"path",path:"M -3.5,-9 L -3.5,7 L -1.5,7.8 L 0,8 L 1.5,7.8 L 3.5,7 L 3.5,-9 Z"},{type:"ellipse",cx:0,cy:-9,rx:3.5,ry:1}],diamond:[{type:"path",path:"M 0,-10 L 10,-1 L -1,1 L 0,-10 Z"},{type:"path",path:"M 0,-10 L -1,1 L -8,-1 L 0,-10 Z"},{type:"path",path:"M -1,1 L 0,10 L -8,-1 L -1,1 Z"},{type:"path",path:"M -1,0 L 0,10 L 10,-1 L -1,1 Z"}],tetrahedron:[{type:"path",path:"M 0,-10 L 10,7 L 0,0 L 0,-10 Z"},{type:"path",path:"M 0,-10 L 0,0 L -8,7 L 0,-10 Z"},{type:"path",path:"M 10,7 L 0,0 L -8,7 L 10,7 Z"}]};function Ze(j,D,Y){const $=I.size;let K=$,Q=$;j<1?K*=.75:j>1&&(Q*=1.25);let q=$,pe=$;return D&&Y&&(K=Q=q=pe=0),[{type:"path",path:[{command:"M",values:[q,0]},{command:"L",values:[Y?q:.875*q,0]},{command:"L",values:[Y?K-.5*q:0,Q-.5*pe]},{command:"L",values:[K-.5*q,Q-.5*pe]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[q,0]},{command:"L",values:[q,D?0:.125*pe]},{command:"L",values:[K-.5*q,D?Q-.5*pe:pe]},{command:"L",values:[K-.5*q,Q-.5*pe]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[K-.5*q,Q-.5*pe]},{command:"L",values:[Y?K-.5*q:0,Q-.5*pe]},{command:"L",values:[Y?K-.5*q:0,D?Q-.5*pe:pe]},{command:"L",values:[K-.5*q,D?Q-.5*pe:pe]},{command:"Z",values:[]}]}]}function N(j){const D=I.size,Y=.5*j;return[{type:"path",path:[{command:"M",values:[0,.7*D*.5]},{command:"L",values:[.3*D,.7*D]},{command:"L",values:[.3*D,.7*D+Y]},{command:"L",values:[0,.7*D+Y-.7*D*.5]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.3*D,.7*D]},{command:"L",values:[.3*D,.7*D+Y]},{command:"L",values:[D,Y]},{command:"L",values:[D,0]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.3*D,0]},{command:"L",values:[D,0]},{command:"L",values:[.3*D,.7*D]},{command:"L",values:[0,.7*D*.5]},{command:"Z",values:[]}]}]}function x(){return[{type:"path",path:"M80,80.2v-27c-1.5,0.7-2.8,1.6-3.9,2.8c-1.8,2.1-4.4,3.3-7.1,3.5c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.4,3.6c-1.8,2.1-4.4,3.3-7.2,3.4C8.3,59.3,5.7,58,3.9,56c-1.1-1.2-2.4-2.1-3.9-2.8v27"},{type:"path",path:"M11,59.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.4-3.6s5.1,1.3,7.4,3.6c1.8,2,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.3-3.6s5.1,1.3,7.4,3.6c1.8,2.1,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c1.1-1.2,2.4-2.1,3.9-2.8v-24c-1.5,0.7-2.8,1.6-3.9,2.8c-1.8,2.1-4.4,3.3-7.1,3.5c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.4,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.7-0.1-5.3-1.4-7.1-3.4c-1.1-1.2-2.4-2.1-3.9-2.8v24c1.5,0.7,2.8,1.6,3.9,2.8C5.7,58,8.3,59.3,11,59.4z"},{type:"path",path:"M11,35.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.4-3.6s5.1,1.3,7.4,3.6c1.8,2,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.3-3.6s5.1,1.3,7.4,3.6c1.8,2.1,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c1.1-1.2,2.4-2.1,3.9-2.8V3.6c-1.5,0.7-2.8,1.6-3.9,2.8c-2.2,2.1-4.6,3.4-7.1,3.4s-5-1.3-7.1-3.4s-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6S42.5,9.9,40,9.9s-5-1.3-7.1-3.4s-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.5,0-5-1.3-7.1-3.4C2.8,5.3,1.4,4.3,0,3.6v25.6c1.5,0.7,2.8,1.6,3.9,2.8C5.7,34.1,8.3,35.3,11,35.4z"}]}function te(j,D){let Y=D?I.tallSymbolWidth:j;const K=D?4:6;Y-=Y<=I.size?.5*K:K;const le=D?.35*Y:.5*Y;return[{type:"path",path:[{command:"M",values:[.5*Y,0]},{command:"L",values:[Y,.5*le]},{command:"L",values:[.5*Y,le]},{command:"L",values:[0,.5*le]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[0,.5*le]},{command:"L",values:[.5*Y,le]},{command:"L",values:[.5*Y,j]},{command:"L",values:[0,j-.5*le]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.5*Y,le]},{command:"L",values:[.5*Y,j]},{command:"L",values:[Y,j-.5*le]},{command:"L",values:[Y,.5*le]},{command:"Z",values:[]}]}]}function $e(j,D){let Y=D?I.tallSymbolWidth:j;const K=D?4:6;Y-=Y<=I.size?.5*K:K;const Q=.5*Y,ne=.15*Y,q=j-ne;return[{type:"ellipse",cx:.5*Y,cy:q,rx:Q,ry:ne},{type:"path",path:[{command:"M",values:[0,ne]},{command:"L",values:[0,q]},{command:"L",values:[Y,q]},{command:"L",values:[Y,ne]},{command:"Z",values:[]}]},{type:"ellipse",cx:.5*Y,cy:ne,rx:Q,ry:ne}]}function je(j,D){let Y=D?I.tallSymbolWidth:j;const K=D?4:6;Y-=Y<=I.size?.5*K:K;const Q=.15*Y,ne=j-Q;return[{type:"ellipse",cx:.5*Y,cy:ne,rx:.5*Y,ry:Q},{type:"path",path:[{command:"M",values:[.5*Y,0]},{command:"L",values:[Y,ne]},{command:"L",values:[0,ne]},{command:"Z",values:[]}]}]}function re(j){let D=j;D-=D<I.size?3:6;const K=.15*D;return[{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[D,0]},{command:"L",values:[.5*D,j-K]},{command:"Z",values:[]}]},{type:"ellipse",cx:.5*D,cy:0,rx:.5*D,ry:K}]}function ae(j){let D=j;const Y=j;D-=D<I.size?2:4;const ne=D,le=Y,q=Math.floor(j/10)-1||1;return[{type:"path",path:[{command:"M",values:[.45*ne,0]},{command:"L",values:[ne,.5*le-q]},{command:"L",values:[.45*ne-q,.5*le+q]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.45*ne,0]},{command:"L",values:[.45*ne-q,.5*le+q]},{command:"L",values:[0,.5*le-q]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[0,.5*le-q]},{command:"L",values:[.45*ne-q,.5*le+q]},{command:"L",values:[.45*ne,Y]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.45*ne,Y]},{command:"L",values:[ne,.5*le-q]},{command:"L",values:[.45*ne-q,.5*le+q]},{command:"Z",values:[]}]}]}function Ae(j){let $=j;return $-=$<I.size?1:2,[{type:"path",path:[{command:"M",values:[.45*j,0]},{command:"L",values:[j,$]},{command:"L",values:[.45*j,.6*$]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.45*j,0]},{command:"L",values:[.45*j,.6*$]},{command:"L",values:[0,$]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[0,$]},{command:"L",values:[.45*j,.6*$]},{command:"L",values:[j,$]},{command:"Z",values:[]}]}]}function Be(j,D){return Math.round(Math.min(Math.max(j+255*D*.75,0),255))}function ke(j,D){if(null==j)return new z.Z;if("type"in j&&("linear"===j.type||"pattern"===j.type))return j;const Y=new z.Z(j);return new z.Z([Be(Y.r,D),Be(Y.g,D),Be(Y.b,D),Y.a])}},34057:(Tt,et,F)=>{F.d(et,{rG:()=>Y,wh:()=>Ae});var z=F(24263),I=F(84792),Te=F(78260),Ze=F(26584),N=F(8314),te=(F(50645),F(62996)),$e=F(30695),je=F(86606);const re=(0,te.E)();function Ae($,K,Q){const ne=Math.ceil(K[0]),le=Math.ceil(K[1]);if(!$.some(pe=>!!pe.length))return null;const q=Q?.node||document.createElement("div");return null!=Q.opacity&&(q.style.opacity=Q.opacity.toString()),null!=Q.effectView&&(q.style.filter=(0,je.wJ)(Q.effectView)),function ae($,K){re.append($,K),re.detach(K)}(q,()=>(0,$e.KB)($,ne,le,Q)),q}function D($,K,Q,ne,le){switch(le){case"multiply":$[K]*=Q[0],$[K+1]*=Q[1],$[K+2]*=Q[2],$[K+3]*=Q[3];break;default:{const q=(0,Te._Y)({r:$[K],g:$[K+1],b:$[K+2]});q.h=ne.h,q.s=ne.s,q.v=q.v/100*ne.v;const pe=(0,Te.xr)(q);$[K]=pe.r,$[K+1]=pe.g,$[K+2]=pe.b,$[K+3]*=Q[3];break}}}function Y($,K,Q,ne,le){return function ke($,K,Q){return $?(0,I.Z)($,{responseType:"image"}).then(ne=>{const le=ne.data,q=le.width,pe=le.height,oe=q/pe;let We=K;if(Q){const G=Math.max(q,pe);We=Math.min(We,G)}return{image:le,width:oe<=1?Math.ceil(We*oe):We,height:oe<=1?We:Math.ceil(We/oe)}}):Promise.reject(new Ze.Z("renderUtils: imageDataSize","href not provided."))}($,K,le).then(q=>{const pe=q.width??K,oe=q.height??K;if(q.image&&function j($,K){return!(!$||"ignore"===K||"multiply"===K&&255===$.r&&255===$.g&&255===$.b&&1===$.a)}(Q,ne)){let We=q.image.width,G=q.image.height;(0,N.Z)("edge")&&/\.svg$/i.test($)&&(We-=1,G-=1);const ge=function Be($,K){$=Math.ceil($),K=Math.ceil(K);const Q=document.createElement("canvas");Q.width=$,Q.height=K,Q.style.width=$+"px",Q.style.height=K+"px";const ne=Q.getContext("2d");return ne.clearRect(0,0,$,K),ne}(pe,oe);ge.drawImage(q.image,0,0,We,G,0,0,pe,oe);const he=ge.getImageData(0,0,pe,oe),Pe=[Q.r/255,Q.g/255,Q.b/255,Q.a],Ie=(0,Te._Y)(Q);for(let Ge=0;Ge<he.data.length;Ge+=4)D(he.data,Ge,Pe,Ie,ne);ge.putImageData(he,0,0),$=ge.canvas.toDataURL("image/png")}else{const We=z.id?.findCredential($);if(We?.token){const G=$.includes("?")?"&":"?";$=`${$}${G}token=${We.token}`}}return{url:$,width:pe,height:oe}}).catch(()=>({url:$,width:K,height:K}))}},30695:(Tt,et,F)=>{F.d(et,{KB:()=>ni});var z=F(91558),I=F(8314),Te=F(62208),Ze=F(12225),N=F(31478),te=(F(38570),F(94450));const $e="http://www.w3.org/2000/svg";let je=0,re=0;const ae=(0,I.Z)("android"),Ae=(0,I.Z)("chrome")||ae&&ae>=4?"auto":"optimizeLegibility",Be={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7,z:0},ke=/([A-DF-Za-df-z])|([-+]?\d*[.]?\d+(?:[eE][-+]?\d+)?)/g;let j={},D={};const Y={solid:"none",shortdash:[4,1],shortdot:[1,1],shortdashdot:[4,1,1,1],shortdashdotdot:[4,1,1,1,1,1],dot:[1,3],dash:[4,3],longdash:[8,3],dashdot:[4,3,1,3],longdashdot:[8,3,1,3],longdashdotdot:[8,3,1,3,1,3]},$=Math.PI;let K=1;function Q(U,E){const _=U*($/180);return Math.abs(E*Math.sin(_))+Math.abs(E*Math.cos(_))}function ne(U){return U.map(E=>`${E.command} ${E.values.join(" ")}`).join(" ").trim()}function le(U,E,_,L){if(U){if("circle"===U.type)return(0,te.u)("circle",{cx:U.cx,cy:U.cy,fill:E,"fill-rule":"evenodd",r:U.r,stroke:_.color,"stroke-dasharray":_.dashArray,"stroke-dashoffset":_.dashOffset,"stroke-linecap":_.cap,"stroke-linejoin":_.join,"stroke-miterlimit":"4","stroke-width":_.width});if("ellipse"===U.type)return(0,te.u)("ellipse",{cx:U.cx,cy:U.cy,fill:E,"fill-rule":"evenodd",rx:U.rx,ry:U.ry,stroke:_.color,"stroke-dasharray":_.dashArray,"stroke-linecap":_.cap,"stroke-linejoin":_.join,"stroke-miterlimit":"4","stroke-width":_.width});if("rect"===U.type)return(0,te.u)("rect",{fill:E,"fill-rule":"evenodd",height:U.height,stroke:_.color,"stroke-dasharray":_.dashArray,"stroke-linecap":_.cap,"stroke-linejoin":_.join,"stroke-miterlimit":"4","stroke-width":_.width,width:U.width,x:U.x,y:U.y});if("image"===U.type)return(0,te.u)("image",{height:U.height,href:U.src,preserveAspectRatio:"none",width:U.width,x:U.x,y:U.y});if("path"===U.type){const S="string"!=typeof U.path?ne(U.path):U.path;return(0,te.u)("path",{d:S,fill:E,"fill-rule":"evenodd",stroke:_.color,"stroke-dasharray":_.dashArray,"stroke-linecap":_.cap,"stroke-linejoin":_.join,"stroke-miterlimit":"4","stroke-width":_.width})}if("text"===U.type)return(0,Te.O3)(L),(0,te.u)("text",{"dominant-baseline":L.dominantBaseline,fill:E,"fill-rule":"evenodd","font-family":L.font.family,"font-size":L.font.size,"font-style":L.font.style,"font-variant":L.font.variant,"font-weight":L.font.weight,kerning:L.kerning,rotate:L.rotate,stroke:_.color,"stroke-dasharray":_.dashArray,"stroke-linecap":_.cap,"stroke-linejoin":_.join,"stroke-miterlimit":"4","stroke-width":_.width,"text-anchor":L.align,"text-decoration":L.decoration,"text-rendering":Ae,x:U.x,y:U.y},U.text)}return null}function q(U){const E={fill:"none",pattern:null,linearGradient:null};if(U)if("type"in U&&"pattern"===U.type){const _="patternId-"+ ++je;E.fill=`url(#${_})`,E.pattern={id:_,x:U.x,y:U.y,width:U.width,height:U.height,image:{x:0,y:0,width:U.width,height:U.height,href:U.src}}}else if("type"in U&&"linear"===U.type){const _="linearGradientId-"+ ++re;E.fill=`url(#${_})`,E.linearGradient={id:_,x1:U.x1,y1:U.y1,x2:U.x2,y2:U.y2,stops:U.colors.map(L=>({offset:L.offset,color:L.color&&new z.Z(L.color).toString()}))}}else if(U){const _=new z.Z(U);E.fill=_.toString()}return E}function pe(U){const E={color:"none",width:1,cap:"butt",join:"4",dashArray:"none",dashOffset:"0"};if(U&&(null!=U.width&&(E.width=U.width),U.cap&&(E.cap=U.cap),U.join&&(E.join=U.join.toString()),U.color&&(E.color=new z.Z(U.color).toString()),U.dashArray&&(E.dashArray=U.dashArray),U.dashArray&&(E.dashOffset=U.dashoffset),U.style)){let _=null;if(U.style in Y&&(_=Y[U.style]),Array.isArray(_)){_=_.slice(0);const L=U.width??0;for(let S=0;S<_.length;++S)_[S]*=L;if("butt"!==U.cap){for(let S=0;S<_.length;S+=2)_[S]-=L,_[S]<1&&(_[S]=1);for(let S=1;S<_.length;S+=2)_[S]+=L}_=_.join(",")}E.dashArray=_}return E}function oe(U,E){const _={align:null,decoration:null,kerning:null,rotate:null,font:{style:null,variant:null,weight:null,size:null,family:null}};if(U){const L=U.alignBaseline,S="baseline"===L?"auto":"top"===L?"text-top":"bottom"===L?"hanging":L;_.align=U.align,_.dominantBaseline=S,_.decoration=U.decoration,_.kerning=U.kerning?"auto":"0",_.rotate=U.rotated?"90":"0",(0,Te.O3)(E),_.font.style=E.style||"normal",_.font.variant=E.variant||"normal",_.font.weight=E.weight||"normal",_.font.size=E.size&&E.size.toString()||"10pt",_.font.family=E.family||"serif"}return _}function We(U){const{pattern:E,linearGradient:_}=U;if(E)return(0,te.u)("pattern",{height:E.height,id:E.id,patternUnits:"userSpaceOnUse",width:E.width,x:E.x,y:E.y},(0,te.u)("image",{height:E.image.height,href:E.image.href,width:E.image.width,x:E.image.x,y:E.image.y}));if(_){const L=_.stops.map((S,Z)=>(0,te.u)("stop",{key:`${Z}-stop`,offset:S.offset,"stop-color":S.color}));return(0,te.u)("linearGradient",{gradientUnits:"userSpaceOnUse",id:_.id,x1:_.x1,x2:_.x2,y1:_.y1,y2:_.y2},L)}return null}function G(U,E){if(!U||0===U.length)return null;const _=[];for(const L of U){const{shape:S,fill:Z,stroke:W,font:X}=L,ee=q(Z),ye=pe(W),Me="text"===S.type?oe(S,X):null,ve=le(S,ee.fill,ye,Me);ve&&_.push(ve)}return(0,te.u)("mask",{id:E,maskUnits:"userSpaceOnUse"},(0,te.u)("g",null,_))}function ge(U,E,_){return(0,N.t)(U,(0,N.c)(U),[E,_])}function he(U,E,_,L,S){return(0,N.s)(U,(0,N.c)(U),[E,_]),U[4]=U[4]*E-L*E+L,U[5]=U[5]*_-S*_+S,U}function Ie(U,E){j&&"left"in j?(null!=j.left&&j.left>U&&(j.left=U),(null==j.right||j.right<U)&&(j.right=U),(null==j.top||j.top>E)&&(j.top=E),(null==j.bottom||j.bottom<E)&&(j.bottom=E)):j={left:U,bottom:E,right:U,top:E}}function Ge(U){const E=U.args,_=E.length;let L;switch(U.action){case"M":case"L":case"C":case"S":case"Q":case"T":for(L=0;L<_;L+=2)Ie(E[L],E[L+1]);D.x=E[_-2],D.y=E[_-1];break;case"H":for(L=0;L<_;++L)Ie(E[L],D.y);D.x=E[_-1];break;case"V":for(L=0;L<_;++L)Ie(D.x,E[L]);D.y=E[_-1];break;case"m":{let S=0;for(("x"in D||(Ie(D.x=E[0],D.y=E[1]),S=2),L=S);L<_;L+=2)Ie(D.x+=E[L],D.y+=E[L+1]);break}case"l":case"t":for(L=0;L<_;L+=2)Ie(D.x+=E[L],D.y+=E[L+1]);break;case"h":for(L=0;L<_;++L)Ie(D.x+=E[L],D.y);break;case"v":for(L=0;L<_;++L)Ie(D.x,D.y+=E[L]);break;case"c":for(L=0;L<_;L+=6)Ie(D.x+E[L],D.y+E[L+1]),Ie(D.x+E[L+2],D.y+E[L+3]),Ie(D.x+=E[L+4],D.y+=E[L+5]);break;case"s":case"q":for(L=0;L<_;L+=4)Ie(D.x+E[L],D.y+E[L+1]),Ie(D.x+=E[L+2],D.y+=E[L+3]);break;case"A":for(L=0;L<_;L+=7)Ie(E[L+5],E[L+6]);D.x=E[_-2],D.y=E[_-1];break;case"a":for(L=0;L<_;L+=7)Ie(D.x+=E[L+5],D.y+=E[L+6])}}function He(U,E,_){const L=Be[U.toLowerCase()];let S;"number"==typeof L&&(L?E.length>=L&&(S={action:U,args:E.slice(0,E.length-E.length%L)},_.push(S),Ge(S)):(S={action:U,args:[]},_.push(S),Ge(S)))}function Pt(U){const E={x:0,y:0,width:0,height:0};if("circle"===U.type)E.x=U.cx-U.r,E.y=U.cy-U.r,E.width=2*U.r,E.height=2*U.r;else if("ellipse"===U.type)E.x=U.cx-U.rx,E.y=U.cy-U.ry,E.width=2*U.rx,E.height=2*U.ry;else if("image"===U.type||"rect"===U.type)E.x=U.x,E.y=U.y,E.width=U.width,E.height=U.height;else if("path"===U.type){const _=function ze(U){const E=("string"!=typeof U.path?ne(U.path):U.path).match(ke),_=[];if(j={},D={},!E)return null;let L="",S=[];const Z=E.length;for(let X=0;X<Z;++X){const ee=E[X],ye=parseFloat(ee);isNaN(ye)?(L&&He(L,S,_),S=[],L=ee):S.push(ye)}He(L,S,_);const W={x:0,y:0,width:0,height:0};return j&&"left"in j&&(W.x=j.left,W.y=j.top,W.width=j.right-j.left,W.height=j.bottom-j.top),W}(U);E.x=_.x,E.y=_.y,E.width=_.width,E.height=_.height}return E}function ti(U){const E={x:0,y:0,width:0,height:0};let _=null,L=Number.NEGATIVE_INFINITY,S=Number.NEGATIVE_INFINITY;for(const Z of U)_?(_.x=Math.min(_.x,Z.x),_.y=Math.min(_.y,Z.y),L=Math.max(L,Z.x+Z.width),S=Math.max(S,Z.y+Z.height)):(_=E,_.x=Z.x,_.y=Z.y,L=Z.x+Z.width,S=Z.y+Z.height);return _&&(_.width=L-_.x,_.height=S-_.y),_}function Zt(U,E,_,L,S,Z,W,X,ee){let ye=(W&&Z?Q(Z,E):E)/2,Me=(W&&Z?Q(Z,_):_)/2;if(ee){const fe=ee[0],me=ee[1];ye=(W&&Z?Q(Z,fe):fe)/2,Me=(W&&Z?Q(Z,me):me)/2}const ve=U.width+L,xe=U.height+L,Qe=(0,Ze.c)(),ce=(0,Ze.c)();let Ce=!1;if(S&&0!==ve&&0!==xe){const fe=E!==_?E/_:ve/xe,me=E>_?E:_;let Le=1,Ke=1;isNaN(me)||(fe>1?(Le=me/ve,Ke=me/fe/xe):(Ke=me/xe,Le=me*fe/ve)),(0,N.m)(ce,ce,he(Qe,Le,Ke,ye,Me)),Ce=!0}const Re=U.x+(ve-L)/2,Ue=U.y+(xe-L)/2;if((0,N.m)(ce,ce,ge(Qe,ye-Re,Me-Ue)),!Ce&&(ve>E||xe>_)){const fe=ve/E>xe/_,me=(fe?E:_)/(fe?ve:xe);(0,N.m)(ce,ce,he(Qe,me,me,Re,Ue))}return Z&&(0,N.m)(ce,ce,function Pe(U,E,_,L){const S=E%360*Math.PI/180;(0,N.r)(U,(0,N.c)(U),S);const Z=Math.cos(S),W=Math.sin(S),X=U[4],ee=U[5];return U[4]=X*Z-ee*W+L*W-_*Z+_,U[5]=ee*Z+X*W-_*W-L*Z+L,U}(Qe,Z,Re,Ue)),X&&(0,N.m)(ce,ce,ge(Qe,X[0],X[1])),`matrix(${ce[0]},${ce[1]},${ce[2]},${ce[3]},${ce[4]},${ce[5]})`}function ni(U,E,_,L={}){const S=[],Z=[],W=++K,X=function ii(U,E,_){const L=U?.effects.find(ye=>"bloom"===ye.type);if(!L)return null;const{strength:S,radius:Z}=L,W=S>0?Z:0,X=(S+W)*E,ee=4*S+1;return(0,te.u)("filter",{filterUnits:"userSpaceOnUse",height:"300%",id:`bloom${_}`,width:"300%",x:"-100%",y:"-100%"},(0,te.u)("feMorphology",{in:"SourceGraphic",operator:"dilate",radius:(S+.5*W)*(5**(E/100)*(.4+E/100)),result:"dilate"}),(0,te.u)("feGaussianBlur",{in:"dilate",result:"blur",stdDeviation:X/25}),(0,te.u)("feGaussianBlur",{in:"blur",result:"intensityBlur",stdDeviation:X/50}),(0,te.u)("feComponentTransfer",{in:"SourceGraphic",result:"intensityBrightness"},(0,te.u)("feFuncR",{slope:ee,type:"linear"}),(0,te.u)("feFuncG",{slope:ee,type:"linear"}),(0,te.u)("feFuncB",{slope:ee,type:"linear"})),(0,te.u)("feMerge",null,(0,te.u)("feMergeNode",{in:"intensityBlur"}),(0,te.u)("feMergeNode",{in:"intensityBrightness"}),(0,te.u)("feGaussianBlur",{stdDeviation:S/10})))}(L.effectView,E,W);let ee=null;if(X){const Me=L.effectView?.effects.find(ce=>"bloom"===ce.type),ve=(Me.strength?Me.strength+Me.radius/2:0)/3,Qe=_+_*ve;ee=[Math.max(E+E*ve,10),Math.max(Qe,10)]}for(let Me=0;Me<U.length;Me++){const ve=U[Me],xe=[],Qe=[];let ce=0,Ce=0,Re=0;for(const me of ve){const{shape:Le,fill:Ke,stroke:at,font:lt,offset:si}=me;L.ignoreStrokeWidth||"text"===Le.type||(ce+=at?.width||0);const oi=q(Ke),Gt=pe(at),Vt="text"===Le.type?oe(Le,lt):null;S.push(We(oi)),xe.push(le(Le,oi.fill,Gt,Vt)),Qe.push(Pt(Le)),si&&(Ce+=si[0],Re+=si[1])}const Ue=Zt(ti(Qe),E,_,ce,L.scale??!1,L.rotation,L.useRotationSize??!1,[Ce,Re],ee);let fe=null;if(L.masking){const me=`mask-${Me}`;S.push(G(L.masking[Me],me)),fe=`url(#${me})`}Z.push(fe?(0,te.u)("g",{mask:fe},(0,te.u)("g",{transform:Ue},xe)):(0,te.u)("g",{transform:Ue},xe))}return L.useRotationSize&&L.rotation&&(E=Q(L.rotation,E),_=Q(L.rotation,_)),X&&((0,Te.O3)(ee),E=ee[0],_=ee[1]),(0,te.u)("svg",{"aria-labelledby":L.ariaLabel,focusable:!1,height:_,role:"img",style:"display: block;",width:E,xmlns:$e},X,(0,te.u)("defs",null,S),X?(0,te.u)("g",{filter:`url(#bloom${W})`},Z):Z)}},9733:(Tt,et,F)=>{F.r(et),F.d(et,{default:()=>il});var z=F(15861),I=F(17626),Te=F(55538),Ze=F(63290),N=F(32917),x=F(77712),$e=(F(90912),F(85931)),re=(F(8314),F(76898)),ae=F(48753),Be=(F(52515),F(74333)),ke=F(17770),j=F(7074),D=F(66656),Y=F(78109),$=F(26584),K=F(41844),ne=(F(23719),F(21286)),le=F(16730);function G(g,y,v="arithmetic"){return{type:(0,le.UF)(y),value:g,unit:y,rotationType:v}}(function pe(g,y){(0,le.UF)(y)})(0,"meters"),function oe(g,y){(0,le.UF)(y)}(0,"square-meters"),G(0,"radians"),G(0,"degrees");var U=F(77275),E=F(15348);const Le=["B","kB","MB","GB","TB"];var at=F(88879),lt=F(83761),si=F(87183),oi=F(67736),Gt=F(88411),Vt=F(90194),uo=F(72469),vi=F(51692),kn=F(46679),ri=F(28302);const Wn=Ze.Z.getLogger("esri.widgets.Feature.support.featureUtils"),ho=/href=(""|'')/gi,po=/(\{([^\{\r\n]+)\})/g,mo=/\'/g,Hn=/^\s*expression\//i,fo=/(\n)/gi,go=/[\u00A0-\u9999<>\&]/gim,yo=/href\s*=\s*(?:\"([^\"]+)\"|\'([^\']+)\')/gi,vo=/^(?:mailto:|tel:)/,Yn="relationships/",Gn=(0,Gt.Ze)("short-date-short-time");function Kn(g){if(null!=g)return(g.sourceLayer||g.layer)??void 0}function bi(g,y){return Oi.apply(this,arguments)}function Oi(){return(Oi=(0,z.Z)(function*(g,y){return"function"==typeof g?g(y):g})).apply(this,arguments)}function Qn(g=""){if(g)return!vo.test(g.trim().toLowerCase())}function Si(g){return!!g&&Hn.test(g)}function Xn(g,y){const v=function bo(g,y){if(!Si(y)||!g)return null;const v=y.replace(Hn,"").toLowerCase();let b=null;return g.some(w=>w.name.toLowerCase()===v&&(b=w,!0)),b}(y,g?.fieldName);return v?v.title||null:g?g.label||g.fieldName:null}function ai(g,y){const v=Zi(y,g);return v?v.name:g}function Zi(g,y){return g&&"function"==typeof g.getField&&y?g.getField(y)??null:null}function Jn(g){return`${g}`.trim()}function $t({attributes:g,globalAttributes:y,layer:v,text:b,expressionAttributes:w,fieldInfoMap:M}){return b?Vi({formattedAttributes:y,template:Ao(b,{...y,...w,...g},v),fieldInfoMap:M}):""}function Vi({formattedAttributes:g,template:y,fieldInfoMap:v}){return Jn(function Mo(g){return g.replaceAll(ho,"")}((0,U.gx)((0,U.gx)(y,b=>function wo(g,y){return`{${y.get(g.toLowerCase())?.fieldName||g}}`}(b,v)),g)))}function $i(g,y){return g.replaceAll(po,(v,b,w)=>{const M=Zi(y,w);return M?`{${M.name}}`:b})}function Ao(g,y,v){const b=$i(g,v);return b&&b.replaceAll(yo,(w,M,C)=>function _o(g,y,v){const b=(y=Jn(y))&&"{"!==y[0];return(0,U.gx)(g,function Io(g,y=!1){const v={...g};return Object.keys(v).forEach(b=>function Fo(g,y,v=!1){const b=y[g];if("string"==typeof b){const w="%27",M=(v?encodeURIComponent(b):b).replaceAll(mo,w);y[g]=M}}(b,v,y)),v}(v,b||!1))}(w,M||C,y))}function Ni(g){return function Eo(g){return null!=g&&"object"==typeof g&&"fieldsIndex"in g&&"geometryType"in g&&"getField"in g&&"load"in g&&"loaded"in g&&"objectIdField"in g&&"spatialReference"in g&&"type"in g&&("feature"===g.type||"scene"===g.type)&&"when"in g}(g)&&function Lo(g){return null!=g&&"object"==typeof g&&"createQuery"in g&&"queryFeatureCount"in g&&"queryObjectIds"in g&&"queryRelatedFeatures"in g&&"queryRelatedFeaturesCount"in g&&"relationships"in g}(g)}function Di(g,y,v,b){return g.trim().split(y).map(w=>(0,E.uf)(Number(w),(0,E.sh)(b))).join(v)}function qn(g,y){if(g?.length&&y)return g.find(v=>v.fieldName?.toLowerCase()===y.toLowerCase())}function es(g){const y=[];if(!g)return y;const{fieldInfos:v,content:b}=g;return v&&y.push(...v),b&&Array.isArray(b)&&b.forEach(w=>{if("fields"===w.type){const M=w?.fieldInfos;M&&y.push(...M)}}),y}function Bi(g){return g.replaceAll(go,y=>`&#${y.charCodeAt(0)};`)}function li(g){return"string"==typeof g?g.replaceAll(fo,'<br class="esri-text-new-line" />'):g}function ts(g){const{value:y,fieldName:v,fieldInfos:b,fieldInfoMap:w,layer:M,graphic:C,timeZone:A}=g;if(null==y)return"";const T=function Uo({fieldName:g,value:y,graphic:v,layer:b}){if(_t(g)||!b||"function"!=typeof b.getFieldDomain)return null;const w=v&&b.getFieldDomain(g,{feature:v});return w&&"coded-value"===w.type?w.getName(y):null}({fieldName:v,value:y,graphic:C,layer:M});if(T)return T;const P=function Ro({fieldName:g,graphic:y,layer:v}){if(_t(g)||!v||"function"!=typeof v.getFeatureType)return null;const{typeIdField:b}=v;if(!b||g!==b)return null;const w=v.getFeatureType(y);return w?w.name:null}({fieldName:v,graphic:C,layer:M});if(P)return P;if(w.get(v.toLowerCase()))return function To(g,y){const{fieldInfos:v,fieldName:b,preventPlacesFormatting:w,layer:M,timeZone:C}=y,A=qn(v,b),T=Zi(M,b);if(A&&!(0,Vt.Ec)(b)){const R=T?.type,V=A.format?.dateFormat;if("date"===R||"date-only"===R||"time-only"===R||"timestamp-offset"===R||V)return(0,vi.$8)(g,{format:V,fieldType:R,timeZoneOptions:{layerTimeZone:M&&"preferredTimeZone"in M?M.preferredTimeZone:null,viewTimeZone:C,datesInUnknownTimezone:!(!M||!("datesInUnknownTimezone"in M)||!M.datesInUnknownTimezone)}})}const P=A?.format;return"string"==typeof g&&(0,Vt.Ec)(b)&&P?function Po(g,y){return g=g.trim(),/\d{2}-\d{2}/.test(g)?g:g.includes(",")?Di(g,",",", ",y):g.includes(";")?Di(g,";","; ",y):g.includes(" ")?Di(g," "," ",y):(0,E.uf)(Number(g),(0,E.sh)(y))}(g,P):"string"==typeof(g=function xo(g,y){if("string"==typeof g&&y&&null==y.dateFormat&&(null!=y.places||null!=y.digitSeparator)){const v=Number(g);if(!isNaN(v))return v}return g}(g,P))||null==g||null==P?li(g):(0,E.uf)(g,w?{...(0,E.sh)(P),minimumFractionDigits:0,maximumFractionDigits:20}:(0,E.sh)(P))}(y,{fieldInfos:b||Array.from(w.values()),fieldName:v,layer:M,timeZone:A});const R=M?.fieldsIndex?.get(v);return R&&((0,vi.a8)(R)||(0,Vt.sX)(R))?(0,vi.$8)(y,{fieldType:R.type,timeZoneOptions:{layerTimeZone:M&&"preferredTimeZone"in M?M.preferredTimeZone:null,viewTimeZone:A,datesInUnknownTimezone:!(!M||!("datesInUnknownTimezone"in M)||!M.datesInUnknownTimezone)}}):li(y)}function zi({fieldInfos:g,attributes:y,layer:v,graphic:b,fieldInfoMap:w,relatedInfos:M,timeZone:C}){const A={};return M?.forEach(T=>function No({attributes:g,relatedInfo:y,fieldInfoMap:v,fieldInfos:b,layer:w,timeZone:M}){g&&y&&(y.relatedFeatures?.forEach(C=>ns({attributes:g,graphic:C,relatedInfo:y,fieldInfoMap:v,fieldInfos:b,layer:w,timeZone:M})),y.relatedStatsFeatures?.forEach(C=>ns({attributes:g,graphic:C,relatedInfo:y,fieldInfoMap:v,fieldInfos:b,layer:w,timeZone:M})))}({attributes:A,relatedInfo:T,fieldInfoMap:w,fieldInfos:g,layer:v,timeZone:C})),y&&Object.keys(y).forEach(T=>{A[T]=ts({fieldName:T,fieldInfos:g,fieldInfoMap:w,layer:v,value:y[T],graphic:b,timeZone:C})}),A}function is(g,y){return ji.apply(this,arguments)}function ji(){return(ji=(0,z.Z)(function*(g,y){const{layer:v,graphic:b,outFields:w,objectIds:M,returnGeometry:C,spatialReference:A}=g,T=M[0];if("number"!=typeof T&&"string"!=typeof T)return Wn.warn("Could not query required fields for the specified feature. The feature's ID is invalid.",{layer:v,graphic:b,objectId:T,requiredFields:w}),null;if(!(0,uo.S1)(v)?.operations?.supportsQuery)return Wn.warn("The specified layer cannot be queried. The following fields will not be available.",{layer:v,graphic:b,requiredFields:w,returnGeometry:C}),null;const P=v.createQuery();return P.objectIds=M,P.outFields=w?.length?w:[v.objectIdField],P.returnGeometry=!!C,P.returnZ=!!C,P.returnM=!!C,P.outSpatialReference=A,(yield v.queryFeatures(P,y)).features[0]})).apply(this,arguments)}function ki(){return(ki=(0,z.Z)(function*(g){if(!g.expressionInfos?.length)return!1;const y=yield(0,kn.LC)(),{arcadeUtils:{hasGeometryFunctions:v}}=y;return v(g)})).apply(this,arguments)}function Wi(){return Wi=(0,z.Z)(function*({graphic:g,popupTemplate:y,layer:v,spatialReference:b},w){if(!v||!y||("function"==typeof v.load&&(yield v.load(w)),!g.attributes))return;const M=g.attributes[v.objectIdField];if(null==M)return;const C=[M],A=yield y.getRequiredFields(v.fieldsIndex),T=(0,Vt.R9)(A,g),P=T?[]:A,R=y.returnGeometry||(yield function Zo(g){return ki.apply(this,arguments)}(y));if(T&&!R)return;const V=yield is({layer:v,graphic:g,outFields:P,objectIds:C,returnGeometry:R,spatialReference:b},w);V&&(V.geometry&&(g.geometry=V.geometry),V.attributes&&(g.attributes={...g.attributes,...V.attributes}))}),Wi.apply(this,arguments)}function _t(g=""){return!!g&&g.includes(Yn)}function ns({attributes:g,graphic:y,relatedInfo:v,fieldInfos:b,fieldInfoMap:w,layer:M,timeZone:C}){g&&y&&v&&Object.keys(y.attributes).forEach(A=>{const T=function $o(g){return g?`${Yn}${g.layerId}/${g.fieldName}`:""}({layerId:v.relation.id.toString(),fieldName:A});g[T]=ts({fieldName:T,fieldInfos:b,fieldInfoMap:w,layer:M,value:y.attributes[A],graphic:y,timeZone:C})})}const ss=g=>{if(!g)return!1;const y=g.toUpperCase();return y.includes("CURRENT_TIMESTAMP")||y.includes("CURRENT_DATE")||y.includes("CURRENT_TIME")},os=({layer:g,method:y,query:v,definitionExpression:b})=>{if(!g.capabilities?.query?.supportsCacheHint||"attachments"===y)return;const w=null!=v.where?v.where:null,M=null!=v.geometry?v.geometry:null;ss(b)||ss(w)||"extent"===M?.type||"tile"===v.resultType||(v.cacheHint=!0)};function rs(g,y,v){const b="scene"===y.type&&y.associatedLayer?y.associatedLayer.url:y.url;return g.filter(Ni).find(w=>w!==y&&w.url===b&&w.layerId===v.relatedTableId)}const as={editing:!1,operations:{add:!0,update:!0,delete:!0}},ls=Be.Z.ofType(si.Z);let ht=class extends lt.Z{constructor(g){super(g),this._getAttachmentsPromise=null,this._attachmentLayer=null,this.capabilities={...as},this.activeAttachmentInfo=null,this.activeFileInfo=null,this.attachmentInfos=new ls,this.fileInfos=new Be.Z,this.graphic=null,this.mode="view",this.filesEnabled=!1,this.addHandles((0,N.YP)(()=>this.graphic,()=>this._graphicChanged(),N.nn))}destroy(){this._attachmentLayer=null,this.graphic=null}castCapabilities(g){return{...as,...g}}get state(){return this._getAttachmentsPromise?"loading":this.graphic?"ready":"disabled"}get supportsResizeAttachments(){const{graphic:g}=this;if(!g)return!1;const y=g.layer||g.sourceLayer;return y?.loaded&&"capabilities"in y&&y.capabilities&&"operations"in y.capabilities&&"supportsResizeAttachments"in y.capabilities.operations&&y.capabilities.operations.supportsResizeAttachments||!1}getAttachments(){var g=this;return(0,z.Z)(function*(){const{_attachmentLayer:y,attachmentInfos:v}=g;if(!y||"function"!=typeof y.queryAttachments)throw new $.Z("invalid-layer","getAttachments(): A valid layer is required.");const b=g._getObjectId(),w=new oi.Z({objectIds:[b],returnMetadata:!0}),M=[],C=y.queryAttachments(w).then(T=>T[b]||M).catch(()=>M);g._getAttachmentsPromise=C,g.notifyChange("state");const A=yield C;return v.removeAll(),A.length&&v.addMany(A),g._getAttachmentsPromise=null,g.notifyChange("state"),A})()}addAttachment(g,y=this.graphic){var v=this;return(0,z.Z)(function*(){const{_attachmentLayer:b,attachmentInfos:w,capabilities:M}=v;if(!y)throw new $.Z("invalid-graphic","addAttachment(): A valid graphic is required.",{graphic:y});if(!g)throw new $.Z("invalid-attachment","addAttachment(): An attachment is required.",{attachment:g});if(!M.operations?.add)throw new $.Z("invalid-capabilities","addAttachment(): add capabilities are required.");if(!b||"function"!=typeof b.addAttachment)throw new $.Z("invalid-layer","addAttachment(): A valid layer is required.");const C=b.addAttachment(y,g).then(T=>v._queryAttachment(T.objectId,y)),A=yield C;return w.add(A),A})()}deleteAttachment(g){var y=this;return(0,z.Z)(function*(){const{_attachmentLayer:v,attachmentInfos:b,graphic:w,capabilities:M}=y;if(!g)throw new $.Z("invalid-attachment-info","deleteAttachment(): An attachmentInfo is required.",{attachmentInfo:g});if(!M.operations?.delete)throw new $.Z("invalid-capabilities","deleteAttachment(): delete capabilities are required.");if(!v||"function"!=typeof v.deleteAttachments)throw new $.Z("invalid-layer","deleteAttachment(): A valid layer is required.");if(!w)throw new $.Z("invalid-graphic","deleteAttachment(): A graphic is required.");const C=v.deleteAttachments(w,[g.id]).then(()=>g),A=yield C;return b.remove(A),A})()}updateAttachment(g,y=this.activeAttachmentInfo){var v=this;return(0,z.Z)(function*(){const{_attachmentLayer:b,attachmentInfos:w,graphic:M,capabilities:C}=v;if(!g)throw new $.Z("invalid-attachment","updateAttachment(): An attachment is required.",{attachment:g});if(!y)throw new $.Z("invalid-attachment-info","updateAttachment(): An attachmentInfo is required.",{attachmentInfo:y});if(!C.operations?.update)throw new $.Z("invalid-capabilities","updateAttachment(): Update capabilities are required.");const A=w.indexOf(y);if(!b||"function"!=typeof b.updateAttachment)throw new $.Z("invalid-layer","updateAttachment(): A valid layer is required.");if(!M)throw new $.Z("invalid-graphic","updateAttachment(): A graphic is required.");const T=b.updateAttachment(M,y.id,g).then(R=>v._queryAttachment(R.objectId)),P=yield T;return w.splice(A,1,P),P})()}commitFiles(){var g=this;return(0,z.Z)(function*(){return yield Promise.all(g.fileInfos.items.map(y=>g.addAttachment(y.form))),g.fileInfos.removeAll(),g.getAttachments()})()}addFile(g,y){if(!g||!y)return null;const v={file:g,form:y};return this.fileInfos.add(v),v}updateFile(g,y,v=this.activeFileInfo){if(!g||!y||!v)return null;const b=this.fileInfos.indexOf(v);return b>-1&&this.fileInfos.splice(b,1,{file:g,form:y}),this.fileInfos.items[b]}deleteFile(g){const y=this.fileInfos.find(v=>v.file===g);return y?(this.fileInfos.remove(y),y):null}_queryAttachment(g,y){var v=this;return(0,z.Z)(function*(){const{_attachmentLayer:b}=v;if(!g||!b?.queryAttachments)throw new $.Z("invalid-attachment-id","Could not query attachment.");const w=v._getObjectId(y),M=new oi.Z({objectIds:[w],attachmentsWhere:`AttachmentId=${g}`,returnMetadata:!0});return b.queryAttachments(M).then(C=>C[w][0])})()}_getObjectId(g=this.graphic){return g?.getObjectId()??null}_graphicChanged(){this.graphic&&(this._setAttachmentLayer(),this.getAttachments().catch(()=>{}))}_setAttachmentLayer(){const{graphic:g}=this,y=Kn(g);this._attachmentLayer=y?"scene"===y.type&&null!=y.associatedLayer?y.associatedLayer:y:null}};(0,I._)([(0,x.Cb)()],ht.prototype,"capabilities",void 0),(0,I._)([(0,D.p)("capabilities")],ht.prototype,"castCapabilities",null),(0,I._)([(0,x.Cb)()],ht.prototype,"activeAttachmentInfo",void 0),(0,I._)([(0,x.Cb)()],ht.prototype,"activeFileInfo",void 0),(0,I._)([(0,x.Cb)({readOnly:!0,type:ls})],ht.prototype,"attachmentInfos",void 0),(0,I._)([(0,x.Cb)()],ht.prototype,"fileInfos",void 0),(0,I._)([(0,x.Cb)({type:at.Z})],ht.prototype,"graphic",void 0),(0,I._)([(0,x.Cb)()],ht.prototype,"mode",void 0),(0,I._)([(0,x.Cb)({readOnly:!0})],ht.prototype,"state",null),(0,I._)([(0,x.Cb)()],ht.prototype,"filesEnabled",void 0),(0,I._)([(0,x.Cb)({readOnly:!0})],ht.prototype,"supportsResizeAttachments",null),ht=(0,I._)([(0,re.j)("esri.widgets.Attachments.AttachmentsViewModel")],ht);const Hi=ht;var jo=F(54346);function ds(g){const y=g.toLowerCase();return"image/bmp"===y||"image/emf"===y||"image/exif"===y||"image/gif"===y||"image/x-icon"===y||"image/jpeg"===y||"image/png"===y||"image/tiff"===y||"image/x-wmf"===y}var Kt=F(97369),be=F(91192),yt=F(20177),Mt=F(38570),pt=F(25552),O=F(94450);const us={addButton:!0,addSubmitButton:!0,cancelAddButton:!0,cancelUpdateButton:!0,deleteButton:!0,errorMessage:!0,progressBar:!0,updateButton:!0},Ee="esri-attachments",de={base:Ee,loaderContainer:`${Ee}__loader-container`,loader:`${Ee}__loader`,fadeIn:`${Ee}--fade-in`,container:`${Ee}__container`,containerList:`${Ee}__container--list`,containerPreview:`${Ee}__container--preview`,actions:`${Ee}__actions`,deleteButton:`${Ee}__delete-button`,addAttachmentButton:`${Ee}__add-attachment-button`,errorMessage:`${Ee}__error-message`,items:`${Ee}__items`,item:`${Ee}__item`,itemButton:`${Ee}__item-button`,itemMask:`${Ee}__item-mask`,itemMaskIcon:`${Ee}__item-mask--icon`,itemImage:`${Ee}__image`,itemImageResizable:`${Ee}__image--resizable`,itemLabel:`${Ee}__label`,itemFilename:`${Ee}__filename`,itemChevronIcon:`${Ee}__item-chevron-icon`,itemLink:`${Ee}__item-link`,itemLinkOverlay:`${Ee}__item-link-overlay`,itemLinkOverlayIcon:`${Ee}__item-link-overlay-icon`,itemEditIcon:`${Ee}__item-edit-icon`,itemAddIcon:`${Ee}__item-add-icon`,itemAddButton:`${Ee}__item-add-button`,formNode:`${Ee}__form-node`,fileFieldset:`${Ee}__file-fieldset`,fileLabel:`${Ee}__file-label`,fileName:`${Ee}__file-name`,fileInput:`${Ee}__file-input`,metadata:`${Ee}__metadata`,metadataFieldset:`${Ee}__metadata-fieldset`,progressBar:`${Ee}__progress-bar`},Yi=window.CSS;let st=class extends Y.Z{constructor(g,y){super(g,y),this.displayType="auto",this.messages=null,this.messagesUnits=null,this.selectedFile=null,this.submitting=!1,this.viewModel=null,this.visibleElements={...us},this._supportsImageOrientation=Yi&&Yi.supports&&Yi.supports("image-orientation","from-image"),this._addAttachmentForm=null,this._updateAttachmentForm=null}normalizeCtorArgs(g){return g?.viewModel||(g={viewModel:new Hi,...g}),g}initialize(){this.addHandles([(0,N.on)(()=>this.viewModel?.attachmentInfos,"change",()=>this.scheduleRender()),(0,N.on)(()=>this.viewModel?.fileInfos,"change",()=>this.scheduleRender()),(0,N.YP)(()=>this.viewModel?.mode,()=>this._modeChanged(),N.nn)])}loadDependencies(){return(0,Kt.h)({icon:()=>F.e(8472).then(F.bind(F,8472))})}get capabilities(){return this.viewModel.capabilities}set capabilities(g){this.viewModel.capabilities=g}get effectiveDisplayType(){const{displayType:g}=this;return g&&"auto"!==g?g:this.viewModel.supportsResizeAttachments?"preview":"list"}get graphic(){return this.viewModel.graphic}set graphic(g){this.viewModel.graphic=g}get label(){return this.messages?.widgetLabel??""}set label(g){this._overrideIfSome("label",g)}castVisibleElements(g){return{...us,...g}}addAttachment(){const{_addAttachmentForm:g,viewModel:y}=this;return this._set("submitting",!0),this._set("error",null),y.addAttachment(g).then(v=>(this._set("submitting",!1),this._set("error",null),y.mode="view",v)).catch(v=>{throw this._set("submitting",!1),this._set("error",new $.Z("attachments:add-attachment",this.messages.addErrorMessage,v)),v})}deleteAttachment(g){const{viewModel:y}=this;return this._set("submitting",!0),this._set("error",null),y.deleteAttachment(g).then(v=>(this._set("submitting",!1),this._set("error",null),y.mode="view",v)).catch(v=>{throw this._set("submitting",!1),this._set("error",new $.Z("attachments:delete-attachment",this.messages.deleteErrorMessage,v)),v})}updateAttachment(){const{viewModel:g}=this,{_updateAttachmentForm:y}=this;return this._set("submitting",!0),this._set("error",null),g.updateAttachment(y).then(v=>(this._set("submitting",!1),this._set("error",null),g.mode="view",v)).catch(v=>{throw this._set("submitting",!1),this._set("error",new $.Z("attachments:update-attachment",this.messages.updateErrorMessage,v)),v})}addFile(){const g=this.viewModel.addFile(this.selectedFile,this._addAttachmentForm);return this.viewModel.mode="view",g}updateFile(){const{viewModel:g}=this,y=g.updateFile(this.selectedFile,this._updateAttachmentForm,g.activeFileInfo);return g.mode="view",y}deleteFile(g){const y=this.viewModel.deleteFile(g||this.viewModel.activeFileInfo?.file);return this.viewModel.mode="view",y}render(){const{submitting:g,viewModel:y}=this,{state:v}=y;return(0,O.u)("div",{class:this.classes(de.base,be.z.widget)},g?this._renderProgressBar():null,"loading"===v?this._renderLoading():this._renderAttachments(),this._renderErrorMessage())}_renderErrorMessage(){const{error:g,visibleElements:y}=this;return g&&y.errorMessage?(0,O.u)("div",{class:de.errorMessage,key:"error-message"},g.message):null}_renderAttachments(){const{activeFileInfo:g,mode:y,activeAttachmentInfo:v}=this.viewModel;return"add"===y?this._renderAddForm():"edit"===y?this._renderDetailsForm(v||g):this._renderAttachmentContainer()}_renderLoading(){return(0,O.u)("div",{class:de.loaderContainer,key:"loader"},(0,O.u)("div",{class:de.loader}))}_renderProgressBar(){return this.visibleElements.progressBar?(0,O.u)("div",{class:de.progressBar,key:"progress-bar"}):null}_renderAddForm(){const{submitting:g,selectedFile:y}=this,v=g||!y,b=this.visibleElements.cancelAddButton?(0,O.u)("button",{bind:this,class:this.classes(be.z.button,be.z.buttonTertiary,be.z.buttonSmall,be.z.buttonHalf,g&&be.z.buttonDisabled),disabled:g,onclick:this._cancelForm,type:"button"},this.messages.cancel):null,w=this.visibleElements.addSubmitButton?(0,O.u)("button",{class:this.classes(be.z.button,be.z.buttonSecondary,be.z.buttonSmall,be.z.buttonHalf,{[be.z.buttonDisabled]:v}),disabled:v,type:"submit"},this.messages.add):null,M=y?(0,O.u)("span",{class:de.fileName,key:"file-name"},y.name):null,C=(0,O.u)("form",{afterCreate:Mt.Yo,afterRemoved:Mt.pV,bind:this,"data-node-ref":"_addAttachmentForm",onsubmit:this._submitAddAttachment},(0,O.u)("fieldset",{class:de.fileFieldset},M,(0,O.u)("label",{class:this.classes(de.fileLabel,be.z.button,be.z.buttonSecondary)},y?this.messages.changeFile:this.messages.selectFile,(0,O.u)("input",{bind:this,class:de.fileInput,name:"attachment",onchange:this._handleFileInputChange,type:"file"}))),w,b);return(0,O.u)("div",{class:de.formNode,key:"add-form-container"},C)}_renderDetailsForm(g){const{visibleElements:y,viewModel:v,selectedFile:b,submitting:w}=this,{capabilities:M}=v,C=w||!b;let A,T,P,R;b?(A=b.type,T=b.name,P=b.size):g&&"file"in g?(A=g.file.type,T=g.file.name,P=g.file.size):g&&"contentType"in g&&(A=g.contentType,T=g.name,P=g.size,R=g.url);const V=M.editing&&M.operations?.delete&&y.deleteButton?(0,O.u)("button",{bind:this,class:this.classes(be.z.button,be.z.buttonSmall,be.z.buttonTertiary,de.deleteButton,{[be.z.buttonDisabled]:w}),disabled:w,key:"delete-button",onclick:se=>this._submitDeleteAttachment(se,g),type:"button"},this.messages.delete):void 0,B=M.editing&&M.operations?.update&&y.updateButton?(0,O.u)("button",{class:this.classes(be.z.button,be.z.buttonSmall,be.z.buttonThird,{[be.z.buttonDisabled]:C}),disabled:C,key:"update-button",type:"submit"},this.messages.update):void 0,k=this.visibleElements.cancelUpdateButton?(0,O.u)("button",{bind:this,class:this.classes(be.z.button,be.z.buttonSmall,be.z.buttonTertiary,be.z.buttonThird,{[be.z.buttonDisabled]:w}),disabled:w,key:"cancel-button",onclick:this._cancelForm,type:"button"},this.messages.cancel):void 0,H=M.editing&&M.operations?.update?(0,O.u)("fieldset",{class:de.fileFieldset,key:"file"},(0,O.u)("span",{class:de.fileName,key:"file-name"},T),(0,O.u)("label",{class:this.classes(de.fileLabel,be.z.button,be.z.buttonSecondary)},this.messages.changeFile,(0,O.u)("input",{bind:this,class:de.fileInput,name:"attachment",onchange:this._handleFileInputChange,type:"file"}))):void 0,J=(0,O.u)("fieldset",{class:de.metadataFieldset,key:"size"},(0,O.u)("label",null,function Ke(g,y){let v=0===(y=Math.round(y))?0:Math.floor(Math.log(y)/Math.log(K.Y.KILOBYTES));v=(0,ne.uZ)(v,0,Le.length-1);const b=(0,E.uf)(y/K.Y.KILOBYTES**v,{maximumFractionDigits:2});return(0,U.gx)(g.units.bytes[Le[v]],{fileSize:b})}(this.messagesUnits,P??0))),ie=(0,O.u)("fieldset",{class:de.metadataFieldset,key:"content-type"},(0,O.u)("label",null,A)),ue=null!=R?(0,O.u)("a",{class:de.itemLink,href:R,rel:"noreferrer",target:"_blank"},this._renderImageMask(g,400),(0,O.u)("div",{class:de.itemLinkOverlay},(0,O.u)("span",{class:de.itemLinkOverlayIcon},(0,O.u)("calcite-icon",{icon:"launch"})))):this._renderImageMask(g,400),Fe=(0,O.u)("form",{afterCreate:Mt.Yo,afterRemoved:Mt.pV,bind:this,"data-node-ref":"_updateAttachmentForm",onsubmit:se=>this._submitUpdateAttachment(se,g)},(0,O.u)("div",{class:de.metadata},J,ie),H,(0,O.u)("div",{class:de.actions},V,k,B));return(0,O.u)("div",{class:de.formNode,key:"edit-form-container"},ue,Fe)}_renderImageMask(g,y){return g?"file"in g?this._renderGenericImageMask(g.file.name,g.file.type):this._renderImageMaskForAttachment(g,y):null}_renderGenericImageMask(g,y){const{supportsResizeAttachments:v}=this.viewModel,b=function ko(g){const y=(0,jo.V)("esri/themes/base/images/files/");return g?"text/plain"===g?`${y}text-32.svg`:"application/pdf"===g?`${y}pdf-32.svg`:"text/csv"===g?`${y}csv-32.svg`:"application/gpx+xml"===g?`${y}gpx-32.svg`:"application/x-dwf"===g?`${y}cad-32.svg`:"application/postscript"===g||"application/json"===g||"text/xml"===g||"model/vrml"===g?`${y}code-32.svg`:"application/x-zip-compressed"===g||"application/x-7z-compressed"===g||"application/x-gzip"===g||"application/x-tar"===g||"application/x-gtar"===g||"application/x-bzip2"===g||"application/gzip"===g||"application/x-compress"===g||"application/x-apple-diskimage"===g||"application/x-rar-compressed"===g||"application/zip"===g?`${y}zip-32.svg`:g.includes("image/")?`${y}image-32.svg`:g.includes("audio/")?`${y}sound-32.svg`:g.includes("video/")?`${y}video-32.svg`:g.includes("msexcel")||g.includes("ms-excel")||g.includes("spreadsheetml")?`${y}excel-32.svg`:g.includes("msword")||g.includes("ms-word")||g.includes("wordprocessingml")?`${y}word-32.svg`:g.includes("powerpoint")||g.includes("presentationml")?`${y}report-32.svg`:`${y}generic-32.svg`:`${y}generic-32.svg`}(y),w={[de.itemImageResizable]:v};return(0,O.u)("div",{class:this.classes(de.itemMaskIcon,de.itemMask),key:b},(0,O.u)("img",{alt:g,class:this.classes(w,de.itemImage),src:b,title:g}))}_renderImageMaskForAttachment(g,y){const{supportsResizeAttachments:v}=this.viewModel;if(!g)return null;const{contentType:b,name:w,url:M}=g;if(!v||!ds(b))return this._renderGenericImageMask(w,b);const C=this._getCSSTransform(g),A=C?{transform:C,"image-orientation":"none"}:{},T=`${M}${M?.includes("?")?"&":"?"}w=${y}`,P={[de.itemImageResizable]:v};return(0,O.u)("div",{class:this.classes(de.itemMask),key:T},(0,O.u)("img",{alt:w,class:this.classes(P,de.itemImage),src:T,styles:A,title:w}))}_renderFile(g){const{file:y}=g;return(0,O.u)("li",{class:de.item,key:y},(0,O.u)("button",{"aria-label":this.messages.attachmentDetails,bind:this,class:de.itemButton,key:"details-button",onclick:()=>this._startEditFile(g),title:this.messages.attachmentDetails,type:"button"},this._renderImageMask(g),(0,O.u)("label",{class:de.itemLabel},(0,O.u)("span",{class:de.itemFilename},y.name||this.messages.noTitle),(0,O.u)("span",{"aria-hidden":"true",class:this.classes(de.itemChevronIcon,(0,Mt.dZ)(this.container)?yt.W.left:yt.W.right)}))))}_renderAttachmentInfo({attachmentInfo:g,displayType:y}){const{viewModel:v,effectiveDisplayType:b}=this,{capabilities:w,supportsResizeAttachments:M}=v,{contentType:C,name:A,url:T}=g,P=this._renderImageMask(g,"list"===y?48:400),R=w.editing?(0,O.u)("span",{"aria-hidden":"true",class:this.classes(de.itemChevronIcon,(0,Mt.dZ)(this.container)?yt.W.left:yt.W.right)}):null,V=[P,"preview"===b&&M&&ds(C)?null:(0,O.u)("label",{class:de.itemLabel},(0,O.u)("span",{class:de.itemFilename},A||this.messages.noTitle),R)],B=w.editing?(0,O.u)("button",{"aria-label":this.messages.attachmentDetails,bind:this,class:de.itemButton,"data-attachment-info-id":g.id,key:"details-button",onclick:()=>this._startEditAttachment(g),title:this.messages.attachmentDetails,type:"button"},V):(0,O.u)("a",{class:de.itemButton,href:T??void 0,key:"details-link",target:"_blank"},V);return(0,O.u)("li",{class:de.item,key:g},B)}_renderAttachmentContainer(){const{effectiveDisplayType:g,viewModel:y,visibleElements:v}=this,{attachmentInfos:b,capabilities:w,fileInfos:M}=y,C=!!b?.length,A=!!M?.length,T={[de.containerList]:"preview"!==g,[de.containerPreview]:"preview"===g},P=w.editing&&w.operations?.add&&v.addButton?(0,O.u)("button",{bind:this,class:this.classes(be.z.button,be.z.buttonTertiary,de.addAttachmentButton),onclick:()=>this._startAddAttachment(),type:"button"},(0,O.u)("span",{"aria-hidden":"true",class:this.classes(de.itemAddIcon,yt.W.plus)}),this.messages.add):void 0,R=C?(0,O.u)("ul",{class:de.items,key:"attachments-list"},b.toArray().map(k=>this._renderAttachmentInfo({attachmentInfo:k,displayType:g}))):void 0,V=A?(0,O.u)("ul",{class:de.items,key:"file-list"},M.toArray().map(k=>this._renderFile(k))):void 0,B=A||C?void 0:(0,O.u)("div",{class:be.z.empty},this.messages.noAttachments);return(0,O.u)("div",{class:this.classes(de.container,T),key:"attachments-container"},R,V,B,P)}_modeChanged(){this._set("error",null),this._set("selectedFile",null)}_handleFileInputChange(g){const v=g.target.files?.item(0);this._set("selectedFile",v)}_submitDeleteAttachment(g,y){g.preventDefault(),y&&("file"in y?this.deleteFile(y.file):y&&this.deleteAttachment(y))}_submitAddAttachment(g){g.preventDefault(),this.viewModel.filesEnabled?this.addFile():this.addAttachment()}_submitUpdateAttachment(g,y){g.preventDefault(),y&&"file"in y?this.updateFile():this.updateAttachment()}_startEditAttachment(g){const{viewModel:y}=this;y.activeFileInfo=null,y.activeAttachmentInfo=g,y.mode="edit"}_startEditFile(g){const{viewModel:y}=this;y.activeAttachmentInfo=null,y.activeFileInfo=g,y.mode="edit"}_startAddAttachment(){this.viewModel.mode="add"}_cancelForm(g){g.preventDefault(),this.viewModel.mode="view"}_getCSSTransform(g){const{orientationInfo:y}=g;return!this._supportsImageOrientation&&y?[y.rotation?`rotate(${y.rotation}deg)`:"",y.mirrored?"scaleX(-1)":""].join(" "):""}};(0,I._)([(0,x.Cb)()],st.prototype,"capabilities",null),(0,I._)([(0,x.Cb)()],st.prototype,"displayType",void 0),(0,I._)([(0,x.Cb)({readOnly:!0})],st.prototype,"effectiveDisplayType",null),(0,I._)([(0,x.Cb)()],st.prototype,"graphic",null),(0,I._)([(0,x.Cb)()],st.prototype,"label",null),(0,I._)([(0,x.Cb)(),(0,pt.H)("esri/widgets/Attachments/t9n/Attachments")],st.prototype,"messages",void 0),(0,I._)([(0,x.Cb)(),(0,pt.H)("esri/core/t9n/Units")],st.prototype,"messagesUnits",void 0),(0,I._)([(0,x.Cb)({readOnly:!0})],st.prototype,"selectedFile",void 0),(0,I._)([(0,x.Cb)({readOnly:!0})],st.prototype,"submitting",void 0),(0,I._)([(0,x.Cb)({readOnly:!0})],st.prototype,"error",void 0),(0,I._)([(0,x.Cb)({type:Hi})],st.prototype,"viewModel",void 0),(0,I._)([(0,x.Cb)()],st.prototype,"visibleElements",void 0),(0,I._)([(0,D.p)("visibleElements")],st.prototype,"castVisibleElements",null),st=(0,I._)([(0,re.j)("esri.widgets.Attachments")],st);const Wo=st;let di=class extends Hi{constructor(g){super(g),this.description=null,this.title=null}};(0,I._)([(0,x.Cb)()],di.prototype,"description",void 0),(0,I._)([(0,x.Cb)()],di.prototype,"title",void 0),di=(0,I._)([(0,re.j)("esri.widgets.Feature.FeatureAttachments.FeatureAttachmentsViewModel")],di);const Gi=di;var Ki=F(13065);const Qi="esri-feature-element-info",Xi={base:Qi,title:`${Qi}__title`,description:`${Qi}__description`};let Qt=class extends Y.Z{constructor(g,y){super(g,y),this.description=null,this.headingLevel=2,this.title=null}render(){return(0,O.u)("div",{class:Xi.base},this._renderTitle(),this._renderDescription())}_renderTitle(){const{title:g}=this;return g?(0,O.u)(Ki.X,{class:Xi.title,level:this.headingLevel},g):null}_renderDescription(){const{description:g}=this;return g?(0,O.u)("div",{class:Xi.description,key:"description"},g):null}};(0,I._)([(0,x.Cb)()],Qt.prototype,"description",void 0),(0,I._)([(0,x.Cb)()],Qt.prototype,"headingLevel",void 0),(0,I._)([(0,x.Cb)()],Qt.prototype,"title",void 0),Qt=(0,I._)([(0,re.j)("esri.widgets.Feature.support.FeatureElementInfo")],Qt);const wi=Qt;let Ft=class extends Y.Z{constructor(g,y){super(g,y),this._featureElementInfo=null,this.attachmentsWidget=new Wo,this.headingLevel=2,this.viewModel=new Gi}initialize(){this._featureElementInfo=new wi,this.addHandles([(0,N.YP)(()=>[this.viewModel?.description,this.viewModel?.title,this.headingLevel],()=>this._setupFeatureElementInfo(),N.nn),(0,N.YP)(()=>this.viewModel,g=>this.attachmentsWidget.viewModel=g,N.nn)])}destroy(){this.attachmentsWidget.viewModel=null,this.attachmentsWidget.destroy(),this._featureElementInfo?.destroy()}get description(){return this.viewModel.description}set description(g){this.viewModel.description=g}get displayType(){return this.attachmentsWidget.displayType}set displayType(g){this.attachmentsWidget.displayType=g}get graphic(){return this.viewModel.graphic}set graphic(g){this.viewModel.graphic=g}get title(){return this.viewModel.title}set title(g){this.viewModel.title=g}render(){const{attachmentsWidget:g}=this;return(0,O.u)("div",{class:"esri-feature-attachments"},this._featureElementInfo?.render(),g?.render())}_setupFeatureElementInfo(){const{description:g,title:y,headingLevel:v}=this;this._featureElementInfo?.set({description:g,title:y,headingLevel:v})}};(0,I._)([(0,x.Cb)({readOnly:!0})],Ft.prototype,"attachmentsWidget",void 0),(0,I._)([(0,x.Cb)()],Ft.prototype,"description",null),(0,I._)([(0,x.Cb)()],Ft.prototype,"displayType",null),(0,I._)([(0,x.Cb)()],Ft.prototype,"graphic",null),(0,I._)([(0,x.Cb)()],Ft.prototype,"headingLevel",void 0),(0,I._)([(0,x.Cb)()],Ft.prototype,"title",null),(0,I._)([(0,x.Cb)({type:Gi})],Ft.prototype,"viewModel",void 0),Ft=(0,I._)([(0,re.j)("esri.widgets.Feature.FeatureAttachments")],Ft);const Yo=Ft;let Rt=class extends lt.Z{constructor(g){super(g),this._loadingPromise=null,this.created=null,this.creator=null,this.destroyer=null,this.graphic=null,this.addHandles((0,N.YP)(()=>this.creator,y=>{this._destroyContent(),this._createContent(y)},N.nn))}destroy(){this._destroyContent()}get state(){return this._loadingPromise?"loading":"ready"}_destroyContent(){const{created:g,graphic:y,destroyer:v}=this;g&&y&&(bi(v,{graphic:y}).catch(()=>null),this._set("created",null))}_createContent(g){var y=this;return(0,z.Z)(function*(){const v=y.graphic;if(!v||!g)return;const b=bi(g,{graphic:v}).catch(()=>null);y._loadingPromise=b,y.notifyChange("state");const w=yield b;b===y._loadingPromise&&(y._loadingPromise=null,y.notifyChange("state"),y._set("created",w))})()}};(0,I._)([(0,x.Cb)({readOnly:!0})],Rt.prototype,"created",void 0),(0,I._)([(0,x.Cb)()],Rt.prototype,"creator",void 0),(0,I._)([(0,x.Cb)()],Rt.prototype,"destroyer",void 0),(0,I._)([(0,x.Cb)({type:at.Z})],Rt.prototype,"graphic",void 0),(0,I._)([(0,x.Cb)({readOnly:!0})],Rt.prototype,"state",null),Rt=(0,I._)([(0,re.j)("esri.widgets.Feature.FeatureContent.FeatureContentViewModel")],Rt);const Mi=Rt;var Ji=F(13777);const qi="esri-feature-content",en={base:qi,loaderContainer:`${qi}__loader-container`,loader:`${qi}__loader`};let Xt=class extends Y.Z{constructor(g,y){super(g,y),this.viewModel=null,this._addTargetToAnchors=v=>{Array.from(v.querySelectorAll("a")).forEach(b=>{Qn(b.href)&&!b.hasAttribute("target")&&b.setAttribute("target","_blank")})}}get creator(){return this.viewModel?.creator}set creator(g){this.viewModel&&(this.viewModel.creator=g)}get graphic(){return this.viewModel?.graphic}set graphic(g){this.viewModel&&(this.viewModel.graphic=g)}render(){const g=this.viewModel?.state;return(0,O.u)("div",{class:en.base},"loading"===g?this._renderLoading():this._renderCreated())}_renderLoading(){return(0,O.u)("div",{class:en.loaderContainer,key:"loader"},(0,O.u)("div",{class:en.loader}))}_renderCreated(){const g=this.viewModel?.created;return g?g instanceof HTMLElement?(0,O.u)("div",{afterCreate:this._attachToNode,bind:g,key:g}):(0,Ji.Qd)(g)?(0,O.u)("div",{key:g},!g.destroyed&&g.render()):(0,O.u)("div",{afterCreate:this._addTargetToAnchors,innerHTML:g,key:g}):null}_attachToNode(g){g.appendChild(this)}};(0,I._)([(0,x.Cb)()],Xt.prototype,"creator",null),(0,I._)([(0,x.Cb)()],Xt.prototype,"graphic",null),(0,I._)([(0,x.Cb)({type:Mi})],Xt.prototype,"viewModel",void 0),Xt=(0,I._)([(0,re.j)("esri.widgets.Feature.FeatureContent")],Xt);const Ci=Xt;var Go=F(38439),cs=F(25621);let At=class extends lt.Z{constructor(g){super(g),this.attributes=null,this.expressionInfos=null,this.description=null,this.fieldInfos=null,this.title=null}get formattedFieldInfos(){const{expressionInfos:g,fieldInfos:y}=this,v=[];return y?.forEach(b=>{if(b.hasOwnProperty("visible")&&!b.visible)return;const w=b.clone();w.label=Xn(w,g),v.push(w)}),v}};(0,I._)([(0,x.Cb)()],At.prototype,"attributes",void 0),(0,I._)([(0,x.Cb)({type:[Go.Z]})],At.prototype,"expressionInfos",void 0),(0,I._)([(0,x.Cb)()],At.prototype,"description",void 0),(0,I._)([(0,x.Cb)({type:[cs.Z]})],At.prototype,"fieldInfos",void 0),(0,I._)([(0,x.Cb)({readOnly:!0})],At.prototype,"formattedFieldInfos",null),(0,I._)([(0,x.Cb)()],At.prototype,"title",void 0),At=(0,I._)([(0,re.j)("esri.widgets.Feature.FeatureFields.FeatureFieldsViewModel")],At);const Fi=At,Ko=[{pattern:/^\s*(https?:\/\/([^\s]+))\s*$/i,target:"_blank",label:"{messages.view}"},{pattern:/^\s*(tel:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(mailto:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(arcgis-appstudio-player:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"App Studio Player"},{pattern:/^\s*(arcgis-collector:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Collector"},{pattern:/^\s*(arcgis-explorer:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Explorer"},{pattern:/^\s*(arcgis-navigator:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Navigator"},{pattern:/^\s*(arcgis-survey123:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Survey123"},{pattern:/^\s*(arcgis-trek2there:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Trek2There"},{pattern:/^\s*(arcgis-workforce:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Workforce"},{pattern:/^\s*(iform:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"iForm"},{pattern:/^\s*(flow:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"FlowFinity"},{pattern:/^\s*(lfmobile:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Laserfische"},{pattern:/^\s*(mspbi:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Microsoft Power Bi"}];const Ii="esri-feature-fields",_i={base:Ii,fieldHeader:`${Ii}__field-header`,fieldData:`${Ii}__field-data`,fieldDataDate:`${Ii}__field-data--date`};let Ct=class extends Y.Z{constructor(g,y){super(g,y),this._featureElementInfo=null,this.viewModel=new Fi,this.messages=null,this.messagesURIUtils=null}initialize(){this._featureElementInfo=new wi,this.addHandles((0,N.YP)(()=>[this.viewModel?.description,this.viewModel?.title],()=>this._setupFeatureElementInfo(),N.nn))}destroy(){this._featureElementInfo?.destroy()}get attributes(){return this.viewModel.attributes}set attributes(g){this.viewModel.attributes=g}get description(){return this.viewModel.description}set description(g){this.viewModel.description=g}get expressionInfos(){return this.viewModel.expressionInfos}set expressionInfos(g){this.viewModel.expressionInfos=g}get fieldInfos(){return this.viewModel.fieldInfos}set fieldInfos(g){this.viewModel.fieldInfos=g}get title(){return this.viewModel.title}set title(g){this.viewModel.title=g}render(){return(0,O.u)("div",{class:_i.base},this._featureElementInfo?.render(),this._renderFields())}_renderFieldInfo(g,y){const{attributes:v}=this.viewModel,b=g.fieldName,w=g.label||b,M=v?null==v[b]?"":v[b]:"",C=!(!g.format||!g.format.dateFormat),A="number"!=typeof M||C?function Xo(g,y){if("string"!=typeof y||!y)return y;const v=function Qo(g){let y=null;return Ko.some(v=>(v.pattern.test(g)&&(y=v),!!y)),y}(y);if(!v)return y;const b=y.match(v.pattern),M=(0,U.gx)((0,U.gx)(v.label,{messages:g,hierPart:b&&b[2]}),{appName:v.appName});return y.replace(v.pattern,`<a${v.target?` target="${v.target}"`:""} href="$1"${"_blank"===v.target?' rel="noreferrer"':""}>${M}</a>`)}(this.messagesURIUtils,M):this._forceLTR(M),T={[_i.fieldDataDate]:C};return(0,O.u)("tr",{key:`fields-element-info-row-${b}-${y}`},(0,O.u)("th",{class:_i.fieldHeader,innerHTML:w,key:`fields-element-info-row-header-${b}-${y}`}),(0,O.u)("td",{class:this.classes(_i.fieldData,T),innerHTML:A,key:`fields-element-info-row-data-${b}-${y}`}))}_renderFields(){const{formattedFieldInfos:g}=this.viewModel;return g?.length?(0,O.u)("table",{class:be.z.table,summary:this.messages.fieldsSummary},(0,O.u)("tbody",null,g.map((y,v)=>this._renderFieldInfo(y,v)))):null}_setupFeatureElementInfo(){const{description:g,title:y}=this;this._featureElementInfo?.set({description:g,title:y})}_forceLTR(g){return`&lrm;${g}`}};(0,I._)([(0,x.Cb)()],Ct.prototype,"attributes",null),(0,I._)([(0,x.Cb)()],Ct.prototype,"description",null),(0,I._)([(0,x.Cb)()],Ct.prototype,"expressionInfos",null),(0,I._)([(0,x.Cb)()],Ct.prototype,"fieldInfos",null),(0,I._)([(0,x.Cb)()],Ct.prototype,"title",null),(0,I._)([(0,x.Cb)({type:Fi,nonNullable:!0})],Ct.prototype,"viewModel",void 0),(0,I._)([(0,x.Cb)(),(0,pt.H)("esri/widgets/Feature/t9n/Feature")],Ct.prototype,"messages",void 0),(0,I._)([(0,x.Cb)(),(0,pt.H)("esri/widgets/support/t9n/uriUtils")],Ct.prototype,"messagesURIUtils",void 0),Ct=(0,I._)([(0,re.j)("esri.widgets.Feature.FeatureFields")],Ct);const hs=Ct;var qo=F(88159);const or={maximumFractionDigits:20};F(8029);var vt=F(86606),ms=F(91558);F(20383),F(52068);const ar="<",lr=">";const cr=new ms.Z([64,64,64]);function fs(g,y){const v=[],b=g.length-1;return 5===g.length?v.push(0,2,4):v.push(0,b),g.map((w,M)=>v.includes(M)?function dr(g,y,v,b){let w="";return 0===y?w=`${ar} `:y===v&&(w=`${lr} `),w+(b?(0,vi.$8)(g,b):function rr(g){return(0,E.uf)(g,or)}(g))}(w,M,b,y):null)}function hr(g,y,v){return sn.apply(this,arguments)}function sn(){return sn=(0,z.Z)(function*(g,y,v){let b=!1,w=[],M=[];if(g.stops){const P=g.stops;w=P.map(R=>R.value),b=P.some(R=>!!R.label),b&&(M=P.map(R=>R.label))}if(null==w[0]&&null==w[w.length-1])return null;const T=b?null:fs(w,v);return(yield Promise.all(w.map(function(){var P=(0,z.Z)(function*(R,V){return{value:R,color:"opacity"===g.type?yield pr(R,g,y):(yield Promise.resolve().then(F.bind(F,81808))).getColor(g,R),label:b?M[V]:T?.[V]??""}});return function(R,V){return P.apply(this,arguments)}}()))).reverse()}),sn.apply(this,arguments)}function pr(g,y,v){return on.apply(this,arguments)}function on(){return(on=(0,z.Z)(function*(g,y,v){const b=new ms.Z(v??cr),w=(yield Promise.resolve().then(F.bind(F,81808))).getOpacity(y,g);return null!=w&&(b.a=w),b})).apply(this,arguments)}var gr=F(52372);function ft(g,y,v){return rn.apply(this,arguments)}function rn(){return(rn=(0,z.Z)(function*(g,y,v){(0,qo.s1)(g,y,()=>[]).push(...v)})).apply(this,arguments)}function an(){return(an=(0,z.Z)(function*(g){const y=new Map;if(!g)return y;if("visualVariables"in g&&g.visualVariables){const v=g.visualVariables.filter(b=>"color"===b.type);for(const b of v){const w=((yield hr(b))??[]).map(M=>M.color);yield ft(y,b.field||b.valueExpression,w)}}if("heatmap"===g.type){const v=function yr(g){if(!g.colorStops)return[];const y=[...g.colorStops].filter(b=>b.color?.a>0);let v=y.length-1;if(y&&y[0]){const b=y[v];b&&1!==b.ratio&&(y.push(new gr.Z({ratio:1,color:b.color})),v++)}return y.map((b,w)=>{let M="";return 0===w?M=g.legendOptions?.minLabel||"low":w===v&&(M=g.legendOptions?.maxLabel||"high"),{color:b.color,label:M,ratio:b.ratio}}).reverse()}(g).map(b=>b.color);yield ft(y,g.field||g.valueExpression,v)}else if("pie-chart"===g.type){for(const v of g.attributes)yield ft(y,v.field||v.valueExpression,[v.color]);yield ft(y,"default",[g?.othersCategory?.color,(0,vt._h)(g.backgroundFillSymbol,null)])}else if("dot-density"===g.type){for(const v of g.attributes)yield ft(y,v.field||v.valueExpression,[v.color]);yield ft(y,"default",[g.backgroundColor])}else if("unique-value"===g.type)if("predominance"===g.authoringInfo?.type)for(const v of g.uniqueValueInfos??[])yield ft(y,v.value.toString(),[(0,vt._h)(v.symbol,null)]);else{const v=(g.uniqueValueInfos??[]).map(A=>(0,vt._h)(A.symbol,null)),{field:b,field2:w,field3:M,valueExpression:C}=g;(b||C)&&(yield ft(y,b||C,v)),w&&(yield ft(y,w,v)),M&&(yield ft(y,M,v))}else if("class-breaks"===g.type){const v=g.classBreakInfos.map(M=>(0,vt._h)(M.symbol,null)),{field:b,valueExpression:w}=g;yield ft(y,b??w,v)}else"simple"===g.type&&(yield ft(y,"default",[(0,vt._h)(g.symbol,null)]));return"defaultSymbol"in g&&g.defaultSymbol&&(yield ft(y,"default",[(0,vt._h)(g.defaultSymbol,null)])),y.forEach((v,b)=>{const w=(0,$e.Tw)(v.filter(Boolean),(M,C)=>JSON.stringify(M)===JSON.stringify(C));y.set(b,w)}),y})).apply(this,arguments)}Ze.Z.getLogger("esri.renderers.support.utils"),(0,Gt.Ze)("short-date");var Ir=F(77891),_r=F(84792),it=F(10699),un=(F(15283),F(2865)),Ar=(F(59318),F(24263),F(21726),F(92383),F(37053),F(82054),F(2004),F(21674),F(72854),F(72642)),cn=(F(37118),F(55214),F(93555),F(24192),F(17253),F(96854)),hn=(F(29132),F(67010)),xr=(F(6871),F(60776));const vs=Ze.Z.getLogger("esri.widgets.Feature.support.relatedFeatureUtils"),bs=new Map;function Ai(g){if(!_t(g))return null;const[y,v]=g.split("/").slice(1);return{layerId:y,fieldName:v}}function pn(){return(pn=(0,z.Z)(function*(g,y,v,b){const w=v.layerId.toString(),{layerInfo:M,relation:C,relatedFields:A,outStatistics:T,url:P,sourceSpatialReference:R}=y,V=function Zr(g){return g?(0,$e.Tw)(g):void 0}(A),B=function Vr(g){return g?(0,$e.Tw)(g,(y,v)=>JSON.stringify(y.toJSON())===JSON.stringify(v.toJSON())):void 0}(T);if(!M||!C)return null;const k=function Tr({originRelationship:g,relationships:y,layerId:v}){let b=null;return y&&y.some(w=>(`${w.relatedTableId}`===v&&w.id===g?.id&&(b=w),!!b)),b}({originRelationship:C,relationships:M.relationships,layerId:w});if(k?.relationshipTableId&&k.keyFieldInRelationshipTable){const J=(yield function Or(g,y,v,b){const w=new hn.default;return w.outFields=["*"],w.relationshipId="number"==typeof y.id?y.id:parseInt(y.id,10),w.objectIds=[g.attributes[v.objectIdField]],v.queryRelatedFeatures?.(w,b)??Promise.resolve({})}(g,k,v,b))[g.attributes[v.objectIdField]];if(!J)return null;const ie=J.features.map(ue=>ue.attributes[M.objectIdField]);if(B?.length&&M.supportsStatistics){const ue=new cn.Z;ue.where=function Sr(g,y,v){let b=0;const w=[];for(;b<y.length;)w.push(`${g} IN (${y.slice(b,v+b)})`),b+=v;return w.join(" OR ")}(M.objectIdField,ie,1e3),ue.outFields=V,ue.outStatistics=B,ue.sourceSpatialReference=R;const Fe={features:Promise.resolve(J),statsFeatures:(0,un.e)(P,ue)};return(0,it.as)(Fe)}}const H=k?.keyField;if(H){const J=(0,Vt.H7)(function jr(g,y){if(null!=g){y=y.toLowerCase();for(const v of g)if(v&&v.name.toLowerCase()===y)return v}return null}(M.fields,H)),ie=function Pr(g,y){const v=y.toLowerCase();for(const b in g)if(b.toLowerCase()===v)return g[b];return null}(g.attributes,C.keyField),ue=J?`${H}=${ie}`:`${H}='${ie}'`,Fe=(0,un.e)(P,new cn.Z({where:ue,outFields:V,sourceSpatialReference:R}),b),se=B?.length&&M.supportsStatistics?(0,un.e)(P,new cn.Z({where:ue,outFields:V,outStatistics:B,sourceSpatialReference:R}),b):null,Ne={features:Fe};return se&&(Ne.statsFeatures=se),(0,it.as)(Ne)}return null})).apply(this,arguments)}const ws={chartAnimation:!0};let Xe=class extends lt.Z{constructor(g){super(g),this.abilities={...ws},this.activeMediaInfoIndex=0,this.attributes=null,this.description=null,this.fieldInfoMap=null,this.formattedAttributes=null,this.expressionAttributes=null,this.isAggregate=!1,this.layer=null,this.mediaInfos=null,this.popupTemplate=null,this.relatedInfos=null,this.title=null}castAbilities(g){return{...ws,...g}}get activeMediaInfo(){return this.formattedMediaInfos[this.activeMediaInfoIndex]||null}get formattedMediaInfos(){return this._formatMediaInfos()||[]}get formattedMediaInfoCount(){return this.formattedMediaInfos.length}setActiveMedia(g){this._setContentElementMedia(g)}next(){this._pageContentElementMedia(1)}previous(){this._pageContentElementMedia(-1)}_setContentElementMedia(g){const{formattedMediaInfoCount:y}=this;this.activeMediaInfoIndex=(g+y)%y}_pageContentElementMedia(g){const{activeMediaInfoIndex:y}=this;this._setContentElementMedia(y+g)}_formatMediaInfos(){const{mediaInfos:g,layer:y}=this,v=this.attributes??{},b=this.formattedAttributes??{},w=this.expressionAttributes??{},M=this.fieldInfoMap??new Map;return g?.map(C=>{const A=C?.clone();if(!A)return null;if(A.title=$t({attributes:v,fieldInfoMap:M,globalAttributes:b,expressionAttributes:w,layer:y,text:A.title}),A.caption=$t({attributes:v,fieldInfoMap:M,globalAttributes:b,expressionAttributes:w,layer:y,text:A.caption}),A.altText=$t({attributes:v,fieldInfoMap:M,globalAttributes:b,expressionAttributes:w,layer:y,text:A.altText}),"image"===A.type){const{value:T}=A;return this._setImageValue({value:T,formattedAttributes:b,layer:y}),A.value.sourceURL?A:void 0}if("pie-chart"===A.type||"line-chart"===A.type||"column-chart"===A.type||"bar-chart"===A.type){const{value:T}=A;return this._setChartValue({value:T,chartType:A.type,attributes:v,formattedAttributes:b,layer:y,expressionAttributes:w}),A}return null}).filter($e.pC)??[]}_setImageValue(g){const y=this.fieldInfoMap??new Map,{value:v,formattedAttributes:b,layer:w}=g,{linkURL:M,sourceURL:C}=v;if(C){const A=$i(C,w);v.sourceURL=Vi({formattedAttributes:b,template:A,fieldInfoMap:y})}if(M){const A=$i(M,w);v.linkURL=Vi({formattedAttributes:b,template:A,fieldInfoMap:y})}}_setChartValue(g){const{value:y,attributes:v,formattedAttributes:b,chartType:w,layer:M,expressionAttributes:C}=g,{popupTemplate:A,relatedInfos:T}=this,{fields:P,normalizeField:R}=y,V=M;if(y.fields=function Co(g,y){return g&&g.map(v=>ai(v,y))}(P,V),R&&(y.normalizeField=ai(R,V)),!P.some(k=>!!(null!=b[k]||_t(k)&&T?.size)))return;const B=A?.fieldInfos??[];P.forEach((k,H)=>{const J=y.colors?.[H];if(_t(k))return void(y.series=[...y.series,...this._getRelatedChartInfos({fieldInfos:B,fieldName:k,formattedAttributes:b,chartType:w,value:y,color:J})]);const ie=this._getChartOption({value:y,attributes:v,chartType:w,formattedAttributes:b,expressionAttributes:C,fieldName:k,fieldInfos:B,color:J});y.series.push(ie)})}_getRelatedChartInfos(g){const{fieldInfos:y,fieldName:v,formattedAttributes:b,chartType:w,value:M,color:C}=g,A=[],T=Ai(v),P=T&&this.relatedInfos?.get(T.layerId.toString());if(!P)return A;const{relatedFeatures:R,relation:V}=P;if(!V||!R)return A;const{cardinality:B}=V;return R.forEach(k=>{const{attributes:H}=k;H&&Object.keys(H).forEach(J=>{J===T.fieldName&&A.push(this._getChartOption({value:M,attributes:H,formattedAttributes:b,fieldName:v,chartType:w,relatedFieldName:J,hasMultipleRelatedFeatures:R?.length>1,fieldInfos:y,color:C}))})}),"one-to-many"===B||"many-to-many"===B?A:[A[0]]}_getTooltip({label:g,value:y,chartType:v}){return"pie-chart"===v?`${g}`:`${g}: ${y}`}_getChartOption(g){const{value:y,attributes:v,formattedAttributes:b,expressionAttributes:w,fieldName:M,relatedFieldName:C,fieldInfos:A,chartType:T,hasMultipleRelatedFeatures:P,color:R}=g,V=this.layer,B=this.fieldInfoMap??new Map,{normalizeField:k,tooltipField:H}=y,J=k?_t(k)?v[Ai(k).fieldName]:v[k]:null,ie=Si(M)&&w&&void 0!==w[M]?w[M]:C&&void 0!==v[C]?v[C]:void 0!==v[M]?v[M]:b[M],ue=new Ir.Z({fieldName:M,color:R,value:void 0===ie?null:ie&&J?ie/J:ie});if(_t(M)){const rt=B.get(M.toLowerCase()),wt=H&&B.get(H.toLowerCase()),Pi=rt?.fieldName??M,yi=P&&H?Ai(H).fieldName:wt?.fieldName??H;return ue.tooltip=this._getTooltip({label:P&&yi?v[yi]:b[yi]??rt?.label??rt?.fieldName??C,value:P&&C?v[C]:b[Pi],chartType:T}),ue}const Fe=qn(A,M),se=ai(M,V),Ne=H&&void 0!==b[H]?b[H]:Xn(Fe||new cs.Z({fieldName:se}),this.popupTemplate?.expressionInfos);return ue.tooltip=this._getTooltip({label:Ne,value:b[se],chartType:T}),ue}};(0,I._)([(0,x.Cb)()],Xe.prototype,"abilities",void 0),(0,I._)([(0,D.p)("abilities")],Xe.prototype,"castAbilities",null),(0,I._)([(0,x.Cb)()],Xe.prototype,"activeMediaInfoIndex",void 0),(0,I._)([(0,x.Cb)({readOnly:!0})],Xe.prototype,"activeMediaInfo",null),(0,I._)([(0,x.Cb)()],Xe.prototype,"attributes",void 0),(0,I._)([(0,x.Cb)()],Xe.prototype,"description",void 0),(0,I._)([(0,x.Cb)()],Xe.prototype,"fieldInfoMap",void 0),(0,I._)([(0,x.Cb)()],Xe.prototype,"formattedAttributes",void 0),(0,I._)([(0,x.Cb)()],Xe.prototype,"expressionAttributes",void 0),(0,I._)([(0,x.Cb)({readOnly:!0})],Xe.prototype,"formattedMediaInfos",null),(0,I._)([(0,x.Cb)()],Xe.prototype,"isAggregate",void 0),(0,I._)([(0,x.Cb)()],Xe.prototype,"layer",void 0),(0,I._)([(0,x.Cb)({readOnly:!0})],Xe.prototype,"formattedMediaInfoCount",null),(0,I._)([(0,x.Cb)()],Xe.prototype,"mediaInfos",void 0),(0,I._)([(0,x.Cb)()],Xe.prototype,"popupTemplate",void 0),(0,I._)([(0,x.Cb)()],Xe.prototype,"relatedInfos",void 0),(0,I._)([(0,x.Cb)()],Xe.prototype,"title",void 0),Xe=(0,I._)([(0,re.j)("esri.widgets.Feature.FeatureMedia.FeatureMediaViewModel")],Xe);const Nt=Xe;var kr=F(64183),It=F(97059);const Je="esri-feature-media",dt={base:Je,mediaContainer:`${Je}__container`,mediaItemContainer:`${Je}__item-container`,mediaItem:`${Je}__item`,mediaItemText:`${Je}__item-text`,mediaItemTitle:`${Je}__item-title`,mediaItemCaption:`${Je}__item-caption`,mediaNavigation:`${Je}__item-navigation`,mediaPagination:`${Je}__pagination`,mediaPaginationText:`${Je}__pagination-text`,mediaPrevious:`${Je}__previous`,mediaPreviousIconLTR:`${Je}__previous-icon`,mediaPreviousIconRTL:`${Je}__previous-icon--rtl`,mediaNext:`${Je}__next`,mediaNextIconLTR:`${Je}__next-icon`,mediaNextIconRTL:`${Je}__next-icon--rtl`,mediaChart:`${Je}__chart`,mediaPaginationButton:`${Je}__pagination-button`,mediaPaginationIcon:`${Je}__pagination-icon`,mediaChartRendered:`${Je}__chart--rendered`},Ut="category",hi="value";let ut=class extends Y.Z{constructor(g,y){var v;super(g,y),v=this,this._refreshTimer=null,this._refreshIntervalInfo=null,this._featureElementInfo=null,this._chartRootMap=new WeakMap,this.viewModel=new Nt,this.messages=null,this._disposeChart=b=>{this._chartRootMap.get(b)?.dispose(),this._chartRootMap.delete(b)},this._createChart=function(){var b=(0,z.Z)(function*(w){const{destroyed:M,viewModel:C}=v;if(M||!C||!w)return;const{createRoot:A}=yield Promise.all([F.e(8670),F.e(8592),F.e(8230)]).then(F.bind(F,48230)),T=yield A(w);v._chartRootMap.set(w,T),v._renderChart({mediaInfo:C.activeMediaInfo,root:T})});return function(w){return b.apply(this,arguments)}}()}initialize(){this._featureElementInfo=new wi,this.addHandles([(0,N.YP)(()=>[this.viewModel?.activeMediaInfo,this.viewModel?.activeMediaInfoIndex],()=>this._setupMediaRefreshTimer(),N.nn),(0,N.YP)(()=>[this.viewModel?.description,this.viewModel?.title],()=>this._setupFeatureElementInfo(),N.nn)])}loadDependencies(){return(0,Kt.h)({icon:()=>F.e(8472).then(F.bind(F,8472))})}destroy(){this._clearMediaRefreshTimer(),this._featureElementInfo?.destroy()}get attributes(){return this.viewModel.attributes}set attributes(g){this.viewModel.attributes=g}get activeMediaInfoIndex(){return this.viewModel.activeMediaInfoIndex}set activeMediaInfoIndex(g){this.viewModel.activeMediaInfoIndex=g}get description(){return this.viewModel.description}set description(g){this.viewModel.description=g}get fieldInfoMap(){return this.viewModel.fieldInfoMap}set fieldInfoMap(g){this.viewModel.fieldInfoMap=g}get layer(){return this.viewModel.layer}set layer(g){this.viewModel.layer=g}get mediaInfos(){return this.viewModel.mediaInfos}set mediaInfos(g){this.viewModel.mediaInfos=g}get popupTemplate(){return this.viewModel.popupTemplate}set popupTemplate(g){this.viewModel.popupTemplate=g}get relatedInfos(){return this.viewModel.relatedInfos}set relatedInfos(g){this.viewModel.relatedInfos=g}get title(){return this.viewModel.title}set title(g){this.viewModel.title=g}render(){return(0,O.u)("div",{bind:this,class:dt.base,onkeyup:this._handleMediaKeyup},this._featureElementInfo?.render(),this._renderMedia())}_renderMedia(){const{formattedMediaInfoCount:g,activeMediaInfoIndex:y}=this.viewModel,v=this._renderMediaText();return g?(0,O.u)("div",{class:dt.mediaContainer,key:"media-element-container"},this._renderMediaInfo(),(0,O.u)("div",{class:dt.mediaNavigation},v,g>1?(0,O.u)("div",{class:dt.mediaPagination},this._renderMediaPageButton("previous"),(0,O.u)("span",{class:dt.mediaPaginationText},(0,It.n)(this.messages.pageText,{index:y+1,total:g})),this._renderMediaPageButton("next")):null)):null}_renderMediaText(){const{activeMediaInfo:g}=this.viewModel;if(!g)return null;const y=g&&g.title?(0,O.u)("div",{class:dt.mediaItemTitle,innerHTML:g.title,key:"media-title"}):null,v=g&&g.caption?(0,O.u)("div",{class:dt.mediaItemCaption,innerHTML:g.caption,key:"media-caption"}):null;return y||v?(0,O.u)("div",{class:dt.mediaItemText,key:"media-text"},y,v):null}_renderImageMediaInfo(g){const{_refreshIntervalInfo:y}=this,{activeMediaInfoIndex:v,formattedMediaInfoCount:b}=this.viewModel,{value:w,refreshInterval:M,altText:C,title:A,type:T}=g,{sourceURL:P,linkURL:R}=w,V=Qn(R??void 0)?"_blank":"_self",B="_blank"===V?"noreferrer":"",k=M?y:null,ie=(0,O.u)("img",{alt:C||A,key:`media-${T}-${v}-${b}-${k?k.timestamp:0}`,src:(k?k.sourceURL:P)??void 0});return(R?(0,O.u)("a",{href:R,rel:B,target:V,title:A},ie):null)??ie}_renderChartMediaInfo(g){const{activeMediaInfoIndex:y,formattedMediaInfoCount:v}=this.viewModel;return(0,O.u)("div",{afterCreate:this._createChart,afterRemoved:this._disposeChart,bind:this,class:dt.mediaChart,key:`media-${g.type}-${y}-${v}`})}_renderMediaInfoType(){const{activeMediaInfo:g}=this.viewModel;return g?"image"===g.type?this._renderImageMediaInfo(g):g.type.includes("chart")?this._renderChartMediaInfo(g):null:null}_renderMediaInfo(){const{activeMediaInfo:g}=this.viewModel;return g?(0,O.u)("div",{class:dt.mediaItemContainer,key:"media-container"},(0,O.u)("div",{class:dt.mediaItem,key:"media-item-container"},this._renderMediaInfoType())):null}_renderMediaPageButton(g){if(this.viewModel.formattedMediaInfoCount<2)return null;const y="previous"===g,v=y?this.messages.previous:this.messages.next;return(0,O.u)("button",{"aria-label":v,bind:this,class:dt.mediaPaginationButton,key:y?"media-previous":"media-next",onclick:y?this._previous:this._next,tabIndex:0,title:v,type:"button"},(0,O.u)("calcite-icon",{class:dt.mediaPaginationIcon,icon:y?"chevron-left":"chevron-right",scale:"s"}))}_setupFeatureElementInfo(){const{description:g,title:y}=this;this._featureElementInfo?.set({description:g,title:y})}_next(){this.viewModel.next()}_previous(){this.viewModel.previous()}_getRenderer(){if(!this.viewModel)return;const{isAggregate:g,layer:y}=this.viewModel;return g&&y?.featureReduction&&"renderer"in y.featureReduction?y.featureReduction.renderer:y?.renderer}_getSeriesColors(g){return(0,z.Z)(function*(){const{colorAm5:y}=yield Promise.all([F.e(8670),F.e(8592),F.e(31)]).then(F.bind(F,90031)),v=new Map;return g.forEach(b=>{b.color&&v.set(b,y(b.color.toCss(!0)))}),v})()}_getRendererColors(){var g=this;return(0,z.Z)(function*(){const{colorAm5:y}=yield Promise.all([F.e(8670),F.e(8592),F.e(31)]).then(F.bind(F,90031)),v=new Map,b=g._getRenderer();if(!b)return v;const M=yield function wr(g){return an.apply(this,arguments)}(b);return M.delete("default"),Array.from(M.values()).every(C=>1===C?.length)&&Array.from(M.keys()).forEach(C=>{const A=M.get(C)?.[0]?.toCss(!0);A&&v.set(C,y(A))}),v})()}_handleMediaKeyup(g){const y=(0,ke.kK)(g);"ArrowLeft"===y&&(g.stopPropagation(),this.viewModel.previous()),"ArrowRight"===y&&(g.stopPropagation(),this.viewModel.next())}_canAnimateChart(){return!!this.viewModel&&!!this.viewModel.abilities.chartAnimation&&!window.matchMedia("(prefers-reduced-motion: reduce)").matches}_getChartAnimationMS(){return this._canAnimateChart()?250:0}_getChartSeriesAnimationMS(){return this._canAnimateChart()?500:0}_renderChart(g){var y=this;return(0,z.Z)(function*(){const{root:v,mediaInfo:b}=g,{value:w,type:M}=b,{ResponsiveThemeAm5:C,DarkThemeAm5:A,AnimatedThemeAm5:T,ColorSetAm5:P,ThemeAm5:R,esriChartColorSet:V}=yield Promise.all([F.e(8670),F.e(8592),F.e(31)]).then(F.bind(F,90031)),B=R.new(v);B.rule("ColorSet").set("colors",V),B.rule("ColorSet").set("reuse",!0);const k=[C.new(v),B];(0,kr.$o)()&&k.push(A.new(v)),y._canAnimateChart()&&k.push(T.new(v)),v.setThemes(k);const H=yield y._getRendererColors(),J=yield y._getSeriesColors(w.series),ie=P.new(v,{}),ue=J.get(w.series[0]),Fe=ue?{lineSettings:{stroke:ue}}:void 0,se=w.series.map((Ne,mt)=>{const rt=J.get(Ne)||H.get(Ne.fieldName)||ie.getIndex(mt);return{[Ut]:Ne.tooltip,[hi]:Ne.value,columnSettings:{fill:rt,stroke:rt},...Fe}}).filter(Ne=>"pie-chart"!==M||null!=Ne.value&&Ne.value>0);"pie-chart"===M?y._createPieChart(g,se):y._createXYChart(g,se)})()}_getDirection(){return(0,Mt.dZ)(this.container)?"rtl":"ltr"}_isInversed(){return!!(0,Mt.dZ)(this.container)}_customizeChartTooltip(g,y="horizontal"){var v=this;return(0,z.Z)(function*(){const{colorAm5:b}=yield Promise.all([F.e(8670),F.e(8592),F.e(31)]).then(F.bind(F,90031));g.setAll({pointerOrientation:y}),g.get("background")?.setAll({stroke:b("rgba(50, 50, 50, 1)")}),g.label.setAll({direction:v._getDirection(),oversizedBehavior:"wrap",maxWidth:200})})()}_createPieChart(g,y){var v=this;return(0,z.Z)(function*(){const{TooltipAm5:b}=yield Promise.all([F.e(8670),F.e(8592),F.e(31)]).then(F.bind(F,90031)),{PieChartAm5:w,PieSeriesAm5:M}=yield Promise.all([F.e(8670),F.e(7254),F.e(8619)]).then(F.bind(F,58619)),{mediaInfo:C,root:A}=g,{title:T}=C,V=A.container.children.push(w.new(A,{ariaLabel:C?.altText||C?.title||"",focusable:!0,paddingBottom:5,paddingTop:5,paddingLeft:5,paddingRight:5})),B="{category}: {valuePercentTotal.formatNumber('0.00')}%\n ({value})",k=b.new(A,{labelText:B}),H=V.series.push(M.new(A,{name:T,valueField:hi,categoryField:Ut,tooltip:k}));H.ticks.template.set("forceHidden",!0),H.labels.template.set("forceHidden",!0),H.slices.template.states.create("active",{shiftRadius:5}),v._customizeChartTooltip(k),H.slices.template.setAll({ariaLabel:B,focusable:!0,templateField:"columnSettings"}),H.data.setAll(y),H.appear(v._getChartSeriesAnimationMS()),V.appear(v._getChartAnimationMS()),V.root.dom.classList.toggle(dt.mediaChartRendered,!0)})()}_getMinSeriesValue(g){let y=0;return g.forEach(v=>y=Math.min(v.value,y)),y}_createColumnChart(g,y,v){var b=this;return(0,z.Z)(function*(){const{TooltipAm5:w,ScrollbarAm5:M}=yield Promise.all([F.e(8670),F.e(8592),F.e(31)]).then(F.bind(F,90031)),{CategoryAxisAm5:C,AxisRendererXAm5:A,ValueAxisAm5:T,AxisRendererYAm5:P,ColumnSeriesAm5:R}=yield Promise.all([F.e(8670),F.e(7254),F.e(8592),F.e(8725)]).then(F.bind(F,88725)),{mediaInfo:V,root:B}=y,{value:k,title:H}=V;g.setAll({wheelX:"panX",wheelY:"zoomX"});const J=g.xAxes.push(C.new(B,{renderer:A.new(B,{inversed:b._isInversed()}),categoryField:Ut}));J.get("renderer").labels.template.setAll({forceHidden:!0});const ie=g.yAxes.push(T.new(B,{renderer:P.new(B,{inside:!1}),min:b._getMinSeriesValue(k.series)}));ie.get("renderer").labels.template.setAll({direction:b._getDirection()});const ue="{categoryX}",Fe=w.new(B,{labelText:ue}),se=g.series.push(R.new(B,{name:H,xAxis:J,yAxis:ie,valueYField:hi,categoryXField:Ut,tooltip:Fe}));b._customizeChartTooltip(Fe),se.columns.template.setAll({ariaLabel:ue,focusable:!0,templateField:"columnSettings"}),k.series.length>15&&g.set("scrollbarX",M.new(B,{orientation:"horizontal"})),J.data.setAll(v),se.data.setAll(v),se.appear(b._getChartSeriesAnimationMS()),g.appear(b._getChartAnimationMS())})()}_createBarChart(g,y,v){var b=this;return(0,z.Z)(function*(){const{TooltipAm5:w,ScrollbarAm5:M}=yield Promise.all([F.e(8670),F.e(8592),F.e(31)]).then(F.bind(F,90031)),{CategoryAxisAm5:C,AxisRendererXAm5:A,ValueAxisAm5:T,AxisRendererYAm5:P,ColumnSeriesAm5:R}=yield Promise.all([F.e(8670),F.e(7254),F.e(8592),F.e(8725)]).then(F.bind(F,88725)),{mediaInfo:V,root:B}=y,{value:k,title:H}=V;g.setAll({wheelX:"panY",wheelY:"zoomY"});const J=g.yAxes.push(C.new(B,{renderer:P.new(B,{inversed:!0}),categoryField:Ut}));J.get("renderer").labels.template.setAll({forceHidden:!0});const ie=g.xAxes.push(T.new(B,{renderer:A.new(B,{inside:!1,inversed:b._isInversed()}),min:b._getMinSeriesValue(k.series)}));ie.get("renderer").labels.template.setAll({direction:b._getDirection()});const ue="{categoryY}",Fe=w.new(B,{labelText:ue}),se=g.series.push(R.new(B,{name:H,xAxis:ie,yAxis:J,valueXField:hi,categoryYField:Ut,tooltip:Fe}));b._customizeChartTooltip(Fe,"vertical"),se.columns.template.setAll({ariaLabel:ue,focusable:!0,templateField:"columnSettings"}),k.series.length>15&&g.set("scrollbarY",M.new(B,{orientation:"vertical"})),J.data.setAll(v),se.data.setAll(v),se.appear(b._getChartSeriesAnimationMS()),g.appear(b._getChartAnimationMS())})()}_createLineChart(g,y,v){var b=this;return(0,z.Z)(function*(){const{TooltipAm5:w,ScrollbarAm5:M}=yield Promise.all([F.e(8670),F.e(8592),F.e(31)]).then(F.bind(F,90031)),{CategoryAxisAm5:C,AxisRendererXAm5:A,ValueAxisAm5:T,AxisRendererYAm5:P,LineSeriesAm5:R}=yield Promise.all([F.e(8670),F.e(7254),F.e(8592),F.e(8725)]).then(F.bind(F,88725)),{root:V,mediaInfo:B}=y,{value:k,title:H}=B;g.setAll({wheelX:"panX",wheelY:"zoomX"});const J=g.xAxes.push(C.new(V,{renderer:A.new(V,{inversed:b._isInversed()}),categoryField:Ut}));J.get("renderer").labels.template.setAll({forceHidden:!0});const ie=g.yAxes.push(T.new(V,{renderer:P.new(V,{inside:!1}),min:b._getMinSeriesValue(k.series)}));ie.get("renderer").labels.template.setAll({direction:b._getDirection()});const Fe=v[0]?.lineSettings?.stroke,se=w.new(V,{getFillFromSprite:!Fe,labelText:"{categoryX}"});Fe&&se.get("background")?.setAll({fill:Fe});const Ne=g.series.push(R.new(V,{name:H,xAxis:J,yAxis:ie,valueYField:hi,categoryXField:Ut,tooltip:se}));Ne.strokes.template.setAll({templateField:"lineSettings"}),b._customizeChartTooltip(se,"vertical"),k.series.length>15&&g.set("scrollbarX",M.new(V,{orientation:"horizontal"})),J.data.setAll(v),Ne.data.setAll(v),Ne.appear(b._getChartSeriesAnimationMS()),g.appear(b._getChartAnimationMS())})()}_createXYChart(g,y){var v=this;return(0,z.Z)(function*(){const{XYChartAm5:b,XYCursorAm5:w}=yield Promise.all([F.e(8670),F.e(7254),F.e(8592),F.e(8725)]).then(F.bind(F,88725)),{root:M,mediaInfo:C}=g,{type:A}=C,P=M.container.children.push(b.new(M,{ariaLabel:C?.altText||C?.title||"",focusable:!0,panX:!0,panY:!0}));P.set("cursor",w.new(M,{})),"column-chart"===A&&(yield v._createColumnChart(P,g,y)),"bar-chart"===A&&(yield v._createBarChart(P,g,y)),"line-chart"===A&&(yield v._createLineChart(P,g,y)),P.root.dom.classList.toggle(dt.mediaChartRendered,!0)})()}_clearMediaRefreshTimer(){const{_refreshTimer:g}=this;g&&(clearTimeout(g),this._refreshTimer=null)}_updateMediaInfoTimestamp(g){const y=Date.now();this._refreshIntervalInfo={timestamp:y,sourceURL:g&&this._getImageSource(g,y)}}_setupMediaRefreshTimer(){this._clearMediaRefreshTimer();const{activeMediaInfo:g}=this.viewModel;g&&"image"===g.type&&g.refreshInterval&&this._setRefreshTimeout(g)}_setRefreshTimeout(g){const{refreshInterval:y,value:v}=g;if(!y)return;const b=6e4*y;this._updateMediaInfoTimestamp(v.sourceURL);const w=setInterval(()=>{this._updateMediaInfoTimestamp(v.sourceURL)},b);this._refreshTimer=w}_getImageSource(g,y){const v=g.includes("?")?"&":"?",[b,w=""]=g.split("#");return`${b}${v}timestamp=${y}${w?"#":""}${w}`}};(0,I._)([(0,x.Cb)()],ut.prototype,"_refreshIntervalInfo",void 0),(0,I._)([(0,x.Cb)()],ut.prototype,"attributes",null),(0,I._)([(0,x.Cb)()],ut.prototype,"activeMediaInfoIndex",null),(0,I._)([(0,x.Cb)()],ut.prototype,"description",null),(0,I._)([(0,x.Cb)()],ut.prototype,"fieldInfoMap",null),(0,I._)([(0,x.Cb)()],ut.prototype,"layer",null),(0,I._)([(0,x.Cb)()],ut.prototype,"mediaInfos",null),(0,I._)([(0,x.Cb)()],ut.prototype,"popupTemplate",null),(0,I._)([(0,x.Cb)()],ut.prototype,"relatedInfos",null),(0,I._)([(0,x.Cb)()],ut.prototype,"title",null),(0,I._)([(0,x.Cb)({type:Nt})],ut.prototype,"viewModel",void 0),(0,I._)([(0,x.Cb)(),(0,pt.H)("esri/widgets/Feature/t9n/Feature")],ut.prototype,"messages",void 0),ut=(0,I._)([(0,re.j)("esri.widgets.Feature.FeatureMedia")],ut);const Ms=ut;F(55664),F(55013),F(16615),F(82561);var Kr=F(75484),Qr=F(64531),Cs=(F(6785),F(501)),Xr=F(38159),Jr=F(80415);const qr=["$datastore","$map","$layer","$aggregatedfeatures"],ta=Ze.Z.getLogger("esri.widgets.Feature.support.arcadeFeatureUtils");function ia(g){return"string"==typeof g?li(Bi(g)):Array.isArray(g)?function na(g){return`<ul class="esri-widget__list">${g.map(y=>`<li>${"string"==typeof y?li(Bi(y)):y}</li>`).join("")}</ul>`}(g):"esri.arcade.Dictionary"===g?.declaredClass?function sa(g){return`<table class="esri-widget__table">${g.keys().map(y=>{const v=g.field(y);return`<tr><th>${y}</th><td>${"string"==typeof v?li(Bi(v)):v}</td></tr>`}).join("")}</table>`}(g):g}function Fs(){return Promise.all([F.e(337),F.e(8592),F.e(4315)]).then(F.bind(F,14315))}function aa(g){return fn.apply(this,arguments)}function fn(){return(fn=(0,z.Z)(function*({graphic:g,view:y}){const{isAggregate:v,layer:b}=g;if(!v||!b||"2d"!==y?.type)return[];const w=yield y.whenLayerView(b);if(!function ra(g){return"createQuery"in g&&"queryFeatures"in g}(w))return[];const M=w.createQuery(),C=g.getObjectId();M.aggregateIds=null!=C?[C]:[];const{features:A}=yield w.queryFeatures(M);return A})).apply(this,arguments)}function Is(g){return gn.apply(this,arguments)}function gn(){return(gn=(0,z.Z)(function*({expressionInfo:g,arcadeUtils:y,interceptor:v,spatialReference:b,map:w,graphic:M,view:C}){if(!g?.expression)return null;const A=y.createSyntaxTree(g.expression),T=qr.filter(k=>y.hasVariable(A,k)),[P]=yield Promise.all([aa({graphic:M,view:C}),y.loadScriptDependencies(A,!0,T)]),R=y.getViewInfo({spatialReference:b}),V=y.createExecContext(M,R,C?.timeZone);V.interceptor=v,V.useAsync=!0,function oa({aggregatedFeatures:g,arcadeUtils:y,featureSetVars:v,context:b,viewInfo:w,map:M,graphic:C,interceptor:A}){v.forEach(T=>{const P=T.toLowerCase(),R=w.sr;if("$map"===P&&(b.vars[P]=y.convertMapToFeatureSetCollection({map:M,spatialReference:R,interceptor:A})),"$layer"===P&&(b.vars[P]=y.convertFeatureLayerToFeatureSet({layer:C.sourceLayer,spatialReference:R,interceptor:A})),"$datastore"===P&&(b.vars[P]=y.convertServiceUrlToWorkspace({url:C.sourceLayer.url,spatialReference:R,interceptor:A})),"$aggregatedfeatures"===P){const B=C.layer,{fields:k,objectIdField:H,geometryType:J,spatialReference:ie,displayField:ue}=B,Fe=new Jr.default({fields:k,objectIdField:H,geometryType:J,spatialReference:ie,displayField:ue,..."feature"===B.type?{templates:B.templates,typeIdField:B.typeIdField,types:B.types}:null,source:g});b.vars[P]=y.convertFeatureLayerToFeatureSet({layer:Fe,spatialReference:ie,interceptor:A})}})}({aggregatedFeatures:P,arcadeUtils:y,featureSetVars:T,context:V,viewInfo:R,map:w,graphic:M,interceptor:v});const B=y.createFunction(A,V);return y.executeAsyncFunction(B,V).catch(k=>ta.error("arcade-execution-error",{error:k,graphic:M,expressionInfo:g}))})).apply(this,arguments)}function la(g){return yn.apply(this,arguments)}function yn(){return(yn=(0,z.Z)(function*({expressionInfos:g,spatialReference:y,graphic:v,interceptor:b,map:w,view:M}){if(!g?.length)return{};const C=yield Fs(),A={};for(const R of g)A[`expression/${R.name}`]=Is({expressionInfo:R,arcadeUtils:C,interceptor:b,spatialReference:y,map:w,graphic:v,view:M});const T=yield(0,it.as)(A),P={};for(const R in T)P[R]=ia(T[R].value);return P})).apply(this,arguments)}let gt=class extends lt.Z{constructor(g){var y;super(g),y=this,this._abortController=null,this.expressionInfo=null,this.graphic=null,this.contentElement=null,this.contentElementViewModel=null,this.interceptor=null,this.view=null,this._cancelQuery=()=>{const{_abortController:v}=this;v&&v.abort(),this._abortController=null},this._createVM=()=>{const v=this.contentElement?.type;this.contentElementViewModel?.destroy();const b="fields"===v?new Fi:"media"===v?new Nt:"text"===v?new Mi:null;this._set("contentElementViewModel",b)},this._compile=(0,z.Z)(function*(){y._cancelQuery();const v=new AbortController;y._abortController=v,yield y._compileExpression(),y._abortController===v&&(y._abortController=null)}),this._compileThrottled=(0,j.P)(this._compile,1,this),this._compileExpression=(0,z.Z)(function*(){const{expressionInfo:v,graphic:b,interceptor:w,spatialReference:M,map:C,view:A,_abortController:T}=y;if(!(v&&b&&M&&C))return void y._set("contentElement",null);const P=yield Fs();if(T!==y._abortController)return;const R=yield Is({arcadeUtils:P,expressionInfo:v,graphic:b,interceptor:w,map:C,spatialReference:M,view:A});if(!R||"esri.arcade.Dictionary"!==R.declaredClass)return void y._set("contentElement",null);const V=yield R.castAsJsonAsync(T?.signal),B=V?.type,k="media"===B?Qr.Z.fromJSON(V):"text"===B?Cs.Z.fromJSON(V):"fields"===B?Kr.Z.fromJSON(V):null;y._set("contentElement",k)}),this.addHandles([(0,N.YP)(()=>[this.expressionInfo,this.graphic,this.map,this.spatialReference,this.view],()=>this._compileThrottled(),N.nn),(0,N.YP)(()=>[this.contentElement],()=>this._createVM(),N.nn)])}initialize(){this.addHandles(this._compileThrottled)}destroy(){this._cancelQuery(),this.contentElementViewModel?.destroy(),this._set("contentElementViewModel",null),this._set("contentElement",null)}get spatialReference(){return this.view?.spatialReference??null}set spatialReference(g){this._override("spatialReference",g)}get state(){const{_abortController:g,contentElement:y,contentElementViewModel:v}=this;return g?"loading":y||v?"ready":"disabled"}get map(){return this.view?.map??null}set map(g){this._override("map",g)}};(0,I._)([(0,x.Cb)()],gt.prototype,"_abortController",void 0),(0,I._)([(0,x.Cb)({type:Xr.Z})],gt.prototype,"expressionInfo",void 0),(0,I._)([(0,x.Cb)({type:at.Z})],gt.prototype,"graphic",void 0),(0,I._)([(0,x.Cb)({readOnly:!0})],gt.prototype,"contentElement",void 0),(0,I._)([(0,x.Cb)({readOnly:!0})],gt.prototype,"contentElementViewModel",void 0),(0,I._)([(0,x.Cb)()],gt.prototype,"interceptor",void 0),(0,I._)([(0,x.Cb)()],gt.prototype,"spatialReference",null),(0,I._)([(0,x.Cb)({readOnly:!0})],gt.prototype,"state",null),(0,I._)([(0,x.Cb)()],gt.prototype,"map",null),(0,I._)([(0,x.Cb)()],gt.prototype,"view",void 0),gt=(0,I._)([(0,re.j)("esri.widgets.Feature.FeatureExpression.FeatureExpressionViewModel")],gt);const vn=gt,bn="esri-feature",wn={base:`${bn}-expression`,loadingSpinnerContainer:`${bn}__loading-container`,spinner:`${bn}__loading-spinner`};let xi=class extends Y.Z{constructor(g,y){super(g,y),this._contentWidget=null,this.viewModel=new vn}initialize(){this.addHandles((0,N.YP)(()=>this.viewModel?.contentElementViewModel,()=>this._setupExpressionWidget(),N.nn))}destroy(){this._destroyContentWidget()}render(){const{state:g}=this.viewModel;return(0,O.u)("div",{class:wn.base},"loading"===g?this._renderLoading():"disabled"===g?null:this._contentWidget?.render())}_renderLoading(){return(0,O.u)("div",{class:wn.loadingSpinnerContainer,key:"loading-container"},(0,O.u)("span",{class:this.classes(yt.W.loadingIndicator,be.z.rotating,wn.spinner)}))}_destroyContentWidget(){const{_contentWidget:g}=this;g&&(g.viewModel=null,g.destroy()),this._contentWidget=null}_setupExpressionWidget(){const{contentElementViewModel:g,contentElement:y}=this.viewModel,v=y?.type;this._destroyContentWidget();const b=g?"fields"===v?new hs({viewModel:g}):"media"===v?new Ms({viewModel:g}):"text"===v?new Ci({viewModel:g}):null:null;this._contentWidget=b,this.scheduleRender()}};(0,I._)([(0,x.Cb)({type:vn})],xi.prototype,"viewModel",void 0),xi=(0,I._)([(0,re.j)("esri.widgets.Feature.FeatureExpression")],xi);const ua=xi;var Mn,ca=F(62208),ha=F(79608),_s=F(61996);F(94573),F(91077),F(47277),(Mn||(Mn={})).TOO_SHORT="length-validation-error::too-short";const va=g=>{const y=[];if(g.formTemplate){const{description:v,title:b}=g.formTemplate;g.fields?.forEach(w=>{const M=b&&(0,U.pZ)(b,w.name),C=v&&(0,U.pZ)(v,w.name);(M||C)&&y.push(w.name)})}return y};let Oe=class extends((0,ha.J)((0,_s.IG)(lt.Z))){constructor(g){var y;super(g),y=this,this._loaded=!1,this._queryAbortController=null,this._queryPageAbortController=null,this._queryFeatureCountAbortController=null,this.featuresPerPage=10,this.description=null,this.graphic=null,this.layer=null,this.map=null,this.orderByFields=null,this.featureCount=0,this.relationshipId=null,this.showAllEnabled=!1,this.title=null,this._cancelQuery=()=>{const{_queryAbortController:v}=this;v&&v.abort(),this._queryAbortController=null},this._cancelQueryFeatureCount=()=>{const{_queryFeatureCountAbortController:v}=this;v&&v.abort(),this._queryFeatureCountAbortController=null},this._cancelQueryPage=()=>{const{_queryPageAbortController:v}=this;v&&v.abort(),this._queryPageAbortController=null},this._queryController=(0,z.Z)(function*(){y._cancelQuery();const v=new AbortController;y._queryAbortController=v,yield(0,it.R8)(y._query()),y._queryAbortController===v&&(y._queryAbortController=null)}),this._queryFeatureCountController=(0,z.Z)(function*(){y._loaded=!1,y._cancelQueryFeatureCount();const v=new AbortController;y._queryFeatureCountAbortController=v,yield(0,it.R8)(y._queryFeatureCount()),y._queryFeatureCountAbortController===v&&(y._queryFeatureCountAbortController=null),y._loaded=!0}),this._queryPageController=(0,z.Z)(function*(){const v=new AbortController;y._queryPageAbortController=v,yield(0,it.R8)(y._queryPage()),y._queryPageAbortController===v&&(y._queryPageAbortController=null)}),this._queryDebounced=(0,it.Ds)(this._queryController,100),this._queryFeatureCountDebounced=(0,it.Ds)(this._queryFeatureCountController,100),this._queryPageDebounced=(0,it.Ds)(this._queryPageController,100),this._query=(0,z.Z)(function*(){const{_queryAbortController:v,relatedFeatures:b}=y;y.featureCount&&(y._destroyRelatedFeatureViewModels(),y.featurePage=1,b.removeAll(),y.destroyed||b.addMany(y._sliceFeatures(yield y._queryRelatedFeatures({signal:v?.signal}))))}),this.addHandles([(0,N.YP)(()=>[this.displayCount,this.graphic,this.layer,this.layer?.loaded,this.map,this.orderByFields,this.relationshipId,this.featuresPerPage,this.showAllEnabled,this.canQuery,this.featureCount],()=>this._queryDebounced(),N.nn),(0,N.YP)(()=>[this.featurePage,this.showAllEnabled],()=>this._queryPageDebounced()),(0,N.YP)(()=>[this.layer,this.relationshipId,this.objectId,this.canQuery],()=>this._queryFeatureCountDebounced())])}destroy(){this._destroyRelatedFeatureViewModels(),this.relatedFeatures.removeAll(),this._cancelQuery(),this._cancelQueryFeatureCount(),this._cancelQueryPage()}set featurePage(g){const{featuresPerPage:y,featureCount:v}=this,w=Math.ceil(v/y)||1;this._set("featurePage",Math.min(Math.max(g,1),w))}get featurePage(){return this._get("featurePage")}get orderByFieldsFixedCasing(){const{orderByFields:g,relatedLayer:y}=this;return g&&y?.loaded?g.map(v=>{const b=v.clone();return b.field=ai(v.field,y),b}):g??[]}get supportsCacheHint(){return!!this.layer?.capabilities?.queryRelated?.supportsCacheHint}get canLoad(){return!!this.map&&"number"==typeof this.relationshipId&&"number"==typeof this.objectId}get canQuery(){const g=this.layer?.capabilities?.queryRelated;return!!(this.relatedLayer&&this.relationship&&"number"==typeof this.relationshipId&&"number"==typeof this.objectId&&g?.supportsCount&&g?.supportsPagination)}get itemDescriptionFieldName(){return this.orderByFieldsFixedCasing[0]?.field||null}set displayCount(g){this._set("displayCount",Math.min(Math.max(g,0),10))}get displayCount(){return this._get("displayCount")}get objectId(){return(this.objectIdField&&this.graphic?.attributes?.[this.objectIdField])??null}get objectIdField(){return this.layer?.objectIdField||null}get relatedFeatures(){return this._get("relatedFeatures")||new Be.Z}get relatedLayer(){const{layer:g,map:y,relationship:v}=this;return g?.loaded&&y&&v?function zo(g,y,v){return g&&y&&v?rs(g.allLayers,y,v)||rs(g.allTables,y,v):null}(y,g,v)??null:null}get relationship(){const{relationshipId:g,layer:y}=this;return"number"==typeof g?y?.relationships?.find(({id:v})=>v===g)??null:null}get relatedFeatureViewModels(){return this._get("relatedFeatureViewModels")||new Be.Z}get state(){const{_queryAbortController:g,_queryFeatureCountAbortController:y,_queryPageAbortController:v,canQuery:b,_loaded:w,canLoad:M}=this;return y||M&&!w?"loading":g||v?"querying":b?"ready":"disabled"}getRelatedFeatureByObjectId(g){return this.relatedFeatures.find(y=>y.getObjectId()===g)}_destroyRelatedFeatureViewModels(){this.relatedFeatureViewModels?.forEach(g=>!g.destroyed&&g.destroy()),this.relatedFeatureViewModels.removeAll()}_queryFeatureCount(){var g=this;return(0,z.Z)(function*(){const{layer:y,relatedLayer:v,relationshipId:b,objectId:w,_queryFeatureCountAbortController:M,canQuery:C,supportsCacheHint:A}=g;if(yield y?.load(),yield v?.load(),!C||!y||!v)return void g._set("featureCount",0);const T=v.createQuery(),P=new hn.default({cacheHint:A,relationshipId:b,returnGeometry:!1,objectIds:[w],where:T.where??void 0}),R=yield y.queryRelatedFeaturesCount(P,{signal:M?.signal});g._set("featureCount",R[w]||0)})()}_sliceFeatures(g){const{showAllEnabled:y,displayCount:v}=this;return y?g:v?g.slice(0,v):[]}_queryPage(){var g=this;return(0,z.Z)(function*(){const{relatedFeatures:y,featurePage:v,showAllEnabled:b,_queryPageAbortController:w,featureCount:M}=g;!b||v<2||!M||y.addMany(yield g._queryRelatedFeatures({signal:w?.signal}))})()}_queryRelatedFeatures(g){var y=this;return(0,z.Z)(function*(){const{orderByFieldsFixedCasing:v,showAllEnabled:b,featuresPerPage:w,displayCount:M,layer:C,relationshipId:A,featurePage:T,featureCount:P,relatedLayer:R,supportsCacheHint:V}=y,{canQuery:B,objectId:k}=y;if(!B||!C||!R)return[];const H=b?((T-1)*w+P)%P:0,J=b?w:M,ie=R.objectIdField,ue=[...v.map(wt=>wt.field),...va(R),ie].filter($e.pC),Fe=v.map(wt=>`${wt.field} ${wt.order}`),se=R.createQuery(),Ne=new hn.default({orderByFields:Fe,start:H,num:J,outFields:ue,cacheHint:V,relationshipId:A,returnGeometry:!1,objectIds:[k],where:se.where??void 0}),rt=(yield C.queryRelatedFeatures(Ne,{signal:g?.signal}))[k]?.features||[];return rt.forEach(wt=>{wt.sourceLayer=R,wt.layer=R}),rt})()}};(0,I._)([(0,x.Cb)()],Oe.prototype,"_loaded",void 0),(0,I._)([(0,x.Cb)()],Oe.prototype,"_queryAbortController",void 0),(0,I._)([(0,x.Cb)()],Oe.prototype,"_queryPageAbortController",void 0),(0,I._)([(0,x.Cb)()],Oe.prototype,"_queryFeatureCountAbortController",void 0),(0,I._)([(0,x.Cb)({value:1})],Oe.prototype,"featurePage",null),(0,I._)([(0,x.Cb)()],Oe.prototype,"featuresPerPage",void 0),(0,I._)([(0,x.Cb)({readOnly:!0})],Oe.prototype,"orderByFieldsFixedCasing",null),(0,I._)([(0,x.Cb)({readOnly:!0})],Oe.prototype,"supportsCacheHint",null),(0,I._)([(0,x.Cb)({readOnly:!0})],Oe.prototype,"canLoad",null),(0,I._)([(0,x.Cb)({readOnly:!0})],Oe.prototype,"canQuery",null),(0,I._)([(0,x.Cb)()],Oe.prototype,"description",void 0),(0,I._)([(0,x.Cb)({readOnly:!0})],Oe.prototype,"itemDescriptionFieldName",null),(0,I._)([(0,x.Cb)({value:3})],Oe.prototype,"displayCount",null),(0,I._)([(0,x.Cb)({type:at.Z})],Oe.prototype,"graphic",void 0),(0,I._)([(0,x.Cb)()],Oe.prototype,"layer",void 0),(0,I._)([(0,x.Cb)()],Oe.prototype,"map",void 0),(0,I._)([(0,x.Cb)({readOnly:!0})],Oe.prototype,"objectId",null),(0,I._)([(0,x.Cb)({readOnly:!0})],Oe.prototype,"objectIdField",null),(0,I._)([(0,x.Cb)()],Oe.prototype,"orderByFields",void 0),(0,I._)([(0,x.Cb)({readOnly:!0})],Oe.prototype,"relatedFeatures",null),(0,I._)([(0,x.Cb)({readOnly:!0})],Oe.prototype,"relatedLayer",null),(0,I._)([(0,x.Cb)({readOnly:!0})],Oe.prototype,"relationship",null),(0,I._)([(0,x.Cb)()],Oe.prototype,"featureCount",void 0),(0,I._)([(0,x.Cb)({readOnly:!0})],Oe.prototype,"relatedFeatureViewModels",null),(0,I._)([(0,x.Cb)()],Oe.prototype,"relationshipId",void 0),(0,I._)([(0,x.Cb)()],Oe.prototype,"showAllEnabled",void 0),(0,I._)([(0,x.Cb)()],Oe.prototype,"state",null),(0,I._)([(0,x.Cb)()],Oe.prototype,"title",void 0),(0,I._)([(0,x.Cb)()],Oe.prototype,"getRelatedFeatureByObjectId",null),Oe=(0,I._)([(0,re.j)("esri.widgets.Feature.FeatureRelationship.FeatureRelationshipViewModel")],Oe);const Fn=Oe,pi="esri-feature",mi=`${pi}-relationship`,xt={base:mi,listContainer:`${mi}__list`,listItem:`${mi}__list-item`,listItemHidden:`${mi}__list-item--hidden`,listContainerQuerying:`${mi}__list--querying`,featureObserver:`${pi}__feature-observer`,stickySpinnerContainer:`${pi}__sticky-loading-container`,loadingSpinnerContainer:`${pi}__loading-container`,spinner:`${pi}__loading-spinner`},Rs={title:!0,description:!0};let ct=class extends Y.Z{constructor(g,y){super(g,y),this._featureElementInfo=null,this._relatedFeatureIntersectionObserverNode=null,this._relatedFeatureIntersectionObserver=new IntersectionObserver(([v])=>{v?.isIntersecting&&this._increaseFeaturePage()},{root:window.document}),this.headingLevel=2,this.viewModel=new Fn,this.messages=null,this.messagesCommon=null,this.visibleElements={...Rs},this._increaseFeaturePage=()=>{const{state:v,showAllEnabled:b,relatedFeatures:w,featuresPerPage:M,featurePage:C}=this.viewModel;"ready"===v&&b&&w.length>=M*C&&this.viewModel.featurePage++}}initialize(){this._featureElementInfo=new wi,this.addHandles([(0,N.YP)(()=>[this.viewModel.description,this.viewModel.title,this.headingLevel],()=>this._setupFeatureElementInfo(),N.nn),(0,N.YP)(()=>[this.viewModel.state,this.viewModel.showAllEnabled,this._relatedFeatureIntersectionObserverNode],()=>this._handleRelatedFeatureObserverChange()),(0,N.on)(()=>this.viewModel.relatedFeatureViewModels,"change",()=>this._setupRelatedFeatureViewModels())])}loadDependencies(){return(0,Kt.h)({icon:()=>F.e(8472).then(F.bind(F,8472)),list:()=>Promise.all([F.e(6554),F.e(3468),F.e(8592),F.e(5988)]).then(F.bind(F,85988)),"list-item":()=>Promise.all([F.e(6554),F.e(8346),F.e(8592),F.e(4141)]).then(F.bind(F,94141)),notice:()=>Promise.all([F.e(6554),F.e(8592),F.e(5636)]).then(F.bind(F,75636))})}destroy(){this._unobserveRelatedFeatureObserver(),this._featureElementInfo=(0,ca.SC)(this._featureElementInfo)}get displayShowAllButton(){const{showAllEnabled:g,featureCount:y,displayCount:v,state:b}=this.viewModel;return!g&&!!y&&"ready"===b&&(y>v||0===v)}get displayListItems(){return this.displayShowAllButton||this.viewModel.relatedFeatureViewModels.length>0}get description(){return this.viewModel.description}set description(g){this.viewModel.description=g}get featureCountDescription(){const{messages:g}=this,{featureCount:y}=this.viewModel;return(0,It.n)(g?.numberRecords,{number:y})}get title(){return this.viewModel.title}set title(g){this.viewModel.title=g}castVisibleElements(g){return{...Rs,...g}}render(){const{state:g}=this.viewModel;return(0,O.u)("div",{class:this.classes(xt.base,be.z.widget)},this._featureElementInfo?.render(),"loading"===g?this._renderLoading():"disabled"===g?this._renderRelationshipNotFound():this._renderRelatedFeatures())}_renderStickyLoading(){return"querying"===this.viewModel.state?(0,O.u)("div",{class:xt.stickySpinnerContainer,key:"sticky-loader"},this._renderLoadingIcon()):null}_renderLoadingIcon(){return(0,O.u)("span",{class:this.classes(yt.W.loadingIndicator,be.z.rotating,xt.spinner)})}_renderLoading(){return(0,O.u)("div",{class:xt.loadingSpinnerContainer,key:"loading-container"},this._renderLoadingIcon())}_renderShowAllIconNode(){return(0,O.u)("calcite-icon",{icon:"list",scale:"s",slot:"content-end"})}_renderChevronIconNode(){const g=(0,Mt.dZ)(this.container)?"chevron-left":"chevron-right";return(0,O.u)("calcite-icon",{icon:g,scale:"s",slot:"content-end"})}_renderRelatedFeature(g){const{itemDescriptionFieldName:y}=this.viewModel,v=g.title;return g.description=y&&g.formattedAttributes?.global[y],(0,O.u)("calcite-list-item",{class:this.classes(xt.listItem,{[xt.listItemHidden]:"loading"===g.state}),description:g.description??"",key:g.uid,label:v,onCalciteListItemSelect:()=>this.emit("select-record",{featureViewModel:g})},this._renderChevronIconNode())}_renderShowAllListItem(){return this.displayShowAllButton?(0,O.u)("calcite-list-item",{description:this.featureCountDescription,key:"show-all-item",label:this.messages?.showAll,onCalciteListItemSelect:()=>this.emit("show-all-records")},this._renderShowAllIconNode()):null}_renderNoRelatedFeaturesMessage(){return(0,O.u)("calcite-notice",{icon:"information",key:"no-related-features-message",kind:"brand",open:!0,scale:"s",width:"full"},(0,O.u)("div",{slot:"message"},this.messages?.noRelatedFeatures))}_renderFeatureObserver(){return(0,O.u)("div",{afterCreate:this._relatedFeatureIntersectionObserverCreated,bind:this,class:xt.featureObserver,key:"feature-observer"})}_renderList(){const{relatedFeatureViewModels:g}=this.viewModel;return(0,O.u)("calcite-list",null,g.toArray().map(y=>this._renderRelatedFeature(y)),this._renderShowAllListItem())}_renderRelatedFeatures(){const{displayListItems:g}=this,{state:y}=this.viewModel;return(0,O.u)("div",{class:this.classes(xt.listContainer,{[xt.listContainerQuerying]:"querying"===y}),key:"list-container"},g?this._renderList():"ready"===y?this._renderNoRelatedFeaturesMessage():null,this._renderStickyLoading(),this._renderFeatureObserver())}_renderRelationshipNotFound(){return(0,O.u)("calcite-notice",{icon:"exclamation-mark-triangle",key:"relationship-not-found",kind:"danger",open:!0,scale:"s",width:"full"},(0,O.u)("div",{slot:"message"},this.messages?.relationshipNotFound))}_setupRelatedFeatureViewModels(){const{relatedFeatureViewModels:g}=this.viewModel,y="related-feature-viewmodels";this.removeHandles(y),g?.forEach(v=>{this.addHandles((0,N.YP)(()=>[v.title,v.state],()=>this.scheduleRender(),N.nn),y)}),this.scheduleRender()}_setupFeatureElementInfo(){const{headingLevel:g,visibleElements:y}=this;this._featureElementInfo?.set({description:y.description&&this.description,title:y.title&&this.title,headingLevel:g})}_handleRelatedFeatureObserverChange(){var g=this;return(0,z.Z)(function*(){g._unobserveRelatedFeatureObserver();const{state:y,showAllEnabled:v}=g.viewModel;yield(0,it.e4)(0),g._relatedFeatureIntersectionObserverNode&&"ready"===y&&v&&g._relatedFeatureIntersectionObserver.observe(g._relatedFeatureIntersectionObserverNode)})()}_relatedFeatureIntersectionObserverCreated(g){this._relatedFeatureIntersectionObserverNode=g}_unobserveRelatedFeatureObserver(){this._relatedFeatureIntersectionObserverNode&&this._relatedFeatureIntersectionObserver.unobserve(this._relatedFeatureIntersectionObserverNode)}};(0,I._)([(0,x.Cb)()],ct.prototype,"_relatedFeatureIntersectionObserverNode",void 0),(0,I._)([(0,x.Cb)({readOnly:!0})],ct.prototype,"displayShowAllButton",null),(0,I._)([(0,x.Cb)({readOnly:!0})],ct.prototype,"displayListItems",null),(0,I._)([(0,x.Cb)()],ct.prototype,"description",null),(0,I._)([(0,x.Cb)({readOnly:!0})],ct.prototype,"featureCountDescription",null),(0,I._)([(0,x.Cb)()],ct.prototype,"headingLevel",void 0),(0,I._)([(0,x.Cb)()],ct.prototype,"title",null),(0,I._)([(0,x.Cb)({type:Fn})],ct.prototype,"viewModel",void 0),(0,I._)([(0,x.Cb)(),(0,pt.H)("esri/widgets/Feature/t9n/Feature")],ct.prototype,"messages",void 0),(0,I._)([(0,x.Cb)(),(0,pt.H)("esri/t9n/common")],ct.prototype,"messagesCommon",void 0),(0,I._)([(0,x.Cb)()],ct.prototype,"visibleElements",void 0),(0,I._)([(0,D.p)("visibleElements")],ct.prototype,"castVisibleElements",null),ct=(0,I._)([(0,re.j)("esri.widgets.Feature.FeatureRelationship")],ct);const Us=ct;var fi;const Os="content-view-models",Ss="relationship-view-models",Zs={attachmentsContent:!0,chartAnimation:!0,customContent:!0,expressionContent:!0,fieldsContent:!0,mediaContent:!0,textContent:!0,relationshipContent:!0};let De=fi=class extends((0,_s.IG)(lt.Z)){constructor(g){super(g),this._error=null,this._featureAbortController=null,this._graphicChangedThrottled=(0,j.P)(this._graphicChanged,1,this),this._expressionAttributes=null,this._graphicExpressionAttributes=null,this.abilities={...Zs},this.content=null,this.contentViewModels=[],this.description=null,this.defaultPopupTemplateEnabled=!1,this.formattedAttributes=null,this.lastEditInfo=null,this.relatedInfos=new Map,this.title="",this.view=null,this._isAllowedContentType=y=>{const{abilities:v}=this;return"attachments"===y.type&&!!v.attachmentsContent||"custom"===y.type&&!!v.customContent||"fields"===y.type&&!!v.fieldsContent||"media"===y.type&&!!v.mediaContent||"text"===y.type&&!!v.textContent||"expression"===y.type&&!!v.expressionContent||"relationship"===y.type&&!!v.relationshipContent},this.addHandles((0,N.YP)(()=>[this.graphic,this._effectivePopupTemplate,this.abilities],()=>this._graphicChangedThrottled(),N.nn))}initialize(){this.addHandles(this._graphicChangedThrottled)}destroy(){this._clear(),this._cancelFeatureQuery(),this._error=null,this.graphic=null,this._destroyContentViewModels(),this.relatedInfos.clear()}get _effectivePopupTemplate(){return null!=this.graphic?this.graphic.getEffectivePopupTemplate(this.defaultPopupTemplateEnabled):null}get _fieldInfoMap(){return function So(g,y){const v=new Map;return g&&g.forEach(b=>{const w=ai(b.fieldName,y);b.fieldName=w,v.set(w.toLowerCase(),b)}),v}(es(this._effectivePopupTemplate),this._sourceLayer)}get _sourceLayer(){return Kn(this.graphic)}castAbilities(g){return{...Zs,...g}}get isTable(){return this._sourceLayer?.isTable||!1}get state(){return this.graphic?this._error?"error":this.waitingForContent?"loading":"ready":"disabled"}set graphic(g){this._set("graphic",g?g.clone():null)}get spatialReference(){return this.view?.spatialReference??null}set spatialReference(g){this._override("spatialReference",g)}get map(){return this.view?.map||null}set map(g){this._override("map",g)}get waitingForContent(){return!!this._featureAbortController}setActiveMedia(g,y){const v=this.contentViewModels[g];v instanceof Nt&&v.setActiveMedia(y)}nextMedia(g){const y=this.contentViewModels[g];y instanceof Nt&&y.next()}previousMedia(g){const y=this.contentViewModels[g];y instanceof Nt&&y.previous()}updateGeometry(){var g=this;return(0,z.Z)(function*(){const{graphic:y,spatialReference:v,_sourceLayer:b}=g;yield b?.load();const w=b?.objectIdField;if(!w||!y||!b)return;const M=y?.attributes?.[w];if(null==M)return;const C=[M];if(!y.geometry){const T=(yield is({layer:b,graphic:y,outFields:[],objectIds:C,returnGeometry:!0,spatialReference:v}))?.geometry;T&&(y.geometry=T)}})()}_clear(){this._set("title",""),this._set("content",null),this._set("formattedAttributes",null)}_graphicChanged(){var g=this;return(0,z.Z)(function*(){g._cancelFeatureQuery(),g._error=null,g._clear();const{graphic:y}=g;if(!y)return;const v=new AbortController;g._featureAbortController=v;try{yield g._queryFeature({signal:v.signal})}catch(b){(0,it.D_)(b)||(g._error=b,Ze.Z.getLogger(g).error("error","The popupTemplate could not be displayed for this feature.",{error:b,graphic:y,popupTemplate:g._effectivePopupTemplate}))}g._featureAbortController===v&&(g._featureAbortController=null)})()}_cancelFeatureQuery(){const{_featureAbortController:g}=this;g&&g.abort(),this._featureAbortController=null}_compileContentElement(g,y){return"attachments"===g.type?this._compileAttachments(g,y):"custom"===g.type?this._compileCustom(g,y):"fields"===g.type?this._compileFields(g,y):"media"===g.type?this._compileMedia(g,y):"text"===g.type?this._compileText(g,y):"expression"===g.type?this._compileExpression(g,y):"relationship"===g.type?this._compileRelationship(g,y):void 0}_compileContent(g){if(this._destroyContentViewModels(),this.graphic)return Array.isArray(g)?g.filter(this._isAllowedContentType).map((y,v)=>this._compileContentElement(y,v)).filter($e.pC):"string"==typeof g?this._compileText(new Cs.Z({text:g}),0).text:g}_destroyContentViewModels(){this.removeHandles(Ss),this.removeHandles(Os),this.contentViewModels.forEach(g=>g&&!g.destroyed&&g.destroy()),this._set("contentViewModels",[])}_matchesFeature(g,y){const v=g?.graphic?.getObjectId(),b=y?.getObjectId();return null!=v&&null!=b&&v===b}_setRelatedFeaturesViewModels({relatedFeatureViewModels:g,relatedFeatures:y,map:v}){const{view:b,spatialReference:w}=this;y?.filter(Boolean).forEach(M=>{g.find(C=>this._matchesFeature(C,M))||g.add(new fi({abilities:{relationshipContent:!1},map:v,view:b,spatialReference:w,graphic:M}))}),g.forEach(M=>{y?.find(A=>this._matchesFeature(M,A))||g.remove(M)})}_setExpressionContentVM(g,y){const v=this.formattedAttributes,{contentElement:b,contentElementViewModel:w}=g,M=b?.type;w&&M&&("fields"===M&&(this._createFieldsFormattedAttributes({contentElement:b,contentElementIndex:y,formattedAttributes:v}),w.set(this._createFieldsVMParams(b,y))),"media"===M&&(this._createMediaFormattedAttributes({contentElement:b,contentElementIndex:y,formattedAttributes:v}),w.set(this._createMediaVMParams(b,y))),"text"===M&&w.set(this._createTextVMParams(b)))}_compileRelationship(g,y){const{displayCount:v,orderByFields:b,relationshipId:w,title:M,description:C}=g,{_sourceLayer:A,graphic:T,map:P}=this;if(!Ni(A))return;const R=new Fn({displayCount:v,graphic:T,orderByFields:b,relationshipId:w,layer:A,map:P,...this._compileTitleAndDesc({title:M,description:C})});return this.contentViewModels[y]=R,this.addHandles((0,N.on)(()=>R.relatedFeatures,"change",()=>this._setRelatedFeaturesViewModels(R)),Ss),g}_compileExpression(g,y){const{expressionInfo:v}=g,{graphic:b,map:w,spatialReference:M,view:C}=this,A=new vn({expressionInfo:v,graphic:b,interceptor:fi.interceptor,map:w,spatialReference:M,view:C});return this.contentViewModels[y]=A,this.addHandles((0,N.YP)(()=>A.contentElementViewModel,()=>this._setExpressionContentVM(A,y),N.nn),Os),g}_compileAttachments(g,y){const{graphic:v}=this,{description:b,title:w}=g;return this.contentViewModels[y]=new Gi({graphic:v,...this._compileTitleAndDesc({title:w,description:b})}),g}_compileCustom(g,y){const{graphic:v}=this,{creator:b,destroyer:w}=g;return this.contentViewModels[y]=new Mi({graphic:v,creator:b,destroyer:w}),g}_compileTitleAndDesc({title:g,description:y}){const{_fieldInfoMap:v,_sourceLayer:b,graphic:w,formattedAttributes:M}=this,C=w?.attributes,A=this._expressionAttributes,T=M.global;return{title:$t({attributes:C,fieldInfoMap:v,globalAttributes:T,expressionAttributes:A,layer:b,text:g}),description:$t({attributes:C,fieldInfoMap:v,globalAttributes:T,expressionAttributes:A,layer:b,text:y})}}_createFieldsVMParams(g,y){const v=this._effectivePopupTemplate,b=this.formattedAttributes,w={...b?.global,...b?.content[y]},C=(g?.fieldInfos||v?.fieldInfos)?.filter(({fieldName:R})=>Si(R)||_t(R)||w.hasOwnProperty(R)),A=v?.expressionInfos,{description:T,title:P}=g;return{attributes:w,expressionInfos:A,fieldInfos:C,...this._compileTitleAndDesc({title:P,description:T})}}_compileFields(g,y){const v=g.clone(),b=new Fi(this._createFieldsVMParams(g,y));return this.contentViewModels[y]=b,v.fieldInfos=b.formattedFieldInfos.slice(0),v}_createMediaVMParams(g,y){const{abilities:v,graphic:b,_fieldInfoMap:w,_effectivePopupTemplate:M,relatedInfos:C,_sourceLayer:A,_expressionAttributes:T}=this,P=this.formattedAttributes,R=b?.attributes??{},{description:V,mediaInfos:B,title:k}=g;return{abilities:{chartAnimation:v.chartAnimation},activeMediaInfoIndex:g.activeMediaInfoIndex||0,attributes:R,isAggregate:b?.isAggregate,layer:A,fieldInfoMap:w,formattedAttributes:{...P?.global,...P?.content[y]},expressionAttributes:T,mediaInfos:B,popupTemplate:M,relatedInfos:C,...this._compileTitleAndDesc({title:k,description:V})}}_compileMedia(g,y){const v=g.clone(),b=new Nt(this._createMediaVMParams(g,y));return v.mediaInfos=b.formattedMediaInfos.slice(0),this.contentViewModels[y]=b,v}_createTextVMParams(g){const{graphic:y,_fieldInfoMap:v,_sourceLayer:b,_expressionAttributes:w}=this;return g&&g.text&&(g.text=$t({attributes:y?.attributes??{},fieldInfoMap:v,globalAttributes:this.formattedAttributes?.global??{},expressionAttributes:w,layer:b,text:g.text})),{graphic:y,creator:g.text}}_compileText(g,y){const v=g.clone();return this.contentViewModels[y]=new Mi(this._createTextVMParams(v)),v}_compileLastEditInfo(){const{_effectivePopupTemplate:g,_sourceLayer:y,graphic:v,view:b}=this;if(!g)return;const{lastEditInfoEnabled:w}=g,M=y?.editFieldsInfo;return w&&M?function Oo(g,y,v,b){const{creatorField:w,creationDateField:M,editorField:C,editDateField:A}=g;if(!y)return;const T=(0,ri.Np)(b&&"preferredTimeZone"in b?b.preferredTimeZone:null,!(!b||!("datesInUnknownTimezone"in b)||!b.datesInUnknownTimezone),v,Gn,"date"),P={...Gn,...T},R=y[A];if("number"==typeof R){const B=y[C];return{type:"edit",date:(0,Gt.p6)(R,P),user:B}}const V=y[M];if("number"==typeof V){const B=y[w];return{type:"create",date:(0,Gt.p6)(V,P),user:B}}return null}(M,v?.attributes,b?.timeZone??ri.By,y):void 0}_compileTitle(g){const{_fieldInfoMap:y,_sourceLayer:v,graphic:b,_expressionAttributes:w}=this;return $t({attributes:b?.attributes??{},fieldInfoMap:y,globalAttributes:this.formattedAttributes?.global??{},expressionAttributes:w,layer:v,text:g})}_getTitle(){var g=this;return(0,z.Z)(function*(){const{_effectivePopupTemplate:y,graphic:v}=g;if(!v)return null;const b=y?.title;return bi(b,{graphic:v})})()}_getContent(){var g=this;return(0,z.Z)(function*(){const{_effectivePopupTemplate:y,graphic:v}=g;if(!v)return null;const b=y?.content;return bi(b,{graphic:v})})()}_queryFeature(g){var y=this;return(0,z.Z)(function*(){const{_featureAbortController:v,_sourceLayer:b,graphic:w,_effectivePopupTemplate:M}=y,C=y.map,A=y.view,T=y.spatialReference;if(v!==y._featureAbortController||!w)return;yield function Vo(g,y){return Wi.apply(this,arguments)}({graphic:w,popupTemplate:M,layer:b,spatialReference:T},g);const{content:{value:P},title:{value:R}}=yield(0,it.as)({content:y._getContent(),title:y._getTitle()}),{expressionAttributes:{value:V}}=yield(0,it.as)({checkForRelatedFeatures:y._checkForRelatedFeatures(g),expressionAttributes:la({expressionInfos:M?.expressionInfos,spatialReference:T,graphic:w,map:C,interceptor:fi.interceptor,view:A})});v===y._featureAbortController&&w&&(y._expressionAttributes=V,y._graphicExpressionAttributes={...w.attributes,...V},y._set("formattedAttributes",y._createFormattedAttributes(P)),y._set("title",y._compileTitle(R)),y._set("lastEditInfo",y._compileLastEditInfo()||null),y._set("content",y._compileContent(P)||null))})()}_createMediaFormattedAttributes({contentElement:g,contentElementIndex:y,formattedAttributes:v}){const{_effectivePopupTemplate:b,graphic:w,relatedInfos:M,_sourceLayer:C,_fieldInfoMap:A,_graphicExpressionAttributes:T}=this;v.content[y]=zi({fieldInfos:b?.fieldInfos,graphic:w,attributes:{...T,...g.attributes},layer:C,fieldInfoMap:A,relatedInfos:M,timeZone:this.view?.timeZone??ri.By})}_createFieldsFormattedAttributes({contentElement:g,contentElementIndex:y,formattedAttributes:v}){if(g.fieldInfos){const{graphic:b,relatedInfos:w,_sourceLayer:M,_fieldInfoMap:C,_graphicExpressionAttributes:A}=this;v.content[y]=zi({fieldInfos:g.fieldInfos,graphic:b,attributes:{...A,...g.attributes},layer:M,fieldInfoMap:C,relatedInfos:w,timeZone:this.view?.timeZone??ri.By})}}_createFormattedAttributes(g){const{_effectivePopupTemplate:y,graphic:v,relatedInfos:b,_sourceLayer:w,_fieldInfoMap:M,_graphicExpressionAttributes:C}=this,A=y?.fieldInfos,T={global:zi({fieldInfos:A,graphic:v,attributes:C,layer:w,fieldInfoMap:M,relatedInfos:b,timeZone:this.view?.timeZone??ri.By}),content:[]};return Array.isArray(g)&&g.forEach((P,R)=>{"fields"===P.type&&this._createFieldsFormattedAttributes({contentElement:P,contentElementIndex:R,formattedAttributes:T}),"media"===P.type&&this._createMediaFormattedAttributes({contentElement:P,contentElementIndex:R,formattedAttributes:T})}),T}_checkForRelatedFeatures(g){const{graphic:y,_effectivePopupTemplate:v}=this;return this._queryRelatedInfos(y,es(v),g)}_queryRelatedInfos(g,y,v){var b=this;return(0,z.Z)(function*(){const{relatedInfos:w,_sourceLayer:M}=b;w.clear();const C=null!=M?.associatedLayer?yield M?.associatedLayer.load(v):M;if(!C||!g||!y.filter(R=>R&&_t(R.fieldName))?.length)return;y.forEach(R=>b._configureRelatedInfo(R,C));const T=yield function Dr({relatedInfos:g,layer:y},v){const b={};return g.forEach((w,M)=>{const{relation:C}=w;if(!C){const V=new $.Z("relation-required","A relation is required on a layer to retrieve related records.");throw vs.error(V),V}const{relatedTableId:A}=C;if("number"!=typeof A){const V=new $.Z("A related table ID is required on a layer to retrieve related records.");throw vs.error(V),V}const T=`${y.url}/${A}`,P=bs.get(T),R=P??function Nr(g,y){return(0,_r.Z)(g,{query:{f:"json"},signal:y?.signal})}(T);P||bs.set(T,R),b[M]=R}),(0,it.Hl)((0,it.as)(b),v)}({relatedInfos:w,layer:C},v);Object.keys(T).forEach(R=>{const V=w.get(R.toString()),B=T[R]?.value;V&&B&&(V.layerInfo=B.data)});const P=yield function Br({graphic:g,relatedInfos:y,layer:v},b){const w={};return y.forEach((M,C)=>{M.layerInfo&&(w[C]=function $r(g,y,v,b){return pn.apply(this,arguments)}(g,M,v,b))}),(0,it.as)(w)}({graphic:g,relatedInfos:w,layer:C},v);Object.keys(P).forEach(R=>{!function Ur(g,y){if(!y||!g)return;const{features:v,statsFeatures:b}=g,w=v?.value;y.relatedFeatures=w?w.features:[];const M=b?.value;y.relatedStatsFeatures=M?M.features:[]}(P[R]?.value,w.get(R.toString()))})})()}_configureRelatedInfo(g,y){const{relatedInfos:v}=this,b=Ai(g.fieldName);if(!b)return;const{layerId:w,fieldName:M}=b;if(!w)return;const C=v.get(w.toString())||function Rr(g,y){const v=function Lr(g,y){if(!y.relationships)return null;let v=null;const{relationships:b}=y;return b.some(w=>w.id===parseInt(g,10)&&(v=w,!0)),v}(g,y);if(v)return{url:`${y.url}/${v.relatedTableId}`,sourceSpatialReference:y.spatialReference,relation:v,relatedFields:[],outStatistics:[]}}(w,y);C&&(function zr({relatedInfo:g,fieldName:y,fieldInfo:v}){if(g.relatedFields?.push(y),v.statisticType){const b=new xr.Z({statisticType:v.statisticType,onStatisticField:y,outStatisticFieldName:y});g.outStatistics?.push(b)}}({relatedInfo:C,fieldName:M,fieldInfo:g}),this.relatedInfos.set(w,C))}};De.interceptor=new class ba{constructor(y,v){this.preLayerQueryCallback=y,this.preRequestCallback=v,this.preLayerQueryCallback||(this.preLayerQueryCallback=b=>{}),this.preRequestCallback||(this.preLayerQueryCallback=b=>{})}}(({query:g,layer:y,method:v})=>{os({layer:y,method:v,query:g,definitionExpression:`${y.definitionExpression} ${y.serviceDefinitionExpression}`})},({queryPayload:g,layer:y,method:v})=>{os({layer:y,method:v,query:g,definitionExpression:`${y.definitionExpression} ${y.serviceDefinitionExpression}`})}),(0,I._)([(0,x.Cb)()],De.prototype,"_error",void 0),(0,I._)([(0,x.Cb)()],De.prototype,"_featureAbortController",void 0),(0,I._)([(0,x.Cb)({readOnly:!0})],De.prototype,"_effectivePopupTemplate",null),(0,I._)([(0,x.Cb)({readOnly:!0})],De.prototype,"_fieldInfoMap",null),(0,I._)([(0,x.Cb)({readOnly:!0})],De.prototype,"_sourceLayer",null),(0,I._)([(0,x.Cb)()],De.prototype,"abilities",void 0),(0,I._)([(0,D.p)("abilities")],De.prototype,"castAbilities",null),(0,I._)([(0,x.Cb)({readOnly:!0})],De.prototype,"content",void 0),(0,I._)([(0,x.Cb)({readOnly:!0})],De.prototype,"contentViewModels",void 0),(0,I._)([(0,x.Cb)()],De.prototype,"description",void 0),(0,I._)([(0,x.Cb)({type:Boolean})],De.prototype,"defaultPopupTemplateEnabled",void 0),(0,I._)([(0,x.Cb)({readOnly:!0})],De.prototype,"isTable",null),(0,I._)([(0,x.Cb)({readOnly:!0})],De.prototype,"state",null),(0,I._)([(0,x.Cb)({readOnly:!0})],De.prototype,"formattedAttributes",void 0),(0,I._)([(0,x.Cb)({type:at.Z,value:null})],De.prototype,"graphic",null),(0,I._)([(0,x.Cb)({readOnly:!0})],De.prototype,"lastEditInfo",void 0),(0,I._)([(0,x.Cb)({readOnly:!0})],De.prototype,"relatedInfos",void 0),(0,I._)([(0,x.Cb)()],De.prototype,"spatialReference",null),(0,I._)([(0,x.Cb)({readOnly:!0})],De.prototype,"title",void 0),(0,I._)([(0,x.Cb)()],De.prototype,"map",null),(0,I._)([(0,x.Cb)({readOnly:!0})],De.prototype,"waitingForContent",null),(0,I._)([(0,x.Cb)()],De.prototype,"view",void 0),De=fi=(0,I._)([(0,re.j)("esri.widgets.FeatureViewModel")],De);const In=De;var Ye=F(99643);const Vs=g=>{let y=class extends g{constructor(){super(...arguments),this.renderNodeContent=v=>(0,Ji.Qd)(v)&&!v.destroyed?(0,O.u)("div",{class:Ye.i.contentNode,key:v},v.render()):v instanceof HTMLElement?(0,O.u)("div",{afterCreate:this._attachToNode,bind:v,class:Ye.i.contentNode,key:v}):(0,Ji.o)(v)?(0,O.u)("div",{afterCreate:this._attachToNode,bind:v.domNode,class:Ye.i.contentNode,key:v}):null}_attachToNode(v){v.appendChild(this)}};return y=(0,I._)([(0,re.j)("esri.widgets.Feature.ContentMixin")],y),y};var _n;const $s={title:!0,content:!0,lastEditedInfo:!0},Ns="relationship-handles";let tt=_n=class extends(Vs(Y.Z)){constructor(g,y){super(g,y),this._contentWidgets=[],this.flowItems=null,this.headingLevel=2,this.messages=null,this.messagesCommon=null,this.messagesURIUtils=null,this.visibleElements={...$s},this.viewModel=new In}initialize(){this.addHandles((0,N.YP)(()=>this.viewModel?.contentViewModels,()=>this._setupContentWidgets(),N.nn))}loadDependencies(){return(0,Kt.h)({notice:()=>Promise.all([F.e(6554),F.e(8592),F.e(5636)]).then(F.bind(F,75636))})}destroy(){this._destroyContentWidgets()}get graphic(){return this.viewModel.graphic}set graphic(g){this.viewModel.graphic=g}get defaultPopupTemplateEnabled(){return this.viewModel.defaultPopupTemplateEnabled}set defaultPopupTemplateEnabled(g){this.viewModel.defaultPopupTemplateEnabled=g}get isTable(){return this.viewModel.isTable}get label(){return this.messages?.widgetLabel??""}set label(g){this._overrideIfSome("label",g)}get spatialReference(){return this.viewModel.spatialReference}set spatialReference(g){this.viewModel.spatialReference=g}get title(){return this.viewModel.title}castVisibleElements(g){return{...$s,...g}}get map(){return this.viewModel.map}set map(g){this.viewModel.map=g}get view(){return this.viewModel.view}set view(g){this.viewModel.view=g}setActiveMedia(g,y){return this.viewModel.setActiveMedia(g,y)}nextMedia(g){return this.viewModel.nextMedia(g)}previousMedia(g){return this.viewModel.previousMedia(g)}render(){const{state:g}=this.viewModel,y=(0,O.u)("div",{class:Ye.i.container,key:"container"},this._renderTitle(),"error"===g?this._renderError():"loading"===g?this._renderLoading():this._renderContentContainer());return(0,O.u)("div",{class:this.classes(Ye.i.base,be.z.widget)},y)}_renderError(){const{messagesCommon:g,messages:y,visibleElements:v}=this;return(0,O.u)("calcite-notice",{icon:"exclamation-mark-circle",kind:"danger",open:!0,scale:"s"},v.title?(0,O.u)("div",{key:"error-title",slot:"title"},g.errorMessage):null,(0,O.u)("div",{key:"error-message",slot:"message"},y.loadingError))}_renderLoading(){return(0,O.u)("div",{class:Ye.i.loadingSpinnerContainer,key:"loading-container"},(0,O.u)("span",{class:this.classes(yt.W.loadingIndicator,be.z.rotating,Ye.i.spinner)}))}_renderContentContainer(){const{visibleElements:g}=this;return g.content?(0,O.u)("div",{class:Ye.i.main},[this._renderContent(),this._renderLastEditInfo()]):null}_renderTitle(){const{visibleElements:g,title:y}=this;return g.title?(0,O.u)(Ki.X,{class:Ye.i.title,innerHTML:y,level:this.headingLevel}):null}_renderContent(){const g=this.viewModel.content,y="content";if(!g)return null;if(Array.isArray(g))return g.length?(0,O.u)("div",{class:Ye.i.contentNode,key:`${y}-content-elements`},g.map(this._renderContentElement,this)):null;if("string"==typeof g){const v=this._contentWidgets[0];return!v||v.destroyed?null:(0,O.u)("div",{class:this.classes(Ye.i.contentNode,Ye.i.contentNodeText),key:`${y}-content`},v.render())}return this.renderNodeContent(g)}_renderContentElement(g,y){const{visibleElements:v}=this;if("boolean"!=typeof v.content&&!v.content?.[g.type])return null;switch(g.type){case"attachments":return this._renderAttachments(y);case"custom":return this._renderCustom(g,y);case"fields":return this._renderFields(y);case"media":return this._renderMedia(y);case"text":return this._renderText(g,y);case"expression":return this._renderExpression(y);case"relationship":return this._renderRelationship(y);default:return null}}_renderAttachments(g){const y=this._contentWidgets[g];if(!y||y.destroyed)return null;const{state:v,attachmentInfos:b}=y.viewModel;return"loading"===v||b.length>0?(0,O.u)("div",{class:this.classes(Ye.i.contentElement),key:this._buildKey("attachments-element",g)},y.render()):null}_renderRelationship(g){const y=this._contentWidgets[g];return y&&!y.destroyed&&this.flowItems?(0,O.u)("div",{class:Ye.i.contentElement,key:this._buildKey("relationship-element",g)},y.render()):null}_renderExpression(g){const y=this._contentWidgets[g];return!y||y.destroyed?null:(0,O.u)("div",{class:Ye.i.contentElement,key:this._buildKey("expression-element",g)},y.render())}_renderCustom(g,y){const{creator:v}=g,b=this._contentWidgets[y];return!b||b.destroyed?null:v?(0,O.u)("div",{class:Ye.i.contentElement,key:this._buildKey("custom-element",y)},b.render()):null}_renderFields(g){const y=this._contentWidgets[g];return!y||y.destroyed?null:(0,O.u)("div",{class:Ye.i.contentElement,key:this._buildKey("fields-element",g)},y.render())}_renderMedia(g){const y=this._contentWidgets[g];return!y||y.destroyed?null:(0,O.u)("div",{class:Ye.i.contentElement,key:this._buildKey("media-element",g)},y.render())}_renderLastEditInfo(){const{visibleElements:g,messages:y}=this,{lastEditInfo:v}=this.viewModel;if(!v||!g.lastEditedInfo)return null;const{date:b,user:w}=v,C=(0,It.n)("edit"===v.type?w?y.lastEditedByUser:y.lastEdited:w?y.lastCreatedByUser:y.lastCreated,{date:b,user:w});return(0,O.u)("div",{class:this.classes(Ye.i.lastEditedInfo,Ye.i.contentElement),key:"edit-info-element"},C)}_renderText(g,y){const b=this._contentWidgets[y];return!b||b.destroyed?null:g.text?(0,O.u)("div",{class:this.classes(Ye.i.contentElement,Ye.i.text),key:this._buildKey("text-element",y)},b.render()):null}_buildKey(g,...y){return`${g}__${this.viewModel?.graphic?.uid||"0"}-${y.join("-")}`}_destroyContentWidget(g){g&&(g.viewModel=null,!g.destroyed&&g.destroy())}_destroyContentWidgets(){this.removeHandles(Ns),this._contentWidgets.forEach(g=>this._destroyContentWidget(g)),this._contentWidgets=[]}_addFeatureRelationshipHandles(g){const{flowItems:y,visibleElements:v}=this;this.addHandles([(0,N.on)(()=>g,"select-record",({featureViewModel:b})=>{y&&(b.abilities={relationshipContent:!0},y.push(new _n({flowItems:y,viewModel:b,visibleElements:v})))}),(0,N.on)(()=>g,"show-all-records",()=>{if(!y)return;const{viewModel:b}=g;b.showAllEnabled=!0;const w=new Us({visibleElements:{title:!1,description:!1},viewModel:b});this._addFeatureRelationshipHandles(w),y.push(w)})],Ns)}_setupContentWidgets(){this._destroyContentWidgets();const{headingLevel:g,visibleElements:y}=this,v=this.viewModel?.content,{contentViewModels:b}=this.viewModel;if(Array.isArray(v))v.forEach((w,M)=>{if("attachments"===w.type&&(this._contentWidgets[M]=new Yo({displayType:w.displayType,headingLevel:y.title?g+1:g,viewModel:b[M]})),"fields"===w.type&&(this._contentWidgets[M]=new hs({viewModel:b[M]})),"media"===w.type&&(this._contentWidgets[M]=new Ms({viewModel:b[M]})),"text"===w.type&&(this._contentWidgets[M]=new Ci({viewModel:b[M]})),"custom"===w.type&&(this._contentWidgets[M]=new Ci({viewModel:b[M]})),"expression"===w.type&&(this._contentWidgets[M]=new ua({viewModel:b[M]})),"relationship"===w.type){const C=new Us({viewModel:b[M]});this._addFeatureRelationshipHandles(C),this._contentWidgets[M]=C}},this);else{const w=b[0];w&&!w.destroyed&&(this._contentWidgets[0]=new Ci({viewModel:w}))}this.scheduleRender()}};(0,I._)([(0,x.Cb)()],tt.prototype,"graphic",null),(0,I._)([(0,x.Cb)()],tt.prototype,"defaultPopupTemplateEnabled",null),(0,I._)([(0,x.Cb)()],tt.prototype,"flowItems",void 0),(0,I._)([(0,x.Cb)()],tt.prototype,"headingLevel",void 0),(0,I._)([(0,x.Cb)({readOnly:!0})],tt.prototype,"isTable",null),(0,I._)([(0,x.Cb)()],tt.prototype,"label",null),(0,I._)([(0,x.Cb)(),(0,pt.H)("esri/widgets/Feature/t9n/Feature")],tt.prototype,"messages",void 0),(0,I._)([(0,x.Cb)(),(0,pt.H)("esri/t9n/common")],tt.prototype,"messagesCommon",void 0),(0,I._)([(0,x.Cb)(),(0,pt.H)("esri/widgets/support/t9n/uriUtils")],tt.prototype,"messagesURIUtils",void 0),(0,I._)([(0,x.Cb)()],tt.prototype,"spatialReference",null),(0,I._)([(0,x.Cb)({readOnly:!0})],tt.prototype,"title",null),(0,I._)([(0,x.Cb)()],tt.prototype,"visibleElements",void 0),(0,I._)([(0,D.p)("visibleElements")],tt.prototype,"castVisibleElements",null),(0,I._)([(0,x.Cb)()],tt.prototype,"map",null),(0,I._)([(0,x.Cb)()],tt.prototype,"view",null),(0,I._)([(0,x.Cb)({type:In})],tt.prototype,"viewModel",void 0),tt=_n=(0,I._)([(0,re.j)("esri.widgets.Feature")],tt);const Ma=tt;var Ca=F(61885);let Dt=class extends Ca.Z.EventedAccessor{constructor(g){super(g),this.location=null,this.screenLocationEnabled=!1,this.view=null,this.addHandles([(0,N.gx)(()=>{const y=this.screenLocationEnabled?this.view:null;return y?[y.size,"3d"===y.type?y.camera:y.viewpoint]:null},()=>this.notifyChange("screenLocation")),(0,N.YP)(()=>this.screenLocation,(y,v)=>{null!=y&&null!=v&&this.emit("view-change")})])}destroy(){this.view=null}get screenLocation(){const{location:g,view:y,screenLocationEnabled:v}=this;return v&&null!=g&&null!=y&&y.ready?y.toScreen(g):null}};(0,I._)([(0,x.Cb)()],Dt.prototype,"location",void 0),(0,I._)([(0,x.Cb)()],Dt.prototype,"screenLocation",null),(0,I._)([(0,x.Cb)()],Dt.prototype,"screenLocationEnabled",void 0),(0,I._)([(0,x.Cb)()],Dt.prototype,"view",void 0),Dt=(0,I._)([(0,re.j)("esri.widgets.support.AnchorElementViewModel")],Dt);const Ds=Dt;let Li=class extends Ds{constructor(g){super(g),this.visible=!1}};(0,I._)([(0,x.Cb)()],Li.prototype,"visible",void 0),Li=(0,I._)([(0,re.j)("esri.widgets.CompassViewModel")],Li);const Bs=Li,An="esri-spinner",xn_base=An,xn_spinnerStart=`${An}--start`,xn_spinnerFinish=`${An}--finish`;let Bt=class extends Y.Z{constructor(g,y){super(g,y),this._animationDelay=500,this._animationPromise=null,this.viewModel=new Bs}initialize(){this.addHandles((0,N.YP)(()=>this.visible,g=>this._visibleChange(g)))}destroy(){this._animationPromise=null}get location(){return this.viewModel.location}set location(g){this.viewModel.location=g}get view(){return this.viewModel.view}set view(g){this.viewModel.view=g}get visible(){return this.viewModel.visible}set visible(g){this.viewModel.visible=g}show(g){const{location:y,promise:v}=g??{};y&&(this.viewModel.location=y),this.visible=!0,v&&v.catch(()=>{}).then(()=>this.hide())}hide(){this.visible=!1}render(){const{visible:g}=this,{screenLocation:y}=this.viewModel,v=!!y,M={[xn_spinnerStart]:g&&v,[xn_spinnerFinish]:!g&&v},C=this._getPositionStyles();return(0,O.u)("div",{class:this.classes(xn_base,M),styles:C})}_visibleChange(g){if(g)return void(this.viewModel.screenLocationEnabled=!0);const y=(0,it.e4)(this._animationDelay);this._animationPromise=y,y.catch(()=>{}).then(()=>{this._animationPromise===y&&(this.viewModel.screenLocationEnabled=!1,this._animationPromise=null)})}_getPositionStyles(){const{screenLocation:g,view:y}=this.viewModel;if(null==y||null==g)return{};const{padding:v}=y;return{left:g.x-v.left+"px",top:g.y-v.top+"px"}}};(0,I._)([(0,x.Cb)()],Bt.prototype,"location",null),(0,I._)([(0,x.Cb)()],Bt.prototype,"view",null),(0,I._)([(0,x.Cb)({type:Bs})],Bt.prototype,"viewModel",void 0),(0,I._)([(0,x.Cb)()],Bt.prototype,"visible",null),Bt=(0,I._)([(0,re.j)("esri.widgets.Spinner")],Bt);const Ia=Bt,ot="esri-features",nt={icon:`${ot}__icon`,actionImage:`${ot}__action-image`,base:ot,container:`${ot}__container`,contentContainer:`${ot}__content-container`,contentFeature:`${ot}__content-feature`,flowItemCollapsed:`${ot}__flow-item--collapsed`,header:`${ot}__header`,footer:`${ot}__footer`,featureMenuObserver:`${ot}__feature-menu-observer`,actionExit:`${ot}__action--exit`,loader:`${ot}__loader`,featuresHeading:`${ot}__heading`,paginationActionBar:`${ot}__pagination-action-bar`,paginationPrevious:`${ot}__pagination-previous`,paginationNext:`${ot}__pagination-next`};let zt=class extends Y.Z{constructor(g,y){super(g,y),this.messages=null,this.closed=!1,this.closable=!0,this._handleOpenRelatedFeature=v=>{this.emit("open-related-feature",{feature:v})}}loadDependencies(){return(0,Kt.h)({action:()=>Promise.all([F.e(6554),F.e(8346),F.e(2573)]).then(F.bind(F,52573)),"flow-item":()=>Promise.all([F.e(6554),F.e(8346),F.e(4792),F.e(8592),F.e(9922)]).then(F.bind(F,59922))})}render(){const{flowItems:g}=this,y=g?.toArray();return(0,O.u)(O.D,null,y?.map(v=>this._renderRelatedRecordsFlowItem(v)))}_handleCloseClick(){this.emit("close")}_handleExitClick(){this.emit("exit")}_handleRelatedRecordsBackClick(){const g=this.flowItems?.pop();g&&("showAllEnabled"in g.viewModel&&(g.viewModel.showAllEnabled=!1),g&&(g.viewModel=null,g.destroy()))}_renderRelatedRecordsFlowItem(g){const{messages:y,closable:v,closed:b}=this,w="graphic"in g&&!g.isTable;return(0,O.u)("calcite-flow-item",{bind:this,closable:v,closed:b,description:this._getRelatedRecordsFlowItemDescription(g),heading:g.title??"",key:`flow-item-${g.viewModel.uid}`,onCalciteFlowItemBack:this._handleRelatedRecordsBackClick,onCalciteFlowItemClose:this._handleCloseClick},(0,O.u)("calcite-action",{appearance:"transparent",bind:this,class:nt.actionExit,icon:"move-up",key:"exit-related-records-action",label:y.exitRelatedRecords,onclick:this._handleExitClick,scale:"m",slot:"header-actions-start",text:y.exitRelatedRecords,title:y.exitRelatedRecords}),w?(0,O.u)("calcite-action",{appearance:"transparent",bind:this,icon:"zoom-to-object",key:"open-related-feature-action",label:y.selectFeature,onclick:()=>this._handleOpenRelatedFeature(g),scale:"m",slot:"header-actions-end",text:y.selectFeature,title:y.selectFeature}):null,(0,O.u)("div",{class:nt.container},g.render()))}_getRelatedRecordsFlowItemDescription(g){return"featureCountDescription"in g?g.featureCountDescription:g.viewModel.description??""}};(0,I._)([(0,x.Cb)()],zt.prototype,"flowItems",void 0),(0,I._)([(0,x.Cb)(),(0,pt.H)("esri/widgets/Features/t9n/Features")],zt.prototype,"messages",void 0),(0,I._)([(0,x.Cb)()],zt.prototype,"closed",void 0),(0,I._)([(0,x.Cb)()],zt.prototype,"closable",void 0),zt=(0,I._)([(0,re.j)("esri.widgets.Features.FeaturesRelatedRecords")],zt);const _a=zt;var jt=F(36082),Aa=F(48902);class xa{constructor(){this._set=new Set,this._observable=new Aa.s}get size(){return(0,jt.it)(this._observable),this._set.size}add(y){const v=this._set.size;return this._set.add(y),this._set.size!==v&&this._observable.notify(),this}clear(){this._set.size>0&&(this._set.clear(),this._observable.notify())}delete(y){const v=this._set.delete(y);return v&&this._observable.notify(),v}entries(){return(0,jt.it)(this._observable),this._set.entries()}forEach(y,v){(0,jt.it)(this._observable),this._set.forEach((b,w)=>y.call(v,b,w,this),v)}has(y){return(0,jt.it)(this._observable),this._set.has(y)}keys(){return(0,jt.it)(this._observable),this._set.keys()}values(){return(0,jt.it)(this._observable),this._set.values()}[Symbol.iterator](){return(0,jt.it)(this._observable),this._set[Symbol.iterator]()}get[Symbol.toStringTag](){return this._set[Symbol.toStringTag]}}var Ea=F(46367),zs=F(44917);function Ln(g){return g&&"opacity"in g?g.opacity*Ln(g.parent):1}function Tn(){return(Tn=(0,z.Z)(function*(g,y){if(!g)return;const v=g.sourceLayer,b=(null!=y&&y.useSourceLayer?v:g.layer)??v,w=Ln(b);if(null!=g.symbol&&(null==y||!0!==y.ignoreGraphicSymbol)){const se="web-style"===g.symbol.type?yield(0,vt.Q8)(g.symbol,{...y,cache:null!=y?y.webStyleCache:null}):g.symbol.clone();return(0,vt.tb)(se,null,w),se}const M=(null!=y?y.renderer:null)??(b&&"renderer"in b?b.renderer:null);let C=M&&"getSymbolAsync"in M?yield M.getSymbolAsync(g,y):null;if(!C)return;if(C="web-style"===C.type?yield C.fetchSymbol({...y,cache:null!=y?y.webStyleCache:null}):C.clone(),!M||!("visualVariables"in M)||!M.visualVariables?.length)return(0,vt.tb)(C,null,w),C;if("arcadeRequiredForVisualVariables"in M&&M.arcadeRequiredForVisualVariables&&null==y?.arcade){const se={...y};se.arcade=yield(0,kn.LC)(),y=se}const{getColor:A,getOpacity:T,getAllSizes:P,getRotationAngle:R}=yield Promise.resolve().then(F.bind(F,81808)),V=[],B=[],k=[],H=[];for(const se of M.visualVariables)switch(se.type){case"color":V.push(se);break;case"opacity":B.push(se);break;case"rotation":H.push(se);break;case"size":se.target||k.push(se)}const J=!!V.length&&V[V.length-1],ie=J?A(J,g,y):null,ue=!!B.length&&B[B.length-1];let Fe=ue?T(ue,g,y):null;if(null!=w&&(Fe=null!=Fe?Fe*w:w),(0,vt.tb)(C,ie,Fe),k.length){const se=P(k,g,y);yield(0,vt.e3)(C,se)}for(const se of H)(0,vt.BR)(C,R(se,g,y),se.axis);return C})).apply(this,arguments)}function Gs(g){return g&&"function"==typeof g.highlight}F(74741),F(71131),F(34057),F(30695),F(58817),F(66960);var Na=F(59397),Ks=F(10671);const kt=Be.Z.ofType({key:"type",defaultKeyValue:"button",base:Na.Z,typeMap:{button:ae.Z,toggle:Ks.Z}}),St=new ae.Z({icon:"magnifying-glass-plus",id:"zoom-to-feature",title:"{messages.zoom}",className:yt.W.zoomInMagnifyingGlass}),Rn=new ae.Z({icon:"trash",id:"remove-selected-feature",title:"{messages.remove}",className:yt.W.trash}),Wt=new ae.Z({icon:"magnifying-glass-plus",id:"zoom-to-clustered-features",title:"{messages.zoom}",className:yt.W.zoomInMagnifyingGlass}),Et=new Ks.Z({icon:"table",id:"browse-clustered-features",title:"{messages.browseClusteredFeatures}",className:yt.W.table,value:!1}),Ti=Ze.Z.getLogger("esri.widgets.Popup.PopupViewModel"),Ba=g=>{const{event:y,view:v,viewModel:b}=g,{action:w}=y;if(!w)return Promise.reject(new $.Z("trigger-action:missing-arguments","Event has no action"));const{disabled:M,id:C}=w;if(!C)return Promise.reject(new $.Z("trigger-action:invalid-action","action.id is missing"));if(M)return Promise.reject(new $.Z("trigger-action:invalid-action","Action is disabled"));if(C===St.id)return function ja(g){return On.apply(this,arguments)}(b).catch(it.H9);if(C===Wt.id)return function ka(g){return Sn.apply(this,arguments)}(b);if(C===Et.id)return b.browseClusterEnabled=!b.browseClusterEnabled,b.featureMenuOpen=b.browseClusterEnabled,Promise.resolve();if(C===Rn.id){b.visible=!1;const{selectedFeature:A}=b;if(!A)return Promise.reject(new $.Z(`trigger-action:${Rn.id}`,"selectedFeature is required",{selectedFeature:A}));const{sourceLayer:T}=A;return T?T.remove(A):v?.graphics.remove(A),Promise.resolve()}return Promise.resolve()};function Qs(g){const{selectedFeature:y,location:v,view:b}=g;return b?y??v??null:null}function Ht(g){return!!g&&g.isAggregate&&"cluster"===g.sourceLayer?.featureReduction?.type}function Un(){return(Un=(0,z.Z)(function*(g,y){if("3d"!==y?.type||!g||"esri.Graphic"!==g.declaredClass)return!0;const v=y.getViewForGraphic(g);if(v&&"whenGraphicBounds"in v){let b=null;try{b=yield v.whenGraphicBounds(g,{useViewElevation:!0})}catch{}return!b||!b.boundingBox||b.boundingBox[0]===b.boundingBox[3]&&b.boundingBox[1]===b.boundingBox[4]&&b.boundingBox[2]===b.boundingBox[5]}return!0})).apply(this,arguments)}function On(){return On=(0,z.Z)(function*(g){const{location:y,selectedFeature:v,view:b,zoomFactor:w}=g,M=Qs(g);if(!b||!M){const R=new $.Z("zoom-to:invalid-target-or-view","Cannot zoom to location without a target and view.",{target:M,view:b});throw Ti.error(R),R}const C=b.scale/w,A=g.selectedFeature?.geometry,T=A??y,P=null!=T&&"point"===T.type&&(yield function za(g,y){return Un.apply(this,arguments)}(v,b));St.active=!0,St.disabled=!0;try{yield g.zoomTo({target:{target:M,scale:P?C:void 0}})}catch{const V=new $.Z("zoom-to:invalid-graphic","Could not zoom to the location of the graphic.",{graphic:v});Ti.error(V)}finally{St.active=!1,St.disabled=!1,g.zoomToLocation=null,P&&(g.location=T)}}),On.apply(this,arguments)}function Sn(){return(Sn=(0,z.Z)(function*(g){const{selectedFeature:y,view:v}=g;if("2d"!==v?.type){const C=new $.Z("zoomToCluster:invalid-view","View must be 2d MapView.",{view:v});throw Ti.error(C),C}if(!y||!Ht(y)){const C=new $.Z("zoomToCluster:invalid-selectedFeature","Selected feature must represent an aggregate/cluster graphic.",{selectedFeature:y});throw Ti.error(C),C}const[b,w]=yield $n(v,y);Wt.active=!0,Wt.disabled=!0;const{extent:M}=yield b.queryExtent(w);yield g.zoomTo({target:M}),Wt.active=!1,Wt.disabled=!1})).apply(this,arguments)}function Zn(){return(Zn=(0,z.Z)(function*(g){const{view:y,selectedFeature:v}=g;if(!y||!v)return;const[b,w]=yield $n(y,v),{extent:M}=yield b.queryExtent(w);g.selectedClusterBoundaryFeature.geometry=M,y.graphics.add(g.selectedClusterBoundaryFeature)})).apply(this,arguments)}function Vn(){return(Vn=(0,z.Z)(function*(g){const{selectedFeature:y,view:v}=g;if(!v||!y)return;const[b,w]=yield $n(v,y);Et.active=!0,Et.disabled=!0;const{features:M}=yield b.queryFeatures(w);Et.active=!1,Et.disabled=!1,Et.value=!0,g?.open({features:[y].concat(M),featureMenuOpen:!0})})).apply(this,arguments)}function $n(g,y){return Nn.apply(this,arguments)}function Nn(){return(Nn=(0,z.Z)(function*(g,y){const v=yield g.whenLayerView(y.sourceLayer),b=v.createQuery(),w=y.getObjectId();return b.aggregateIds=null!=w?[w]:[],[v,b]})).apply(this,arguments)}function Xs(g){if(null==g)return null;switch(g.type){case"point":return g;case"extent":return g.center;case"polygon":return g.centroid;case"multipoint":case"polyline":return g.extent?.center;default:return null}}var Ga=F(67436),Ka=F(88493);let we=class extends((0,Ga._)(Ds)){constructor(g){super(g),this._pendingPromises=new xa,this._fetchFeaturesController=null,this._highlightSelectedFeaturePromise=null,this._highlightActiveFeaturePromise=null,this._selectedClusterFeature=null,this.actions=new kt,this.activeFeature=null,this.autoCloseEnabled=!1,this.autoOpenEnabled=!0,this.browseClusterEnabled=!1,this.content=null,this.defaultPopupTemplateEnabled=!1,this.featurePage=null,this.featuresPerPage=20,this.featureMenuOpen=!1,this.featureViewModelAbilities=null,this.featureViewModels=[],this.highlightEnabled=!0,this.includeDefaultActions=!0,this.selectedClusterBoundaryFeature=new at.Z({symbol:new Ka.Z({outline:{width:1.5,color:"cyan"},style:"none"})}),this.title=null,this.updateLocationEnabled=!1,this.view=null,this.visible=!1,this.zoomFactor=4,this.zoomToLocation=null}initialize(){this.addHandles([this.on("view-change",()=>this._autoClose()),(0,N.YP)(()=>[this.highlightEnabled,this.selectedFeature,this.visible,this.view],()=>this._highlightSelectedFeature()),(0,N.YP)(()=>[this.highlightEnabled,this.activeFeature,this.visible,this.view],()=>this._highlightActiveFeature()),(0,N.YP)(()=>this.view?.animation?.state,g=>this._animationStateChange(g)),(0,N.YP)(()=>this.location,g=>this._locationChange(g)),(0,N.YP)(()=>this.selectedFeature,g=>this._selectedFeatureChange(g)),(0,N.YP)(()=>[this.selectedFeatureIndex,this.featureCount,this.featuresPerPage],()=>this._selectedFeatureIndexChange()),(0,N.YP)(()=>[this.featurePage,this.selectedFeatureIndex,this.featureCount,this.featuresPerPage,this.featureViewModels],()=>this._setGraphicOnFeatureViewModels()),(0,N.YP)(()=>this.featureViewModels,()=>this._featureViewModelsChange()),this.on("trigger-action",g=>Ba({event:g,viewModel:this,view:this.view})),(0,N.gx)(()=>!this.waitingForResult,()=>this._waitingForResultChange(),N.Z_),(0,N.YP)(()=>[this.features,this.view?.map,this.view?.spatialReference],()=>this._updateFeatureVMs()),(0,N.YP)(()=>this.view?.scale,()=>this._viewScaleChange()),(0,N.gx)(()=>!this.visible,()=>this.browseClusterEnabled=!1),(0,N.YP)(()=>this.browseClusterEnabled,g=>g?this.enableClusterBrowsing():this.disableClusterBrowsing())])}destroy(){this._cancelFetchingFeatures(),this._pendingPromises.clear(),this.browseClusterEnabled=!1,this.view=null}get active(){return!(!this.visible||this.waitingForResult)}get allActions(){const g=this._get("allActions")||new kt;g.removeAll();const{actions:y,defaultActions:v,defaultPopupTemplateEnabled:b,includeDefaultActions:w,selectedFeature:M}=this,C=w?v.concat(y):y,A=M&&("function"==typeof M.getEffectivePopupTemplate&&M.getEffectivePopupTemplate(b)||M.popupTemplate),T=A?.actions;return(A?.overwriteActions?T:T?.concat(C)??C)?.filter(Boolean).forEach(R=>g.add(R)),g}get defaultActions(){const g=this._get("defaultActions")||new kt;return g.removeAll(),g.addMany(Ht(this.selectedFeature)?[Wt.clone(),Et.clone()]:[St.clone()]),g}get featureCount(){return this.features.length}set features(g){const y=g||[];this._set("features",y);const{pendingPromisesCount:v,promiseCount:b,selectedFeatureIndex:w}=this,M=b&&y.length;M&&v&&-1===w?this.selectedFeatureIndex=0:M&&-1!==w||(this.selectedFeatureIndex=y.length?0:-1)}set location(g){let y=g;const v=this.view?.spatialReference?.isWebMercator;g?.spatialReference?.isWGS84&&v&&(y=(0,Ea.$)(g)),this._set("location",y)}get pendingPromisesCount(){return this._pendingPromises.size}get promiseCount(){return this.promises.length}get promises(){return this._get("promises")||[]}set promises(g){this._pendingPromises.clear(),this.features=[],Array.isArray(g)&&g.length?(this._set("promises",g),(g=g.slice(0)).forEach(y=>{this._pendingPromises.add(y),y.then(w=>{this._pendingPromises.has(y)&&this._updateFeatures(w),this._updatePendingPromises(y)},()=>this._updatePendingPromises(y))})):this._set("promises",[])}get selectedFeature(){const{features:g,selectedFeatureIndex:y}=this;return-1===y?null:g[y]||null}get selectedFeatureIndex(){const g=this._get("selectedFeatureIndex");return"number"==typeof g?g:-1}set selectedFeatureIndex(g){const{featureCount:y}=this;g=isNaN(g)||g<-1||!y?-1:(g+y)%y,this.activeFeature=null,this._set("selectedFeatureIndex",g)}get selectedFeatureViewModel(){return this.featureViewModels[this.selectedFeatureIndex]||null}get state(){return this.view?.ready?"ready":"disabled"}get waitingForContents(){return this.featureViewModels.some(g=>g.waitingForContent)}get waitingForResult(){return!(!(this._fetchFeaturesController||this.pendingPromisesCount>0)||0!==this.featureCount)}centerAtLocation(){const{view:g}=this,y=Qs(this);return y&&g?this.callGoTo({target:{target:y,scale:g.scale}}):Promise.reject(new $.Z("center-at-location:invalid-target-or-view","Cannot center at a location without a target and view.",{target:y,view:g}))}zoomTo(g){return this.callGoTo(g)}clear(){this.set({promises:[],features:[],content:null,title:null,location:null,activeFeature:null})}fetchFeatures(g,y){const{view:v}=this;if(!v||!g)throw new $.Z("fetch-features:invalid-screenpoint-or-view","Cannot fetch features without a screenPoint and view.",{screenPoint:g,view:v});return v.fetchPopupFeatures(g,{event:y?.event,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,signal:y?.signal})}open(g){const y={updateLocationEnabled:!1,promises:[],fetchFeatures:!1,...g,visible:!0},{fetchFeatures:v}=y;delete y.fetchFeatures,v&&this._setFetchFeaturesPromises(y.location);const b=["actionsMenuOpen","collapsed"];for(const w of b)delete y[w];this.set(y)}triggerAction(g){const y=this.allActions.at(g);y&&!y.disabled&&this.emit("trigger-action",{action:y})}next(){return this.selectedFeatureIndex++,this}previous(){return this.selectedFeatureIndex--,this}disableClusterBrowsing(){(function Ya(g){Et.value=!1;const y=g.features.filter(v=>Ht(v));y.length&&(g.features=y)})(this),this._clearBrowsedClusterGraphics()}enableClusterBrowsing(){var g=this;return(0,z.Z)(function*(){const{view:y,selectedFeature:v}=g;"2d"===y?.type?Ht(v)?(yield function Wa(g){return Zn.apply(this,arguments)}(g),yield function Ha(g){return Vn.apply(this,arguments)}(g)):Ze.Z.getLogger(g).warn("enableClusterBrowsing:invalid-selectedFeature: Selected feature must represent an aggregate/cluster graphic.",v):Ze.Z.getLogger(g).warn("enableClusterBrowsing:invalid-view: View must be 2d MapView.",v)})()}handleViewClick(g){this.autoOpenEnabled&&this._fetchFeaturesAndOpen(g)}_animationStateChange(g){this.zoomToLocation||(St.disabled="waiting-for-target"===g)}_clearBrowsedClusterGraphics(){const g=[this.selectedClusterBoundaryFeature,this._selectedClusterFeature].filter($e.pC);this.view?.graphics?.removeMany(g),this._selectedClusterFeature=null,this.selectedClusterBoundaryFeature.geometry=null}_viewScaleChange(){if(Ht(this.selectedFeature))return this.browseClusterEnabled=!1,this.visible=!1,void this.clear();this.browseClusterEnabled&&(this.features=this.selectedFeature?[this.selectedFeature]:[])}_locationChange(g){const{selectedFeature:y,updateLocationEnabled:v}=this;v&&g&&(!y||y.geometry)&&this.centerAtLocation()}_selectedFeatureIndexChange(){this.featurePage=this.featureCount>1?Math.floor(this.selectedFeatureIndex/this.featuresPerPage)+1:null}_featureViewModelsChange(){this.featurePage=this.featureCount>1?1:null}_setGraphicOnFeatureViewModels(){const{features:g,featureCount:y,featurePage:v,featuresPerPage:b,featureViewModels:w}=this;if(null===v)return;const M=((v-1)*b+y)%y;w.slice(M,M+b).forEach((A,T)=>{A&&(A.graphic??=g[M+T])})}_selectedFeatureChange(g){var y=this;return(0,z.Z)(function*(){const{location:v,updateLocationEnabled:b,view:w}=y;if(g&&w){if(y.browseClusterEnabled)return y._selectedClusterFeature&&(w.graphics.remove(y._selectedClusterFeature),y._selectedClusterFeature=null),Ht(g)?void 0:(g.symbol=yield function $a(g,y){return Tn.apply(this,arguments)}(g),y._selectedClusterFeature=g,void w.graphics.add(y._selectedClusterFeature));if(!b&&v||!g.geometry){if(b&&!g.geometry){yield y.centerAtLocation();const M=w.center?.clone();M&&(y.location=M)}}else y.location=Xs(g.geometry)}})()}_waitingForResultChange(){!this.featureCount&&this.promises&&(this.visible=!1)}_setFetchFeaturesPromises(g){var y=this;return(0,z.Z)(function*(){const{clientOnlyGraphics:v,promisesPerLayerView:b}=yield y._fetchFeaturesWithController(y._getScreenPoint(g||y.location)),w=Promise.resolve(v),M=b.map(C=>C.promise);y.promises=[w,...M]})()}_destroyFeatureVMs(){this.featureViewModels.forEach(g=>g&&!g.destroyed&&g.destroy()),this._set("featureViewModels",[])}_updateFeatureVMs(){const{selectedFeature:g,features:y,featureViewModels:v,view:b}=this;if(Ht(g)||(this.browseClusterEnabled=!1),this._destroyFeatureVMs(),!y?.length)return;const w=v.slice(0),M=[];y.forEach((C,A)=>{if(!C)return;let T=null;if(w.some((P,R)=>(P&&P.graphic===C&&(T=P,w.splice(R,1)),!!T)),T)M[A]=T;else{const P=new In({abilities:this.featureViewModelAbilities,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,spatialReference:b?.spatialReference,graphic:C===g?C:null,map:b?.map,view:b});M[A]=P}}),w.forEach(C=>C&&!C.destroyed&&C.destroy()),this._set("featureViewModels",M)}_getScreenPoint(g){const{view:y}=this;return y&&g&&"function"==typeof y.toScreen?y.toScreen(g):null}_cancelFetchingFeatures(){const g=this._fetchFeaturesController;g&&g.abort(),this._fetchFeaturesController=null}_fetchFeaturesWithController(g,y){this._cancelFetchingFeatures();const v=new AbortController,{signal:b}=v;this._fetchFeaturesController=v;const w=this.fetchFeatures(g,{signal:b,event:y});return w.catch(()=>{}).then(()=>{this._fetchFeaturesController=null}),w}_fetchFeaturesAndOpen(g){var y=this;return(0,z.Z)(function*(){const{screenPoint:v,mapPoint:b}=g,{view:w}=y,{clientOnlyGraphics:M,promisesPerLayerView:C,location:A}=yield y._fetchFeaturesWithController(v,g),T=[Promise.resolve(M),...C.map(P=>P.promise)];w?.popup&&"open"in w.popup&&w.popup.open({location:A||b,promises:T})})()}_updatePendingPromises(g){g&&this._pendingPromises.has(g)&&this._pendingPromises.delete(g)}_autoClose(){this.autoCloseEnabled&&(this.visible=!1)}_getLayerView(g,y){return(0,z.Z)(function*(){return yield g.when(),g.whenLayerView(y)})()}_getHighlightLayer(g){const{layer:y,sourceLayer:v}=g;return v&&"layer"in v&&v.layer?v.layer:"map-notes"===v?.type||"subtype-group"===v?.type?v:y}_getHighlightTarget(g,y){const v="imagery"===y.type?void 0:"objectIdField"in y?y.objectIdField||"OBJECTID":null,b=g.attributes;return b&&v&&b[v]||g}_mapIncludesLayer(g){return!!this.view?.map?.allLayers?.includes(g)}_highlightActiveFeature(){var g=this;return(0,z.Z)(function*(){const y="highlight-active-feature";g.removeHandles(y);const{highlightEnabled:v,view:b,activeFeature:w,visible:M}=g;if(!(w&&b&&v&&M))return;const C=g._getHighlightLayer(w);if(!(C&&C instanceof zs.Z&&g._mapIncludesLayer(C)))return;const A=g._getLayerView(b,C);g._highlightActiveFeaturePromise=A;const T=yield A;if(!(T&&Gs(T)&&g._highlightActiveFeaturePromise===A&&g.activeFeature&&g.highlightEnabled))return;const P=T.highlight(g._getHighlightTarget(w,C));g.addHandles(P,y)})()}_highlightSelectedFeature(){var g=this;return(0,z.Z)(function*(){const y="highlight-selected-feature";g.removeHandles(y);const{selectedFeature:v,highlightEnabled:b,view:w,visible:M}=g;if(!(v&&w&&b&&M))return;const C=g._getHighlightLayer(v);if(!(C&&C instanceof zs.Z&&g._mapIncludesLayer(C)))return;const A=g._getLayerView(w,C);g._highlightSelectedFeaturePromise=A;const T=yield A;if(!(T&&Gs(T)&&g._highlightSelectedFeaturePromise===A&&g.selectedFeature&&g.highlightEnabled&&g.visible))return;const P=T.highlight(g._getHighlightTarget(v,C));g.addHandles(P,y)})()}_updateFeatures(g){const{features:y}=this;if(!g?.length)return;if(!y.length)return void(this.features=g);const v=g.filter(b=>!y.includes(b));this.features=y.concat(v)}};(0,I._)([(0,x.Cb)()],we.prototype,"_fetchFeaturesController",void 0),(0,I._)([(0,x.Cb)({type:kt})],we.prototype,"actions",void 0),(0,I._)([(0,x.Cb)({readOnly:!0})],we.prototype,"active",null),(0,I._)([(0,x.Cb)()],we.prototype,"activeFeature",void 0),(0,I._)([(0,x.Cb)({readOnly:!0})],we.prototype,"allActions",null),(0,I._)([(0,x.Cb)()],we.prototype,"autoCloseEnabled",void 0),(0,I._)([(0,x.Cb)()],we.prototype,"autoOpenEnabled",void 0),(0,I._)([(0,x.Cb)()],we.prototype,"browseClusterEnabled",void 0),(0,I._)([(0,x.Cb)()],we.prototype,"content",void 0),(0,I._)([(0,x.Cb)({type:kt,readOnly:!0})],we.prototype,"defaultActions",null),(0,I._)([(0,x.Cb)({type:Boolean})],we.prototype,"defaultPopupTemplateEnabled",void 0),(0,I._)([(0,x.Cb)({readOnly:!0})],we.prototype,"featureCount",null),(0,I._)([(0,x.Cb)()],we.prototype,"featurePage",void 0),(0,I._)([(0,x.Cb)({value:[]})],we.prototype,"features",null),(0,I._)([(0,x.Cb)()],we.prototype,"featuresPerPage",void 0),(0,I._)([(0,x.Cb)()],we.prototype,"featureMenuOpen",void 0),(0,I._)([(0,x.Cb)()],we.prototype,"featureViewModelAbilities",void 0),(0,I._)([(0,x.Cb)({readOnly:!0})],we.prototype,"featureViewModels",void 0),(0,I._)([(0,x.Cb)()],we.prototype,"highlightEnabled",void 0),(0,I._)([(0,x.Cb)()],we.prototype,"includeDefaultActions",void 0),(0,I._)([(0,x.Cb)({type:Ar.Z})],we.prototype,"location",null),(0,I._)([(0,x.Cb)({readOnly:!0})],we.prototype,"pendingPromisesCount",null),(0,I._)([(0,x.Cb)({readOnly:!0})],we.prototype,"promiseCount",null),(0,I._)([(0,x.Cb)()],we.prototype,"promises",null),(0,I._)([(0,x.Cb)({readOnly:!0})],we.prototype,"selectedClusterBoundaryFeature",void 0),(0,I._)([(0,x.Cb)({value:null,readOnly:!0})],we.prototype,"selectedFeature",null),(0,I._)([(0,x.Cb)({value:-1})],we.prototype,"selectedFeatureIndex",null),(0,I._)([(0,x.Cb)({readOnly:!0})],we.prototype,"selectedFeatureViewModel",null),(0,I._)([(0,x.Cb)({readOnly:!0})],we.prototype,"state",null),(0,I._)([(0,x.Cb)()],we.prototype,"title",void 0),(0,I._)([(0,x.Cb)()],we.prototype,"updateLocationEnabled",void 0),(0,I._)([(0,x.Cb)()],we.prototype,"view",void 0),(0,I._)([(0,x.Cb)()],we.prototype,"visible",void 0),(0,I._)([(0,x.Cb)({readOnly:!0})],we.prototype,"waitingForContents",null),(0,I._)([(0,x.Cb)({readOnly:!0})],we.prototype,"waitingForResult",null),(0,I._)([(0,x.Cb)()],we.prototype,"zoomFactor",void 0),(0,I._)([(0,x.Cb)()],we.prototype,"zoomToLocation",void 0),(0,I._)([(0,x.Cb)()],we.prototype,"centerAtLocation",null),we=(0,I._)([(0,re.j)("esri.widgets.Features.FeaturesViewModel")],we);const Dn=we;let Lt=class extends lt.Z{constructor(){super(...arguments),this.actionBar=!0,this.closeButton=!0,this.collapseButton=!1,this.featureNavigation=!0,this.heading=!0,this.spinner=!0}};(0,I._)([(0,x.Cb)({type:Boolean,nonNullable:!0})],Lt.prototype,"actionBar",void 0),(0,I._)([(0,x.Cb)({type:Boolean,nonNullable:!0})],Lt.prototype,"closeButton",void 0),(0,I._)([(0,x.Cb)({type:Boolean,nonNullable:!0})],Lt.prototype,"collapseButton",void 0),(0,I._)([(0,x.Cb)({type:Boolean,nonNullable:!0})],Lt.prototype,"featureNavigation",void 0),(0,I._)([(0,x.Cb)({type:Boolean,nonNullable:!0})],Lt.prototype,"heading",void 0),(0,I._)([(0,x.Cb)({type:Boolean,nonNullable:!0})],Lt.prototype,"spinner",void 0),Lt=(0,I._)([(0,re.j)("esri.widgets.Features.FeaturesVisibleElements")],Lt);const Js=Lt;function qs(g){return y=>{y.hasOwnProperty("_delegatedEventNames")||(y._delegatedEventNames=y._delegatedEventNames?y._delegatedEventNames.slice():[]);const v=y._delegatedEventNames,b=Array.isArray(g)?g:function Ja(g){return g.split(",").map(y=>y.trim())}(g);v.push(...b)}}const eo="selected-index",to="features-spinner";let Se=class extends(Vs(Y.Z)){constructor(g,y){var v;super(g,y),v=this,this._featureMenuIntersectionObserverCallback=([b])=>{b?.isIntersecting&&null!=this.viewModel.featurePage&&this.viewModel.featurePage++},this._featureMenuIntersectionObserver=new IntersectionObserver(this._featureMenuIntersectionObserverCallback,{root:window.document}),this._featureMenuIntersectionObserverNode=null,this._focusOn=null,this._spinner=null,this._feature=null,this._relatedRecordsFlowItems=new Be.Z,this._relatedRecordsWidget=new _a({flowItems:this._relatedRecordsFlowItems}),this._rootFlowItemNode=null,this._featureMenuViewportNode=null,this.collapsed=!1,this.icon=null,this.featureNavigationTop=!1,this.headerActions=new kt,this.headingLevel=2,this.messages=null,this.messagesCommon=null,this.responsiveActionsEnabled=!1,this.viewModel=new Dn,this.visibleElements=new Js,this._renderAction=(b,w)=>{const M=this._getActionTitle(b),{type:C,active:A,uid:T,disabled:P,indicator:R}=b;return b.visible?(0,O.u)("calcite-action",{active:"toggle"===C&&b.value,appearance:"solid",bind:this,"data-action-uid":T,disabled:P,icon:this._getActionIcon(b),indicator:R,key:`action-${w}`,loading:A,onclick:this._triggerAction,scale:"s",text:M,title:this._hideActionText?M:void 0},this._getFallbackIcon(b)):null},this._openFeatureMenu=()=>{this.featureMenuOpen=!0},this._previousFeature=()=>{this.viewModel.selectedFeatureIndex--},this._nextFeature=()=>{this.viewModel.selectedFeatureIndex++},this._handleFeatureMenuBack=()=>{this.featureMenuOpen&&(this._focusOn="root-flow-item",this.featureMenuOpen=!1)},this._focusFlowItemNode=b=>{this._focusOn===b&&requestAnimationFrame((0,z.Z)(function*(){switch(b){case"menu-flow-item":yield v._featureMenuViewportNode?.setFocus();break;case"root-flow-item":yield v._rootFlowItemNode?.setFocus()}v._focusOn=null}))},this._focusFlowItemNodeThrottled=(0,j.P)(this._focusFlowItemNode,50),this._displaySpinnerThrottled=(0,j.P)(()=>this._displaySpinner(),0),this._addSelectedFeatureIndexHandle(),this.addHandles([this._displaySpinnerThrottled,this._focusFlowItemNodeThrottled,(0,N.YP)(()=>this.viewModel?.active,()=>this._toggleScreenLocationEnabled()),(0,N.YP)(()=>this.viewModel?.active,b=>this._relatedRecordsWidget.closed=!b),(0,N.YP)(()=>this.visibleElements?.closeButton,b=>this._relatedRecordsWidget.closable=b),(0,N.YP)(()=>this.visibleElements?.spinner,b=>this._spinnerEnabledChange(b)),(0,N.YP)(()=>this.viewModel?.view,(b,w)=>this._viewChange(b,w)),(0,N.YP)(()=>this.viewModel?.view?.ready,(b,w)=>this._viewReadyChange(b??!1,w??!1)),(0,N.YP)(()=>[this.viewModel?.waitingForResult,this.viewModel?.location],()=>{this._hideSpinner(),this._displaySpinnerThrottled()}),(0,N.YP)(()=>this.selectedFeatureWidget,()=>this._destroyRelatedRecordsFlowItemWidgets()),(0,N.YP)(()=>{const b=this.selectedFeatureWidget?.viewModel;return[b?.title,b?.state]},()=>this._setTitleFromFeatureWidget()),(0,N.YP)(()=>{const b=this.selectedFeatureWidget?.viewModel;return[b?.content,b?.state]},()=>this._setContentFromFeatureWidget()),(0,N.YP)(()=>this.viewModel?.featureViewModels,()=>this._featureMenuViewportScrollTop()),this._relatedRecordsWidget.on("close",()=>this.close()),this._relatedRecordsWidget.on("exit",()=>this._destroyRelatedRecordsFlowItemWidgets()),this._relatedRecordsWidget.on("open-related-feature",({feature:b})=>this._openRelatedFeature(b))])}loadDependencies(){return(0,Kt.h)({action:()=>Promise.all([F.e(6554),F.e(8346),F.e(2573)]).then(F.bind(F,52573)),"action-bar":()=>Promise.all([F.e(6554),F.e(8346),F.e(4792),F.e(8592),F.e(7533)]).then(F.bind(F,67533)),"action-group":()=>Promise.all([F.e(6554),F.e(8346),F.e(4792),F.e(8592),F.e(9758)]).then(F.bind(F,89758)),button:()=>Promise.all([F.e(6554),F.e(3468),F.e(9338)]).then(F.bind(F,9268)),flow:()=>F.e(8178).then(F.bind(F,58178)),"flow-item":()=>Promise.all([F.e(6554),F.e(8346),F.e(4792),F.e(8592),F.e(9922)]).then(F.bind(F,59922)),list:()=>Promise.all([F.e(6554),F.e(3468),F.e(8592),F.e(5988)]).then(F.bind(F,85988)),"list-item":()=>Promise.all([F.e(6554),F.e(8346),F.e(8592),F.e(4141)]).then(F.bind(F,94141)),"list-item-group":()=>Promise.all([F.e(8592),F.e(7400)]).then(F.bind(F,27400)),loader:()=>F.e(5210).then(F.bind(F,5210))})}destroy(){this._destroyRelatedRecordsFlowItemWidgets(),this._destroySelectedFeatureWidget(),this._destroySpinner(),this._unobserveFeatureMenuObserver(),this._featureMenuIntersectionObserver?.disconnect(),this._relatedRecordsWidget?.destroy()}get _hideActionText(){if(!this.responsiveActionsEnabled)return!1;const g=this.view?.widthBreakpoint;return"xsmall"===g||"small"===g||"medium"===g}get _featureNavigationVisible(){return this.viewModel.active&&this.viewModel.featureCount>1&&this.visibleElements.featureNavigation}get _isCollapsed(){return this._collapseEnabled&&this.collapsed}get _collapseEnabled(){return this.visibleElements.collapseButton&&!!this.title&&!!this.content}get content(){return this.viewModel.content}set content(g){this.viewModel.content=g}get featureMenuOpen(){return this.viewModel.featureMenuOpen}set featureMenuOpen(g){this.viewModel.featureMenuOpen=g}get features(){return this.viewModel.features}set features(g){this.viewModel.features=g}get location(){return this.viewModel.location}set location(g){this.viewModel.location=g}get label(){return this.messages?.widgetLabel??""}set label(g){this._overrideIfSome("label",g)}get promises(){return this.viewModel.promises}set promises(g){this.viewModel.promises=g}get selectedFeature(){return this.viewModel.selectedFeature}get selectedFeatureIndex(){return this.viewModel.selectedFeatureIndex}set selectedFeatureIndex(g){this.viewModel.selectedFeatureIndex=g}get selectedFeatureWidget(){const{_feature:g,headingLevel:y,_relatedRecordsFlowItems:v}=this,{selectedFeatureViewModel:b}=this.viewModel,w={title:!1};return b?(g?(g.viewModel=b,g.visibleElements=w):this._feature=new Ma({flowItems:v,headingLevel:y+1,viewModel:b,visibleElements:w}),this._feature):null}get title(){return this.viewModel.title}set title(g){this.viewModel.title=g}get updateLocationEnabled(){return this.viewModel.updateLocationEnabled}set updateLocationEnabled(g){this.viewModel.updateLocationEnabled=g}get view(){return this.viewModel.view}set view(g){this.viewModel.view=g}get visible(){return this.viewModel.visible}set visible(g){this.viewModel.visible=g}blur(){const{active:g}=this.viewModel;g?this._rootFlowItemNode?.blur():Ze.Z.getLogger(this).warn("Features can only be blurred when currently active.")}clear(){return this.viewModel.clear()}close(){this.viewModel.visible=!1}fetchFeatures(g,y){return this.viewModel.fetchFeatures(g,y)}focus(){const{active:g}=this.viewModel;g?this._setFocusOn():Ze.Z.getLogger(this).warn("Features can only be focused when currently active.")}next(){return this.viewModel.next()}open(g){this.removeHandles(eo),this.set({collapsed:g?.collapsed??!1}),this.viewModel.open(g),this.addHandles((0,N.gx)(()=>!this.viewModel.waitingForResult,()=>this._addSelectedFeatureIndexHandle(),{once:!0}))}previous(){return this.viewModel.previous()}triggerAction(g){return this.viewModel.triggerAction(g)}render(){return(0,O.u)("div",{bind:this,class:this.classes(nt.base,be.z.widget,be.z.panel),onkeydown:this._onMainKeydown},this._renderHeader(),this._renderContentContainer())}_renderFeatureNavigation(){return[this._renderPagination(),this._renderFeatureMenuButton()]}_renderHeader(){return!this.featureMenuOpen&&this.featureNavigationTop&&this._featureNavigationVisible?(0,O.u)("div",{class:nt.header,key:"header-actions"},this._renderFeatureNavigation()):null}_renderFooter(){return this.featureMenuOpen||this.featureNavigationTop||!this._featureNavigationVisible?null:(0,O.u)("div",{class:nt.footer,key:"footer-actions",slot:"footer"},this._renderFeatureNavigation())}_renderFeatureMenuButton(){const{messages:g,viewModel:y}=this,{featureCount:v,selectedFeatureIndex:b,pendingPromisesCount:w}=y;return(0,O.u)("calcite-action",{appearance:"solid",bind:this,icon:"list",key:"feature-menu-button",label:g.selectFeature,loading:w>0,onclick:this._openFeatureMenu,scale:"s",text:(0,It.n)(g.pageText,{index:(0,E.uf)(b+1),total:(0,E.uf)(v)}),textEnabled:!0,title:g.selectFeature})}_renderPagination(){const{previous:g,next:y}=this.messagesCommon.pagination;return(0,O.u)("calcite-action-bar",{class:nt.paginationActionBar,expandDisabled:!0,key:"pagination-action-bar",layout:"horizontal",overflowActionsDisabled:!0,scale:"s"},(0,O.u)("calcite-action-group",{scale:"s"},(0,O.u)("calcite-action",{appearance:"solid",class:nt.paginationPrevious,icon:"chevron-left",iconFlipRtl:!0,label:g,onclick:this._previousFeature,scale:"s",text:g,title:g}),(0,O.u)("calcite-action",{appearance:"solid",icon:"chevron-right",iconFlipRtl:!0,label:y,onclick:this._nextFeature,scale:"s",text:y,title:y})))}_renderFeatureMenuItem(g){const{selectedFeatureViewModel:y,featureViewModels:v}=this.viewModel,b=g===y,w=v.indexOf(g);return(0,O.u)("calcite-list-item",{bind:this,"data-feature-index":w,key:`feature-menu-item-${g.uid}`,onblur:this._removeActiveFeature,onfocus:this._setActiveFeature,onmouseleave:this._removeActiveFeature,onmouseover:this._setActiveFeature,selected:b,onCalciteListItemSelect:this._selectFeature},(0,O.u)("span",{innerHTML:g.title||this.messagesCommon.untitled,slot:"content"}))}_groupResultsByLayer(){const{featureViewModels:g}=this.viewModel,y=new Map;return g.forEach(v=>{const b=v?.graphic;if(!b)return;const w=b.sourceLayer??b.layer,M=y.get(w)??[];y.set(w,[...M,v])}),y}_renderFeatureMenu(){const{featureViewModels:g}=this.viewModel,y=this._groupResultsByLayer();return g.length?(0,O.u)("calcite-list",{selectionAppearance:"icon",selectionMode:"single"},Array.from(y.keys()).map(v=>(0,O.u)("calcite-list-item-group",{heading:v?.title??this.messagesCommon.untitled,key:v?.uid||"untitled"},y.get(v)?.map(b=>this._renderFeatureMenuItem(b))))):null}_renderHeaderAction(g,y){return g.visible?(0,O.u)("calcite-action",{active:"toggle"===g.type&&g.value,appearance:"solid",bind:this,"data-action-uid":g.uid,disabled:g.disabled,icon:g.icon||"",indicator:g.indicator,key:`header-action-${y}`,loading:g.active,onclick:this._triggerHeaderAction,scale:"m",slot:"header-actions-end",text:g.title||"",title:g.title||""}):null}_renderHeaderActions(){return this.headerActions.map((g,y)=>this._renderHeaderAction(g,y)).toArray()}_renderContentFeature(){const{headingLevel:g,visibleElements:y,_isCollapsed:v,_collapseEnabled:b,featureNavigationTop:w}=this,{title:M,active:C}=this.viewModel,A=y.heading&&M?M:"";return(0,O.u)("calcite-flow-item",{afterCreate:this._storeRootFlowItemNode,afterUpdate:this._focusRootFlowItemNode,bind:this,class:this.classes({[nt.contentFeature]:!0,[nt.flowItemCollapsed]:v}),closable:y.closeButton,closed:!C,collapsed:v,collapseDirection:w?"down":"up",collapsible:b,headingLevel:g,key:"root-flow-item",onCalciteFlowItemClose:this.close,onCalciteFlowItemToggle:this._handleCollapseToggle},A?(0,O.u)(Ki.X,{class:this.classes(nt.featuresHeading,be.z.heading),innerHTML:A,key:"header-content",level:this.headingLevel,slot:"header-content"}):null,this._renderHeaderActions(),this._renderActionBar(),v?null:(0,O.u)("div",{class:this.classes(nt.container,nt.contentContainer)},this._renderContent()),this._renderFooter())}_renderFeatureMenuContainer(){const{viewModel:g,featureMenuOpen:y,messages:v,messagesCommon:b}=this,{active:w,featureViewModels:M,pendingPromisesCount:C}=g;return y?(0,O.u)("calcite-flow-item",{afterCreate:this._storeFeatureMenuFlowItemNode,afterUpdate:this._focusFeatureMenuFlowItemNode,bind:this,closable:!1,closed:!w,description:(0,It.n)(v.total,{total:M.length}),heading:v.selectFeature,key:"feature-menu",loading:g.waitingForContents,onCalciteFlowItemBack:this._handleFeatureMenuBack},C>0?(0,O.u)("calcite-loader",{class:nt.loader,inline:!0,key:"feature-menu-loader",label:b.loading,scale:"m",slot:"header-actions-end"}):null,(0,O.u)("div",{class:nt.container},this._renderFeatureMenu()),(0,O.u)("div",{afterCreate:this._featureMenuIntersectionObserverCreated,bind:this,class:nt.featureMenuObserver}),(0,O.u)("calcite-button",{appearance:"transparent",onclick:this._handleFeatureMenuBack,slot:"footer-actions",width:"full"},b.back)):null}_renderContentContainer(){return(0,O.u)("calcite-flow",{key:"content-container"},this._renderContentFeature(),this._renderFeatureMenuContainer(),this._relatedRecordsWidget.render())}_getIconStyles(g){return{"background-image":g?`url(${g})`:""}}_getActionImage(g){const{selectedFeature:y}=this,v=y?.attributes,{image:b}=g;return b&&v?(0,It.n)(b,v):b??""}_getFallbackIcon(g){const{className:y,icon:v}=g;if(v)return null;const b=this._getActionImage(g),w={[nt.icon]:!!y,[nt.actionImage]:!!b};return y&&(w[y]=!0),b||y?(0,O.u)("span",{"aria-hidden":"true",class:this.classes(nt.icon,w),key:"icon",styles:b?this._getIconStyles(b):{}}):null}_renderActionBar(){return!this._isCollapsed&&this.visibleElements.actionBar&&this.viewModel.allActions?.length?(0,O.u)("calcite-action-bar",{expandDisabled:!0,expanded:!this._hideActionText,key:"header-action-bar",scale:"s",slot:"action-bar"},(0,O.u)("calcite-action-group",{overlayPositioning:"fixed",scale:"s"},this._renderActions())):null}_renderActions(){return this.viewModel.allActions.toArray().map(this._renderAction)}_renderContent(){const g=this.viewModel?.content;return g?"string"==typeof g?(0,O.u)("div",{class:Ye.i.contentNode,innerHTML:g,key:g}):this.renderNodeContent(g):null}_setFocusOn(){this._focusOn=this.featureMenuOpen?"menu-flow-item":"root-flow-item",this.renderNow()}_handleCollapseToggle(){this.collapsed=!this.collapsed}_openRelatedFeature(g){var y=this;return(0,z.Z)(function*(){yield g.viewModel.updateGeometry();const v=g.graphic,b=v?.geometry;if(null==b||null==v)return;y._destroyRelatedRecordsFlowItemWidgets(),yield y.viewModel.zoomTo({target:b});const w=Xs(b);y.open({features:[v],location:w??void 0})})()}_focusRootFlowItemNode(){this._focusFlowItemNodeThrottled("root-flow-item")}_focusFeatureMenuFlowItemNode(){this._focusFlowItemNodeThrottled("menu-flow-item")}_storeRootFlowItemNode(g){this._rootFlowItemNode=g,this._focusFlowItemNodeThrottled("root-flow-item")}_storeFeatureMenuFlowItemNode(g){this._featureMenuViewportNode=g,this._focusFlowItemNodeThrottled("menu-flow-item")}_setActiveFeature(g){const{viewModel:y}=this;y.activeFeature=y.features?.[g.currentTarget["data-feature-index"]]||null}_removeActiveFeature(){this.viewModel.activeFeature=null}_selectFeature(g){const y=g.currentTarget["data-feature-index"];isNaN(y)||(this.viewModel.selectedFeatureIndex=y),this._handleFeatureMenuBack()}_unobserveFeatureMenuObserver(){this._featureMenuIntersectionObserverNode&&this._featureMenuIntersectionObserver.unobserve(this._featureMenuIntersectionObserverNode)}_featureMenuIntersectionObserverCreated(g){this._unobserveFeatureMenuObserver(),this._featureMenuIntersectionObserver.observe(g),this._featureMenuIntersectionObserverNode=g}_getActionIcon(g){return g.icon?g.icon:g.image||g.className?void 0:"question"}_getActionTitle(g){const{messages:y,selectedFeature:v,messagesCommon:b}=this,{id:w}=g,M=v?.attributes,C=g.title??"",A="zoom-to-feature"===w?(0,It.n)(C,{messages:y}):"remove-selected-feature"===w?(0,It.n)(C,{messages:b}):"zoom-to-clustered-features"===w||"browse-clustered-features"===w?(0,It.n)(C,{messages:y}):g.title;return A&&M?(0,It.n)(A,M):A??""}_onMainKeydown(g){const y=(0,ke.kK)(g);"ArrowLeft"===y&&(g.stopPropagation(),this._handleFeatureMenuBack(),this.previous()),"ArrowRight"===y&&(g.stopPropagation(),this._handleFeatureMenuBack(),this.next())}_featureMenuViewportScrollTop(){this._featureMenuViewportNode&&this._featureMenuViewportNode.scrollContentTo({top:0})}_setContentFromFeatureWidget(){const{selectedFeatureWidget:g}=this;g&&(this.viewModel.content=g)}_setTitleFromFeatureWidget(){const{selectedFeatureWidget:g,messagesCommon:y}=this,v=g?.viewModel;g&&(this.viewModel.title="error"===v?.state?y?.errorMessage:v?.title||"")}_addSelectedFeatureIndexHandle(){const g=(0,N.YP)(()=>this.viewModel?.selectedFeatureIndex,(y,v)=>this._selectedFeatureIndexUpdated(y,v));this.addHandles(g,eo)}_selectedFeatureIndexUpdated(g,y){const{featureCount:v}=this.viewModel;v&&g!==y&&-1!==g&&(this._destroyRelatedRecordsFlowItemWidgets(),this._rootFlowItemNode&&this._rootFlowItemNode.scrollContentTo({top:0}))}_triggerHeaderAction(g){const y=g.currentTarget;if(y.disabled)return;const v=y.dataset.actionUid,b=this.headerActions.find(({uid:w})=>w===v);b&&!b.disabled&&("toggle"===b?.type&&(b.value=!b.value),this.emit("trigger-header-action",{action:b}))}_triggerAction(g){const y=g.currentTarget;if(y.disabled)return;const v=y.dataset.actionUid,{allActions:b}=this.viewModel,w=b.findIndex(C=>C.uid===v),M=b.at(w);M&&"toggle"===M.type&&(M.value=!M.value),this.viewModel.triggerAction(w)}_createSpinner(g){g&&(this._spinner=new Ia({view:g}),g.ui.add(this._spinner,{key:to,position:"manual",internal:!0}))}_wireUpView(g){this._destroySpinner(),g&&this.visibleElements?.spinner&&this._createSpinner(g)}_hideSpinner(){const{_spinner:g}=this;g&&(g.location=null,g.hide())}_viewReadyChange(g,y){g?this._wireUpView(this.viewModel?.view):y&&this.viewModel.clear()}_viewChange(g,y){g&&y&&this.viewModel.clear()}_destroySelectedFeatureWidget(){const{_feature:g}=this;g&&(g.viewModel=null,!g.destroyed&&g.destroy()),this._feature=null}_destroyRelatedRecordsFlowItemWidgets(){this._relatedRecordsFlowItems.removeAll().forEach(g=>{"showAllEnabled"in g.viewModel&&(g.viewModel.showAllEnabled=!1),g.viewModel=null,g.destroy()})}_toggleScreenLocationEnabled(){const{viewModel:g}=this;g&&(g.screenLocationEnabled=g.active)}_displaySpinner(){const{_spinner:g}=this;if(!g)return;const{location:y,waitingForResult:v}=this.viewModel;v&&y?g.show({location:y}):g.hide()}_destroySpinner(){const{_spinner:g,view:y}=this;g&&(y?.ui?.remove(g,to),g.destroy(),this._spinner=null)}_spinnerEnabledChange(g){this._destroySpinner(),g&&this._createSpinner(this.viewModel?.view)}};(0,I._)([(0,x.Cb)()],Se.prototype,"_focusOn",void 0),(0,I._)([(0,x.Cb)()],Se.prototype,"_relatedRecordsFlowItems",void 0),(0,I._)([(0,x.Cb)()],Se.prototype,"_hideActionText",null),(0,I._)([(0,x.Cb)()],Se.prototype,"_featureNavigationVisible",null),(0,I._)([(0,x.Cb)()],Se.prototype,"_isCollapsed",null),(0,I._)([(0,x.Cb)()],Se.prototype,"_collapseEnabled",null),(0,I._)([(0,x.Cb)()],Se.prototype,"collapsed",void 0),(0,I._)([(0,x.Cb)()],Se.prototype,"content",null),(0,I._)([(0,x.Cb)()],Se.prototype,"icon",void 0),(0,I._)([(0,x.Cb)()],Se.prototype,"featureMenuOpen",null),(0,I._)([(0,x.Cb)()],Se.prototype,"featureNavigationTop",void 0),(0,I._)([(0,x.Cb)()],Se.prototype,"features",null),(0,I._)([(0,x.Cb)({type:kt})],Se.prototype,"headerActions",void 0),(0,I._)([(0,x.Cb)()],Se.prototype,"headingLevel",void 0),(0,I._)([(0,x.Cb)()],Se.prototype,"location",null),(0,I._)([(0,x.Cb)()],Se.prototype,"label",null),(0,I._)([(0,x.Cb)(),(0,pt.H)("esri/widgets/Features/t9n/Features")],Se.prototype,"messages",void 0),(0,I._)([(0,x.Cb)(),(0,pt.H)("esri/t9n/common")],Se.prototype,"messagesCommon",void 0),(0,I._)([(0,x.Cb)()],Se.prototype,"promises",null),(0,I._)([(0,x.Cb)()],Se.prototype,"responsiveActionsEnabled",void 0),(0,I._)([(0,x.Cb)({readOnly:!0})],Se.prototype,"selectedFeature",null),(0,I._)([(0,x.Cb)()],Se.prototype,"selectedFeatureIndex",null),(0,I._)([(0,x.Cb)({readOnly:!0})],Se.prototype,"selectedFeatureWidget",null),(0,I._)([(0,x.Cb)()],Se.prototype,"title",null),(0,I._)([(0,x.Cb)()],Se.prototype,"updateLocationEnabled",null),(0,I._)([(0,x.Cb)()],Se.prototype,"view",null),(0,I._)([(0,x.Cb)({type:Dn}),qs(["triggerAction","trigger-action"])],Se.prototype,"viewModel",void 0),(0,I._)([(0,x.Cb)({type:Js,nonNullable:!0})],Se.prototype,"visibleElements",void 0),(0,I._)([(0,x.Cb)()],Se.prototype,"visible",null),Se=(0,I._)([(0,re.j)("esri.widgets.Features")],Se);const tl=Se,bt="esri-popup",Yt=`${bt}--is-docked`,qe={base:bt,main:`${bt}__main-container`,shadow:`${bt}--shadow`,isDocked:Yt,isDockedTopLeft:`${Yt}-top-left`,isDockedTopCenter:`${Yt}-top-center`,isDockedTopRight:`${Yt}-top-right`,isDockedBottomLeft:`${Yt}-bottom-left`,isDockedBottomCenter:`${Yt}-bottom-center`,isDockedBottomRight:`${Yt}-bottom-right`,alignTopCenter:`${bt}--aligned-top-center`,alignBottomCenter:`${bt}--aligned-bottom-center`,alignTopLeft:`${bt}--aligned-top-left`,alignBottomLeft:`${bt}--aligned-bottom-left`,alignTopRight:`${bt}--aligned-top-right`,alignBottomRight:`${bt}--aligned-bottom-right`,pointer:`${bt}__pointer`,pointerDirection:`${bt}__pointer-direction`};let Bn=class extends Dn{constructor(g){super(g)}};Bn=(0,I._)([(0,re.j)("esri.widgets.Popup.PopupViewModel")],Bn);const io=Bn;let gi=class extends lt.Z{constructor(){super(...arguments),this.closeButton=!0,this.featureNavigation=!0}};(0,I._)([(0,x.Cb)({type:Boolean,nonNullable:!0})],gi.prototype,"closeButton",void 0),(0,I._)([(0,x.Cb)({type:Boolean,nonNullable:!0})],gi.prototype,"featureNavigation",void 0),gi=(0,I._)([(0,re.j)("esri.widgets.Features.PopupVisibleElements")],gi);const no=gi,so={buttonEnabled:!0,position:"auto",breakpoint:{width:544}};let _e=class extends Y.Z{constructor(g,y){super(g,y),this._dockAction=new ae.Z({id:"popup-dock-action"}),this._featuresWidget=new tl({responsiveActionsEnabled:!0}),this._containerNode=null,this._mainContainerNode=null,this._pointerOffsetInPx=16,this.alignment="auto",this.collapsed=!1,this.collapseEnabled=!0,this.dockEnabled=!1,this.headingLevel=2,this.maxInlineActions=3,this.messages=null,this.spinnerEnabled=!0,this.viewModel=new io,this.visibleElements=new no}initialize(){this.addHandles([(0,N.YP)(()=>[this.viewModel?.view?.widthBreakpoint,this.dockEnabled],()=>this._handleDockIcon(),{initial:!0}),(0,N.YP)(()=>[this.dockEnabled,this.messages?.undock,this.messages?.dock],()=>this._handleDockEnabled(),{initial:!0}),(0,N.YP)(()=>this.dockOptions,g=>{const{_dockAction:y}=this,v=this._featuresWidget.headerActions;v.remove(y),g.buttonEnabled&&v.add(y)},{initial:!0}),(0,N.YP)(()=>this.viewModel?.screenLocation,()=>this._positionContainer()),(0,N.YP)(()=>[this.viewModel?.active,this.dockEnabled],()=>this._toggleScreenLocationEnabled()),(0,N.YP)(()=>[this.viewModel?.screenLocation,this.viewModel?.view?.padding,this.viewModel?.view?.size,this.viewModel?.active,this.viewModel?.location,this.alignment],()=>this.reposition()),(0,N.YP)(()=>this.viewModel?.view?.size,(g,y)=>this._updateDockEnabledForViewSize(g,y)),(0,N.YP)(()=>this.viewModel?.view,(g,y)=>this._viewChange(g,y)),(0,N.YP)(()=>this.viewModel?.view?.ready,(g,y)=>this._viewReadyChange(g??!1,y??!1)),(0,N.YP)(()=>this.viewModel,()=>this._featuresWidget.viewModel=this.viewModel,{initial:!0}),(0,N.YP)(()=>this._featureNavigationTop,g=>this._featuresWidget.featureNavigationTop=g,{initial:!0}),(0,N.YP)(()=>this.headingLevel,g=>this._featuresWidget.headingLevel=g,{initial:!0}),(0,N.YP)(()=>this.collapseEnabled,g=>this._featuresWidget.visibleElements.collapseButton=g,{initial:!0}),(0,N.YP)(()=>this.collapsed,g=>this._featuresWidget.collapsed=g,{initial:!0}),(0,N.YP)(()=>this.visibleElements.closeButton,g=>this._featuresWidget.visibleElements.closeButton=!!g,{initial:!0}),(0,N.YP)(()=>this.spinnerEnabled,g=>this._featuresWidget.visibleElements.spinner=g,{initial:!0}),(0,N.YP)(()=>this.visibleElements.featureNavigation,g=>this._featuresWidget.visibleElements.featureNavigation=!!g,{initial:!0}),(0,N.on)(()=>this._featuresWidget,"trigger-header-action",g=>{g.action===this._dockAction&&(this.dockEnabled=!this.dockEnabled)})])}destroy(){this._dockAction.destroy(),this._featuresWidget?.destroy()}get _featureNavigationTop(){const{currentAlignment:g,currentDockPosition:y}=this;return"bottom-left"===g||"bottom-center"===g||"bottom-right"===g||"top-left"===y||"top-center"===y||"top-right"===y}get actions(){return this.viewModel.actions}set actions(g){this.viewModel.actions=g}get autoCloseEnabled(){return this.viewModel.autoCloseEnabled}set autoCloseEnabled(g){this.viewModel.autoCloseEnabled=g}get autoOpenEnabled(){return(0,Te.Mr)(Ze.Z.getLogger(this),"autoOpenEnabled",{replacement:"MapView/SceneView.popupEnabled",version:"4.27"}),this.viewModel.autoOpenEnabled}set autoOpenEnabled(g){(0,Te.Mr)(Ze.Z.getLogger(this),"autoOpenEnabled",{replacement:"MapView/SceneView.popupEnabled",version:"4.27"}),this.viewModel.autoOpenEnabled=g}get defaultPopupTemplateEnabled(){return this.viewModel.defaultPopupTemplateEnabled}set defaultPopupTemplateEnabled(g){this.viewModel.defaultPopupTemplateEnabled=g}get content(){return this.viewModel.content}set content(g){this.viewModel.content=g}get currentAlignment(){return this._getCurrentAlignment()}get currentDockPosition(){return this._getCurrentDockPosition()}get dockOptions(){return this._get("dockOptions")||so}set dockOptions(g){const y={...so},v=this.viewModel?.view?.breakpoints,b={};v&&(b.width=v.xsmall,b.height=v.xsmall);const w={...y,...g},M={...y.breakpoint,...b},{breakpoint:C}=w;"object"==typeof C?w.breakpoint={...M,...C}:C&&(w.breakpoint=M),this._set("dockOptions",w),this._setCurrentDockPosition(),this.reposition()}get featureCount(){return this.viewModel.featureCount}get featureMenuOpen(){return this.viewModel.featureMenuOpen}set featureMenuOpen(g){this.viewModel.featureMenuOpen=g}get features(){return this.viewModel.features}set features(g){this.viewModel.features=g}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(g){this.viewModel.goToOverride=g}get highlightEnabled(){return this.viewModel.highlightEnabled}set highlightEnabled(g){this.viewModel.highlightEnabled=g}get location(){return this.viewModel.location}set location(g){this.viewModel.location=g}get label(){return this.messages?.widgetLabel??""}set label(g){this._overrideIfSome("label",g)}get promises(){return this.viewModel.promises}set promises(g){this.viewModel.promises=g}get selectedFeature(){return this.viewModel.selectedFeature}get selectedFeatureIndex(){return this.viewModel.selectedFeatureIndex}set selectedFeatureIndex(g){this.viewModel.selectedFeatureIndex=g}get selectedFeatureWidget(){return this._featuresWidget.selectedFeatureWidget}get title(){return this.viewModel.title}set title(g){this.viewModel.title=g}get updateLocationEnabled(){return this.viewModel.updateLocationEnabled}set updateLocationEnabled(g){this.viewModel.updateLocationEnabled=g}get view(){return this.viewModel.view}set view(g){this.viewModel.view=g}get visible(){return this.viewModel.visible}set visible(g){this.viewModel.visible=g}blur(){const{active:g}=this.viewModel;g||Ze.Z.getLogger(this).warn("Popup can only be blurred when currently active."),this._featuresWidget.blur()}clear(){return this.viewModel.clear()}close(){this.visible=!1}fetchFeatures(g,y){return this.viewModel.fetchFeatures(g,y)}focus(){const{active:g}=this.viewModel;g||Ze.Z.getLogger(this).warn("Popup can only be focused when currently active."),this.renderNow(),this._featuresWidget.focus()}next(){return this.viewModel.next()}open(g){this.set({collapsed:!!g&&!!g.collapsed,featureMenuOpen:!!g&&!!g.featureMenuOpen}),this.viewModel.open(g),this._shouldFocus(g)}previous(){return this.viewModel.previous()}reposition(){this.renderNow(),this._positionContainer(),this._setCurrentAlignment()}triggerAction(g){return this.viewModel.triggerAction(g)}render(){const{dockEnabled:g,currentAlignment:y,currentDockPosition:v}=this,{active:b}=this.viewModel,C=this.selectedFeature?.layer?.title,A=this.selectedFeature?.layer?.id;return(0,O.u)("div",{afterCreate:this._positionContainer,afterUpdate:this._positionContainer,bind:this,class:this.classes(qe.base,{[qe.alignTopCenter]:"top-center"===y,[qe.alignBottomCenter]:"bottom-center"===y,[qe.alignTopLeft]:"top-left"===y,[qe.alignBottomLeft]:"bottom-left"===y,[qe.alignTopRight]:"top-right"===y,[qe.alignBottomRight]:"bottom-right"===y,[qe.isDocked]:b&&g,[qe.shadow]:b&&!g,[qe.isDockedTopLeft]:"top-left"===v,[qe.isDockedTopCenter]:"top-center"===v,[qe.isDockedTopRight]:"top-right"===v,[qe.isDockedBottomLeft]:"bottom-left"===v,[qe.isDockedBottomCenter]:"bottom-center"===v,[qe.isDockedBottomRight]:"bottom-right"===v}),"data-layer-id":A,"data-layer-title":C,role:"presentation"},b?[this._renderMainContainer(),this._renderPointer()]:null)}_renderPointer(){return this.dockEnabled?null:(0,O.u)("div",{class:qe.pointer,key:"popup-pointer",role:"presentation"},(0,O.u)("div",{class:this.classes(qe.pointerDirection,qe.shadow)}))}_renderMainContainer(){const{dockEnabled:g}=this;return(0,O.u)("div",{afterCreate:this._setMainContainerNode,afterUpdate:this._setMainContainerNode,bind:this,class:this.classes(qe.main,be.z.widget,{[qe.shadow]:g})},this._featuresWidget.render())}_shouldFocus(g){var y=this;return(0,z.Z)(function*(){g?.shouldFocus&&(yield(0,N.N1)(()=>!0===y.viewModel?.active),y.focus())})()}_isOutsideView(g){const{popupHeight:y,popupWidth:v,screenLocation:b,side:w,view:M}=g;if(isNaN(v)||isNaN(y)||!M||!b)return!1;const C=M.padding;return"right"===w&&b.x+v/2>M.width-C.right||"left"===w&&b.x-v/2<C.left||"top"===w&&b.y-y<C.top||"bottom"===w&&b.y+y>M.height-C.bottom}_calculateAutoAlignment(g){if("auto"!==g)return g;const{_pointerOffsetInPx:y,_containerNode:v,_mainContainerNode:b,viewModel:w}=this,{screenLocation:M,view:C}=w;if(null==M||!C||!v)return"top-center";function A(se){return parseInt(se.replaceAll(/[^-\d\.]/g,""),10)}const T=b?window.getComputedStyle(b,null):null,P=T?A(T.getPropertyValue("max-height")):0,R=T?A(T.getPropertyValue("height")):0,{height:V,width:B}=v.getBoundingClientRect(),k=B+y,H=Math.max(V,P,R)+y,J=this._isOutsideView({popupHeight:H,popupWidth:k,screenLocation:M,side:"right",view:C}),ie=this._isOutsideView({popupHeight:H,popupWidth:k,screenLocation:M,side:"left",view:C}),ue=this._isOutsideView({popupHeight:H,popupWidth:k,screenLocation:M,side:"top",view:C}),Fe=this._isOutsideView({popupHeight:H,popupWidth:k,screenLocation:M,side:"bottom",view:C});return ie?ue?"bottom-right":"top-right":J?ue?"bottom-left":"top-left":ue?Fe?"top-center":"bottom-center":"top-center"}_callCurrentAlignment(g){return"function"==typeof g?g.call(this):g}_getCurrentAlignment(){const{alignment:g,dockEnabled:y}=this;return y||!this.viewModel.active?null:this._calculatePositionResult(this._calculateAutoAlignment(this._callCurrentAlignment(g)))}_setCurrentAlignment(){this._set("currentAlignment",this._getCurrentAlignment())}_setCurrentDockPosition(){this._set("currentDockPosition",this._getCurrentDockPosition())}_calculatePositionResult(g){const y=["left","right"];return(0,Mt.dZ)(this.container)&&y.reverse(),g?.replace(/leading/gi,y[0]).replaceAll(/trailing/gi,y[1])}_callDockPosition(g){return"function"==typeof g?g.call(this):g}_getDockPosition(){return this._calculatePositionResult(this._calculateAutoDockPosition(this._callDockPosition(this.dockOptions?.position)))}_getCurrentDockPosition(){return this.dockEnabled&&this.viewModel.active?this._getDockPosition():null}_calculateAutoDockPosition(g){if("auto"!==g)return g;const y=this.viewModel?.view,v=(0,Mt.dZ)(this.container)?"top-left":"top-right";if(!y)return v;const b=y.padding||{left:0,right:0,top:0,bottom:0},w=y.width-b.left-b.right,{breakpoints:M}=y;return M&&w<=M.xsmall?"bottom-center":v}_getDockIcon(){const g=this._getDockPosition();if(this.dockEnabled)return"minimize";switch(g){case"top-left":case"bottom-left":return"dock-left";case"top-center":return"maximize";case"bottom-center":return"dock-bottom";default:return"dock-right"}}_handleDockIcon(){this._dockAction.icon=this._getDockIcon()}_handleDockEnabled(){this._dockAction.title=this.dockEnabled?this.messages?.undock:this.messages?.dock}_setMainContainerNode(g){this._mainContainerNode=g}_positionContainer(g=this._containerNode){if(g&&(this._containerNode=g),!this._containerNode)return;const{screenLocation:y}=this.viewModel,{width:v}=this._containerNode.getBoundingClientRect(),b=this._calculatePositionStyle(y,v);b&&Object.assign(this._containerNode.style,b)}_calculateFullWidth(g){const{currentAlignment:y,_pointerOffsetInPx:v}=this;return"top-left"===y||"bottom-left"===y||"top-right"===y||"bottom-right"===y?g+v:g}_calculateAlignmentPosition(g,y,v,b){const{currentAlignment:w,_pointerOffsetInPx:M}=this;if(!v)return;const{padding:C}=v,A=b/2,T=v.height-y,P=v.width-g;return"bottom-center"===w?{top:y+M-C.top,left:g-A-C.left}:"top-left"===w?{bottom:T+M-C.bottom,right:P+M-C.right}:"bottom-left"===w?{top:y+M-C.top,right:P+M-C.right}:"top-right"===w?{bottom:T+M-C.bottom,left:g+M-C.left}:"bottom-right"===w?{top:y+M-C.top,left:g+M-C.left}:"top-center"===w?{bottom:T+M-C.bottom,left:g-A-C.left}:void 0}_calculatePositionStyle(g,y){const{dockEnabled:v,view:b}=this;if(!b)return;if(v)return{left:"",top:"",right:"",bottom:""};if(null==g||!y)return;const w=this._calculateFullWidth(y),M=this._calculateAlignmentPosition(g.x,g.y,b,w);return M?{top:void 0!==M.top?`${M.top}px`:"auto",left:void 0!==M.left?`${M.left}px`:"auto",bottom:void 0!==M.bottom?`${M.bottom}px`:"auto",right:void 0!==M.right?`${M.right}px`:"auto"}:void 0}_viewChange(g,y){g&&y&&(this.close(),this.clear())}_viewReadyChange(g,y){g?this._wireUpView():y&&(this.close(),this.clear())}_wireUpView(){this._setDockEnabledForViewSize(this.dockOptions)}_dockingThresholdCrossed(g,y,v){const[b,w]=g,[M,C]=y,{width:A=0,height:T=0}=v??{};return b<=A&&M>A||b>A&&M<=A||w<=T&&C>T||w>T&&C<=T}_updateDockEnabledForViewSize(g,y){if(!g||!y)return;const v=this.viewModel?.view?.padding||{left:0,right:0,top:0,bottom:0},b=v.left+v.right,w=v.top+v.bottom,M=[],C=[];M[0]=g[0]-b,M[1]=g[1]-w,C[0]=y[0]-b,C[1]=y[1]-w;const{dockOptions:A}=this;this._dockingThresholdCrossed(M,C,A.breakpoint)&&this._setDockEnabledForViewSize(A),this._setCurrentDockPosition()}_toggleScreenLocationEnabled(){const{dockEnabled:g,viewModel:y}=this;y&&(y.screenLocationEnabled=y.active&&!g)}_shouldDockAtCurrentViewSize(g){const y=g.breakpoint,v=this.viewModel?.view?.ui;if(!v)return!1;const{width:b,height:w}=v;if(isNaN(b)||isNaN(w)||!y)return!1;const M=y.hasOwnProperty("width")&&b<=(y.width??0),C=y.hasOwnProperty("height")&&w<=(y.height??0);return M||C}_setDockEnabledForViewSize(g){g.breakpoint&&(this.dockEnabled=this._shouldDockAtCurrentViewSize(g))}};(0,I._)([(0,x.Cb)({readOnly:!0})],_e.prototype,"_featureNavigationTop",null),(0,I._)([(0,x.Cb)()],_e.prototype,"actions",null),(0,I._)([(0,x.Cb)()],_e.prototype,"alignment",void 0),(0,I._)([(0,x.Cb)()],_e.prototype,"autoCloseEnabled",null),(0,I._)([(0,x.Cb)()],_e.prototype,"autoOpenEnabled",null),(0,I._)([(0,x.Cb)()],_e.prototype,"defaultPopupTemplateEnabled",null),(0,I._)([(0,x.Cb)()],_e.prototype,"content",null),(0,I._)([(0,x.Cb)()],_e.prototype,"collapsed",void 0),(0,I._)([(0,x.Cb)()],_e.prototype,"collapseEnabled",void 0),(0,I._)([(0,x.Cb)({readOnly:!0})],_e.prototype,"currentAlignment",null),(0,I._)([(0,x.Cb)({readOnly:!0})],_e.prototype,"currentDockPosition",null),(0,I._)([(0,x.Cb)()],_e.prototype,"dockOptions",null),(0,I._)([(0,x.Cb)()],_e.prototype,"dockEnabled",void 0),(0,I._)([(0,x.Cb)({readOnly:!0})],_e.prototype,"featureCount",null),(0,I._)([(0,x.Cb)()],_e.prototype,"featureMenuOpen",null),(0,I._)([(0,x.Cb)()],_e.prototype,"features",null),(0,I._)([(0,x.Cb)()],_e.prototype,"goToOverride",null),(0,I._)([(0,x.Cb)()],_e.prototype,"headingLevel",void 0),(0,I._)([(0,x.Cb)()],_e.prototype,"highlightEnabled",null),(0,I._)([(0,x.Cb)()],_e.prototype,"location",null),(0,I._)([(0,x.Cb)()],_e.prototype,"label",null),(0,I._)([(0,x.Cb)()],_e.prototype,"maxInlineActions",void 0),(0,I._)([(0,x.Cb)(),(0,pt.H)("esri/widgets/Popup/t9n/Popup")],_e.prototype,"messages",void 0),(0,I._)([(0,x.Cb)()],_e.prototype,"promises",null),(0,I._)([(0,x.Cb)({readOnly:!0})],_e.prototype,"selectedFeature",null),(0,I._)([(0,x.Cb)()],_e.prototype,"selectedFeatureIndex",null),(0,I._)([(0,x.Cb)({readOnly:!0})],_e.prototype,"selectedFeatureWidget",null),(0,I._)([(0,x.Cb)()],_e.prototype,"spinnerEnabled",void 0),(0,I._)([(0,x.Cb)()],_e.prototype,"title",null),(0,I._)([(0,x.Cb)()],_e.prototype,"updateLocationEnabled",null),(0,I._)([(0,x.Cb)()],_e.prototype,"view",null),(0,I._)([(0,x.Cb)({type:io}),qs(["triggerAction","trigger-action"])],_e.prototype,"viewModel",void 0),(0,I._)([(0,x.Cb)()],_e.prototype,"visible",null),(0,I._)([(0,x.Cb)({type:no,nonNullable:!0})],_e.prototype,"visibleElements",void 0),_e=(0,I._)([(0,re.j)("esri.widgets.Popup")],_e);const il=_e}}]);