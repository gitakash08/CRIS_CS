"use strict";(self.webpackChunkCRIS=self.webpackChunkCRIS||[]).push([[7969],{52489:(p,g,t)=>{t.d(g,{D:()=>h});var l=t(22558);function h(r){r?.writtenProperties&&r.writtenProperties.forEach(({target:o,propName:d,newOrigin:L})=>{(0,l.l)(o)&&L&&o.originOf(d)!==L&&o.updateOrigin(d,L)})}},22558:(p,g,t)=>{function l(h){return h&&"getAtOrigin"in h&&"originOf"in h}t.d(g,{l:()=>l})},36912:(p,g,t)=>{t.r(g),t.d(g,{save:()=>yt,saveAll:()=>ft,saveAllAs:()=>mt,saveAs:()=>dt});var l=t(15861),h=t(85931),r=t(26584),o=t(52489),d=t(82674),L=t(38305),Z=t(17196),w=t(72469),k=t(30164),F=t(88755),m=t(37281);const O="Feature Service",M="feature-layer-utils",q=`${M}-save`,_=`${M}-save-as`,c=`${M}-saveall`,E=`${M}-saveall-as`;function S(n){return{isValid:(0,w.fP)(n)&&("feature"!==n.type||!n.dynamicDataSource),errorMessage:"Feature layer should be a layer or table in a map or feature service"}}function G(n){const e=[],a=[];for(const{layer:i,layerJSON:y}of n)i.isTable?a.push(y):e.push(y);return{layers:e,tables:a}}function V(n){return G([n])}function z(n,e){return I.apply(this,arguments)}function I(){return(I=(0,l.Z)(function*(n,e){return/\/\d+\/?$/.test(n.url)?V(e[0]):J(e,n)})).apply(this,arguments)}function J(n,e){return D.apply(this,arguments)}function D(){return D=(0,l.Z)(function*(n,e){if(!e)return n.reverse(),G(n);const{layer:{url:a,customParameters:i,apiKey:y}}=n[0];let u=yield e.fetchData("json");null!=u?.layers&&null!=u?.tables||(u=yield function tt(n,e,a){return x.apply(this,arguments)}(u,{url:a??"",customParameters:i,apiKey:y},n.map(s=>s.layer.layerId)));for(const s of n)Q(s.layer,s.layerJSON,u);return u}),D.apply(this,arguments)}function x(){return x=(0,l.Z)(function*(n,e,a){n||={},n.layers||=[],n.tables||=[];const{url:i,customParameters:y,apiKey:u}=e,{serviceJSON:s,layersJSON:f}=yield(0,Z.V)(i,{customParameters:y,apiKey:u}),v=Y(n.layers,s.layers,a),P=Y(n.tables,s.tables,a);n.layers=v.itemResources,n.tables=P.itemResources;const T=[...v.added,...P.added],ht=f?[...f.layers,...f.tables]:[];return yield function nt(n,e,a,i){return C.apply(this,arguments)}(n,T,i,ht),n}),x.apply(this,arguments)}function Y(n,e,a){const i=(0,h.e5)(n,e,(u,s)=>u.id===s.id);n=n.filter(u=>!i.removed.some(s=>s.id===u.id));const y=i.added;return y.forEach(({id:u})=>{n.push({id:u})}),{itemResources:n,added:y.filter(({id:u})=>!a.includes(u))}}function C(){return C=(0,l.Z)(function*(n,e,a,i){const y=yield function rt(n){return R.apply(this,arguments)}(e),u=e.map(({id:s,type:f})=>new(y.get(f))({url:a,layerId:s,sourceJSON:i.find(({id:v})=>v===s)}));yield Promise.allSettled(u.map(s=>s.load())),u.forEach(s=>{const{layerId:f,loaded:v,defaultPopupTemplate:P}=s;if(!v||null==P)return;const T={id:f,popupInfo:P.toJSON()};"ArcGISFeatureLayer"!==s.operationalLayerType&&(T.layerType=s.operationalLayerType),Q(s,T,n)})}),C.apply(this,arguments)}function R(){return(R=(0,l.Z)(function*(n){const e=[];n.forEach(({type:y})=>{const u=function et(n){let e;switch(n){case"Feature Layer":case"Table":e="FeatureLayer";break;case"Oriented Imagery Layer":e="OrientedImageryLayer"}return e}(y);e.push((0,k.T[u])())});const a=yield Promise.all(e),i=new Map;return n.forEach(({type:y},u)=>{i.set(y,a[u])}),i})).apply(this,arguments)}function Q(n,e,a){!function X(n,e){const a=n.findIndex(({id:i})=>i===e.id);-1===a?n.push(e):n[a]=e}(n.isTable?a.tables:a.layers,e)}function H(n,e){if(!n.length)throw new r.Z(`${e}:missing-parameters`,"'layers' array should contain at least one feature layer")}function b(n,e){const a=n.map(i=>i.layerId);if(new Set(a).size!==a.length)throw new r.Z(`${e}:invalid-parameters`,"'layers' array should contain only one instance each of layer or table in a feature service")}function U(){return(U=(0,l.Z)(function*(n){H(n,c),yield Promise.all(n.map(e=>e.load()));for(const e of n)(0,d.DC)(e,c,S),(0,d.Ym)({layer:e,itemType:O,errorNamePrefix:c});(function lt(n,e){const a=n.map(i=>i.portalItem.id);if(new Set(a).size>1)throw new r.Z(`${e}:invalid-parameters`,"All layers in the 'layers' array should be loaded from the same portal item")})(n,c),b(n,c)})).apply(this,arguments)}function ot(n,e){return A.apply(this,arguments)}function A(){return(A=(0,l.Z)(function*(n,e){const{url:a,layerId:i,title:y,fullExtent:u,isTable:s}=n,f=(0,L.Qc)(a);e.url="FeatureServer"===f?.serverType?a:`${a}/${i}`,e.title||=y,e.extent=null,s||null==u||(e.extent=yield(0,m.$o)(u)),(0,m.ck)(e,m.Kz.METADATA),(0,m.ck)(e,m.Kz.MULTI_LAYER),(0,m.qj)(e,m.Kz.SINGLE_LAYER),s&&(0,m.qj)(e,m.Kz.TABLE)})).apply(this,arguments)}function K(){return(K=(0,l.Z)(function*(n){H(n,E),yield Promise.all(n.map(e=>e.load()));for(const e of n)(0,d.DC)(e,E,S);(function st(n,e){for(const u of n){const s=u.parsedUrl.path,f=(0,L.Qc)(s);if(!f?.url.path)throw new r.Z(`${e}:invalid-parameters`,(0,d.xG)(u,`has unsupported url pattern: ${s}`),{layer:u});const P=f?.serverType;if("FeatureServer"!==P&&"MapServer"!==P)throw new r.Z(`${e}:invalid-parameters`,(0,d.xG)(u,`has unsupported server type: ${P}`),{layer:u});if("MapServer"===P&&n.length>1)throw new r.Z(`${e}:invalid-parameters`,"Only one layer or table in a map service can be saved")}const i=(0,L.Qc)(n[0].parsedUrl.path)?.url.path;if(!n.every(u=>(0,L.Qc)(u.parsedUrl.path)?.url.path===i))throw new r.Z(`${e}:invalid-parameters`,"'layers' array should only contain layers or tables that belong to the same feature service")})(n,E),b(n,E)})).apply(this,arguments)}function B(){return(B=(0,l.Z)(function*(n,e){let a=0,i=0;for(const{isTable:s}of e)s?i++:a++;const y=e[0].parsedUrl.path,u=(0,L.Qc)(y);if(n.url="FeatureServer"===u?.serverType?u.url.path:y,n.title||=u.title,n.extent=null,a>0){const s=e.map(f=>f.fullExtent).filter(h.pC).reduce((f,v)=>f.clone().union(v));s&&(n.extent=yield(0,m.$o)(s))}(0,m.ck)(n,m.Kz.METADATA),(0,m.Ct)(n,m.Kz.MULTI_LAYER,e.length>1),(0,m.Ct)(n,m.Kz.SINGLE_LAYER,1===e.length),(0,m.Ct)(n,m.Kz.TABLE,i>0&&0===a),(0,d.UY)(n)})).apply(this,arguments)}function yt(n,e){return W.apply(this,arguments)}function W(){return(W=(0,l.Z)(function*(n,e){return(0,d.a1)({layer:n,itemType:O,validateLayer:S,createItemData:(a,i)=>z(i,[a]),errorNamePrefix:q},e)})).apply(this,arguments)}function ft(n,e){return j.apply(this,arguments)}function j(){return j=(0,l.Z)(function*(n,e){yield function at(n){return U.apply(this,arguments)}(n);const a=n[0].portalItem,i=(0,F.Yv)(a),y=yield Promise.all(n.map(s=>(0,d.Nw)(s,i,e))),u=yield z(a,n.map((s,f)=>({layer:s,layerJSON:y[f]})));return(0,d.UY)(a),yield a.update({data:u}),yield Promise.all(n.slice(1).map(s=>s.portalItem.reload())),(0,o.D)(i),a.clone()}),j.apply(this,arguments)}function dt(n,e,a){return N.apply(this,arguments)}function N(){return(N=(0,l.Z)(function*(n,e,a){return(0,d.po)({layer:n,itemType:O,validateLayer:S,createItemData:(i,y)=>Promise.resolve(V(i)),errorNamePrefix:_,newItem:e,setItemProperties:ot},a)})).apply(this,arguments)}function mt(n,e,a){return $.apply(this,arguments)}function $(){return $=(0,l.Z)(function*(n,e,a){yield function ut(n){return K.apply(this,arguments)}(n);const i=(0,d.uT)({itemType:O,errorNamePrefix:E,newItem:e}),y=(0,F.Yv)(i),u=yield Promise.all(n.map(f=>(0,d.Nw)(f,y,a))),s=yield J(n.map((f,v)=>({layer:f,layerJSON:u[v]})));yield function it(n,e){return B.apply(this,arguments)}(i,n),yield(0,d.jX)(i,s,a);for(const f of n)f.portalItem=i.clone();return(0,o.D)(y),i}),$.apply(this,arguments)}},30164:(p,g,t)=>{t.d(g,{T:()=>h});var l=t(15861);const h={BingMapsLayer:(r=(0,l.Z)(function*(){return(yield t.e(2248).then(t.bind(t,72248))).default}),function(){return r.apply(this,arguments)}),BuildingSceneLayer:function(){var r=(0,l.Z)(function*(){return(yield Promise.all([t.e(4199),t.e(5366),t.e(4430),t.e(415),t.e(2432),t.e(9709),t.e(4629),t.e(3784),t.e(9319)]).then(t.bind(t,19319))).default});return function(){return r.apply(this,arguments)}}(),CSVLayer:function(){var r=(0,l.Z)(function*(){return(yield Promise.all([t.e(4199),t.e(5366),t.e(4430),t.e(415),t.e(5625)]).then(t.bind(t,85625))).default});return function(){return r.apply(this,arguments)}}(),DimensionLayer:function(){var r=(0,l.Z)(function*(){return(yield Promise.all([t.e(8592),t.e(326)]).then(t.bind(t,90326))).default});return function(){return r.apply(this,arguments)}}(),ElevationLayer:function(){var r=(0,l.Z)(function*(){return(yield t.e(3327).then(t.bind(t,3327))).default});return function(){return r.apply(this,arguments)}}(),FeatureLayer:function(){var r=(0,l.Z)(function*(){return(yield Promise.all([t.e(4199),t.e(5366),t.e(4430),t.e(415)]).then(t.bind(t,80415))).default});return function(){return r.apply(this,arguments)}}(),GeoJSONLayer:function(){var r=(0,l.Z)(function*(){return(yield Promise.all([t.e(4199),t.e(5366),t.e(2903)]).then(t.bind(t,72903))).default});return function(){return r.apply(this,arguments)}}(),GeoRSSLayer:function(){var r=(0,l.Z)(function*(){return(yield t.e(6306).then(t.bind(t,96306))).default});return function(){return r.apply(this,arguments)}}(),GroupLayer:function(){var r=(0,l.Z)(function*(){return(yield t.e(5700).then(t.bind(t,55700))).default});return function(){return r.apply(this,arguments)}}(),ImageryLayer:function(){var r=(0,l.Z)(function*(){return(yield Promise.all([t.e(6926),t.e(2863),t.e(6606),t.e(3216),t.e(2328)]).then(t.bind(t,62328))).default});return function(){return r.apply(this,arguments)}}(),ImageryTileLayer:function(){var r=(0,l.Z)(function*(){return(yield Promise.all([t.e(6926),t.e(8594),t.e(2863),t.e(6606),t.e(6241),t.e(3216),t.e(8592),t.e(4316)]).then(t.bind(t,4316))).default});return function(){return r.apply(this,arguments)}}(),IntegratedMeshLayer:function(){var r=(0,l.Z)(function*(){return(yield Promise.all([t.e(2432),t.e(8592),t.e(362)]).then(t.bind(t,31370))).default});return function(){return r.apply(this,arguments)}}(),KMLLayer:function(){var r=(0,l.Z)(function*(){return(yield Promise.all([t.e(8592),t.e(8411)]).then(t.bind(t,38411))).default});return function(){return r.apply(this,arguments)}}(),LineOfSightLayer:function(){var r=(0,l.Z)(function*(){return(yield Promise.all([t.e(8592),t.e(468)]).then(t.bind(t,83602))).default});return function(){return r.apply(this,arguments)}}(),LinkChartLayer:function(){var r=(0,l.Z)(function*(){return(yield Promise.all([t.e(337),t.e(5366),t.e(774),t.e(9466),t.e(331),t.e(1599),t.e(8592),t.e(8005)]).then(t.bind(t,28005))).default});return function(){return r.apply(this,arguments)}}(),MapImageLayer:function(){var r=(0,l.Z)(function*(){return(yield Promise.resolve().then(t.bind(t,48887))).default});return function(){return r.apply(this,arguments)}}(),MapNotesLayer:function(){var r=(0,l.Z)(function*(){return(yield Promise.all([t.e(4199),t.e(5366),t.e(4430),t.e(415),t.e(8592),t.e(9859)]).then(t.bind(t,19859))).default});return function(){return r.apply(this,arguments)}}(),MediaLayer:function(){var r=(0,l.Z)(function*(){return(yield Promise.all([t.e(8592),t.e(9347)]).then(t.bind(t,24762))).default});return function(){return r.apply(this,arguments)}}(),OGCFeatureLayer:function(){var r=(0,l.Z)(function*(){return(yield Promise.all([t.e(4199),t.e(5366),t.e(9628),t.e(2955)]).then(t.bind(t,36554))).default});return function(){return r.apply(this,arguments)}}(),OpenStreetMapLayer:function(){var r=(0,l.Z)(function*(){return(yield Promise.all([t.e(8592),t.e(1591)]).then(t.bind(t,71591))).default});return function(){return r.apply(this,arguments)}}(),OrientedImageryLayer:function(){var r=(0,l.Z)(function*(){return(yield Promise.all([t.e(4199),t.e(5366),t.e(4430),t.e(415),t.e(6150)]).then(t.bind(t,66150))).default});return function(){return r.apply(this,arguments)}}(),PointCloudLayer:function(){var r=(0,l.Z)(function*(){return(yield Promise.all([t.e(2432),t.e(8592),t.e(7155)]).then(t.bind(t,7155))).default});return function(){return r.apply(this,arguments)}}(),RouteLayer:function(){var r=(0,l.Z)(function*(){return(yield Promise.all([t.e(403),t.e(4940)]).then(t.bind(t,84940))).default});return function(){return r.apply(this,arguments)}}(),SceneLayer:function(){var r=(0,l.Z)(function*(){return(yield Promise.all([t.e(5366),t.e(2432),t.e(9709),t.e(4629),t.e(3784),t.e(8592),t.e(6933)]).then(t.bind(t,27559))).default});return function(){return r.apply(this,arguments)}}(),StreamLayer:function(){var r=(0,l.Z)(function*(){return(yield Promise.all([t.e(4199),t.e(5366),t.e(289)]).then(t.bind(t,70289))).default});return function(){return r.apply(this,arguments)}}(),SubtypeGroupLayer:function(){var r=(0,l.Z)(function*(){return(yield Promise.all([t.e(5366),t.e(4430),t.e(1976)]).then(t.bind(t,81976))).default});return function(){return r.apply(this,arguments)}}(),TileLayer:function(){var r=(0,l.Z)(function*(){return(yield Promise.resolve().then(t.bind(t,59735))).default});return function(){return r.apply(this,arguments)}}(),UnknownLayer:function(){var r=(0,l.Z)(function*(){return(yield t.e(6339).then(t.bind(t,56339))).default});return function(){return r.apply(this,arguments)}}(),UnsupportedLayer:function(){var r=(0,l.Z)(function*(){return(yield t.e(6240).then(t.bind(t,16240))).default});return function(){return r.apply(this,arguments)}}(),VectorTileLayer:function(){var r=(0,l.Z)(function*(){return(yield Promise.all([t.e(4336),t.e(8364),t.e(8592),t.e(2826)]).then(t.bind(t,10193))).default});return function(){return r.apply(this,arguments)}}(),VoxelLayer:function(){var r=(0,l.Z)(function*(){return(yield Promise.all([t.e(2432),t.e(8592),t.e(3521)]).then(t.bind(t,26007))).default});return function(){return r.apply(this,arguments)}}(),WFSLayer:function(){var r=(0,l.Z)(function*(){return(yield Promise.all([t.e(4199),t.e(5366),t.e(9636),t.e(8762)]).then(t.bind(t,98762))).default});return function(){return r.apply(this,arguments)}}(),WMSLayer:function(){var r=(0,l.Z)(function*(){return(yield Promise.all([t.e(8592),t.e(6894)]).then(t.bind(t,46894))).default});return function(){return r.apply(this,arguments)}}(),WMTSLayer:function(){var r=(0,l.Z)(function*(){return(yield Promise.all([t.e(8592),t.e(9526)]).then(t.bind(t,69526))).default});return function(){return r.apply(this,arguments)}}(),WebTileLayer:function(){var r=(0,l.Z)(function*(){return(yield t.e(8592).then(t.bind(t,28678))).default});return function(){return r.apply(this,arguments)}}()};var r},45205:(p,g,t)=>{t.d(g,{T:()=>r});var l=t(15861),h=t(84792);function r(d,L){return o.apply(this,arguments)}function o(){return(o=(0,l.Z)(function*(d,L){const{data:Z}=yield(0,h.Z)(d,{responseType:"json",query:{f:"json",...L?.customParameters,token:L?.apiKey}});return Z})).apply(this,arguments)}},53543:(p,g,t)=>{t.d(g,{w:()=>o});var l=t(59318),h=t(26584),r=t(12680);function o(d){if(l.Z.apiKey&&(0,r.r)(d.portal.url))throw new h.Z("save-api-key-utils:api-key-not-supported",`Saving is not supported on ${d.portal.url} when using an api key`)}}}]);