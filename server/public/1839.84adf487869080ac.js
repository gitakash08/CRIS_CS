"use strict";(self.webpackChunkCRIS=self.webpackChunkCRIS||[]).push([[1839],{90301:(L,D,e)=>{e.d(D,{JZ:()=>M,RL:()=>f,eY:()=>j});var x=e(15861),l=e(10699),o=e(30217),y=e(49966),_=e(9545),T=e(57477),a=e(14403),v=e(80738),P=e(67969),i=e(18952),N=e(31548);function M(I){return I&&"render"in I}function f(I){const p=document.createElement("canvas");return p.width=I.width,p.height=I.height,I.render(p.getContext("2d")),p}class j extends T.s{constructor(p=null,E=!1){super(),this.blendFunction="standard",this._sourceWidth=0,this._sourceHeight=0,this._textureInvalidated=!1,this._texture=null,this.stencilRef=0,this.coordScale=[1,1],this._height=void 0,this.pixelRatio=1,this.resolution=0,this.rotation=0,this._source=null,this._width=void 0,this.x=0,this.y=0,this.immutable=E,this.source=p,this.requestRender=this.requestRender.bind(this)}destroy(){this._texture&&(this._texture.dispose(),this._texture=null),null!=this._uploadStatus&&(this._uploadStatus.controller.abort(),this._uploadStatus=null)}get isSourceScaled(){return this.width!==this._sourceWidth||this.height!==this._sourceHeight}get height(){return void 0!==this._height?this._height:this._sourceHeight}set height(p){this._height=p}get source(){return this._source}set source(p){null==p&&null==this._source||(this._source=p,this.invalidateTexture(),this.requestRender())}get width(){return void 0!==this._width?this._width:this._sourceWidth}set width(p){this._width=p}beforeRender(p){super.beforeRender(p),this.updateTexture(p)}setSourceAsync(p,E){var g=this;return(0,x.Z)(function*(){null!=g._uploadStatus&&g._uploadStatus.controller.abort();const b=new AbortController,w=(0,l.hh)();return(0,l.$F)(E,()=>b.abort()),(0,l.$F)(b,R=>w.reject(R)),g._uploadStatus={controller:b,resolver:w},g.source=p,w.promise})()}invalidateTexture(){this._textureInvalidated||(this._textureInvalidated=!0,this._source instanceof HTMLImageElement?(this._sourceHeight=this._source.naturalHeight,this._sourceWidth=this._source.naturalWidth):this._source&&(this._sourceHeight=this._source.height,this._sourceWidth=this._source.width))}updateTransitionProperties(p,E){p>=64&&(this.fadeTransitionEnabled=!1,this.inFadeTransition=!1),super.updateTransitionProperties(p,E)}setTransform(p){const E=(0,o.g)(this.transforms.dvs),[g,b]=p.toScreenNoRotation([0,0],[this.x,this.y]),w=this.resolution/this.pixelRatio/p.resolution,R=w*this.width,U=w*this.height,F=Math.PI*this.rotation/180;(0,o.h)(E,E,(0,_.f)(g,b)),(0,o.h)(E,E,(0,_.f)(R/2,U/2)),(0,o.r)(E,E,-F),(0,o.h)(E,E,(0,_.f)(-R/2,-U/2)),(0,o.l)(E,E,(0,_.f)(R,U)),(0,o.m)(this.transforms.dvs,p.displayViewMat3,E)}setSamplingProfile(p){this._texture&&(p.mips&&!this._texture.descriptor.hasMipmap&&this._texture.generateMipmap(),this._texture.setSamplingMode(p.samplingMode))}bind(p,E){this._texture&&p.bindTexture(this._texture,E)}updateTexture({context:p,painter:E}){var g=this;return(0,x.Z)(function*(){if(!g._textureInvalidated)return;if(g._textureInvalidated=!1,g._texture||(g._texture=g._createTexture(p)),!g.source)return void g._texture.setData(null);g._texture.resize(g._sourceWidth,g._sourceHeight);const b=function O(I){return M(I)?I instanceof a.Z?I.getRenderedRasterPixels()?.renderedRasterPixels:f(I):I}(g.source);try{if(null!=g._uploadStatus){const{controller:w,resolver:R}=g._uploadStatus,U={signal:w.signal},{width:F,height:k}=g,Z=g._texture;yield E.textureUploadManager.enqueueTextureUpdate({data:b,texture:Z,width:F,height:k},U),R.resolve(),g._uploadStatus=null}else g._texture.setData(b);g.ready()}catch(w){(0,l.H9)(w)}})()}onDetach(){this.destroy()}_createTransforms(){return{dvs:(0,y.c)()}}_createTexture(p){const E=this.immutable&&p.type===v.zO.WEBGL2,g=new N.X;return g.internalFormat=E?P.lP.RGBA8:P.VI.RGBA,g.wrapMode=P.e8.CLAMP_TO_EDGE,g.isImmutable=E,g.width=this._sourceWidth,g.height=this._sourceHeight,new i.x(p,g)}}},14403:(L,D,e)=>{e.d(D,{Z:()=>x});class x{constructor(o,y,_){this.pixelBlock=o,this.extent=y,this.originalPixelBlock=_}get width(){return null!=this.pixelBlock?this.pixelBlock.width:0}get height(){return null!=this.pixelBlock?this.pixelBlock.height:0}render(o){const y=this.pixelBlock;if(null==y)return;const _=this.filter({extent:this.extent,pixelBlock:this.originalPixelBlock??y});if(null==_.pixelBlock)return;_.pixelBlock.maskIsAlpha&&(_.pixelBlock.premultiplyAlpha=!0);const T=_.pixelBlock.getAsRGBA(),a=o.createImageData(_.pixelBlock.width,_.pixelBlock.height);a.data.set(T),o.putImageData(a,0,0)}getRenderedRasterPixels(){const o=this.filter({extent:this.extent,pixelBlock:this.pixelBlock});return null==o.pixelBlock?null:(o.pixelBlock.maskIsAlpha&&(o.pixelBlock.premultiplyAlpha=!0),{width:o.pixelBlock.width,height:o.pixelBlock.height,renderedRasterPixels:new Uint8Array(o.pixelBlock.getAsRGBA().buffer)})}}},82557:(L,D,e)=>{e.r(D),e.d(D,{default:()=>at});var x=e(15861),l=e(17626),o=e(24263),y=e(74333),_=e(62208),T=e(32917),a=e(21726),v=e(77712),M=(e(90912),e(85931),e(8314),e(76898)),f=e(2004),O=e(5464),j=e(65234),I=e(98686),p=e(2618),E=e(51815),g=e(90301),b=e(91757),w=e(37384),R=e(36275),U=e(78209),F=e(45611),k=e(84792),Z=e(72642),z=e(28594),lt=e(50392),st=e(15197),K=e(67969),nt=e(85775),ot=e(38982),rt=e(4995),ht=e(18952),Y=e(31548);let ut=(()=>{class r{constructor(h){if(this._ownsRctx=!1,h)this._ownsRctx=!1,this._rctx=h;else{if(r._instance)return r._instanceRefCount++,r._instance;r._instanceRefCount=1,r._instance=this,this._ownsRctx=!0;const d=document.createElement("canvas").getContext("webgl");d.getExtension("OES_texture_float"),this._rctx=new rt.x(d,{})}const s=(0,st.s)("raster/reproject","raster/reproject",new Map([["a_position",0]]),{applyProjection:!0,bilinear:!1,bicubic:!1});this._program=this._rctx.programCache.acquire(s.shaders.vertexShader,s.shaders.fragmentShader,s.attributes),this._rctx.useProgram(this._program),this._program.setUniform1f("u_opacity",1),this._program.setUniform1i("u_image",0),this._program.setUniform1i("u_flipY",0),this._program.setUniform1i("u_transformGrid",1),this._quad=new lt.Z(this._rctx,[0,0,1,0,0,1,1,1])}reprojectTexture(h,t,s=!1){const d=(0,O.project)(h.extent,t),m=new Z.Z({x:(h.extent.xmax-h.extent.xmin)/h.texture.descriptor.width,y:(h.extent.ymax-h.extent.ymin)/h.texture.descriptor.height,spatialReference:h.extent.spatialReference}),{x:C,y:B}=(0,z.VO)(m,t,h.extent);let S=(C+B)/2;const V=Math.round((d.xmax-d.xmin)/S),A=Math.round((d.ymax-d.ymin)/S);S=(d.width/V+d.height/A)/2;const dt=new Z.Z({x:S,y:S,spatialReference:d.spatialReference}),Q=(0,z.Qp)({projectedExtent:d,srcBufferExtent:h.extent,pixelSize:dt,hasWrapAround:!0,spacing:[16,16]}),$=(0,ot.Br)(this._rctx,Q),q=new Y.X(V,A);q.wrapMode=K.e8.CLAMP_TO_EDGE;const W=new nt.X(this._rctx,q);this._rctx.bindFramebuffer(W),this._rctx.setViewport(0,0,V,A),this._rctx.useProgram(this._program),this._rctx.bindTexture(h.texture,0),this._rctx.bindTexture($,1),this._quad.bind();const{width:tt=0,height:et=0}=h.texture.descriptor;if(this._program.setUniform2f("u_srcImageSize",tt,et),this._program.setUniform2fv("u_transformSpacing",Q.spacing),this._program.setUniform2fv("u_transformGridSize",Q.size),this._program.setUniform2f("u_targetImageSize",V,A),this._quad.draw(),this._quad.unbind(),this._rctx.useProgram(null),this._rctx.bindFramebuffer(null),$.dispose(),s){const{width:it,height:H}=W,_t=new ImageData(it??0,H??0);W.readPixels(0,0,it??0,H??0,K.VI.RGBA,K.Br.UNSIGNED_BYTE,_t.data);const ct=W.detachColorTexture(K.VY.COLOR_ATTACHMENT0);return W.dispose(),{texture:ct,extent:d,imageData:_t}}const X=W.detachColorTexture(K.VY.COLOR_ATTACHMENT0);return W.dispose(),{texture:X,extent:d}}reprojectBitmapData(h,t){const s=(0,g.JZ)(h.bitmapData)?(0,g.RL)(h.bitmapData):h.bitmapData,d=new Y.X;d.wrapMode=K.e8.CLAMP_TO_EDGE,d.width=h.bitmapData.width,d.height=h.bitmapData.height;const m=new ht.x(this._rctx,d,s),C=this.reprojectTexture({texture:m,extent:h.extent},t,!0);C.texture.dispose();const B=document.createElement("canvas"),S=C.imageData;return B.width=S.width,B.height=S.height,B.getContext("2d").putImageData(S,0,0),{bitmapData:B,extent:C.extent}}loadAndReprojectBitmapData(h,t,s){var d=this;return(0,x.Z)(function*(){const m=(yield(0,k.Z)(h,{responseType:"image"})).data,C=document.createElement("canvas");C.width=m.width,C.height=m.height;const B=C.getContext("2d");B.drawImage(m,0,0);const S=B.getImageData(0,0,C.width,C.height);if(t.spatialReference.equals(s))return{bitmapData:S,extent:t};const V=d.reprojectBitmapData({bitmapData:S,extent:t},s);return{bitmapData:V.bitmapData,extent:V.extent}})()}destroy(){this._ownsRctx?(r._instanceRefCount--,0===r._instanceRefCount&&(this._quad.dispose(),this._program.dispose(),this._rctx.dispose(),r._instance=null)):(this._quad.dispose(),this._program.dispose())}}return r._instanceRefCount=0,r})();class J{constructor(){this.allSublayers=new Map,this.allPoints=[],this.allPolylines=[],this.allPolygons=[],this.allMapImages=[]}}let G=class extends((0,w.y)(F.Z)){constructor(){super(...arguments),this._bitmapIndex=new Map,this._mapImageContainer=new b.c,this._kmlVisualData=new J,this._fetchController=null,this.allVisiblePoints=new E.J,this.allVisiblePolylines=new E.J,this.allVisiblePolygons=new E.J,this.allVisibleMapImages=new y.Z}hitTest(r,c){var h=this;return(0,x.Z)(function*(){const t=h.layer;return[h._pointsView?.hitTest(r),h._polylinesView?.hitTest(r),h._polygonsView?.hitTest(r)].flat().filter(Boolean).map(s=>(s.layer=t,s.sourceLayer=t,{type:"graphic",graphic:s,layer:t,mapPoint:r}))})()}update(r){this._polygonsView&&this._polygonsView.processUpdate(r),this._polylinesView&&this._polylinesView.processUpdate(r),this._pointsView&&this._pointsView.processUpdate(r)}attach(){this._fetchController=new AbortController,this.container.addChild(this._mapImageContainer),this._polygonsView=new U.Z({view:this.view,graphics:this.allVisiblePolygons,requestUpdateCallback:()=>this.requestUpdate(),container:new R.Z(this.view.featuresTilingScheme)}),this.container.addChild(this._polygonsView.container),this._polylinesView=new U.Z({view:this.view,graphics:this.allVisiblePolylines,requestUpdateCallback:()=>this.requestUpdate(),container:new R.Z(this.view.featuresTilingScheme)}),this.container.addChild(this._polylinesView.container),this._pointsView=new U.Z({view:this.view,graphics:this.allVisiblePoints,requestUpdateCallback:()=>this.requestUpdate(),container:new R.Z(this.view.featuresTilingScheme)}),this.container.addChild(this._pointsView.container),this.addAttachHandles([this.allVisibleMapImages.on("change",r=>{r.added.forEach(c=>this._addMapImage(c)),r.removed.forEach(c=>this._removeMapImage(c))}),(0,T.YP)(()=>this.layer.visibleSublayers,r=>{for(const[c,h]of this._kmlVisualData.allSublayers)h.visibility=0;for(const c of r){const h=this._kmlVisualData.allSublayers.get(c.id);h&&(h.visibility=1)}this._refreshCollections()})]),this._updatingHandles.addPromise(this._fetchService(this._fetchController.signal)),this._imageReprojector=new ut}detach(){this._fetchController=(0,_.IM)(this._fetchController),this._mapImageContainer.removeAllChildren(),this.container.removeAllChildren(),this._bitmapIndex.clear(),this._polygonsView=(0,_.SC)(this._polygonsView),this._polylinesView=(0,_.SC)(this._polylinesView),this._pointsView=(0,_.SC)(this._pointsView),this._imageReprojector=(0,_.SC)(this._imageReprojector)}moveStart(){}viewChange(){this._polygonsView.viewChange(),this._polylinesView.viewChange(),this._pointsView.viewChange()}moveEnd(){}isUpdating(){return this._pointsView.updating||this._polygonsView.updating||this._polylinesView.updating}_addMapImage(r){(this.view.spatialReference?.isWGS84||this.view.spatialReference?.isWebMercator)&&this._imageReprojector.loadAndReprojectBitmapData(r.href,f.Z.fromJSON(r.extent),this.view.spatialReference).then(c=>{const h=new g.eY(c.bitmapData);h.x=c.extent.xmin,h.y=c.extent.ymax,h.resolution=c.extent.width/c.bitmapData.width,h.rotation=r.rotation,this._mapImageContainer.addChild(h),this._bitmapIndex.set(r,h)})}_getViewDependentUrl(r,c){return(0,x.Z)(function*(){const{viewFormat:h,viewBoundScale:t,httpQuery:s}=r;if(null!=h){if(null==c)throw new Error("Loading this network link requires a view state.");let d;if(yield(0,O.load)(),null!=t&&1!==t){const X=new f.Z(c.extent);X.expand(t),d=X}else d=c.extent;d=(0,O.project)(d,j.Z.WGS84);const m=(0,O.project)(d,j.Z.WebMercator),C=d.xmin,B=d.xmax,S=d.ymin,V=d.ymax,A=c.size[0]*c.pixelRatio,dt=c.size[1]*c.pixelRatio,Q=Math.max(m.width,m.height),$={"[bboxWest]":C.toString(),"[bboxEast]":B.toString(),"[bboxSouth]":S.toString(),"[bboxNorth]":V.toString(),"[lookatLon]":d.center.x.toString(),"[lookatLat]":d.center.y.toString(),"[lookatRange]":Q.toString(),"[lookatTilt]":"0","[lookatHeading]":c.rotation.toString(),"[lookatTerrainLon]":d.center.x.toString(),"[lookatTerrainLat]":d.center.y.toString(),"[lookatTerrainAlt]":"0","[cameraLon]":d.center.x.toString(),"[cameraLat]":d.center.y.toString(),"[cameraAlt]":Q.toString(),"[horizFov]":"60","[vertFov]":"60","[horizPixels]":A.toString(),"[vertPixels]":dt.toString(),"[terrainEnabled]":"0","[clientVersion]":o.i8,"[kmlVersion]":"2.2","[clientName]":"ArcGIS API for JavaScript","[language]":"en-US"},q=X=>{for(const it in X){let H;for(H in $)X[it]=X[it].replace(H,$[H])}},W=(0,a.u0)(h);q(W);let tt={};null!=s&&(tt=(0,a.u0)(s),q(tt));const et=(0,p.en)(r.href);return et.query={...et.query,...W,...tt},`${et.path}?${(0,a.B7)(W)}`}return r.href})()}_fetchService(r){var c=this;return(0,x.Z)(function*(){const h=new J;yield c._loadVisualData(c.layer.url,h,r),c._kmlVisualData=h,c._refreshCollections()})()}_refreshCollections(){this.allVisiblePoints.removeAll(),this.allVisiblePolylines.removeAll(),this.allVisiblePolygons.removeAll(),this.allVisibleMapImages.removeAll(),this.allVisiblePoints.addMany(this._kmlVisualData.allPoints.filter(r=>this._isSublayerVisible(r.sublayerId)).map(({item:r})=>r)),this.allVisiblePolylines.addMany(this._kmlVisualData.allPolylines.filter(r=>this._isSublayerVisible(r.sublayerId)).map(({item:r})=>r)),this.allVisiblePolygons.addMany(this._kmlVisualData.allPolygons.filter(r=>this._isSublayerVisible(r.sublayerId)).map(({item:r})=>r)),this.allVisibleMapImages.addMany(this._kmlVisualData.allMapImages.filter(r=>this._isSublayerVisible(r.sublayerId)).map(({item:r})=>r))}_isSublayerVisible(r){const c=this._kmlVisualData.allSublayers.get(r);return!!c?.visibility&&(-1===c.parentFolderId||this._isSublayerVisible(c.parentFolderId))}_loadVisualData(r,c,h){var t=this;return this._fetchParsedKML(r,h).then(function(){var s=(0,x.Z)(function*(d){for(const m of d.sublayers){c.allSublayers.set(m.id,m);const C=m.points?yield(0,I.Yu)(m.points):[],B=m.polylines?yield(0,I.Yu)(m.polylines):[],S=m.polygons?yield(0,I.Yu)(m.polygons):[],V=m.mapImages||[];if(c.allPoints.push(...C.map(A=>({item:A,sublayerId:m.id}))),c.allPolylines.push(...B.map(A=>({item:A,sublayerId:m.id}))),c.allPolygons.push(...S.map(A=>({item:A,sublayerId:m.id}))),c.allMapImages.push(...V.map(A=>({item:A,sublayerId:m.id}))),m.networkLink){const A=yield t._getViewDependentUrl(m.networkLink,t.view.state);yield t._loadVisualData(A,c,h)}}});return function(d){return s.apply(this,arguments)}}())}_fetchParsedKML(r,c){return(0,I.CS)(r,this.layer.spatialReference,this.layer.refreshInterval,c).then(h=>(0,I.Cw)(h.data))}_removeMapImage(r){const c=this._bitmapIndex.get(r);c&&(this._mapImageContainer.removeChild(c),this._bitmapIndex.delete(r))}};(0,l._)([(0,v.Cb)()],G.prototype,"_pointsView",void 0),(0,l._)([(0,v.Cb)()],G.prototype,"_polylinesView",void 0),(0,l._)([(0,v.Cb)()],G.prototype,"_polygonsView",void 0),(0,l._)([(0,v.Cb)()],G.prototype,"updating",void 0),G=(0,l._)([(0,M.j)("esri.views.2d.layers.KMLLayerView2D")],G);const at=G},17625:(L,D,e)=>{e.d(D,{H:()=>o,K:()=>l});const l=class x{};function o(y,..._){let T="";for(let a=0;a<_.length;a++)T+=y[a]+_[a];return T+=y[y.length-1],T}var y;(y=o||(o={})).int=function _(a){return Math.round(a).toString()},y.float=function T(a){return a.toPrecision(8)}},88569:(L,D,e)=>{e.d(D,{Bh:()=>M,IB:()=>T,j7:()=>a,je:()=>N,ve:()=>P,wu:()=>y});var x=e(44835),l=e(67969),o=e(2078);const y=(0,o.wK)(l.zi.SRC_ALPHA,l.zi.ONE,l.zi.ONE_MINUS_SRC_ALPHA,l.zi.ONE_MINUS_SRC_ALPHA),_=(0,o.if)(l.zi.ONE,l.zi.ONE),T=(0,o.if)(l.zi.ZERO,l.zi.ONE_MINUS_SRC_ALPHA);function a(f){return f===x.A.FrontFace?null:f===x.A.Alpha?T:_}const P=5e5,i={factor:-1,units:-2};function N(f){return f?i:null}function M(f,O=l.wb.LESS){return f===x.A.NONE||f===x.A.FrontFace?O:l.wb.LEQUAL}},44835:(L,D,e)=>{var x,l;e.d(D,{A:()=>x}),(l=x||(x={}))[l.Color=0]="Color",l[l.Alpha=1]="Alpha",l[l.FrontFace=2]="FrontFace",l[l.NONE=3]="NONE",l[l.COUNT=4]="COUNT"},42743:(L,D,e)=>{var x,l,o,y,_,T,a,v,P,i;e.d(D,{Gv:()=>l,Iq:()=>v,JJ:()=>a,Rw:()=>y,Ti:()=>P,V_:()=>T,Vr:()=>x,hU:()=>_}),(i=x||(x={}))[i.None=0]="None",i[i.Front=1]="Front",i[i.Back=2]="Back",i[i.COUNT=3]="COUNT",function(i){i[i.Less=0]="Less",i[i.Lequal=1]="Lequal",i[i.COUNT=2]="COUNT"}(l||(l={})),function(i){i[i.BACKGROUND=0]="BACKGROUND",i[i.UPDATE=1]="UPDATE"}(o||(o={})),function(i){i[i.NOT_LOADED=0]="NOT_LOADED",i[i.LOADING=1]="LOADING",i[i.LOADED=2]="LOADED"}(y||(y={})),function(i){i[i.IntegratedMeshMaskExcluded=1]="IntegratedMeshMaskExcluded",i[i.OutlineVisualElementMask=2]="OutlineVisualElementMask"}(_||(_={})),function(i){i[i.Highlight=0]="Highlight",i[i.MaskOccludee=1]="MaskOccludee",i[i.COUNT=2]="COUNT"}(T||(T={})),function(i){i[i.Blend=0]="Blend",i[i.Opaque=1]="Opaque",i[i.Mask=2]="Mask",i[i.MaskBlend=3]="MaskBlend",i[i.COUNT=4]="COUNT"}(a||(a={})),function(i){i[i.OFF=0]="OFF",i[i.ON=1]="ON"}(v||(v={})),function(i){i.DDS_ENCODING="image/vnd-ms.dds",i.KTX2_ENCODING="image/ktx2",i.BASIS_ENCODING="image/x.basis"}(P||(P={}))},69839:(L,D,e)=>{e.d(D,{G:()=>l});var x=e(62208);class l{constructor(){this._result=!1}dispose(){this._program=(0,x.M2)(this._program)}get result(){return null!=this._program&&(this._result=this._test(this._program),this.dispose()),this._result}}},46593:(L,D,e)=>{e.d(D,{mO:()=>y});var x=e(38210);class l{constructor(T,a,v,P,i,N,M,f,O){this.createQuery=T,this.deleteQuery=a,this.resultAvailable=v,this.getResult=P,this.disjoint=i,this.beginTimeElapsed=N,this.endTimeElapsed=M,this.createTimestamp=f,this.timestampBits=O}}let o=!1;function y(_,T){if(T.disjointTimerQuery)return null;let a=_.getExtension("EXT_disjoint_timer_query_webgl2");return a&&(0,x.Z)(_)?new l(()=>_.createQuery(),v=>{_.deleteQuery(v),o=!1},v=>_.getQueryParameter(v,_.QUERY_RESULT_AVAILABLE),v=>_.getQueryParameter(v,_.QUERY_RESULT),()=>_.getParameter(a.GPU_DISJOINT_EXT),v=>{o||(o=!0,_.beginQuery(a.TIME_ELAPSED_EXT,v))},()=>{_.endQuery(a.TIME_ELAPSED_EXT),o=!1},v=>a.queryCounterEXT(v,a.TIMESTAMP_EXT),()=>_.getQuery(a.TIMESTAMP_EXT,a.QUERY_COUNTER_BITS_EXT)):(a=_.getExtension("EXT_disjoint_timer_query"),a?new l(()=>a.createQueryEXT(),v=>{a.deleteQueryEXT(v),o=!1},v=>a.getQueryObjectEXT(v,a.QUERY_RESULT_AVAILABLE_EXT),v=>a.getQueryObjectEXT(v,a.QUERY_RESULT_EXT),()=>_.getParameter(a.GPU_DISJOINT_EXT),v=>{o||(o=!0,a.beginQueryEXT(a.TIME_ELAPSED_EXT,v))},()=>{a.endQueryEXT(a.TIME_ELAPSED_EXT),o=!1},v=>a.queryCounterEXT(v,a.TIMESTAMP_EXT),()=>a.getQueryEXT(a.TIMESTAMP_EXT,a.QUERY_COUNTER_BITS_EXT)):null)}},2078:(L,D,e)=>{e.d(D,{BK:()=>P,LZ:()=>v,if:()=>o,jp:()=>h,sm:()=>g,wK:()=>y,zp:()=>a});var x=e(42743),l=e(67969);function o(t,s,d=l.db.ADD,m=[0,0,0,0]){return{srcRgb:t,srcAlpha:t,dstRgb:s,dstAlpha:s,opRgb:d,opAlpha:d,color:{r:m[0],g:m[1],b:m[2],a:m[3]}}}function y(t,s,d,m,C=l.db.ADD,B=l.db.ADD,S=[0,0,0,0]){return{srcRgb:t,srcAlpha:s,dstRgb:d,dstAlpha:m,opRgb:C,opAlpha:B,color:{r:S[0],g:S[1],b:S[2],a:S[3]}}}const _={face:l.LR.BACK,mode:l.Wf.CCW},T={face:l.LR.FRONT,mode:l.Wf.CCW},a=t=>t===x.Vr.Back?_:t===x.Vr.Front?T:null,v={zNear:0,zFar:1},P={r:!0,g:!0,b:!0,a:!0};function i(t){return R.intern(t)}function N(t){return F.intern(t)}function M(t){return Z.intern(t)}function f(t){return lt.intern(t)}function O(t){return K.intern(t)}function j(t){return ot.intern(t)}function I(t){return ht.intern(t)}function p(t){return ut.intern(t)}function E(t){return G.intern(t)}function g(t){return r.intern(t)}class b{constructor(s,d){this._makeKey=s,this._makeRef=d,this._interns=new Map}intern(s){if(!s)return null;const d=this._makeKey(s),m=this._interns;return m.has(d)||m.set(d,this._makeRef(s)),m.get(d)??null}}function w(t){return"["+t.join(",")+"]"}const R=new b(U,t=>({__tag:"Blending",...t}));function U(t){return t?w([t.srcRgb,t.srcAlpha,t.dstRgb,t.dstAlpha,t.opRgb,t.opAlpha,t.color.r,t.color.g,t.color.b,t.color.a]):null}const F=new b(k,t=>({__tag:"Culling",...t}));function k(t){return t?w([t.face,t.mode]):null}const Z=new b(z,t=>({__tag:"PolygonOffset",...t}));function z(t){return t?w([t.factor,t.units]):null}const lt=new b(st,t=>({__tag:"DepthTest",...t}));function st(t){return t?w([t.func]):null}const K=new b(nt,t=>({__tag:"StencilTest",...t}));function nt(t){return t?w([t.function.func,t.function.ref,t.function.mask,t.operation.fail,t.operation.zFail,t.operation.zPass]):null}const ot=new b(rt,t=>({__tag:"DepthWrite",...t}));function rt(t){return t?w([t.zNear,t.zFar]):null}const ht=new b(Y,t=>({__tag:"ColorWrite",...t}));function Y(t){return t?w([t.r,t.g,t.b,t.a]):null}const ut=new b(J,t=>({__tag:"StencilWrite",...t}));function J(t){return t?w([t.mask]):null}const G=new b(at,t=>({__tag:"DrawBuffers",...t}));function at(t){return t?w(t.buffers):null}const r=new b(function c(t){return t?w([U(t.blending),k(t.culling),z(t.polygonOffset),st(t.depthTest),nt(t.stencilTest),rt(t.depthWrite),Y(t.colorWrite),J(t.stencilWrite),at(t.drawBuffers)]):null},t=>({blending:i(t.blending),culling:N(t.culling),polygonOffset:M(t.polygonOffset),depthTest:f(t.depthTest),stencilTest:O(t.stencilTest),depthWrite:j(t.depthWrite),colorWrite:I(t.colorWrite),stencilWrite:p(t.stencilWrite),drawBuffers:E(t.drawBuffers)}));class h{constructor(s){this._pipelineInvalid=!0,this._blendingInvalid=!0,this._cullingInvalid=!0,this._polygonOffsetInvalid=!0,this._depthTestInvalid=!0,this._stencilTestInvalid=!0,this._depthWriteInvalid=!0,this._colorWriteInvalid=!0,this._stencilWriteInvalid=!0,this._drawBuffersInvalid=!0,this._stateSetters=s}setPipeline(s){(this._pipelineInvalid||s!==this._pipeline)&&(this._setBlending(s.blending),this._setCulling(s.culling),this._setPolygonOffset(s.polygonOffset),this._setDepthTest(s.depthTest),this._setStencilTest(s.stencilTest),this._setDepthWrite(s.depthWrite),this._setColorWrite(s.colorWrite),this._setStencilWrite(s.stencilWrite),this._setDrawBuffers(s.drawBuffers),this._pipeline=s),this._pipelineInvalid=!1}invalidateBlending(){this._blendingInvalid=!0,this._pipelineInvalid=!0}invalidateCulling(){this._cullingInvalid=!0,this._pipelineInvalid=!0}invalidatePolygonOffset(){this._polygonOffsetInvalid=!0,this._pipelineInvalid=!0}invalidateDepthTest(){this._depthTestInvalid=!0,this._pipelineInvalid=!0}invalidateStencilTest(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDepthWrite(){this._depthWriteInvalid=!0,this._pipelineInvalid=!0}invalidateColorWrite(){this._colorWriteInvalid=!0,this._pipelineInvalid=!0}invalidateStencilWrite(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDrawBuffers(){this._drawBuffersInvalid=!0,this._pipelineInvalid=!0}_setBlending(s){this._blending=this._setSubState(s,this._blending,this._blendingInvalid,this._stateSetters.setBlending),this._blendingInvalid=!1}_setCulling(s){this._culling=this._setSubState(s,this._culling,this._cullingInvalid,this._stateSetters.setCulling),this._cullingInvalid=!1}_setPolygonOffset(s){this._polygonOffset=this._setSubState(s,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset),this._polygonOffsetInvalid=!1}_setDepthTest(s){this._depthTest=this._setSubState(s,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest),this._depthTestInvalid=!1}_setStencilTest(s){this._stencilTest=this._setSubState(s,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest),this._stencilTestInvalid=!1}_setDepthWrite(s){this._depthWrite=this._setSubState(s,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite),this._depthWriteInvalid=!1}_setColorWrite(s){this._colorWrite=this._setSubState(s,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite),this._colorWriteInvalid=!1}_setStencilWrite(s){this._stencilWrite=this._setSubState(s,this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite),this._stencilTestInvalid=!1}_setDrawBuffers(s){this._drawBuffers=this._setSubState(s,this._drawBuffers,this._drawBuffersInvalid,this._stateSetters.setDrawBuffers),this._drawBuffersInvalid=!1}_setSubState(s,d,m,C){return(m||s!==d)&&(C(s),this._pipelineInvalid=!0),s}}},7160:(L,D,e)=>{e.d(D,{d:()=>P});var x=e(93292),l=e(83994),o=e(67969),y=e(85775),_=e(18952),T=e(31548),a=e(49353),v=e(69839);class P extends v.G{constructor(M){super(),this._rctx=M,this._program=M.programCache.acquire("\n    precision highp float;\n\n    attribute vec2 a_pos;\n    varying vec2 v_uv;\n\n    void main() {\n      v_uv = a_pos;\n      gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n    }\n    ","\n    precision highp float;\n\n    varying vec2 v_uv;\n\n    uniform sampler2D u_texture;\n\n    void main() {\n      gl_FragColor = texture2D(u_texture, v_uv);\n    }\n    ",new Map([["a_pos",0]]))}dispose(){super.dispose()}_test(M){const f=this._rctx;if(!f.gl)return M.dispose(),!0;const O=new T.X(1);O.wrapMode=o.e8.CLAMP_TO_EDGE,O.samplingMode=o.cw.NEAREST;const j=new y.X(f,O),I=l.f.createVertex(f,o.l1.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),p=new a.U(f,new Map([["a_pos",0]]),x.cD,{geometry:I}),E=new T.X;E.samplingMode=o.cw.LINEAR,E.wrapMode=o.e8.CLAMP_TO_EDGE;const g=new _.x(f,E,i);f.useProgram(M),f.bindTexture(g,0),M.setUniform1i("u_texture",0);const b=f.getBoundFramebufferObject(),{x:w,y:R,width:U,height:F}=f.getViewport();f.bindFramebuffer(j),f.setViewport(0,0,1,1),f.setClearColor(0,0,0,0),f.setBlendingEnabled(!1),f.clearSafe(o.lk.COLOR_BUFFER_BIT),f.bindVAO(p),f.drawArrays(o.MX.TRIANGLE_STRIP,0,4);const k=new Uint8Array(4);return j.readPixels(0,0,1,1,o.VI.RGBA,o.Br.UNSIGNED_BYTE,k),p.dispose(),j.dispose(),g.dispose(),f.setViewport(w,R,U,F),f.bindFramebuffer(b),255!==k[0]}}const i=new Image;i.src="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='5' height='5' version='1.1' viewBox='0 0 5 5' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='5' height='5' fill='%23f00' fill-opacity='.5'/%3E%3C/svg%3E%0A",i.width=5,i.height=5,i.decode()}}]);