"use strict";(self.webpackChunkCRIS=self.webpackChunkCRIS||[]).push([[7434],{67434:(m,c,r)=>{r.r(c),r.d(c,{default:()=>L});var E=r(15861),u=r(17626),d=(r(8314),r(63290),r(90912),r(85931),r(26584),r(76898)),O=r(84682),v=r(36859),R=r(39351),I=r(13112),a=r(55376);class l{constructor(t,_){this.offset=t,this.extent=_}}let f=class extends I.Z{constructor(){super(...arguments),this.type="heatmap",this._tileKeyToFeatureSets=new Map}initialize(){this.addHandles([this.tileStore.on("update",this.onTileUpdate.bind(this))])}update(o,t){var _=this;return(0,E.Z)(function*(){const s=t.schema.processors[0];"heatmap"===s.type&&(0,O.Hg)(_._schema,s)&&(o.mesh=!0,_._schema=s)})()}onTileUpdate(o){for(const t of o.removed)this._tileKeyToFeatureSets.delete(t.key.id)}onTileClear(o){return this._tileKeyToFeatureSets.delete(o.key.id),this.remoteClient.invoke("tileRenderer.onTileData",{tileKey:o.id,data:{clear:!0}})}onTileMessage(o,t,_){var s=this;return(0,E.Z)(function*(){s._tileKeyToFeatureSets.has(o.key.id)||s._tileKeyToFeatureSets.set(o.key.id,new Map);const e=s._tileKeyToFeatureSets.get(o.key.id);if(e&&null!=t.addOrUpdate&&t.addOrUpdate.hasFeatures&&e.set(t.addOrUpdate.instance,t),t.end){const n=[],y=function B(o){const t=o.key,_=new Map,s=256,e=R.i9,n=o.tileInfoView.tileInfo.isWrappable;return _.set((0,a.M)(t,-1,-1,n).id,new l([-e,-e],[e-s,e-s,e,e])),_.set((0,a.M)(t,0,-1,n).id,new l([0,-e],[0,e-s,e,e])),_.set((0,a.M)(t,1,-1,n).id,new l([e,-e],[0,e-s,s,e])),_.set((0,a.M)(t,-1,0,n).id,new l([-e,0],[e-s,0,e,e])),_.set((0,a.M)(t,1,0,n).id,new l([e,0],[0,0,s,e])),_.set((0,a.M)(t,-1,1,n).id,new l([-e,e],[e-s,0,e,s])),_.set((0,a.M)(t,0,1,n).id,new l([0,e],[0,0,e,s])),_.set((0,a.M)(t,1,1,n).id,new l([e,e],[0,0,s,s])),_}(o);s._tileKeyToFeatureSets.forEach((C,T)=>{if(T===o.key.id)C.forEach(({addOrUpdate:h})=>{h&&n.push(h)});else if(y.has(T)){const h=y.get(T),[W,A]=h.offset;C.forEach(({addOrUpdate:K})=>{if(K){const w=K.transform(W,A,1,1);n.push(w)}})}});const U=(0,v.QM)(n,s._schema.mesh,512,512);return s.remoteClient.invoke("tileRenderer.onTileData",{tileKey:o.key.id,intensityInfo:U},{..._,transferList:[U.matrix]})}})()}onTileError(o,t,_){return this.remoteClient.invoke("tileRenderer.onTileError",{tileKey:o.id,error:t},_)}};f=(0,u._)([(0,d.j)("esri.views.2d.layers.features.processors.HeatmapProcessor")],f);const L=f},55376:(m,c,r)=>{function E(u,p,D,P){const i=u.clone(),M=1<<i.level,d=i.col+p,O=i.row+D;return P&&d<0?(i.col=d+M,i.world-=1):d>=M?(i.col=d-M,i.world+=1):i.col=d,i.row=O,i}r.d(c,{M:()=>E})}}]);