"use strict";(self.webpackChunkCRIS=self.webpackChunkCRIS||[]).push([[1913,1e3],{81913:(re,j,s)=>{s.r(j),s.d(j,{applyEdits:()=>z,checkEditingCapabilities:()=>p,isFeatureIdentifierArrayWithGlobalId:()=>O,isFeatureIdentifierArrayWithObjectId:()=>P,isFeatureIdentifierWithGlobalId:()=>Z,isFeatureIdentifierWithObjectId:()=>M,normalizeCollections:()=>k,normalizeEdits:()=>q,normalizeGeometries:()=>U,shallowCloneFeature:()=>$,uploadAssets:()=>ee});var v=s(15861),x=s(88879),b=s(74333),i=s(26584),V=s(58817),te=s(63290),Y=s(10699),L=s(21726),G=s(35948),E=s(93555),m=s(6733),D=s(90194),I=s(35391),A=s(72469);function R(e){return null!=e?.applyEdits}function M(e){return"object"==typeof e&&null!=e&&"objectId"in e&&!!e.objectId}function P(e){return e.every(M)}function Z(e){return"object"==typeof e&&null!=e&&"globalId"in e&&!!e.globalId}function O(e){return e.every(Z)}function z(e,t,r){return H.apply(this,arguments)}function H(){return H=(0,v.Z)(function*(e,t,r,a={}){let n;const W=a.gdbVersion??("gdbVersion"in e?e.gdbVersion:null);(0,m.lQ)(e)&&e.url?n=(0,m.jF)(e.url,e.layerId,W,"original-and-current-features"===a.returnServiceEditsOption):(n=(0,Y.hh)(),n.promise.then(l=>{(l.addedFeatures.length||l.updatedFeatures.length||l.deletedFeatures.length||l.addedAttachments.length||l.updatedAttachments.length||l.deletedAttachments.length)&&e.emit("edits",l)}),e.emit("apply-edits",{result:n.promise}));try{const{results:d,edits:l}=yield function u(e,t,r,a){return h.apply(this,arguments)}(e,t,r,a),F=c=>c.filter(ae=>!ae.error).map(V.d9),K={edits:l,addedFeatures:F(d.addFeatureResults),updatedFeatures:F(d.updateFeatureResults),deletedFeatures:F(d.deleteFeatureResults),addedAttachments:F(d.addAttachmentResults),updatedAttachments:F(d.updateAttachmentResults),deletedAttachments:F(d.deleteAttachmentResults),exceededTransferLimit:!1,historicMoment:d.editMoment?new Date(d.editMoment):null,globalIdToObjectId:a.globalIdToObjectId};return d.editedFeatureResults?.length&&(K.editedFeatures=d.editedFeatureResults),n.resolve(K),d}catch(d){throw n.reject(d),d}}),H.apply(this,arguments)}function h(){return h=(0,v.Z)(function*(e,t,r,a){if(yield e.load(),!R(t))throw new i.Z(`${e.type}-layer:no-editing-support`,"Layer source does not support applyEdits capability",{layer:e});if(!(0,A.ln)(e))throw new i.Z(`${e.type}-layer:editing-disabled`,"Editing is disabled for layer",{layer:e});const{edits:n,options:o}=yield function _(e,t,r){return f.apply(this,arguments)}(e,r,a);return n.addFeatures?.length||n.updateFeatures?.length||n.deleteFeatures?.length||n.addAttachments?.length||n.updateAttachments?.length||n.deleteAttachments?.length?{edits:n,results:yield t.applyEdits(n,o)}:{edits:n,results:{addFeatureResults:[],updateFeatureResults:[],deleteFeatureResults:[],addAttachmentResults:[],updateAttachmentResults:[],deleteAttachmentResults:[]}}}),h.apply(this,arguments)}function f(){return f=(0,v.Z)(function*(e,t,r){const a=(0,A.S1)(e),W=null!=e.infoFor3D;if(p(t,a,r,!(!t||!(t.addFeatures||t.updateFeatures||t.deleteFeatures)),!(!t||!(t.addAttachments||t.updateAttachments||t.deleteAttachments)),`${e.type}-layer`),!a.data.isVersioned&&r?.gdbVersion)throw new i.Z(`${e.type}-layer:invalid-parameter`,"'gdbVersion' is applicable only if the layer supports versioned data. See: 'capabilities.data.isVersioned'");if(!a.editing.supportsRollbackOnFailure&&r?.rollbackOnFailureEnabled)throw new i.Z(`${e.type}-layer:invalid-parameter`,"This layer does not support 'rollbackOnFailureEnabled' parameter. See: 'capabilities.editing.supportsRollbackOnFailure'");const d={...r};if(null!=d.rollbackOnFailureEnabled||a.editing.supportsRollbackOnFailure||(d.rollbackOnFailureEnabled=!0),d.rollbackOnFailureEnabled||"original-and-current-features"!==d.returnServiceEditsOption||(!1===d.rollbackOnFailureEnabled&&te.Z.getLogger("esri.layers.graphics.editingSupport").warn(`${e.type}-layer:invalid-parameter`,"'original-and-current-features' is valid for 'returnServiceEditsOption' only when 'rollBackOnFailure' is true, but 'rollBackOnFailure' was set to false. 'rollBackOnFailure' has been overwrritten and set to true."),d.rollbackOnFailureEnabled=!0),!a.editing.supportsReturnServiceEditsInSourceSpatialReference&&d.returnServiceEditsInSourceSR)throw new i.Z(`${e.type}-layer:invalid-parameter`,"This layer does not support 'returnServiceEditsInSourceSR' parameter. See: 'capabilities.editing.supportsReturnServiceEditsInSourceSpatialReference'");if(d.returnServiceEditsInSourceSR&&"original-and-current-features"!==d.returnServiceEditsOption)throw new i.Z(`${e.type}-layer:invalid-parameter`,"'returnServiceEditsInSourceSR' is valid only when 'returnServiceEditsOption' is set to 'original-and-current-features'");const l=q(t,a,`${e.type}-layer`),F=r?.globalIdUsed||W,K=e.fields.filter(c=>"big-integer"===c.type||"oid"===c.type&&(c.length||0)>=8);if(F){const{globalIdField:c}=e;if(null==c)throw new i.Z(`${e.type}-layer:invalid-parameter`,"Layer does not specify a global id field.");l.addFeatures.forEach(ae=>function N(e,t){const{attributes:r}=e;null==r[t]&&(r[t]=(0,G.zS)())}(ae,c))}return l.addFeatures.forEach(c=>function w(e,t,r,a){g(e,t,r,a),y(e,t)}(c,e,F,K)),l.updateFeatures.forEach(c=>function J(e,t,r,a){g(e,t,r,a),y(e,t);const n=(0,A.S1)(t);if("geometry"in e&&null!=e.geometry&&!n?.editing.supportsGeometryUpdate)throw new i.Z(`${t.type}-layer:unsupported-operation`,"Layer does not support geometry updates.")}(c,e,F,K)),l.deleteFeatures.forEach(c=>function S(e,t,r,a){g(e,t,r,a)}(c,e,F,K)),l.addAttachments.forEach(c=>T(c,e)),l.updateAttachments.forEach(c=>T(c,e)),W&&(yield function B(e,t){return C.apply(this,arguments)}(l,e)),{edits:yield U(l),options:d}}),f.apply(this,arguments)}function g(e,t,r,a){if(r){if("attributes"in e&&!e.attributes[t.globalIdField])throw new i.Z(`${t.type}-layer:invalid-parameter`,`Feature should have '${t.globalIdField}' when 'globalIdUsed' is true`);if(!("attributes"in e)&&!e.globalId)throw new i.Z(`${t.type}-layer:invalid-parameter`,"`'globalId' of the feature should be passed when 'globalIdUsed' is true")}if(a.length&&"attributes"in e)for(const n of a){const o=e.attributes[n.name];if(void 0!==o&&!(0,D.d2)(n,o))throw new i.Z(`${t.type}-layer:invalid-parameter`,`Big-integer field '${n.name}' of the feature must be less than ${Number.MAX_SAFE_INTEGER}`,{feature:e})}if("geometry"in e&&null!=e.geometry){if(e.geometry.hasZ&&!1===t.capabilities?.data.supportsZ)throw new i.Z(`${t.type}-layer:z-unsupported`,"Layer does not support z values while feature has z values.");if(e.geometry.hasM&&!1===t.capabilities?.data.supportsM)throw new i.Z(`${t.type}-layer:m-unsupported`,"Layer does not support m values while feature has m values.")}}function y(e,t){if("geometry"in e&&"mesh"===e.geometry?.type&&null!=t.infoFor3D){const{geometry:r}=e;if(r.vertexSpace.isGeoreferenced)throw new i.Z(`${t.type}-layer:georeferenced-mesh-unsupported`,"Uploading georeferenced meshes to a layer is not supported.")}}function T(e,t){const{feature:r,attachment:a}=e;if(!r||"attributes"in r&&!r.attributes[t.globalIdField])throw new i.Z(`${t.type}-layer:invalid-parameter`,"Attachment should have reference to a feature with 'globalId'");if(!("attributes"in r)&&!r.globalId)throw new i.Z(`${t.type}-layer:invalid-parameter`,"Attachment should have reference to 'globalId' of the parent feature");if(!a.globalId)throw new i.Z(`${t.type}-layer:invalid-parameter`,"Attachment should have 'globalId'");if(!a.data&&!a.uploadId)throw new i.Z(`${t.type}-layer:invalid-parameter`,"Attachment should have 'data' or 'uploadId'");if(!(a.data instanceof File&&a.data.name||a.name))throw new i.Z(`${t.type}-layer:invalid-parameter`,"'name' is required when attachment is specified as Base64 encoded string using 'data'");if(!t.capabilities?.editing.supportsUploadWithItemId&&a.uploadId)throw new i.Z(`${t.type}-layer:invalid-parameter`,"This layer does not support 'uploadId' parameter. See: 'capabilities.editing.supportsUploadWithItemId'");if("string"==typeof a.data){const n=(0,L.sJ)(a.data);if(n&&!n.isBase64)throw new i.Z(`${t.type}-layer:invalid-parameter`,"Attachment 'data' should be a Blob, File or Base64 encoded string")}}function U(e){return Q.apply(this,arguments)}function Q(){return(Q=(0,v.Z)(function*(e){const t=e.addFeatures??[],r=e.updateFeatures??[],a=t.concat(r).map(d=>d.geometry),n=yield(0,E.aX)(a),o=t.length,W=r.length;return n.slice(0,o).forEach((d,l)=>t[l].geometry=d),n.slice(o,o+W).forEach((d,l)=>r[l].geometry=d),e})).apply(this,arguments)}function k(e){return{addFeatures:Array.from(e?.addFeatures??[]),updateFeatures:Array.from(e?.updateFeatures??[]),deleteFeatures:e&&b.Z.isCollection(e.deleteFeatures)?e.deleteFeatures.toArray():e.deleteFeatures||[],addAttachments:e.addAttachments||[],updateAttachments:e.updateAttachments||[],deleteAttachments:e.deleteAttachments||[]}}function q(e,t,r){const a=k(e);if(a.addFeatures?.length&&!t.operations.supportsAdd)throw new i.Z(`${r}:unsupported-operation`,"Layer does not support adding features.");if(a.updateFeatures?.length&&!t.operations.supportsUpdate)throw new i.Z(`${r}:unsupported-operation`,"Layer does not support updating features.");if(a.deleteFeatures?.length&&!t.operations.supportsDelete)throw new i.Z(`${r}:unsupported-operation`,"Layer does not support deleting features.");return a.addFeatures=a.addFeatures.map($),a.updateFeatures=a.updateFeatures.map($),a.addAssetFeatures=[],a}function p(e,t,r,a,n,o){if(!e||!a&&!n)throw new i.Z(`${o}:missing-parameters`,"'addFeatures', 'updateFeatures', 'deleteFeatures', 'addAttachments', 'updateAttachments' or 'deleteAttachments' parameter is required");if(!t.editing.supportsGlobalId&&r?.globalIdUsed)throw new i.Z(`${o}:invalid-parameter`,"This layer does not support 'globalIdUsed' parameter. See: 'capabilities.editing.supportsGlobalId'");if(!t.editing.supportsGlobalId&&n)throw new i.Z(`${o}:invalid-parameter`,"'addAttachments', 'updateAttachments' and 'deleteAttachments' are applicable only if the layer supports global ids. See: 'capabilities.editing.supportsGlobalId'");if(!r?.globalIdUsed&&n)throw new i.Z(`${o}:invalid-parameter`,"When 'addAttachments', 'updateAttachments' or 'deleteAttachments' is specified, globalIdUsed should be set to true")}function $(e){const t=new x.Z;return e.attributes||(e.attributes={}),t.geometry=e.geometry,t.attributes=e.attributes,t}function C(){return(C=(0,v.Z)(function*(e,t){if(null==t.infoFor3D)return;const{infoFor3D:r}=t,a=(0,I.S0)("model/gltf-binary",r.supportedFormats)??(0,I.Ow)("glb",r.supportedFormats);if(!a||!r.editFormats.includes(a))throw new i.Z(`${t.type}-layer:binary-gltf-asset-not-supported`,"3DObjectFeatureLayer requires binary glTF (.glb) support for updating mesh geometry.");e.addAssetFeatures??=[];const{addAssetFeatures:n}=e;for(const o of e.addFeatures??[])X(o)&&n.push(o);for(const o of e.updateFeatures??[])X(o)&&n.push(o)})).apply(this,arguments)}function X(e){return"mesh"===e?.geometry?.type}function ee(e,t,r,a){if(!R(t))throw new i.Z(`${e.type}-layer:no-editing-support`,"Layer source does not support applyEdits capability",{layer:e});if(!t.uploadAssets)throw new i.Z(`${e.type}-layer:no-asset-upload-support`,"Layer source does not support uploadAssets capability",{layer:e});return t.uploadAssets(r,a)}},6733:(re,j,s)=>{s.d(j,{jF:()=>A,lQ:()=>Z,o1:()=>H});var v=s(17626),x=s(61885),b=s(58817),i=s(10699),G=(s(63290),s(90912),s(26584),s(8314),s(76898)),E=s(67385);const m=new x.Z.EventEmitter;function A(u,h,_=null,f=!1){const g=(0,i.hh)();return m.emit("apply-edits",{serviceUrl:u,layerId:h,gdbVersion:_,mayReceiveServiceEdits:f=null==h||f,result:g.promise}),g}const M="esri.layers.mixins.EditBusLayer",P=Symbol(M);function Z(u){return null!=u&&"object"==typeof u&&P in u}function O(u){return null!=u&&"object"==typeof u&&"gdbVersion"in u}function z(u,h,_){const f=new URL(u).host,g=E.Jp.get(f),y=w=>!w||w===g;return y(h)&&y(_)||h===_}const H=u=>{var h;let _=class extends u{constructor(...f){super(...f),this[h]=!0,this._applyEditsHandler=g=>{const{serviceUrl:y,layerId:w,gdbVersion:S,mayReceiveServiceEdits:J,result:T}=g,N=y===this.url,U=null!=w&&null!=this.layerId&&w===this.layerId,Q=O(this),k=O(this)&&z(y,S,this.gdbVersion);if(!N||Q&&!k||!U&&!J)return;const q=T.then(p=>{if(U&&(p.addedFeatures.length||p.updatedFeatures.length||p.deletedFeatures.length||p.addedAttachments.length||p.updatedAttachments.length||p.deletedAttachments.length))return this.emit("edits",(0,b.d9)(p)),p;const $=p.editedFeatures?.find(({layerId:B})=>B===this.layerId);if($){const{adds:B,updates:C,deletes:X}=$.editedFeatures,ee={edits:null,addedAttachments:[],deletedAttachments:[],updatedAttachments:[],addedFeatures:B?B.map(({attributes:e})=>({objectId:this.objectIdField&&e[this.objectIdField],globalId:this.globalIdField&&e[this.globalIdField]})):[],deletedFeatures:X?X.map(({attributes:e})=>({objectId:this.objectIdField&&e[this.objectIdField],globalId:this.globalIdField&&e[this.globalIdField]})):[],updatedFeatures:C?C.map(({current:{attributes:e}})=>({objectId:this.objectIdField&&e[this.objectIdField],globalId:this.globalIdField&&e[this.globalIdField]})):[],editedFeatures:(0,b.d9)(p.editedFeatures),exceededTransferLimit:!1,historicMoment:(0,b.d9)(p.historicMoment)};return this.emit("edits",ee),ee}return{edits:null,addedAttachments:[],deletedAttachments:[],updatedAttachments:[],addedFeatures:[],deletedFeatures:[],updatedFeatures:[],editedFeatures:(0,b.d9)(p.editedFeatures),exceededTransferLimit:!1,historicMoment:(0,b.d9)(p.historicMoment)}}).then(p=>("historicMoment"in this&&this.historicMoment!==p.historicMoment&&(0,E.JV)(y,S)&&(this.historicMoment=p.historicMoment),p));this.emit("apply-edits",{result:q})},this._updateMomentHandler=g=>{const{serviceUrl:y,gdbVersion:w,moment:S}=g,J=y===this.url,T=O(this),N=O(this)&&z(y,w,this.gdbVersion),U=O(this)&&!z(y,this.gdbVersion,null);J&&T&&N&&U&&"historicMoment"in this&&this.historicMoment!==S&&(this.historicMoment=S)},this.when().then(()=>{this.addHandles(function D(u){return m.on("apply-edits",new WeakRef(u))}(this._applyEditsHandler)),"historicMoment"in this&&this.addHandles(function I(u){return m.on("update-moment",new WeakRef(u))}(this._updateMomentHandler))},()=>{})}};return h=P,_=(0,v._)([(0,G.j)(M)],_),_}},67385:(re,j,s)=>{s.d(j,{JV:()=>G,Jp:()=>i,Px:()=>Y,U8:()=>b});var v=s(15861);const b=(0,s(35948).dG)(),i=new Map,V=new Map;function Y(E,m){return L.apply(this,arguments)}function L(){return(L=(0,v.Z)(function*(E,m,D=!1){if(!E||!m)return!0;const I=E.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,""),A=V.get(I)?.entries();if(A)for(const[R,M]of A)if(M.name===m){const P=!M.stack?.hasForwardEdits();if(!P&&D){const[{deleteForwardEdits:Z},{default:O}]=yield Promise.all([s.e(7993).then(s.bind(s,87993)),s.e(3084).then(s.bind(s,73084))]);return Z(I,R,new O({sessionId:b,moment:M.moment}))}return P}return!0})).apply(this,arguments)}function G(E,m){if(!E)return!1;const D=E.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,""),I=V.get(D)?.entries();if(I)for(const[A,R]of I)if(R.name===m)return"edit"===R.lockType;return!1}}}]);