"use strict";(self.webpackChunkCRIS=self.webpackChunkCRIS||[]).push([[9066],{47123:(w,A,e)=>{e.d(A,{T:()=>L});var D=e(15861),I=e(10699),E=e(35133),V=e(28082),p=e(26268),m=e(23841),P=e(16730),R=e(21254),d=e(87526),O=e(17807),g=e(25575),T=e(31637);function S(B,s){const r=s.length;if(B<s[0].value||1===r)return s[0].size;for(let a=1;a<r;a++)if(B<s[a].value)return s[a-1].size+(B-s[a-1].value)/(s[a].value-s[a-1].value)*(s[a].size-s[a-1].size);return s[r-1].size}class x{constructor(){this.symbolLevels=[],this.vvColorValues=new Float32Array(8),this.vvColors=new Float32Array(32),this.vvOpacityValues=new Float32Array(8),this.vvOpacities=new Float32Array(8),this.vvSizeMinMaxValue=new Float32Array(4),this.outsideLabelsVisible=!1,this._vvMaterialParameters={vvSizeEnabled:!1,vvColorEnabled:!1,vvRotationEnabled:!1,vvRotationType:"geographic",vvOpacityEnabled:!1},this._technique=O.v}getSizeVVFieldStops(s){const r=this._vvSizeFieldStops;if(r)switch(r.type){case"static":return r;case"level-dependent":return r.levels[s]??(()=>{let a=1/0,i=0;for(const o in r.levels){const u=parseFloat(o),l=Math.abs(s-u);l<a&&(a=l,i=u)}if(a===1/0)return{sizes:new Float32Array([0,0,0,0,0,0]),values:new Float32Array([0,0,0,0,0,0])};const c=2**((s-i)/2),_=r.levels[i],y=new Float32Array(_.values);return y[2]*=c,y[3]*=c,{sizes:_.sizes,values:y}})();default:return}}get vvMaterialParameters(){return this._vvMaterialParameters}update(s){null!=this._vvInfo&&this._updateVisualVariables(this._vvInfo.vvRanges,s)}setInfo(s,r,a){this._updateEffects(a),this._vvInfo=r,this._technique=(0,g.EJ)(s),this.rendererSchema=this._technique.createOrUpdateRendererSchema(this.rendererSchema,s)}getVariation(){return{...this._technique.getVariation(this.rendererSchema),outsideLabelsVisible:this.outsideLabelsVisible,supportsTextureFloat:(0,T.hc)("2d").supportsTextureFloat}}getVariationHash(){return this._technique.getVariationHash(this.rendererSchema)<<1|(this.outsideLabelsVisible?1:0)}_updateEffects(s){this.outsideLabelsVisible=null!=s&&s.excludedLabelsVisible}_updateVisualVariables(s,r){const a=this._vvMaterialParameters;if(a.vvOpacityEnabled=!1,a.vvSizeEnabled=!1,a.vvColorEnabled=!1,a.vvRotationEnabled=!1,!s)return;const i=s.size;if(i){if(a.vvSizeEnabled=!0,i.minMaxValue){const o=i.minMaxValue;let u,l;if((0,d.$K)(o.minSize)&&(0,d.$K)(o.maxSize))if((0,d.hj)(o.minSize)&&(0,d.hj)(o.maxSize))u=(0,m.F2)(o.minSize),l=(0,m.F2)(o.maxSize);else{const f=r.scale;u=(0,m.F2)(S(f,o.minSize.stops)),l=(0,m.F2)(S(f,o.maxSize.stops))}this.vvSizeMinMaxValue.set([o.minDataValue,o.maxDataValue,u,l])}if(i.scaleStops&&(this.vvSizeScaleStopsValue=(0,m.F2)(S(r.scale,i.scaleStops.stops))),i.unitValue){const o=(0,P.c9)(r.spatialReference)/R.a[i.unitValue.unit];this.vvSizeUnitValueToPixelsRatio=o/r.resolution}i.fieldStops&&(this._vvSizeFieldStops=i.fieldStops)}const c=s.color;c&&(a.vvColorEnabled=!0,this.vvColorValues.set(c.values),this.vvColors.set(c.colors));const _=s.opacity;_&&(a.vvOpacityEnabled=!0,this.vvOpacityValues.set(_.values),this.vvOpacities.set(_.opacities));const y=s.rotation;y&&(a.vvRotationEnabled=!0,a.vvRotationType=y.type)}}class L extends p.Z{constructor(s){super(s),this._rendererInfo=new x,this._materialItemsRequestQueue=new E.Z,this.attributeView=new V.H(()=>this.onAttributeStoreUpdate())}destroy(){this.children.forEach(s=>s.destroy()),this.removeAllChildren(),this.attributeView.destroy(),this._materialItemsRequestQueue.clear()}setRendererInfo(s,r,a){this._rendererInfo.setInfo(s,r,a),this.requestRender()}getMaterialItems(s,r){var a=this;return(0,D.Z)(function*(){if(!s||0===s.length)return[];const i=(0,I.hh)();return a._materialItemsRequestQueue.push({items:s,abortOptions:r,resolver:i}),a.requestRender(),i.promise})()}doRender(s){if(s.context.capabilities.enable("textureFloat"),s.context.capabilities.enable("vao"),this._materialItemsRequestQueue.length>0){let r=this._materialItemsRequestQueue.pop();for(;r;)this._processMaterialItemRequest(s,r),r=this._materialItemsRequestQueue.pop()}super.doRender(s)}renderChildren(s){for(const r of this.children)r.commit(s);this._rendererInfo.update(s.state),super.renderChildren(s)}createRenderParams(s){const r=super.createRenderParams(s);return r.rendererInfo=this._rendererInfo,r.attributeView=this.attributeView,r}onAttributeStoreUpdate(){}_processMaterialItemRequest(s,{items:r,abortOptions:a,resolver:i}){const{painter:c,pixelRatio:_}=s,y=r.map(o=>c.textureManager.rasterizeItem(o.symbol,_,o.glyphIds,a));Promise.all(y).then(o=>{if(!this.stage)return void i.reject();const u=o.map((l,f)=>({id:r[f].id,mosaicItem:l}));i.resolve(u)},i.reject)}}},26268:(w,A,e)=>{e.d(A,{Z:()=>P});var D=e(8314),I=e(39406),E=e(44589),V=e(8650),p=e(13382);const m=(R,d)=>R.key.level-d.key.level!=0?R.key.level-d.key.level:R.key.row-d.key.row!=0?R.key.row-d.key.row:R.key.col-d.key.col;class P extends E.Z{constructor(d){super(),this._tileInfoView=d}renderChildren(d){this.sortChildren(m),this.setStencilReference(d),super.renderChildren(d)}createRenderParams(d){const{state:O}=d,g=super.createRenderParams(d);return g.requiredLevel=this._tileInfoView.getClosestInfoForScale(O.scale).level,g.displayLevel=this._tileInfoView.tileInfo.scaleToZoom(O.scale),g}prepareRenderPasses(d){const O=super.prepareRenderPasses(d);return O.push(d.registerRenderPass({name:"stencil",brushes:[p.Z],drawPhase:I.jx.DEBUG|I.jx.MAP|I.jx.HIGHLIGHT,target:()=>this.getStencilTarget()})),(0,D.Z)("esri-tiles-debug")&&O.push(d.registerRenderPass({name:"tileInfo",brushes:[V.Z],drawPhase:I.jx.DEBUG,target:()=>this.children})),O}getStencilTarget(){return this.children}setStencilReference(d){let O=1;for(const g of this.children)g.stencilRef=O++}}},9066:(w,A,e)=>{e.r(A),e.d(A,{default:()=>b});var D=e(15861),I=e(17626),E=e(85931),V=e(74333),p=e(46882),m=e(54024),P=e(32917),R=e(77712),g=(e(90912),e(8314),e(76898)),T=e(99683),S=e(58924),x=e(53753),L=e(719),B=e(17718),s=e(29739),r=e(69583),a=e(37384),i=e(36275),c=e(78209),_=e(45611);const y=["route-info","direction-line","direction-point","polygon-barrier","polyline-barrier","point-barrier","stop"],o={graphic:null,property:null,oldValue:null,newValue:null};function u(t){return t instanceof T.Z||t instanceof S.Z||t instanceof x.Z||t instanceof L.Z||t instanceof B.Z||t instanceof s.Z||t instanceof r.Z}let v=class extends((0,a.y)(_.Z)){constructor(){super(...arguments),this._graphics=new V.Z,this._highlightIds=new Map,this._networkFeatureMap=new Map,this._networkGraphicMap=new Map}get _routeItems(){return new p.Z({getCollections:()=>null==this.layer||this.destroyed?[]:[null!=this.layer.routeInfo?new V.Z([this.layer.routeInfo]):null,this.layer.directionLines,this.layer.directionPoints,this.layer.polygonBarriers,this.layer.polylineBarriers,this.layer.pointBarriers,this.layer.stops]})}initialize(){this._updatingHandles.addOnCollectionChange(()=>this._routeItems,t=>this._routeItemsChanged(t),P.nn)}destroy(){this._networkFeatureMap.clear(),this._networkGraphicMap.clear(),this._graphics.removeAll(),this._get("_routeItems")?.destroy()}attach(){this._createGraphicsView()}detach(){this._destroyGraphicsView()}fetchPopupFeatures(t){var n=this;return(0,D.Z)(function*(){return n._graphicsView.hitTest(t).filter(h=>!!h.popupTemplate)})()}highlight(t){let n;n=u(t)?[this._getNetworkFeatureUid(t)]:function f(t){return Array.isArray(t)&&t.length>0&&u(t[0])}(t)?t.map(C=>this._getNetworkFeatureUid(C)):function l(t){return V.Z.isCollection(t)&&t.length&&u(t.at(0))}(t)?t.map(C=>this._getNetworkFeatureUid(C)).toArray():[t.uid];const h=n.filter(E.pC);return h.length?(this._addHighlight(h),(0,m.kB)(()=>this._removeHighlight(h))):(0,m.kB)()}hitTest(t,n){var h=this;return(0,D.Z)(function*(){if(h.suspended)return null;const C=h._graphicsView.hitTest(t).filter(E.pC).map(M=>h._networkGraphicMap.get(M));if(!C.length)return null;const{layer:U}=h;return C.reverse().map(M=>({type:"route",layer:U,mapPoint:t,networkFeature:M}))})()}isUpdating(){return this._graphicsView.updating}moveStart(){}moveEnd(){}update(t){this._graphicsView.processUpdate(t)}viewChange(){this._graphicsView.viewChange()}_addHighlight(t){for(const n of t)if(this._highlightIds.has(n)){const h=this._highlightIds.get(n);this._highlightIds.set(n,h+1)}else this._highlightIds.set(n,1);this._updateHighlight()}_createGraphic(t){const n=t.toGraphic();return n.layer=this.layer,n.sourceLayer=this.layer,n}_createGraphicsView(){const t=this.view,h=new i.Z(t.featuresTilingScheme);this._graphicsView=new c.Z({container:h,graphics:this._graphics,requestUpdateCallback:()=>this.requestUpdate(),view:t}),this.container.addChild(h),this._updateHighlight()}_destroyGraphicsView(){this.container.removeChild(this._graphicsView.container),this._graphicsView.destroy()}_getDrawOrder(t){const n=this._networkGraphicMap.get(t);return y.indexOf(n.type)}_getNetworkFeatureUid(t){return this._networkFeatureMap.has(t)?this._networkFeatureMap.get(t).uid:null}_removeHighlight(t){for(const n of t)if(this._highlightIds.has(n)){const h=this._highlightIds.get(n)-1;0===h?this._highlightIds.delete(n):this._highlightIds.set(n,h)}this._updateHighlight()}_routeItemsChanged(t){if(t.removed.length){this._graphics.removeMany(t.removed.map(n=>{const h=this._networkFeatureMap.get(n);return this._networkFeatureMap.delete(n),this._networkGraphicMap.delete(h),h}));for(const n of t.removed)this.removeHandles(n)}if(t.added.length){this._graphics.addMany(t.added.map(n=>{const h=this._createGraphic(n);return null==h.symbol?null:(this._networkFeatureMap.set(n,h),this._networkGraphicMap.set(h,n),h)}).filter(E.pC));for(const n of t.added)this.addHandles([(0,P.YP)(()=>n.geometry,(h,C)=>{this._updateGraphic(n,"geometry",h,C)}),(0,P.YP)(()=>n.symbol,(h,C)=>{this._updateGraphic(n,"symbol",h,C)})],n);this._graphics.sort((n,h)=>this._getDrawOrder(n)-this._getDrawOrder(h))}}_updateGraphic(t,n,h,C){if(!this._networkFeatureMap.has(t)){const M=this._createGraphic(t);return this._networkFeatureMap.set(t,M),this._networkGraphicMap.set(M,t),void this._graphics.add(M)}const U=this._networkFeatureMap.get(t);U[n]=h,o.graphic=U,o.property=n,o.oldValue=C,o.newValue=h,this._graphicsView.graphicUpdateHandler(o)}_updateHighlight(){const t=Array.from(this._highlightIds.keys());this._graphicsView.setHighlight(t)}};(0,I._)([(0,R.Cb)()],v.prototype,"_graphics",void 0),(0,I._)([(0,R.Cb)()],v.prototype,"_routeItems",null),v=(0,I._)([(0,g.j)("esri.views.2d.layers.RouteLayerView2D")],v);const b=v},55051:(w,A,e)=>{e.d(A,{Z:()=>s});var D=e(62208),I=e(47123),E=e(30217),V=e(49966),p=e(9545),m=e(14658),P=e(93555),R=e(57477),d=e(87526),O=e(83994),g=e(67969),T=e(49353);const S=Math.PI/180;class L extends R.s{constructor(a){super(),this._program=null,this._vao=null,this._vertexBuffer=null,this._indexBuffer=null,this._dvsMat3=(0,V.c)(),this._localOrigin={x:0,y:0},this._getBounds=a}destroy(){this._vao&&(this._vao.dispose(),this._vao=null,this._vertexBuffer=null,this._indexBuffer=null),this._program=(0,D.M2)(this._program)}doRender(a){const{context:i}=a,c=this._getBounds();if(c.length<1)return;this._createShaderProgram(i),this._updateMatricesAndLocalOrigin(a),this._updateBufferData(i,c),i.setBlendingEnabled(!0),i.setDepthTestEnabled(!1),i.setStencilWriteMask(0),i.setStencilTestEnabled(!1),i.setBlendFunction(g.zi.ONE,g.zi.ONE_MINUS_SRC_ALPHA),i.setColorMask(!0,!0,!0,!0);const _=this._program;i.bindVAO(this._vao),i.useProgram(_),_.setUniformMatrix3fv("u_dvsMat3",this._dvsMat3),i.gl.lineWidth(1),i.drawElements(g.MX.LINES,8*c.length,g.g.UNSIGNED_INT,0),i.bindVAO()}_createTransforms(){return{dvs:(0,V.c)()}}_createShaderProgram(a){this._program||(this._program=a.programCache.acquire("precision highp float;\n        uniform mat3 u_dvsMat3;\n\n        attribute vec2 a_position;\n\n        void main() {\n          mediump vec3 pos = u_dvsMat3 * vec3(a_position, 1.0);\n          gl_Position = vec4(pos.xy, 0.0, 1.0);\n        }","precision mediump float;\n      void main() {\n        gl_FragColor = vec4(0.75, 0.0, 0.0, 0.75);\n      }",B().attributes))}_updateMatricesAndLocalOrigin(a){const{state:i}=a,{displayMat3:c,size:_,resolution:y,pixelRatio:o,rotation:u,viewpoint:l}=i,f=S*u,{x:v,y:b}=l.targetGeometry,t=(0,P.or)(v,i.spatialReference);this._localOrigin.x=t,this._localOrigin.y=b;const n=o*_[0],h=o*_[1],C=y*n,U=y*h,M=(0,E.g)(this._dvsMat3);(0,E.m)(M,M,c),(0,E.h)(M,M,(0,p.f)(n/2,h/2)),(0,E.c)(M,M,(0,m.f)(_[0]/C,-h/U,1)),(0,E.r)(M,M,-f)}_updateBufferData(a,i){const{x:c,y:_}=this._localOrigin,o=new Float32Array(8*i.length),u=new Uint32Array(8*i.length);let l=0,f=0;for(const v of i)v&&(o[2*l]=v[0]-c,o[2*l+1]=v[1]-_,o[2*l+2]=v[0]-c,o[2*l+3]=v[3]-_,o[2*l+4]=v[2]-c,o[2*l+5]=v[3]-_,o[2*l+6]=v[2]-c,o[2*l+7]=v[1]-_,u[f]=l+0,u[f+1]=l+3,u[f+2]=l+3,u[f+3]=l+2,u[f+4]=l+2,u[f+5]=l+1,u[f+6]=l+1,u[f+7]=l+0,l+=4,f+=8);if(this._vertexBuffer?this._vertexBuffer.setData(o.buffer):this._vertexBuffer=O.f.createVertex(a,g.l1.DYNAMIC_DRAW,o.buffer),this._indexBuffer?this._indexBuffer.setData(u):this._indexBuffer=O.f.createIndex(a,g.l1.DYNAMIC_DRAW,u),!this._vao){const v=B();this._vao=new T.U(a,v.attributes,v.bufferLayouts,{geometry:this._vertexBuffer},this._indexBuffer)}}}const B=()=>(0,d.cM)("bounds",{geometry:[{location:0,name:"a_position",count:2,type:g.g.FLOAT}]});let s=class extends I.T{constructor(r){super(r),this.checkHighlight=()=>!0}destroy(){super.destroy(),this._boundsRenderer=(0,D.SC)(this._boundsRenderer)}enableRenderingBounds(r){this._boundsRenderer=new L(r),this.requestRender()}get hasHighlight(){return this.checkHighlight()}onTileData(r,a){r.patch(a),this.contains(r)||this.addChild(r),this.requestRender()}onTileError(r){r.clear(),this.contains(r)||this.addChild(r)}_renderChildren(r,a){for(const i of this.children)i.isReady&&i.hasData&&(i.commit(r),r.context.setStencilFunction(g.wb.EQUAL,i.stencilRef,255),i.getDisplayList().replay(r,i,a))}}},36275:(w,A,e)=>{e.d(A,{Z:()=>E});var D=e(39406),I=e(55051);class E extends I.Z{renderChildren(p){this.attributeView.update(),this.children.some(m=>m.hasData)&&(this.attributeView.bindTextures(p.context,!1),super.renderChildren(p),p.drawPhase===D.jx.MAP&&this._renderChildren(p),this.hasHighlight&&p.drawPhase===D.jx.HIGHLIGHT&&this._renderHighlight(p),this._boundsRenderer&&this._boundsRenderer.doRender(p))}_renderHighlight(p){const{painter:m}=p,P=m.effects.highlight;P.bind(p),this._renderChildren(p,P.defines),P.draw(p),P.unbind()}}}}]);