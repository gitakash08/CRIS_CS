"use strict";(self.webpackChunkCRIS=self.webpackChunkCRIS||[]).push([[6926],{85073:(bt,kt,tt)=>{tt.d(kt,{Z:()=>dt});var z=tt(17626),xt=tt(26584),ct=tt(86810),ut=tt(58817),ft=tt(63290),N=tt(77712),pt=tt(66656),yt=tt(76898);class mt{constructor(T=null,G=null,J=null){this.minValue=T,this.maxValue=G,this.noDataValue=J}}var at,ot=tt(67313);let nt=at=class extends ct.wq{static createEmptyBand(C,T){return new(at.getPixelArrayConstructor(C))(T)}static getPixelArrayConstructor(C){let T;switch(C){case"u1":case"u2":case"u4":case"u8":T=Uint8Array;break;case"u16":T=Uint16Array;break;case"u32":T=Uint32Array;break;case"s8":T=Int8Array;break;case"s16":T=Int16Array;break;case"s32":T=Int32Array;break;case"f32":case"c64":case"c128":case"unknown":T=Float32Array;break;case"f64":T=Float64Array}return T}constructor(C){super(C),this.width=null,this.height=null,this.pixelType="f32",this.validPixelCount=null,this.mask=null,this.maskIsAlpha=!1,this.premultiplyAlpha=!1,this.statistics=null,this.depthCount=1}castPixelType(C){if(!C)return"f32";let T=C.toLowerCase();return["u1","u2","u4"].includes(T)?T="u8":["unknown","u8","s8","u16","s16","u32","s32","f32","f64"].includes(T)||(T="f32"),T}getPlaneCount(){return this.pixels?.length}addData(C){if(!C.pixels||C.pixels.length!==this.width*this.height)throw new xt.Z("pixelblock:invalid-or-missing-pixels","add data requires valid pixels array that has same length defined by pixel block width * height");this.pixels||(this.pixels=[]),this.statistics||(this.statistics=[]),this.pixels.push(C.pixels),this.statistics.push(C.statistics??new mt)}getAsRGBA(){const C=new ArrayBuffer(this.width*this.height*4);switch(this.pixelType){case"s8":case"s16":case"u16":case"s32":case"u32":case"f32":case"f64":this._fillFromNon8Bit(C);break;default:this._fillFrom8Bit(C)}return new Uint8ClampedArray(C)}getAsRGBAFloat(){const C=new Float32Array(this.width*this.height*4);return this._fillFrom32Bit(C),C}updateStatistics(){if(!this.pixels)return;this.statistics=this.pixels.map(G=>this._calculateBandStatistics(G,this.mask));const C=this.mask;let T=0;if(null!=C)for(let G=0;G<C.length;G++)C[G]&&T++;else T=this.width*this.height;this.validPixelCount=T}clamp(C){if(!C||"f64"===C||"f32"===C||!this.pixels)return;const[T,G]=(0,ot.r)(C),J=this.pixels,X=this.width*this.height,O=J.length;let S,Y,Z;const $=[];for(let et=0;et<O;et++){Z=at.createEmptyBand(C,X),S=J[et];for(let W=0;W<X;W++)Y=S[W],Z[W]=Y>G?G:Y<T?T:Y;$.push(Z)}this.pixels=$,this.pixelType=C}extractBands(C){const{pixels:T,statistics:G}=this;if(null==C||0===C.length||!T||0===T.length)return this;const J=T.length,X=C.some(W=>W>=T.length),O=J===C.length&&!C.some((W,I)=>W!==I);if(X||O)return this;const S=this.bandMasks?.length===J?C.map(W=>this.bandMasks[W]):void 0;let{mask:Y,validPixelCount:Z}=this;const{width:$,height:et}=this;if(S){if(1===S.length)Y=S[0];else{const W=$*et;Y=new Uint8Array(W).fill(255);for(let I=0;I<S.length;I++){const b=S[I];for(let E=0;E<W;E++)b[E]||(Y[E]=0)}}Z=Y.filter(W=>!!W).length}return new at({pixelType:this.pixelType,width:$,height:et,mask:Y,bandMasks:S,validPixelCount:Z,maskIsAlpha:this.maskIsAlpha,pixels:C.map(W=>T[W]),statistics:G&&C.map(W=>G[W])})}clone(){const C=new at({width:this.width,height:this.height,pixelType:this.pixelType,maskIsAlpha:this.maskIsAlpha,validPixelCount:this.validPixelCount});let T;null!=this.mask&&(C.mask=this.mask instanceof Uint8Array?new Uint8Array(this.mask):this.mask.slice(0)),this.bandMasks&&(C.bandMasks=this.bandMasks.map(J=>new Uint8Array(J)));const G=at.getPixelArrayConstructor(this.pixelType);if(this.pixels&&this.pixels.length>0){C.pixels=[];const J=!!this.pixels[0].slice;for(T=0;T<this.pixels.length;T++)C.pixels[T]=J?this.pixels[T].slice(0,this.pixels[T].length):new G(this.pixels[T])}if(this.statistics)for(C.statistics=[],T=0;T<this.statistics.length;T++)C.statistics[T]=(0,ut.d9)(this.statistics[T]);return C.premultiplyAlpha=this.premultiplyAlpha,C}_fillFrom8Bit(C){const{mask:T,maskIsAlpha:G,premultiplyAlpha:J,pixels:X}=this;if(!C||!X?.length)return void ft.Z.getLogger(this).error("getAsRGBA()","Unable to convert to RGBA. The input pixel block is empty.");let O,S,Y,Z;O=S=Y=X[0],X.length>=3?(S=X[1],Y=X[2]):2===X.length&&(S=X[1]);const $=new Uint32Array(C),et=this.width*this.height;if(O.length===et)if(null!=T&&T.length===et)if(G)for(Z=0;Z<et;Z++){const W=T[Z];if(W){const I=W/255;$[Z]=J?W<<24|Y[Z]*I<<16|S[Z]*I<<8|O[Z]*I:W<<24|Y[Z]<<16|S[Z]<<8|O[Z]}}else for(Z=0;Z<et;Z++)T[Z]&&($[Z]=255<<24|Y[Z]<<16|S[Z]<<8|O[Z]);else for(Z=0;Z<et;Z++)$[Z]=255<<24|Y[Z]<<16|S[Z]<<8|O[Z];else ft.Z.getLogger(this).error("getAsRGBA()","Unable to convert to RGBA. The pixelblock is invalid.")}_fillFromNon8Bit(C){const{pixels:T,mask:G,statistics:J}=this;if(!C||!T?.length)return void ft.Z.getLogger(this).error("getAsRGBA()","Unable to convert to RGBA. The input pixel block is empty.");const X=this.pixelType;let O=1,S=0,Y=1;if(J&&J.length>0){for(const D of J)null!=D.minValue&&(S=Math.min(S,D.minValue)),null!=D.maxValue&&null!=D.minValue&&(Y=Math.max(Y,D.maxValue-D.minValue));O=255/Y}else{let D=255;"s8"===X?(S=-128,D=127):"u16"===X?D=65535:"s16"===X?(S=-32768,D=32767):"u32"===X?D=4294967295:"s32"===X?(S=-2147483648,D=2147483647):"f32"===X?(S=-34e38,D=34e38):"f64"===X&&(S=-Number.MAX_VALUE,D=Number.MAX_VALUE),O=255/(D-S)}const Z=new Uint32Array(C),$=this.width*this.height;let et,W,I,b,E;if(et=W=I=T[0],et.length!==$)return ft.Z.getLogger(this).error("getAsRGBA()","Unable to convert to RGBA. The pixelblock is invalid.");if(T.length>=2)if(W=T[1],T.length>=3&&(I=T[2]),null!=G&&G.length===$)for(b=0;b<$;b++)G[b]&&(Z[b]=255<<24|(I[b]-S)*O<<16|(W[b]-S)*O<<8|(et[b]-S)*O);else for(b=0;b<$;b++)Z[b]=255<<24|(I[b]-S)*O<<16|(W[b]-S)*O<<8|(et[b]-S)*O;else if(null!=G&&G.length===$)for(b=0;b<$;b++)E=(et[b]-S)*O,G[b]&&(Z[b]=255<<24|E<<16|E<<8|E);else for(b=0;b<$;b++)E=(et[b]-S)*O,Z[b]=255<<24|E<<16|E<<8|E}_fillFrom32Bit(C){const{pixels:T,mask:G}=this;if(!C||!T?.length)return ft.Z.getLogger(this).error("getAsRGBAFloat()","Unable to convert to RGBA. The input pixel block is empty.");let J,X,O,S;J=X=O=T[0],T.length>=3?(X=T[1],O=T[2]):2===T.length&&(X=T[1]);const Y=this.width*this.height;if(J.length!==Y)return ft.Z.getLogger(this).error("getAsRGBAFloat()","Unable to convert to RGBA. The pixelblock is invalid.");let Z=0;if(null!=G&&G.length===Y)for(S=0;S<Y;S++)C[Z++]=J[S],C[Z++]=X[S],C[Z++]=O[S],C[Z++]=1&G[S];else for(S=0;S<Y;S++)C[Z++]=J[S],C[Z++]=X[S],C[Z++]=O[S],C[Z++]=1}_calculateBandStatistics(C,T){let G=1/0,J=-1/0;const X=C.length;let O,S=0;if(null!=T)for(O=0;O<X;O++)T[O]&&(S=C[O],G=S<G?S:G,J=S>J?S:J);else for(O=0;O<X;O++)S=C[O],G=S<G?S:G,J=S>J?S:J;return new mt(G,J)}};(0,z._)([(0,N.Cb)({json:{write:!0}})],nt.prototype,"width",void 0),(0,z._)([(0,N.Cb)({json:{write:!0}})],nt.prototype,"height",void 0),(0,z._)([(0,N.Cb)({json:{write:!0}})],nt.prototype,"pixelType",void 0),(0,z._)([(0,pt.p)("pixelType")],nt.prototype,"castPixelType",null),(0,z._)([(0,N.Cb)({json:{write:!0}})],nt.prototype,"validPixelCount",void 0),(0,z._)([(0,N.Cb)({json:{write:!0}})],nt.prototype,"mask",void 0),(0,z._)([(0,N.Cb)({json:{write:!0}})],nt.prototype,"maskIsAlpha",void 0),(0,z._)([(0,N.Cb)({json:{write:!0}})],nt.prototype,"pixels",void 0),(0,z._)([(0,N.Cb)()],nt.prototype,"premultiplyAlpha",void 0),(0,z._)([(0,N.Cb)({json:{write:!0}})],nt.prototype,"statistics",void 0),(0,z._)([(0,N.Cb)({json:{write:!0}})],nt.prototype,"depthCount",void 0),(0,z._)([(0,N.Cb)({json:{write:!0}})],nt.prototype,"noDataValues",void 0),(0,z._)([(0,N.Cb)({json:{write:!0}})],nt.prototype,"bandMasks",void 0),nt=at=(0,z._)([(0,yt.j)("esri.layers.support.PixelBlock")],nt);const dt=nt},67313:(bt,kt,tt)=>{tt.d(kt,{A:()=>ft,r:()=>ut});const z=9999999e31,xt=2e-7,ct={u1:[0,1],u2:[0,3],u4:[0,15],u8:[0,255],s8:[-128,127],u16:[0,65535],s16:[-32768,32767],u32:[0,4294967295],s32:[-2147483648,2147483647],f32:[-34028234663852886e22,34028234663852886e22],f64:[-Number.MAX_VALUE,Number.MAX_VALUE],unknown:void 0,c64:void 0,c128:void 0};function ut(N){return ct[N]??[-34028234663852886e22,34028234663852886e22]}function ft(N,pt,yt){if(N.depthCount&&N.depthCount>1)return;const{pixels:mt,statistics:ot,pixelType:at}=N,dt=N.bandMasks??[],C=N.mask??new Uint8Array(mt[0].length).fill(255),T="f32"===at||"f64"===at,G=ut(at);let J=!1;for(let X=0;X<mt.length;X++){const O="number"==typeof pt?pt:pt[X];if(null==O)continue;if((ot?.[X]?.minValue??G[0])>O+Number.EPSILON||(ot?.[X]?.maxValue??G[1])<O-Number.EPSILON)continue;const Z=dt[X]||C.slice(),$=mt[X],et=yt?.customFloatTolerance;if(T&&0!==et){let W=et;W||(W=Math.abs(O)>=z?xt*Math.abs(O):"f32"===at?2**-23:Number.EPSILON);for(let I=0;I<$.length;I++)Z[I]&&Math.abs($[I]-O)<W&&($[I]=0,Z[I]=0,C[I]=0,J=!0)}else for(let W=0;W<$.length;W++)Z[W]&&$[W]===O&&($[W]=0,Z[W]=0,C[W]=0,J=!0);dt[X]=Z}J&&(N.bandMasks=N.bandMasks||N.pixels.length>1?dt:null,N.mask=C),J&&"updateStatistics"in N&&N.updateStatistics()}},79751:(bt,kt,tt)=>{tt.d(kt,{$f:()=>ft,CD:()=>ut,DX:()=>ct,Gd:()=>yt,Kh:()=>Z,Pz:()=>mt,Qh:()=>g,SJ:()=>ot,Uk:()=>x,Vl:()=>w,XV:()=>at,a2:()=>C,nA:()=>S,nk:()=>N,oB:()=>O,pW:()=>I,sS:()=>X,us:()=>et,wV:()=>nt,zp:()=>dt});var ct,ut,t,z=tt(85073),xt=tt(67313);(t=ct||(ct={}))[t.matchAny=0]="matchAny",t[t.matchAll=1]="matchAll",function(t){t[t.bestMatch=0]="bestMatch",t[t.fail=1]="fail"}(ut||(ut={}));const ft=6;function N(t){return null!=t&&"esri.layers.support.PixelBlock"===t.declaredClass&&t.pixels&&t.pixels.length>0}function yt(t){if(!t?.length||t.some(n=>!N(n)))return null;if(1===t.length)return t[0]?.clone()??null;const s=t,{width:e,height:i,pixelType:r}=s[0];if(s.some(n=>n.width!==e||n.height!==i))return null;const l=s.map(({mask:n})=>n).filter(n=>null!=n);let a=null;l.length&&(a=new Uint8Array(e*i),a.set(l[0]),l.length>1&&J(l.slice(1),a));const o=[];s.forEach(({pixels:n})=>o.push(...n));const u=s.map(({statistics:n})=>n).filter(n=>n?.length),c=[];return u.forEach(n=>c.push(...n)),new z.Z({pixelType:r,width:e,height:i,mask:a,pixels:o,statistics:c.length?c:null})}function mt(t){if(!t)return;const s=t.colormap;if(!s||0===s.length)return;const e=s.sort((h,y)=>h[0]-y[0]);let i=0;e[0][0]<0&&(i=e[0][0]);const r=Math.max(256,e[e.length-1][0]-i+1),l=new Uint8Array(4*r),a=[];let o,u=0,c=0;const n=5===e[0].length;if(r>65536)return e.forEach(h=>{a[h[0]-i]=n?h.slice(1):h.slice(1).concat([255])}),{indexed2DColormap:a,offset:i,alphaSpecified:n};if(t.fillUnspecified)for(o=e[c],u=o[0]-i;u<r;u++)l[4*u]=o[1],l[4*u+1]=o[2],l[4*u+2]=o[3],l[4*u+3]=n?o[4]:255,u===o[0]-i&&(o=c===e.length-1?o:e[++c]);else for(u=0;u<e.length;u++)o=e[u],c=4*(o[0]-i),l[c]=o[1],l[c+1]=o[2],l[c+2]=o[3],l[c+3]=n?o[4]:255;return{indexedColormap:l,offset:i,alphaSpecified:n}}function ot(t,s){if(!N(t)||!s||!s.indexedColormap&&!s.indexed2DColormap)return t;const e=t.clone(),i=e.pixels;let r=e.mask;const l=e.width*e.height;if(1!==i.length)return t;const{indexedColormap:a,indexed2DColormap:o,offset:u,alphaSpecified:c}=s;let n=0;const h=i[0],y=new Uint8Array(h.length),f=new Uint8Array(h.length),m=new Uint8Array(h.length);let p,M=0;if(a){const _=a.length-1;if(null!=r)for(n=0;n<l;n++)r[n]&&(M=4*(h[n]-u),M<u||M>_?r[n]=0:(y[n]=a[M],f[n]=a[M+1],m[n]=a[M+2],r[n]=a[M+3]));else{for(r=new Uint8Array(l),n=0;n<l;n++)M=4*(h[n]-u),M<u||M>_?r[n]=0:(y[n]=a[M],f[n]=a[M+1],m[n]=a[M+2],r[n]=a[M+3]);e.mask=r}}else if(o)if(null!=r)for(n=0;n<l;n++)r[n]&&(p=o[h[n]],y[n]=p[0],f[n]=p[1],m[n]=p[2],r[n]=p[3]);else{for(r=new Uint8Array(l),n=0;n<l;n++)p=o[h[n]],y[n]=p[0],f[n]=p[1],m[n]=p[2],r[n]=p[3];e.mask=r}return e.pixels=[y,f,m],e.statistics=null,e.pixelType="u8",e.maskIsAlpha=c,e}function at(t,s){if(!N(t))return null;const{pixels:e,mask:i}=t,r=e.length;let l=s.lut;const{offset:a}=s;l&&1===l[0].length&&(l=e.map(()=>l));const o=[],u=s.outputPixelType||"u8";for(let n=0;n<r;n++){const h=nt(e[n],i,l[n],a||0,u);o.push(h)}const c=new z.Z({width:t.width,height:t.height,pixels:o,mask:i,pixelType:u});return c.updateStatistics(),c}function nt(t,s,e,i,r){const l=t.length,a=z.Z.createEmptyBand(r,l);if(s)for(let o=0;o<l;o++)s[o]&&(a[o]=e[t[o]-i]);else for(let o=0;o<l;o++)a[o]=e[t[o]-i];return a}function dt(t,s){if(!N(t))return null;const e=t.clone(),{pixels:i}=e,r=e.width*e.height,l=s.length,a=Math.floor(l/2),o=s[Math.floor(a)],u=i[0];let c,n,h,y,f,m,p=!1;const M=new Uint8Array(r),_=new Uint8Array(r),P=new Uint8Array(r);let F=e.mask;const v=4===s[0].mappedColor.length;for(F||(F=new Uint8Array(r),F.fill(v?255:1),e.mask=F),f=0;f<r;f++)if(F[f]){for(c=u[f],p=!1,m=a,n=o,h=0,y=l-1;y-h>1;){if(c===n.value){p=!0;break}c>n.value?h=m:y=m,m=Math.floor((h+y)/2),n=s[Math.floor(m)]}p||(c===s[h].value?(n=s[h],p=!0):c===s[y].value?(n=s[y],p=!0):c<s[h].value?(p=!1,n=null):c>s[h].value&&(c<s[y].value?(n=s[h],p=!0):y===l-1?(p=!1,n=null):(n=s[y],p=!0))),p?(M[f]=n.mappedColor[0],_[f]=n.mappedColor[1],P[f]=n.mappedColor[2],F[f]=n.mappedColor[3]):M[f]=_[f]=P[f]=F[f]=0}return e.pixels=[M,_,P],e.mask=F,e.pixelType="u8",e.maskIsAlpha=v,e}function C(t,s){if(!N(t))return null;const{width:e,height:i}=t,{inputRanges:r,outputValues:l,outputPixelType:a,noDataRanges:o,allowUnmatched:u,isLastInputRangeInclusive:c}=s,n=t.pixels[0],h=z.Z.createEmptyBand(a,n.length),y=t.mask,f=new Uint8Array(e*i);y?f.set(y):f.fill(255);const m=t.pixelType.startsWith("f")?1e-6:0,p=r.map(v=>v-m);p[0]=r[0],p[p.length-1]=r[r.length-1]+(c?1e-6:0);const M=r.length/2,[_,P]=(0,xt.r)(a);for(let v=0;v<i;v++)for(let U=0;U<e;U++){const R=v*e+U;if(f[R]){const B=n[R];let K=!1;for(let Q=M-1;Q>=0;Q--)if(B===p[2*Q]||B>p[2*Q]&&B<p[2*Q+1]){h[R]=l[Q],K=!0;break}K||(u?h[R]=B>P?P:B<_?_:B:f[R]=0)}}const F=o?.length;if(F)for(let v=0;v<i;v++)for(let U=0;U<e;U++){const R=v*e+U;if(!y||y[R]){const B=n[R];for(let K=0;K<F;K+=2)if(B>=o[K]&&B<=o[K+1]){h[R]=0,f[R]=0;break}}}return new z.Z({width:e,height:i,pixelType:a,pixels:[h],mask:f})}function T(t,s,e,i){const r=null!=e&&e.length>=2?new Set(e):null,l=1===e?.length?e[0]:null,a=!!s?.length;for(let o=0;o<t.length;o++)if(i[o]){const u=t[o];if(a){let c=!1;for(let n=0;n<s.length;n+=2)if(u>=s[n]&&u<=s[n+1]){c=!0;break}c||(i[o]=0)}i[o]&&(u===l||r?.has(u))&&(i[o]=0)}}function G(t,s){const e=t[0].length;for(let i=0;i<e;i++)if(s[i]){let r=!1;for(let l=0;l<t.length;l++)if(t[l][i]){r=!0;break}r||(s[i]=0)}}function J(t,s){const e=t[0].length;for(let i=0;i<e;i++)if(s[i]){let r=!1;for(let l=0;l<t.length;l++)if(0===t[l][i]){r=!0;break}r&&(s[i]=0)}}function X(t,s){if(!N(t))return null;const{width:e,height:i,pixels:r}=t,l=e*i,a=new Uint8Array(l);t.mask?a.set(t.mask):a.fill(255);const o=r.length,{includedRanges:u,noDataValues:c,outputPixelType:n,matchAll:h,lookups:y}=s;if(y){const f=[];for(let m=0;m<o;m++){const p=y[m],M=nt(r[m],a,p.lut,p.offset||0,"u8");f.push(M)}1===f.length?a.set(f[0]):h?G(f,a):J(f,a)}else if(h){const f=[];for(let m=0;m<o;m++){const p=new Uint8Array(l);p.set(a),T(r[m],u?.slice(2*m,2*m+2),c?.[m],p),f.push(p)}1===f.length?a.set(f[0]):G(f,a)}else for(let f=0;f<o;f++)T(r[f],u?.slice(2*f,2*f+2),c?.[f],a);return new z.Z({width:e,height:i,pixelType:n,pixels:r,mask:a})}function O(t){const{srcPixelType:s,inputRanges:e,outputValues:i,allowUnmatched:r,noDataRanges:l,isLastInputRangeInclusive:a,outputPixelType:o}=t;if("u8"!==s&&"s8"!==s&&"u16"!==s&&"s16"!==s)return null;const u=s.includes("16")?65536:256,c=s.includes("s")?-u/2:0,n=z.Z.createEmptyBand(o,u),h=new Uint8Array(u);r&&h.fill(255);const[y,f]=(0,xt.r)(o);if(e?.length&&i?.length){const p=e.map(M=>M-1e-6);p[0]=e[0],a&&(p[p.length-1]=e[e.length-1]);for(let M=0;M<p.length;M++){const _=i[M]>f?f:i[M]<y?y:i[M],P=Math.ceil(p[2*M]-c),F=Math.floor(p[2*M+1]-c);for(let v=P;v<=F;v++)n[v]=_,h[v]=255}}if(l?.length)for(let m=0;m<l.length;m++){const p=Math.ceil(l[2*m]-c),M=Math.floor(l[2*m+1]-c);for(let _=p;_<=M;_++)h[_]=0}return{lut:n,offset:c,mask:h}}function S(t,s,e){if("u8"!==t&&"s8"!==t&&"u16"!==t&&"s16"!==t)return null;const i=t.includes("16")?65536:256,r=t.includes("s")?-i/2:0,l=new Uint8Array(i);if(s)for(let a=0;a<s.length;a++){const o=Math.ceil(s[2*a]-r),u=Math.floor(s[2*a+1]-r);for(let c=o;c<=u;c++)l[c]=255}else l.fill(255);if(e)for(let a=0;a<e.length;a++)l[e[a]-r]=0;return{lut:l,offset:r}}function Z(t,s){if(!t||0===t.length)return null;const e=t.find(m=>m.pixelBlock);if(null==e?.pixelBlock)return null;const i=(e.extent.xmax-e.extent.xmin)/e.pixelBlock.width,r=(e.extent.ymax-e.extent.ymin)/e.pixelBlock.height,l=.01*Math.min(i,r),a=t.sort((m,p)=>Math.abs(m.extent.ymax-p.extent.ymax)>l?p.extent.ymax-m.extent.ymax:Math.abs(m.extent.xmin-p.extent.xmin)>l?m.extent.xmin-p.extent.xmin:0),o=Math.min.apply(null,a.map(m=>m.extent.xmin)),u=Math.min.apply(null,a.map(m=>m.extent.ymin)),c=Math.max.apply(null,a.map(m=>m.extent.xmax)),n=Math.max.apply(null,a.map(m=>m.extent.ymax)),h={x:Math.round((s.xmin-o)/i),y:Math.round((n-s.ymax)/r)},y={width:Math.round((c-o)/i),height:Math.round((n-u)/r)},f={width:Math.round((s.xmax-s.xmin)/i),height:Math.round((s.ymax-s.ymin)/r)};return Math.round(y.width/e.pixelBlock.width)*Math.round(y.height/e.pixelBlock.height)!==a.length||h.x<0||h.y<0||y.width<f.width||y.height<f.height?null:{extent:s,pixelBlock:et(a.map(m=>m.pixelBlock),y,{clipOffset:h,clipSize:f})}}function $(t,s,e,i,r,l){const{width:a,height:o}=e.block,{x:u,y:c}=e.offset,{width:n,height:h}=e.mosaic,y=function Y(t,s,e,i,r,l,a,o){return{xmin:r<=e*t?0:r<e*t+t?r-e*t:t,ymin:l<=i*s?0:l<i*s+s?l-i*s:s,xmax:r+a<=e*t?0:r+a<e*t+t?r+a-e*t:t,ymax:l+o<=i*s?0:l+o<i*s+s?l+o-i*s:s}}(a,o,i,r,u,c,n,h);let f=0,m=0;if(l){const p=l.hasGCSSShiftTransform?360:l.halfWorldWidth??0,M=a*l.resolutionX,_=l.startX+i*M;_<p&&_+M>p?m=l.rightPadding:_>=p&&(f=l.leftMargin-l.rightPadding,m=0)}if(y.xmax-=m,"number"!=typeof s)for(let p=y.ymin;p<y.ymax;p++){const M=(r*o+p-c)*n+(i*a-u)+f,_=p*a;for(let P=y.xmin;P<y.xmax;P++)t[M+P]=s[_+P]}else for(let p=y.ymin;p<y.ymax;p++){const M=(r*o+p-c)*n+(i*a-u)+f;for(let _=y.xmin;_<y.xmax;_++)t[M+_]=s}}function et(t,s,e={}){const{clipOffset:i,clipSize:r,alignmentInfo:l,blockWidths:a}=e;if(a)return function W(t,s,e){const i=t.find(M=>null!=M);if(null==i)return null;const r=t.some(M=>null==M||!!M.mask),{width:l,height:a}=s,o=r?new Uint8Array(l*a):null,{blockWidths:u}=e,c=[],n=i.getPlaneCount(),h=z.Z.getPixelArrayConstructor(i.pixelType);if(r)for(let M=0,_=0;M<t.length;_+=u[M],M++){const P=t[M];if(!N(P))continue;const F=P.mask;for(let v=0;v<a;v++)for(let U=0;U<u[M];U++)o[v*l+U+_]=null==F?255:F[v*P.width+U]}const y=t.some(M=>M?.bandMasks&&M.bandMasks.length>1),f=y?[]:void 0,m=l*a;for(let M=0;M<n;M++){const _=new h(m),P=y?new Uint8Array(m):void 0;for(let F=0,v=0;F<t.length;v+=u[F],F++){const U=t[F];if(!N(U))continue;const R=U.pixels[M];if(null!=R){for(let B=0;B<a;B++)for(let K=0;K<u[F];K++)_[B*l+K+v]=R[B*U.width+K];if(P){const B=U.bandMasks?.[M]??U.mask;for(let K=0;K<a;K++)for(let Q=0;Q<u[F];Q++)P[K*l+Q+v]=B?B[K*U.width+Q]:255}}}c.push(_),f&&P&&f.push(P)}const p=new z.Z({width:l,height:a,mask:o,bandMasks:f,pixels:c,pixelType:i.pixelType});return p.updateStatistics(),p}(t,s,{blockWidths:a});const o=t.find(j=>N(j));if(null==o)return null;const u=r?r.width:s.width,c=r?r.height:s.height,n=o.width,h=o.height,y=s.width/n,f=s.height/h,m={offset:i||{x:0,y:0},mosaic:r||s,block:{width:n,height:h}},p=o.pixelType,M=z.Z.getPixelArrayConstructor(p),_=o.pixels.length,P=[];let F,v;for(let j=0;j<_;j++){v=new M(u*c);for(let H=0;H<f;H++)for(let L=0;L<y;L++){const q=t[H*y+L];N(q)&&(F=q.pixels[j],$(v,F,m,L,H,l))}P.push(v)}const U=t.some(j=>null==j||null!=j.mask&&j.mask.length>0),R=t.some(j=>j?.bandMasks&&j.bandMasks.length>1),B=U?new Uint8Array(u*c):void 0,K=R?[]:void 0;if(B){for(let j=0;j<f;j++)for(let H=0;H<y;H++){const L=t[j*y+H];$(B,(null!=L?L.mask:null)??(L?255:0),m,H,j,l)}if(K)for(let j=0;j<_;j++){const H=new Uint8Array(u*c);for(let L=0;L<f;L++)for(let q=0;q<y;q++){const ht=t[L*y+q];$(H,ht?.bandMasks?.[j]??ht?.mask??(ht?255:0),m,q,L,l)}K.push(H)}}const Q=new z.Z({width:u,height:c,pixels:P,pixelType:p,bandMasks:K,mask:B});return Q.updateStatistics(),Q}function I(t,s,e){if(!N(t))return null;const{width:i,height:r}=t,l=s.x,a=s.y,o=e.width+l,u=e.height+a;if(l<0||a<0||o>i||u>r||0===l&&0===a&&o===i&&u===r)return t;t.mask||(t.mask=new Uint8Array(i*r));const c=t.mask;for(let n=0;n<r;n++){const h=n*i;for(let y=0;y<i;y++)c[h+y]=n<a||n>=u||y<l||y>=o?0:1}return t.updateStatistics(),t}function E(t){if(0===t.size)return 0;let s=0,e=-1,i=0;const r=t.keys();let l=r.next();for(;!l.done;)i=t.get(l.value),i>s&&(e=l.value,s=i),l=r.next();return e}function D(t,s,e){if(0===e)return;const i=t.get(s);1===i?t.delete(s):t.set(s,i-1)}function V(t,s,e){0!==e&&t.set(s,t.has(s)?t.get(s)+1:1)}function d(t,s,e){let{x:i,y:r}=s;const{width:l,height:a}=e;if(0===i&&0===r&&a===t.height&&l===t.width)return t;const{width:o,height:u}=t,c=Math.max(0,r),n=Math.max(0,i),h=Math.min(i+l,o),y=Math.min(r+a,u);if(h<0||y<0||!N(t))return null;i=Math.max(0,-i),r=Math.max(0,-r);const{pixels:f}=t,m=l*a,p=f.length,M=[];for(let v=0;v<p;v++){const U=f[v],R=z.Z.createEmptyBand(t.pixelType,m);for(let B=c;B<y;B++){const K=B*o;let Q=(B+r-c)*l+i;for(let j=n;j<h;j++)R[Q++]=U[K+j]}M.push(R)}const _=new Uint8Array(m),P=t.mask;for(let v=c;v<y;v++){const U=v*o;let R=(v+r-c)*l+i;for(let B=n;B<h;B++)_[R++]=P?P[U+B]:1}const F=new z.Z({width:e.width,height:e.height,pixelType:t.pixelType,pixels:M,mask:_});return F.updateStatistics(),F}function k(t,s=!0){if(!N(t))return null;const{pixels:e,width:i,height:r,mask:l,pixelType:a}=t,o=[],u=Math.round(i/2),c=Math.round(r/2),n=r-1,h=i-1;for(let f=0;f<e.length;f++){const m=e[f],p=z.Z.createEmptyBand(a,u*c);let M=0;for(let _=0;_<r;_+=2)for(let P=0;P<i;P+=2){const F=m[_*i+P];if(s){const v=P===h?F:m[_*i+P+1],U=_===n?F:m[_*i+P+i];p[M++]=(F+v+U+(P===h?U:_===n?v:m[_*i+P+i+1]))/4}else p[M++]=F}o.push(p)}let y=null;if(null!=l){y=new Uint8Array(u*c);let f=0;for(let m=0;m<r;m+=2)for(let p=0;p<i;p+=2){const M=l[m*i+p];if(s){const _=p===h?M:l[m*i+p+1],P=m===n?M:l[m*i+p+i];y[f++]=M*_*P*(p===h?P:m===n?_:l[m*i+p+i+1])?1:0}else y[f++]=M}}return new z.Z({width:u,height:c,pixelType:a,pixels:o,mask:y})}function w(t,s,e){if(!N(t))return null;const{width:i,height:r}=s;let{width:l,height:a}=t;const o=new Map,u={x:0,y:0},c=null==e?1:1+e;let n=t;for(let h=0;h<c;h++){const y=Math.ceil(l/i),f=Math.ceil(a/r);for(let m=0;m<f;m++){u.y=m*r;for(let p=0;p<y;p++){u.x=p*i;const M=d(n,u,s);o.set(`${h}/${m}/${p}`,M)}}h<c-1&&(n=k(n)),l=Math.round(l/2),a=Math.round(a/2)}return o}function A(t,s,e,i,r=0){const{width:l,height:a}=t,{width:o,height:u}=s,c=i.cols,n=i.rows,h=Math.ceil(o/c-.1/c),y=Math.ceil(u/n-.1/n);let f,m,p,M,_,P,F;const v=h*c,U=v*y*n,R=new Float32Array(U),B=new Float32Array(U),K=new Uint32Array(U),Q=new Uint32Array(U);let j,H,L=0;for(let q=0;q<y;q++)for(let ht=0;ht<h;ht++){f=12*(q*h+ht),m=e[f],p=e[f+1],M=e[f+2],_=e[f+3],P=e[f+4],F=e[f+5];for(let rt=0;rt<n;rt++){L=(q*n+rt)*v+ht*c,H=(rt+.5)/n;for(let lt=0;lt<rt;lt++)j=(lt+.5)/c,R[L+lt]=(m*j+p*H+M)*l+r,B[L+lt]=(_*j+P*H+F)*a+r,K[L+lt]=Math.floor(R[L+lt]),Q[L+lt]=Math.floor(B[L+lt])}f+=6,m=e[f],p=e[f+1],M=e[f+2],_=e[f+3],P=e[f+4],F=e[f+5];for(let rt=0;rt<n;rt++){L=(q*n+rt)*v+ht*c,H=(rt+.5)/n;for(let lt=rt;lt<c;lt++)j=(lt+.5)/c,R[L+lt]=(m*j+p*H+M)*l+r,B[L+lt]=(_*j+P*H+F)*a+r,K[L+lt]=Math.floor(R[L+lt]),Q[L+lt]=Math.floor(B[L+lt])}}return{offsets_x:R,offsets_y:B,offsets_xi:K,offsets_yi:Q,gridWidth:v}}function g(t,s){const{coefficients:e,spacing:i}=s,{offsets_x:r,offsets_y:l,gridWidth:a}=A(t,t,e,{rows:i[0],cols:i[1]}),{width:o,height:u}=t,c=new Float32Array(o*u),n=180/Math.PI;for(let h=0;h<u;h++)for(let y=0;y<o;y++){const f=h*a+y,m=0===h?f:f-a,p=h===u-1?f:f+a,M=r[m]-r[p],_=l[p]-l[m];if(isNaN(M)||isNaN(_))c[h*o+y]=90;else{let P=Math.atan2(_,M)*n;P=(360+P)%360,c[h*o+y]=P}}return c}function x(t,s,e,i,r="nearest"){if(!N(t))return null;"majority"===r&&(t=function b(t){if(!N(t))return null;const s=t.clone(),{width:e,height:i,pixels:r}=t,l=r[0],a=s.pixels[0],o=t.mask;for(let u=2;u<i-1;u++){const c=new Map;for(let h=u-2;h<u+2;h++)for(let y=0;y<4;y++){const f=h*e+y;V(c,l[f],o?o[f]:1)}a[u*e]=E(c),a[u*e+1]=a[u*e+2]=a[u*e];let n=3;for(;n<e-1;n++){let h=(u-2)*e+n+1;V(c,l[h],o?o[h]:1),h=(u-1)*e+n+1,V(c,l[h],o?o[h]:1),h=u*e+n+1,V(c,l[h],o?o[h]:1),h=(u+1)*e+n+1,V(c,l[h],o?o[h]:1),h=(u-2)*e+n-3,D(c,l[h],o?o[h]:1),h=(u-1)*e+n-3,D(c,l[h],o?o[h]:1),h=u*e+n-3,D(c,l[h],o?o[h]:1),h=(u+1)*e+n-3,D(c,l[h],o?o[h]:1),a[u*e+n]=E(c)}a[u*e+n+1]=a[u*e+n]}for(let u=0;u<e;u++)a[u]=a[e+u]=a[2*e+u],a[(i-1)*e+u]=a[(i-2)*e+u];return s.updateStatistics(),s}(t));const{pixels:l,mask:a,bandMasks:o,pixelType:u}=t,c=t.width,n=t.height,h=z.Z.getPixelArrayConstructor(u),y=l.length,{width:f,height:m}=s;let p=!1;for(let L=0;L<e.length;L+=3)-1===e[L]&&-1===e[L+1]&&-1===e[L+2]&&(p=!0);const{offsets_x:M,offsets_y:_,offsets_xi:P,offsets_yi:F,gridWidth:v}=A({width:c,height:n},s,e,i,"majority"===r?.5:0);let U;const R=(L,q,ht,rt)=>{const lt=L instanceof Float32Array||L instanceof Float64Array?0:.5;for(let gt=0;gt<m;gt++){U=gt*v;for(let it=0;it<f;it++){if(M[U]<0||_[U]<0)L[gt*f+it]=0;else if(rt)L[gt*f+it]=q[P[U]+F[U]*c];else{const st=Math.floor(M[U]),wt=Math.floor(_[U]),Mt=Math.ceil(M[U]),At=Math.ceil(_[U]),_t=M[U]-st,vt=_[U]-wt;L[gt*f+it]=!ht||ht[st+wt*c]&&ht[Mt+wt*c]&&ht[st+At*c]&&ht[Mt+At*c]?(1-vt)*((1-_t)*q[st+wt*c]+_t*q[Mt+wt*c])+vt*((1-_t)*q[st+At*c]+_t*q[Mt+At*c])+lt:q[P[U]+F[U]*c]}U++}}},B=[];let K;const Q=o?.length===y,j=[];for(let L=0;L<y;L++){if(Q){const q=new Uint8Array(f*m);R(q,o[L],o[L],!0),j.push(q)}K=new h(f*m),R(K,l[L],Q?o[L]:a,"nearest"===r||"majority"===r),B.push(K)}const H=new z.Z({width:f,height:m,pixelType:u,pixels:B,bandMasks:Q?j:void 0});if(null!=a)H.mask=new Uint8Array(f*m),R(H.mask,a,a,!0);else if(p){H.mask=new Uint8Array(f*m);for(let L=0;L<f*m;L++)H.mask[L]=M[L]<0||_[L]<0?0:1}return H.updateStatistics(),H}},30994:(bt,kt,tt)=>{tt.d(kt,{BH:()=>T,K:()=>E,KC:()=>dt,NL:()=>pt,QI:()=>C,Tg:()=>ot,Yx:()=>yt,nb:()=>V,wF:()=>D,xQ:()=>nt});var z=tt(2076),xt=tt(85073),ct=tt(79751);const ut=new Map;ut.set("meter-per-second",1),ut.set("kilometer-per-hour",.277778),ut.set("knots",.514444),ut.set("feet-per-second",.3048),ut.set("mile-per-hour",.44704);const ft=180/Math.PI,N=5,pt=new z.X({esriMetersPerSecond:"meter-per-second",esriKilometersPerHour:"kilometer-per-hour",esriKnots:"knots",esriFeetPerSecond:"feet-per-second",esriMilesPerHour:"mile-per-hour"});function yt(d,k){return ut.get(d)/ut.get(k)||1}function mt(d){return(450-d)%360}function ot(d,k="geographic"){const[w,A]=d,g=Math.sqrt(w*w+A*A);let x=Math.atan2(A,w)*ft;return x=(360+x)%360,"geographic"===k&&(x=mt(x)),[g,x]}function at(d,k="geographic"){let w=d[1];"geographic"===k&&(w=mt(w)),w%=360;const A=d[0];return[A*Math.cos(w/ft),A*Math.sin(w/ft)]}function nt(d,k,w,A="geographic"){if(!(0,ct.nk)(d)||null==w)return d;const g="vector-magdir"===k?d.clone():dt(d,k),x=g.pixels[1];for(let t=0;t<x.length;t++)x[t]="geographic"===A?(x[t]+w[t]+270)%360:(x[t]+360-w[t])%360;return"vector-magdir"===k?g:dt(g,"vector-magdir")}function dt(d,k,w="geographic",A=1){if(!(0,ct.nk)(d))return d;const{pixels:g,width:x,height:t}=d,s=x*t,e=g[0],i=g[1],r=d.pixelType.startsWith("f")?d.pixelType:"f32",l=xt.Z.createEmptyBand(r,s),a=xt.Z.createEmptyBand(r,s);let o=0;for(let c=0;c<t;c++)for(let n=0;n<x;n++)"vector-uv"===k?([l[o],a[o]]=ot([e[o],i[o]],w),l[o]*=A):([l[o],a[o]]=at([e[o],i[o]],w),l[o]*=A,a[o]*=A),o++;const u=new xt.Z({pixelType:r,width:d.width,height:d.height,mask:d.mask,validPixelCount:d.validPixelCount,maskIsAlpha:d.maskIsAlpha,pixels:[l,a]});return u.updateStatistics(),u}function C(d,k,w=1){if(1===w||!(0,ct.nk)(d))return d;const A=d.clone(),{pixels:g,width:x,height:t}=A,s=g[0],e=g[1];let i=0;for(let r=0;r<t;r++)for(let l=0;l<x;l++)"vector-uv"===k?(s[i]*=w,e[i]*=w):s[i]*=w,i++;return A.updateStatistics(),A}function T(d,k,w,A,g){if(null==g||!g.spatialReference.equals(d.spatialReference))return{extent:d,width:Math.round(k/A),height:Math.round(w/A),resolution:d.width/k};const x=g.xmin,t=g.ymax,s=(d.xmax-d.xmin)/k*A,e=(d.ymax-d.ymin)/w*A,i=(s+e)/2;return d.xmin=x+Math.floor((d.xmin-x)/s)*s,d.xmax=x+Math.ceil((d.xmax-x)/s)*s,d.ymin=t+Math.floor((d.ymin-t)/e)*e,d.ymax=t+Math.ceil((d.ymax-t)/e)*e,{extent:d,width:Math.round(d.width/s),height:Math.round(d.height/e),resolution:i}}const G=J(0,0,0);function J(d=0,k=0,w=Math.PI,A=!0){A&&(w=(2*Math.PI-w)%(2*Math.PI));const g=A?-1:1,x=13*g,t=-7*g,s=-2*g,e=-16*g,i=21.75,[r,l]=O(0,k+x,w,i),[a,o]=O(d-5.5,k+t,w,i),[u,c]=O(d+5.5,k+t,w,i),[n,h]=O(d-1.5,k+s,w,i),[y,f]=O(d+1.5,k+s,w,i),[m,p]=O(d-1.5,k+e,w,i),[M,_]=O(d+1.5,k+e,w,i);return[r,l,a,o,n,h,y,f,u,c,m,p,M,_]}function X(d=0,k=Math.PI,w=!0){w&&(k=(2*Math.PI-k)%(2*Math.PI));const g=w?-1:1,x=5*g,t=20*g,s=25*g,e=45,o=2*g,u=w?1:-1,c=5*u;let[n,h]=[0+c,0-t],[y,f]=[n+2*u,h],[m,p]=[y-0*u,f+o],[M,_]=[0-c,0-s],[P,F]=[M+0*u,_-o],v=Math.ceil(d/N),U=Math.floor(v/10);v-=8*U;const R=[],B=[];for(let gt=0;gt<v/2;gt++,U--){U<=0&&v%2==1&&gt===(v-1)/2&&(M=0,P=M+0*u,_=(_+h)/2,F=_-o);const[it,st]=O(M,_,k,e);if(U>0){const[wt,Mt]=O(y,_,k,e),[At,_t]=O(n,h,k,e);R.push(wt),R.push(Mt),R.push(it),R.push(st),R.push(At),R.push(_t)}else{const[wt,Mt]=O(y,f,k,e),[At,_t]=O(m,p,k,e),[vt,Pt]=O(P,F,k,e);B.push(it),B.push(st),B.push(vt),B.push(Pt),B.push(At),B.push(_t),B.push(wt),B.push(Mt)}_+=x,h+=x,f+=x,p+=x,F+=x}const[K,Q]=O(0+c,0+t,k,e),j=7*u,[H,L]=O(0+j,0+t,k,e),[q,ht]=O(0+c,0-s,k,e),[rt,lt]=O(0+j,0-s,k,e);return{pennants:R,barbs:B,shaft:[K,Q,H,L,q,ht,rt,lt]}}function O(d,k,w,A=1){const g=Math.sqrt(d*d+k*k)/A,x=(2*Math.PI+Math.atan2(k,d))%(2*Math.PI);return[g,(2*Math.PI+x-w)%(2*Math.PI)]}const S=[0,1,3,6,10,16,21,27,33,40,47,55,63],Y=[0,.5,1,1.5,2],Z=[0,.25,.5,1,1.5,2,2.5,3,3.5,4];function $(d,k,w,A){const g=yt(A||"knots",w);let x;for(x=1;x<k.length;x++)if(x===k.length-1){if(d<k[x]*g)break}else if(d<=k[x]*g)break;return Math.min(x-1,k.length-2)}function et(d,k,w,A,g){let x=0;switch(k){case"beaufort_kn":x=$(d,S,"knots",w);break;case"beaufort_km":x=$(d,S,"kilometer-per-hour",w);break;case"beaufort_ft":x=$(d,S,"feet-per-second",w);break;case"beaufort_m":x=$(d,S,"meter-per-second",w);break;case"classified_arrow":x=$(d,g??[],A,w);break;case"ocean_current_m":x=$(d,Y,"meter-per-second",w);break;case"ocean_current_kn":x=$(d,Z,"knots",w)}return x}const I=[];function E(d,k){let A=0,g=0;const{width:x,height:t,mask:s}=d,e=d.pixels[0],i=[],r=[],l=yt(pt.fromJSON(k.inputUnit),"knots"),a="wind_speed"===k.style?N:Number.MAX_VALUE;for(let o=0;o<t;o++)for(let u=0;u<x;u++){const c=e[o*x+u]*l;if((!s||s[o*x+u])&&c<a){for(let h=0;h<4;h++)i[A++]=(u+.5)/x,i[A++]=(o+.5)/t,i[A++]=h<2?-.5:.5,i[A++]=h%2==0?-.5:.5,i[A++]=0,i[A++]=c;const n=4*(A/24-1);r[g++]=n,r[g++]=n+1,r[g++]=n+2,r[g++]=n+1,r[g++]=n+2,r[g++]=n+3}}return{vertexData:new Float32Array(i),indexData:new Uint32Array(r)}}function D(d,k){return"simple_scalar"===k.style?E(d,k):"wind_speed"===k.style?function b(d,k){if(0===I.length)for(let o=0;o<30;o++)I.push(X(5*o,0,!k.invertDirection));const w=yt(pt.fromJSON(k.inputUnit),"knots"),{width:A,height:g,mask:x}=d,t=d.pixels[0],s=d.pixels[1],i=[],r=[];let l=0,a=0;for(let o=0;o<g;o++)for(let u=0;u<A;u++){const c=o*A+u,n=t[c]*w;if((!x||x[o*A+u])&&n>=N){const h=(s[c]+360)%360/180*Math.PI,{pennants:y,barbs:f,shaft:m}=I[Math.min(Math.floor(n/5),29)];if(y.length+f.length===0)continue;let p=i.length/6;const M=(u+.5)/A,_=(o+.5)/g;for(let P=0;P<y.length;P+=2)i[l++]=M,i[l++]=_,i[l++]=y[P],i[l++]=y[P+1]+h,i[l++]=0,i[l++]=n;for(let P=0;P<f.length;P+=2)i[l++]=M,i[l++]=_,i[l++]=f[P],i[l++]=f[P+1]+h,i[l++]=0,i[l++]=n;for(let P=0;P<m.length;P+=2)i[l++]=M,i[l++]=_,i[l++]=m[P],i[l++]=m[P+1]+h,i[l++]=0,i[l++]=n;for(let P=0;P<y.length/6;P++)r[a++]=p,r[a++]=p+1,r[a++]=p+2,p+=3;for(let P=0;P<f.length/8;P++)r[a++]=p,r[a++]=p+1,r[a++]=p+2,r[a++]=p+1,r[a++]=p+2,r[a++]=p+3,p+=4;r[a++]=p+0,r[a++]=p+1,r[a++]=p+2,r[a++]=p+1,r[a++]=p+3,r[a++]=p+2,p+=4}}return{vertexData:new Float32Array(i),indexData:new Uint32Array(r)}}(d,k):function W(d,k){const{style:w,inputUnit:A,outputUnit:g,breakValues:x}=k,t=pt.fromJSON(A),s=pt.fromJSON(g);let r=0,l=0;const{width:a,height:o,mask:u}=d,c=d.pixels[0],n=d.pixels[1],h=null!=u?u.filter(p=>p>0).length:a*o,y=new Float32Array(42*h),f=new Uint32Array(15*h),m=k.invertDirection?J(0,0,0,!1):G;for(let p=0;p<o;p++)for(let M=0;M<a;M++){const _=p*a+M;if(!u||u[p*a+M]){const P=(n[_]+360)%360/180*Math.PI,F=et(c[_],w,t,s,x);for(let U=0;U<m.length;U+=2)y[r++]=(M+.5)/a,y[r++]=(p+.5)/o,y[r++]=m[U],y[r++]=m[U+1]+P,y[r++]=F,y[r++]=c[_];const v=7*(r/42-1);f[l++]=v,f[l++]=v+1,f[l++]=v+2,f[l++]=v+0,f[l++]=v+4,f[l++]=v+3,f[l++]=v+0,f[l++]=v+2,f[l++]=v+3,f[l++]=v+2,f[l++]=v+5,f[l++]=v+3,f[l++]=v+5,f[l++]=v+6,f[l++]=v+3}}return{vertexData:y,indexData:f}}(d,k)}function V(d,k,w,A=[0,0],g=.5){const{width:x,height:t,mask:s}=d,[e,i]=d.pixels,[r,l]=A,a=Math.round((x-r)/w),o=Math.round((t-l)/w),u=a*o,c=new Float32Array(u),n=new Float32Array(u),h=new Uint8Array(u),y="vector-uv"===k;for(let m=0;m<o;m++)for(let p=0;p<a;p++){let M=0;const _=m*a+p,P=Math.max(0,m*w+l),F=Math.max(0,p*w+r),v=Math.min(t,P+w),U=Math.min(x,F+w);for(let R=P;R<v;R++)for(let B=F;B<U;B++){const K=R*x+B;if(!s||s[K]){M++;const Q=y?[e[K],i[K]]:[e[K],(360+i[K])%360],[j,H]=y?Q:at(Q);c[_]+=j,n[_]+=H}}if(M>=(v-P)*(U-F)*(1-g)){h[_]=1;const[R,B]=ot([c[_]/M,n[_]/M]);c[_]=R,n[_]=B}else h[_]=0,c[_]=0,n[_]=0}const f=new xt.Z({width:a,height:o,pixels:[c,n],mask:h});return f.updateStatistics(),f}},37084:(bt,kt,tt)=>{tt.d(kt,{GE:()=>nt,KK:()=>Z});var z=tt(15861),ct=(tt(29132),tt(8314)),ut=tt(63290),ft=tt(21286),N=tt(10699),pt=tt(4619),yt=tt(37053),mt=tt(2004);const ot=ut.Z.getLogger("esri.views.2d.engine.flow.dataUtils"),at=10;function nt(I,b,E,D){return dt.apply(this,arguments)}function dt(){return(dt=(0,z.Z)(function*(I,b,E,D){const V=performance.now(),d=function C(I,b){const E=function J(I,b,E,D){if(0===D)return I;const V=Math.round(3*D),d=new Array(2*V+1);let k=0;for(let g=-V;g<=V;g++){const x=Math.exp(-g*g/(D*D));d[g+V]=x,k+=x}for(let g=-V;g<=V;g++)d[g+V]/=k;const w=new Float32Array(I.length);for(let g=0;g<E;g++)for(let x=0;x<b;x++){let t=0,s=0;for(let e=-V;e<=V;e++){if(x+e<0||x+e>=b)continue;const i=d[e+V];t+=i*I[2*(g*b+(x+e))],s+=i*I[2*(g*b+(x+e))+1]}w[2*(g*b+x)]=t,w[2*(g*b+x)+1]=s}const A=new Float32Array(I.length);for(let g=0;g<b;g++)for(let x=0;x<E;x++){let t=0,s=0;for(let e=-V;e<=V;e++){if(x+e<0||x+e>=E)continue;const i=d[e+V];t+=i*w[2*((x+e)*b+g)],s+=i*w[2*((x+e)*b+g)+1]}A[2*(x*b+g)]=t,A[2*(x*b+g)+1]=s}return A}(b.data,b.width,b.height,I.smoothing);return I.interpolate?(D,V)=>{const d=Math.floor(D),k=Math.floor(V);if(d<0||d>=b.width)return[0,0];if(k<0||k>=b.height)return[0,0];const w=D-d,A=V-k,t=d<b.width-1?d+1:d,s=k<b.height-1?k+1:k;return[(E[2*(k*b.width+d)]*(1-A)+E[2*(s*b.width+d)]*A)*(1-w)+(E[2*(k*b.width+t)]*(1-A)+E[2*(s*b.width+t)]*A)*w,(E[2*(k*b.width+d)+1]*(1-A)+E[2*(s*b.width+d)+1]*A)*(1-w)+(E[2*(k*b.width+t)+1]*(1-A)+E[2*(s*b.width+t)+1]*A)*w]}:(D,V)=>{const d=Math.round(D),k=Math.round(V);return d<0||d>=b.width||k<0||k>=b.height?[0,0]:[E[2*(k*b.width+d)],E[2*(k*b.width+d)+1]]}}(b,E),k=performance.now(),w=function G(I,b,E,D){const V=[],d=new pt.Z,k=1/Math.max(I.lineCollisionWidth,1),w=Math.round(E*k),A=Math.round(D*k),g=new Int32Array(w*A);for(let t=0;t<g.length;t++)g[t]=-1;const x=[];for(let t=0;t<D;t+=I.lineSpacing)for(let s=0;s<E;s+=I.lineSpacing)x.push({x:s,y:t,sort:d.getFloat()});x.sort((t,s)=>t.sort-s.sort);for(const{x:t,y:s}of x)if(d.getFloat()<I.density){const e=T(I,b,t,s,V.length,g,w,A,k);if(e.length<2)continue;V.push(e)}return V}(b,d,E.width,E.height),A=performance.now(),g=function X(I,b){const E=new pt.Z,D=I.reduce((A,g)=>A+g.length,0),V=new Float32Array(4*D),d=new Array(I.length);let k=0,w=0;for(const A of I){const g=k;for(const x of A)V[4*k]=x.x,V[4*k+1]=x.y,V[4*k+2]=x.t,V[4*k+3]=x.speed,k++;d[w++]={startVertex:g,numberOfVertices:A.length,totalTime:A[A.length-1].t,timeSeed:b?E.getFloat():0}}return{lineVertices:V,lineDescriptors:d}}(w,!0),x=performance.now(),t="Streamlines"===I?function O(I,b){const{lineVertices:D,lineDescriptors:V}=I;let d=0,k=0;for(const e of V)d+=2*e.numberOfVertices,k+=6*(e.numberOfVertices-1);const w=new Float32Array(9*d),A=new Uint32Array(k);let g=0,x=0;function s(e,i,r,l,a,o,u,c){const n=9*g;let h=0;w[n+h++]=e,w[n+h++]=i,w[n+h++]=1,w[n+h++]=r,w[n+h++]=o,w[n+h++]=u,w[n+h++]=l/2,w[n+h++]=a/2,w[n+h++]=c,g++,w[n+h++]=e,w[n+h++]=i,w[n+h++]=-1,w[n+h++]=r,w[n+h++]=o,w[n+h++]=u,w[n+h++]=-l/2,w[n+h++]=-a/2,w[n+h++]=c,g++}for(const e of V){const{totalTime:i,timeSeed:r}=e;let l=null,a=null,o=null,u=null,c=null,n=null;for(let h=0;h<e.numberOfVertices;h++){const y=D[4*(e.startVertex+h)],f=D[4*(e.startVertex+h)+1],m=D[4*(e.startVertex+h)+2],p=D[4*(e.startVertex+h)+3];let M=null,_=null,P=null,F=null;if(h>0){M=y-l,_=f-a;const v=Math.sqrt(M*M+_*_);if(M/=v,_/=v,h>1){let U=M+c,R=_+n;const B=Math.sqrt(U*U+R*R);U/=B,R/=B;const K=Math.min(1/(U*M+R*_),b);U*=K,R*=K,P=-R,F=U}else P=-_,F=M;null!==P&&null!==F&&(s(l,a,o,P,F,i,r,p),A[x++]=g-2,A[x++]=g,A[x++]=g-1,A[x++]=g,A[x++]=g+1,A[x++]=g-1)}l=y,a=f,o=m,c=M,n=_,u=p}s(l,a,o,-n,c,i,r,u)}return{vertexData:w,indexData:A}}(g,at):function S(I){const{lineVertices:V,lineDescriptors:d}=I;let k=0,w=0;for(const v of d){const U=v.numberOfVertices-1;k+=4*U*2,w+=6*U*2}const A=new Float32Array(16*k),g=new Uint32Array(w);let x,t,s,e,i,r,l,a,o,u,c,n,h,y,f=0,m=0;function _(v,U){let R=o+c,B=u+n;const K=Math.sqrt(R*R+B*B);R/=K,B/=K;const Q=o*R+u*B;R/=Q,B/=Q;let j=c+h,H=n+y;const L=Math.sqrt(j*j+H*H);j/=L,H/=L;const q=c*j+n*H;j/=q,H/=q,function M(v,U,R,B,K,Q,j,H,L,q,ht,rt,lt,gt){const it=16*f;let st=0;for(const wt of[1,2])for(const Mt of[1,2,3,4])A[it+st++]=v,A[it+st++]=U,A[it+st++]=R,A[it+st++]=B,A[it+st++]=j,A[it+st++]=H,A[it+st++]=L,A[it+st++]=q,A[it+st++]=wt,A[it+st++]=Mt,A[it+st++]=lt,A[it+st++]=gt,A[it+st++]=K/2,A[it+st++]=Q/2,A[it+st++]=ht/2,A[it+st++]=rt/2,f++}(x,t,s,e,-B,R,i,r,l,a,-H,j,v,U),function p(){g[m++]=f-8,g[m++]=f-7,g[m++]=f-6,g[m++]=f-7,g[m++]=f-5,g[m++]=f-6,g[m++]=f-4,g[m++]=f-3,g[m++]=f-2,g[m++]=f-3,g[m++]=f-1,g[m++]=f-2}()}function P(v,U,R,B,K,Q){if(o=c,u=n,c=h,n=y,null==o&&null==u&&(o=c,u=n),null!=i&&null!=r){h=v-i,y=U-r;const j=Math.sqrt(h*h+y*y);h/=j,y/=j}null!=o&&null!=u&&_(K,Q),x=i,t=r,s=l,e=a,i=v,r=U,l=R,a=B}function F(v,U){o=c,u=n,c=h,n=y,null==o&&null==u&&(o=c,u=n),null!=o&&null!=u&&_(v,U)}for(const v of d){x=null,t=null,s=null,e=null,i=null,r=null,l=null,a=null,o=null,u=null,c=null,n=null,h=null,y=null;const{totalTime:U,timeSeed:R}=v;for(let B=0;B<v.numberOfVertices;B++)P(V[4*(v.startVertex+B)],V[4*(v.startVertex+B)+1],V[4*(v.startVertex+B)+2],V[4*(v.startVertex+B)+3],U,R);F(U,R)}return{vertexData:A,indexData:g}}(g),s=performance.now();return(0,ct.Z)("esri-2d-profiler")&&(ot.info("I.1","_createFlowFieldFromData (ms)",Math.round(k-V)),ot.info("I.2","_getStreamlines (ms)",Math.round(A-k)),ot.info("I.3","createAnimatedLinesData (ms)",Math.round(x-A)),ot.info("I.4","create{Streamlines|Particles}Mesh (ms)",Math.round(s-x)),ot.info("I.5","createFlowMesh (ms)",Math.round(s-V)),ot.info("I.6","Mesh size (bytes)",t.vertexData.buffer.byteLength+t.indexData.buffer.byteLength)),yield Promise.resolve(),(0,N.k_)(D),t})).apply(this,arguments)}function T(I,b,E,D,V,d,k,w,A){const g=[];let x=E,t=D,s=0,[e,i]=b(x,t);e*=I.velocityScale,i*=I.velocityScale;const r=Math.sqrt(e*e+i*i);let l,a;g.push({x,y:t,t:s,speed:r});for(let o=0;o<I.verticesPerLine;o++){let[u,c]=b(x,t);u*=I.velocityScale,c*=I.velocityScale;const n=Math.sqrt(u*u+c*c);if(n<I.minSpeedThreshold)return g;const h=u/n,y=c/n;if(x+=h*I.segmentLength,t+=y*I.segmentLength,s+=I.segmentLength/n,Math.acos(h*l+y*a)>I.maxTurnAngle)return g;if(I.collisions){const f=Math.round(x*A),m=Math.round(t*A);if(f<0||f>k-1||m<0||m>w-1)return g;const p=d[m*k+f];if(-1!==p&&p!==V)return g;d[m*k+f]=V}g.push({x,y:t,t:s,speed:n}),l=h,a=y}return g}function Y(I,b){const E=b.pixels,{width:D,height:V}=b,d=new Float32Array(D*V*2),k=b.mask||new Uint8Array(D*V*2);if(b.mask||k.fill(255),"vector-uv"===I)for(let w=0;w<D*V;w++)d[2*w]=E[0][w],d[2*w+1]=-E[1][w];else if("vector-magdir"===I)for(let w=0;w<D*V;w++){const A=E[0][w],g=(0,ft.Vl)(E[1][w]),x=Math.cos(g-Math.PI/2),t=Math.sin(g-Math.PI/2);d[2*w]=x*A,d[2*w+1]=t*A}return{data:d,mask:k,width:D,height:V}}function Z(I,b,E,D,V,d){return $.apply(this,arguments)}function $(){return($=(0,z.Z)(function*(I,b,E,D,V,d){const k=performance.now(),w=(0,yt.C5)(b.spatialReference);if(!w){const c=yield et(I,b,E,D,V,d);return(0,ct.Z)("esri-2d-profiler")&&ot.info("I.7","loadImagery, early exit (ms)",Math.round(performance.now()-k)),(0,ct.Z)("esri-2d-profiler")&&ot.info("I.9","Number of parts",1),c}const[A,g]=w.valid,t=Math.ceil(b.width/(g-A)),s=b.width/t,e=Math.round(E/t);let i=b.xmin;const r=[],l=performance.now();for(let c=0;c<t;c++){const n=new mt.Z({xmin:i,xmax:i+s,ymin:b.ymin,ymax:b.ymax,spatialReference:b.spatialReference});r.push(et(I,n,e,D,V,d)),i+=s}const a=yield Promise.all(r);(0,ct.Z)("esri-2d-profiler")&&ot.info("I.8","All calls to _fetchPart (ms)",Math.round(performance.now()-l)),(0,ct.Z)("esri-2d-profiler")&&ot.info("I.9","Number of parts",a.length);const o={data:new Float32Array(E*D*2),mask:new Uint8Array(E*D),width:E,height:D};let u=0;for(const c of a){for(let n=0;n<c.height;n++)for(let h=0;h<c.width;h++)u+h>=E||(o.data[2*(n*E+u+h)]=c.data[2*(n*c.width+h)],o.data[2*(n*E+u+h)+1]=c.data[2*(n*c.width+h)+1],o.mask[n*E+u+h]=c.mask[n*c.width+h]);u+=c.width}return(0,ct.Z)("esri-2d-profiler")&&ot.info("I.10","loadImagery, general exit (ms)",Math.round(performance.now()-k)),o})).apply(this,arguments)}function et(I,b,E,D,V,d){return W.apply(this,arguments)}function W(){return(W=(0,z.Z)(function*(I,b,E,D,V,d){const k={requestProjectedLocalDirections:!0,signal:d};if(null!=V&&(k.timeExtent=V),"imagery"===I.type){yield I.load({signal:d});const g=I.rasterInfo.dataType,x=yield I.fetchImage(b,E,D,k);return null==x?.pixelData?.pixelBlock?{data:new Float32Array(E*D*2),mask:new Uint8Array(E*D),width:E,height:D}:Y(g,x.pixelData.pixelBlock)}yield I.load({signal:d});const w=I.rasterInfo.dataType,A=yield I.fetchPixels(b,E,D,k);return null==A?.pixelBlock?{data:new Float32Array(E*D*2),mask:new Uint8Array(E*D),width:E,height:D}:Y(w,A.pixelBlock)})).apply(this,arguments)}}}]);