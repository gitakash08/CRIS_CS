"use strict";(self.webpackChunkCRIS=self.webpackChunkCRIS||[]).push([[1619],{58774:(Kt,St,f)=>{f.d(St,{b:()=>b,j:()=>q});var F=f(15861),ft=f(54346),pt=f(8314);const V=128e3;let k=null,Z=null;function q(){return U.apply(this,arguments)}function U(){return U=(0,F.Z)(function*(){return k||(k=function j(){return ot.apply(this,arguments)}()),k}),U.apply(this,arguments)}function ot(){return(ot=(0,F.Z)(function*(){Z=yield((0,pt.Z)("esri-csp-restrictions")?yield f.e(71).then(f.bind(f,10071)).then(J=>J.l):yield f.e(9507).then(f.bind(f,99507)).then(J=>J.l)).load({locateFile:J=>(0,ft.V)(`esri/core/libs/libtess/${J}`)})})).apply(this,arguments)}function b(xt,J){const P=Math.max(xt.length,V);return Z.triangulate(xt,J,P)}},25293:(Kt,St,f)=>{f.d(St,{i:()=>ft});var F=f(43080);class ft{static getPlacement(V,k,Z,q,U,j){const ot=(0,F.W)(Z);return ot?(-1===k&&V.invertY(),ot.execute(V,Z,q,U,j)):null}}},46519:(Kt,St,f)=>{f.d(St,{z:()=>J});var F=f(7547),ft=f(39351);function pt(P,a){return P.x===a.x&&P.y===a.y}function k(P,a){return P.x=a.y,P.y=-a.x,P}function Z(P,a){return P.x=-a.y,P.y=a.x,P}function q(P,a){return P.x=a.x,P.y=a.y,P}function U(P,a){return P.x=-a.x,P.y=-a.y,P}function j(P){return Math.sqrt(P.x*P.x+P.y*P.y)}function ot(P,a){return P.x*a.y-P.y*a.x}function b(P,a){return P.x*a.x+P.y*a.y}function xt(P,a,u,T){return P.x=a.x*u+a.y*T,P.y=a.x*T-a.y*u,P}class J{constructor(a,u,T){this._writeVertex=a,this._writeTriangle=u,this._canUseThinTessellation=T,this._prevNormal={x:void 0,y:void 0},this._nextNormal={x:void 0,y:void 0},this._textureNormalLeft={x:0,y:1},this._textureNormalRight={x:0,y:-1},this._textureNormal={x:void 0,y:void 0},this._joinNormal={x:void 0,y:void 0},this._inner={x:void 0,y:void 0},this._outer={x:void 0,y:void 0},this._roundStart={x:void 0,y:void 0},this._roundEnd={x:void 0,y:void 0},this._startBreak={x:void 0,y:void 0},this._endBreak={x:void 0,y:void 0},this._innerPrev={x:void 0,y:void 0},this._innerNext={x:void 0,y:void 0},this._bevelStart={x:void 0,y:void 0},this._bevelEnd={x:void 0,y:void 0},this._bevelMiddle={x:void 0,y:void 0}}tessellate(a,u){(function V(P){if(!P)return;const a=P.length;if(a<=1)return;let u=0;for(let T=1;T<a;T++)pt(P[T],P[u])||++u===T||(P[u]=P[T]);P.length=u+1})(a),this._canUseThinTessellation&&u.halfWidth<ft.do&&!u.offset?this._tessellateThin(a,u):this._tessellate(a,u)}_tessellateThin(a,u){if(a.length<2)return;const T=u.wrapDistance||65535;let Q=u.initialDistance||0,at=!1,it=a[0].x,st=a[0].y;const d=a.length;for(let _=1;_<d;++_){at&&(at=!1,Q=0);let v=a[_].x,E=a[_].y,L=v-it,B=E-st,W=Math.sqrt(L*L+B*B);if(L/=W,B/=W,Q+W>T){at=!0;const c=(T-Q)/W;W=T-Q,v=(1-c)*it+c*v,E=(1-c)*st+c*E,--_}const O=this._writeVertex(it,st,0,0,L,B,B,-L,0,-1,Q),p=this._writeVertex(it,st,0,0,L,B,-B,L,0,1,Q);Q+=W;const Y=this._writeVertex(v,E,0,0,L,B,B,-L,0,-1,Q),m=this._writeVertex(v,E,0,0,L,B,-B,L,0,1,Q);this._writeTriangle(O,p,Y),this._writeTriangle(p,Y,m),it=v,st=E}}_tessellate(a,u){const Q=a[a.length-1],at=pt(a[0],Q);if(a.length<(at?3:2))return;const st=u.pixelCoordRatio,d=null!=u.capType?u.capType:F.RL.BUTT,_=null!=u.joinType?u.joinType:F.AH.MITER,v=null!=u.miterLimit?Math.min(u.miterLimit,4):2,E=null!=u.roundLimit?Math.min(u.roundLimit,1.05):1.05,L=null!=u.halfWidth?u.halfWidth:2,B=!!u.textured;let W,O,p,Y=null;const m=this._prevNormal,c=this._nextNormal;let H=-1,_t=-1;const tt=this._joinNormal;let lt,rt;const Ot=this._textureNormalLeft,At=this._textureNormalRight,yt=this._textureNormal;let Mt=-1,gt=-1;const Ct=u.wrapDistance||65535;let wt=u.initialDistance||0;const Yt=this._writeVertex,ee=this._writeTriangle,K=(g,x,S,C,A,et)=>{const nt=Yt(O,p,lt,rt,S,C,g,x,A,et,wt);return Mt>=0&&gt>=0&&nt>=0&&ee(Mt,gt,nt),Mt=gt,gt=nt,nt};at&&(W=a[a.length-2],c.x=Q.x-W.x,c.y=Q.y-W.y,_t=j(c),c.x/=_t,c.y/=_t);let o=!1;for(let g=0;g<a.length;++g){if(o&&(o=!1,wt=0),W&&(m.x=-c.x,m.y=-c.y,H=_t,wt+H>Ct&&(o=!0)),o){const $=(Ct-wt)/H;H=Ct-wt,W={x:(1-$)*W.x+$*a[g].x,y:(1-$)*W.y+$*a[g].y},--g}else W=a[g];O=W.x,p=W.y;const x=g<=0&&!o,S=g===a.length-1;if(x||(wt+=H),Y=S?at?a[1]:null:a[g+1],Y?(c.x=Y.x-O,c.y=Y.y-p,_t=j(c),c.x/=_t,c.y/=_t):(c.x=void 0,c.y=void 0),!at){if(x){Z(tt,c),lt=tt.x,rt=tt.y,d===F.RL.SQUARE&&(K(-c.y-c.x,c.x-c.y,c.x,c.y,0,-1),K(c.y-c.x,-c.x-c.y,c.x,c.y,0,1)),d===F.RL.ROUND&&(K(-c.y-c.x,c.x-c.y,c.x,c.y,-1,-1),K(c.y-c.x,-c.x-c.y,c.x,c.y,-1,1)),d!==F.RL.ROUND&&d!==F.RL.BUTT||(K(-c.y,c.x,c.x,c.y,0,-1),K(c.y,-c.x,c.x,c.y,0,1));continue}if(S){k(tt,m),lt=tt.x,rt=tt.y,d!==F.RL.ROUND&&d!==F.RL.BUTT||(K(m.y,-m.x,-m.x,-m.y,0,-1),K(-m.y,m.x,-m.x,-m.y,0,1)),d===F.RL.SQUARE&&(K(m.y-m.x,-m.x-m.y,-m.x,-m.y,0,-1),K(-m.y-m.x,m.x-m.y,-m.x,-m.y,0,1)),d===F.RL.ROUND&&(K(m.y-m.x,-m.x-m.y,-m.x,-m.y,1,-1),K(-m.y-m.x,m.x-m.y,-m.x,-m.y,1,1));continue}}let C,A,et=-ot(m,c);if(Math.abs(et)<.01)b(m,c)>0?(tt.x=m.x,tt.y=m.y,et=1,C=Number.MAX_VALUE,A=!0):(Z(tt,c),et=1,C=1,A=!1);else{tt.x=(m.x+c.x)/et,tt.y=(m.y+c.y)/et,C=j(tt);const $=(C-1)*L*st;A=C>4||$>H&&$>_t}lt=tt.x,rt=tt.y;let nt=_;switch(_){case F.AH.BEVEL:C<1.05&&(nt=F.AH.MITER);break;case F.AH.ROUND:C<E&&(nt=F.AH.MITER);break;case F.AH.MITER:C>v&&(nt=F.AH.BEVEL)}switch(nt){case F.AH.MITER:if(K(tt.x,tt.y,-m.x,-m.y,0,-1),K(-tt.x,-tt.y,-m.x,-m.y,0,1),S)break;if(B){const $=o?0:wt;Mt=this._writeVertex(O,p,lt,rt,c.x,c.y,tt.x,tt.y,0,-1,$),gt=this._writeVertex(O,p,lt,rt,c.x,c.y,-tt.x,-tt.y,0,1,$)}break;case F.AH.BEVEL:{const $=et<0;let ut,G,Et,Lt;if($){const dt=Mt;Mt=gt,gt=dt,ut=Ot,G=At}else ut=At,G=Ot;if(A)Et=$?Z(this._innerPrev,m):k(this._innerPrev,m),Lt=$?k(this._innerNext,c):Z(this._innerNext,c);else{const dt=$?U(this._inner,tt):q(this._inner,tt);Et=dt,Lt=dt}const Bt=$?k(this._bevelStart,m):Z(this._bevelStart,m);K(Et.x,Et.y,-m.x,-m.y,ut.x,ut.y);const mt=K(Bt.x,Bt.y,-m.x,-m.y,G.x,G.y);if(S)break;const Wt=$?Z(this._bevelEnd,c):k(this._bevelEnd,c);if(A){const dt=this._writeVertex(O,p,lt,rt,-m.x,-m.y,0,0,0,0,wt);Mt=this._writeVertex(O,p,lt,rt,c.x,c.y,Lt.x,Lt.y,ut.x,ut.y,wt),gt=this._writeVertex(O,p,lt,rt,c.x,c.y,Wt.x,Wt.y,G.x,G.y,wt),this._writeTriangle(mt,dt,gt)}else{if(B){const dt=this._bevelMiddle;dt.x=(Bt.x+Wt.x)/2,dt.y=(Bt.y+Wt.y)/2,xt(yt,dt,-m.x,-m.y),K(dt.x,dt.y,-m.x,-m.y,yt.x,yt.y),xt(yt,dt,c.x,c.y),Mt=this._writeVertex(O,p,lt,rt,c.x,c.y,dt.x,dt.y,yt.x,yt.y,wt),gt=this._writeVertex(O,p,lt,rt,c.x,c.y,Lt.x,Lt.y,ut.x,ut.y,wt)}else{const dt=Mt;Mt=gt,gt=dt}K(Wt.x,Wt.y,c.x,c.y,G.x,G.y)}if($){const dt=Mt;Mt=gt,gt=dt}break}case F.AH.ROUND:{const $=et<0;let ut,G;if($){const Ut=Mt;Mt=gt,gt=Ut,ut=Ot,G=At}else ut=At,G=Ot;const Et=$?U(this._inner,tt):q(this._inner,tt);let Lt,Bt;A?(Lt=$?Z(this._innerPrev,m):k(this._innerPrev,m),Bt=$?k(this._innerNext,c):Z(this._innerNext,c)):(Lt=Et,Bt=Et);const mt=$?k(this._roundStart,m):Z(this._roundStart,m),Wt=$?Z(this._roundEnd,c):k(this._roundEnd,c),dt=K(Lt.x,Lt.y,-m.x,-m.y,ut.x,ut.y),Pt=K(mt.x,mt.y,-m.x,-m.y,G.x,G.y);if(S)break;const vt=this._writeVertex(O,p,lt,rt,-m.x,-m.y,0,0,0,0,wt);A||this._writeTriangle(Mt,gt,vt);const Dt=U(this._outer,Et),Ft=this._writeVertex(O,p,lt,rt,c.x,c.y,Wt.x,Wt.y,G.x,G.y,wt);let zt,Zt;const jt=C>2;if(jt){let Ut;C!==Number.MAX_VALUE?(Dt.x/=C,Dt.y/=C,Ut=b(m,Dt),Ut=(C*(Ut*Ut-1)+1)/Ut):Ut=-1,zt=$?k(this._startBreak,m):Z(this._startBreak,m),zt.x+=m.x*Ut,zt.y+=m.y*Ut,Zt=$?Z(this._endBreak,c):k(this._endBreak,c),Zt.x+=c.x*Ut,Zt.y+=c.y*Ut}xt(yt,Dt,-m.x,-m.y);const Qt=this._writeVertex(O,p,lt,rt,-m.x,-m.y,Dt.x,Dt.y,yt.x,yt.y,wt);xt(yt,Dt,c.x,c.y);const Gt=B?this._writeVertex(O,p,lt,rt,c.x,c.y,Dt.x,Dt.y,yt.x,yt.y,wt):Qt,re=vt,qt=B?this._writeVertex(O,p,lt,rt,c.x,c.y,0,0,0,0,wt):vt;let $t=-1,te=-1;if(jt&&(xt(yt,zt,-m.x,-m.y),$t=this._writeVertex(O,p,lt,rt,-m.x,-m.y,zt.x,zt.y,yt.x,yt.y,wt),xt(yt,Zt,c.x,c.y),te=this._writeVertex(O,p,lt,rt,c.x,c.y,Zt.x,Zt.y,yt.x,yt.y,wt)),B?jt?(this._writeTriangle(re,Pt,$t),this._writeTriangle(re,$t,Qt),this._writeTriangle(qt,Gt,te),this._writeTriangle(qt,te,Ft)):(this._writeTriangle(re,Pt,Qt),this._writeTriangle(qt,Gt,Ft)):jt?(this._writeTriangle(vt,Pt,$t),this._writeTriangle(vt,$t,te),this._writeTriangle(vt,te,Ft)):(this._writeTriangle(vt,Pt,Qt),this._writeTriangle(vt,Gt,Ft)),A?(Mt=this._writeVertex(O,p,lt,rt,c.x,c.y,Bt.x,Bt.y,ut.x,ut.y,wt),gt=Ft):(Mt=B?this._writeVertex(O,p,lt,rt,c.x,c.y,Bt.x,Bt.y,ut.x,ut.y,wt):dt,this._writeTriangle(Mt,qt,Ft),gt=Ft),$){const Ut=Mt;Mt=gt,gt=Ut}break}}}}}},55130:(Kt,St,f)=>{f.d(St,{_:()=>W}),f(9598);var ft=f(58098),k=(f(8480),f(79527),f(39351)),Z=f(99666),q=f(39406),U=f(87526);const j=new Map;j.set(q.LW.MARKER,{multiplier:1,indicesPerRecord:6,verticesPerRecord:4}),j.set(q.LW.LINE,{multiplier:1,indicesPerRecord:24,verticesPerRecord:8}),j.set(q.LW.FILL,{multiplier:1,indicesPerRecord:10,verticesPerRecord:10}),j.set(q.LW.TEXT,{multiplier:8,indicesPerRecord:6,verticesPerRecord:4}),j.set(q.LW.LABEL,{multiplier:8,indicesPerRecord:6,verticesPerRecord:4});var b=f(75734);class xt{constructor(p,Y,m){this._start={index:0,vertex:0};const c=function ot(O,p,Y){const{indicesPerRecord:m,multiplier:c,verticesPerRecord:H}=j.get(O);return{recordBytes:Y*k.T3*Uint32Array.BYTES_PER_ELEMENT,indexBytes:c*m*Y*Uint32Array.BYTES_PER_ELEMENT,vertexBytes:c*H*Y*p}}(p,Y,m),H=Y/4;this.geometryType=p,this._records=new b.Z(Int32Array,c.recordBytes),this._indices=new b.Z(Uint32Array,c.indexBytes),this._vertices=new b.Z(Uint32Array,c.vertexBytes),this._metrics=new b.Z(Float32Array,0),this._strideInt=H}serialize(p){const Y=this._records.buffer(),m=this._indices.buffer(),c=this._vertices.buffer(),H=this._metrics.length?this._metrics.buffer():null,_t=4*this._strideInt;return p.push(Y,m,c),{stride:_t,records:Y,indices:m,vertices:c,metrics:H}}get strideInt(){return this._strideInt}get recordCount(){return this._records.length/k.T3}get vertexCount(){return this._vertices.length/this._strideInt}get indexCount(){return this._indices.length}get indexWriter(){return this._indices}get vertexWriter(){return this._vertices}get metricWriter(){return this._metrics}vertexEnsureSize(p){this._vertices.ensureSize(p)}indexEnsureSize(p){this._indices.ensureSize(p)}recordStart(){this._start.index=this._indices.length,this._start.vertex=this._vertices.length}recordEnd(p,Y,m,c,H,_t,tt,lt){this._records.push(p),this._records.push(Y??0),this._records.push(m),this._records.push(c),this._records.push(H),this._records.push(_t),this._records.push(tt),this._records.writeF32(lt)}writeIndex(p){this._indices.push(p)}writeVertex(p){this._vertices.push(p)}writeVertexF32(p){this._vertices.writeF32(p)}copyLastFrom(p,Y,m){const c=p._records.length-k.T3,H=p._records.getValue(c),_t=p._records.getValue(c+1),tt=p._records.getValue(c+2),lt=p._records.getValue(c+4),rt=p._records.getValue(c+6),Ot=p._records.getValue(c+7),At=this._vertices.length,yt=(p._start.vertex-this._vertices.length)/this._strideInt,Mt=this._indices.length,gt=this.vertexCount;for(let Ct=p._start.index;Ct!==p._indices.length;Ct++){const wt=p._indices.getValue(Ct);this._indices.push(wt-yt)}for(let Ct=p._start.vertex;Ct!==p._vertices.length;Ct++){const wt=p._vertices.getValue(Ct);this._vertices.push(wt)}for(let Ct=At;Ct<=this._vertices.length;Ct+=this._strideInt)this._vertices.i1616Add(Ct,Y,m);this._records.push(H),this._records.push(_t),this._records.push(tt),this._records.push(Mt),this._records.push(lt),this._records.push(gt),this._records.push(rt),this._records.push(Ot)}}var J=f(55376);const P=1,a=2,u=4,T=8,Q=16,at=32,it=64,st=128;function d(O){switch(O){case P:case T:case at:return-1;case a:case it:return 0;case u:case Q:case st:return 1}}function _(O){switch(O){case P:case a:case u:return-1;case T:case Q:return 0;case at:case it:case st:return 1}}const v=P|T|at,E=u|Q|st,L=P|a|u,B=at|it|st;class W{constructor(p,Y,m,c,H,_t=0){this._hasAggregate=!1,this.hasRecords=!1,this._data={self:new Map,neighbors:new Array},this._version=0,this._current={geometryType:0,writer:null,overlaps:0,start:0,insertAfter:0,sortKey:0,id:0,materialKey:0,indexStart:0,vertStart:0,isDotDensity:!1,bufferingEnabled:!1,metricBoxLenPointer:0},this.hint=Y,this.tileKey=p,this._hasAggregate=c,this._pixelBufferEnabled=H,this._version=_t,this._symbologyType=m}get hasAggregates(){return this._hasAggregate}get hasPixelBufferEnabled(){return this._pixelBufferEnabled}serialize(p){const Y=[];return Y.push(this._serializeTileVertexData(this.tileKey,this.tileKey,this._data.self)),this._data.neighbors.forEach((m,c)=>{const H=1<<c,_t=d(H),tt=_(H),lt=(0,J.M)(new ft.Z(this.tileKey),_t,tt,p),rt=this._serializeTileVertexData(this.tileKey,lt.id,m.vertexData);rt.message.bufferIds=m.displayIds,Y.push(rt)}),Y}_serializeTileVertexData(p,Y,m){const c=new Array;return{message:{tileKeyOrigin:p,tileKey:Y,data:{[q.LW.MARKER]:m.get(q.LW.MARKER)?.serialize(c),[q.LW.FILL]:m.get(q.LW.FILL)?.serialize(c),[q.LW.LINE]:m.get(q.LW.LINE)?.serialize(c),[q.LW.TEXT]:m.get(q.LW.TEXT)?.serialize(c),[q.LW.LABEL]:m.get(q.LW.LABEL)?.serialize(c)},version:this._version},transferList:c}}featureStart(p,Y){this._current.insertAfter=p,this._current.sortKey=Y}featureEnd(){}recordStart(p,Y,m,c){this._current.writer=this._getVertexWriter(m),this._current.overlaps=0,this._current.indexStart=this._current.writer.indexCount,this._current.vertStart=this._current.writer.vertexCount,this._current.bufferingEnabled=c,this._current.id=p,this._current.materialKey=Y,this._current.geometryType=m,this._current.isDotDensity=!1,this._current.writer.recordStart()}recordCount(){return this._current.writer.recordCount}vertexCount(){return this._current.writer.vertexCount}indexCount(){return this._current.writer.indexCount}vertexEnsureSize(p){this._current.writer.vertexEnsureSize(p)}indexEnsureSize(p){this._current.writer.indexEnsureSize(p)}vertexBounds(p,Y,m,c){this._current.bufferingEnabled&&this._addOverlap(p,Y,m,c)}vertexWrite(p){this._current.writer.writeVertex(p)}vertexWriteF32(p){this._current.writer.writeVertexF32(p)}vertexEnd(){}vertexWriter(){return this._current.writer.vertexWriter}indexWrite(p){this._current.writer.writeIndex(p)}indexWriter(){return this._current.writer.indexWriter}metricWriter(){return this._current.writer.metricWriter}metricStart(p,Y,m,c,H,_t,tt,lt){this._current.writer=this._getVertexWriter(q.LW.LABEL);const rt=this._current.writer.metricWriter;rt.push((0,Z.jL)(p)),rt.push(Y),rt.push(m),rt.push(c),rt.push(H),rt.push(_t),rt.push(tt),rt.push(lt),rt.push(255),this._current.metricBoxLenPointer=rt.push(0)}metricEnd(){const p=this._current.writer.metricWriter;0===p.getValue(this._current.metricBoxLenPointer)&&p.seek(p.length-10)}metricBoxWrite(p,Y,m,c){const H=this._current.writer.metricWriter;H.incr(this._current.metricBoxLenPointer),H.push(0),H.push(0),H.push(p),H.push(Y),H.push(m),H.push(c)}recordEnd(){const p=this._current.vertStart,Y=this._current.writer.vertexCount-p;if(!Y)return!1;this.hasRecords=!0;const m=this._current.indexStart;if(this._current.writer.recordEnd(this._current.id,this._current.materialKey,this._current.insertAfter,m,this._current.writer.indexCount-m,p,Y,this._current.sortKey),!this._pixelBufferEnabled||this._hasAggregate||0===this._current.overlaps||this._current.geometryType===q.LW.LABEL)return!0;const H=this._current.writer;for(let _t=0;_t<8;_t++){const tt=1<<_t;if(this._current.overlaps&tt){this._data.neighbors[_t]||(this._data.neighbors[_t]={vertexData:new Map,displayIds:new Set});const lt=this._data.neighbors[_t],rt=this._current.geometryType;if(!lt.vertexData.has(rt)){const gt=(0,U.$_)(rt,this._symbologyType).geometry,Ct=new xt(rt,gt,k.Cj);lt.vertexData.set(rt,Ct)}const Ot=lt.vertexData.get(this._current.geometryType),At=8,yt=512*-d(tt)*At,Mt=512*-_(tt)*At;Ot?.copyLastFrom(H,yt,Mt),lt.displayIds.add(this._current.id)}}return!0}_addOverlap(p,Y,m,c){this._current.overlaps|=255^((p<0+m?E:p>=k.i9-m?v:E|v)|(Y<0+c?B:Y>=k.i9-c?L:B|L))}_getVertexWriter(p){if(!this._data.self.has(p)){const Y=this._data.self,m=(0,U.$_)(p,this._symbologyType).geometry;Y.set(p,new xt(p,m,this.hint.records))}return this._data.self.get(p)}}},246:(Kt,St,f)=>{f.d(St,{j:()=>ee});var F=f(15861),pt=(f(8314),f(10699)),V=f(58774),k=f(99666),Z=f(26584),q=f(63290),U=f(21286),j=f(23841),ot=f(31478),b=f(12225),xt=f(7547),J=f(61261),P=f(81295),a=f(39351),u=f(39406),T=f(5254),Q=f(18716),at=f(50114);function st(K){return K.length-1}function _(K,o,g=1){const[x,S]=function it(K,o){return K[o+1]}(K,o);return Math.sqrt(x*x+S*S)*g}class v{constructor(o,g,x,S,C){this._segments=o,this._index=g,this._distance=x,this._xStart=S,this._yStart=C,this._done=!1}static create(o){return new v(o,0,0,o[0][0],o[0][1])}clone(){return new v(this._segments,this._index,this._distance,this.xStart,this.yStart)}equals(o){return this._index===o._index||o._index===this._index-1&&(0===this._distance||1===o._distance)||o._index===this._index+1&&(1===this._distance||0===o._distance)}leq(o){return this._index<o._index||this._index===o._index&&this._distance<=o._distance}geq(o){return this._index>o._index||this._index===o._index&&this._distance>=o._distance}get _segment(){return this._segments[this._index+1]}get angle(){const o=this.dy;let x=Math.acos((0*o+-1*-this.dx)/(1*this.length));return o>0&&(x=2*Math.PI-x),x}get xStart(){return this._xStart}get yStart(){return this._yStart}get x(){return this.xStart+this.distance*this.dx}get y(){return this.yStart+this.distance*this.dy}get dx(){return this._segment[0]}get dy(){return this._segment[1]}get xMidpoint(){return this.xStart+.5*this.dx}get yMidpoint(){return this.yStart+.5*this.dy}get xEnd(){return this.xStart+this.dx}get yEnd(){return this.yStart+this.dy}get length(){const{dx:o,dy:g}=this;return Math.sqrt(o*o+g*g)}get remainingLength(){return this.length*(1-this._distance)}get backwardLength(){return this.length*this._distance}get distance(){return this._distance}get done(){return this._done}hasPrev(){return this._index-1>=0}hasNext(){return this._index+1<st(this._segments)}next(){return this.hasNext()?(this._xStart+=this.dx,this._yStart+=this.dy,this._distance=0,this._index+=1,this):null}prev(){return this.hasPrev()?(this._index-=1,this._xStart-=this.dx,this._yStart-=this.dy,this._distance=1,this):(this._done=!0,null)}_seekBackwards(o,g){const x=this.backwardLength;if(o<=x)return this._distance=(x-o)/this.length,this;let S=this.backwardLength;for(;this.prev();){if(S+this.length>o)return this._seekBackwards(o-S);S+=this.length}return this._distance=0,g?this:null}seek(o,g=!1){if(o<0)return this._seekBackwards(Math.abs(o),g);if(o<=this.remainingLength)return this._distance=(this.backwardLength+o)/this.length,this;let x=this.remainingLength;for(;this.next();){if(x+this.length>o)return this.seek(o-x,g);x+=this.length}return this._distance=1,g?this:null}}function E(K,o,g,x=!0){const S=function d(K){let o=0;for(let g=0;g<st(K);g++)o+=_(K,g);return o}(K),C=v.create(K),A=S/2;if(!x)return C.seek(A),void g(C.clone(),0,A+0*o,S);const et=Math.max((S-o)/2,0),nt=Math.floor(et/o);C.seek(A-nt*o);for(let ut=-nt;ut<=nt;ut++)C.x<512&&C.x>=0&&C.y<512&&C.y>=0&&g(C.clone(),ut,A+ut*o,S),C.seek(o)}function O(K,o){if(o<=0)return;const x=K.length;if(x<3)return;const S=[];let C=0;S.push(0);for(let G=1;G<x;G++)C+=(0,at.TK)(K[G],K[G-1]),S.push(C);o=Math.min(o,.2*C);const A=[];A.push(K[0][0]),A.push(K[0][1]);const et=K[x-1][0],nt=K[x-1][1],$=(0,at.lu)([0,0],K[0],K[1]);(0,at.Fv)($),K[0][0]+=o*$[0],K[0][1]+=o*$[1],(0,at.lu)($,K[x-1],K[x-2]),(0,at.Fv)($),K[x-1][0]+=o*$[0],K[x-1][1]+=o*$[1];for(let G=1;G<x;G++)S[G]+=o;S[x-1]+=o;const ut=.5*o;for(let G=1;G<x-1;G++){let Et=0,Lt=0,Bt=0;for(let mt=G-1;mt>=0&&!(S[mt+1]<S[G]-ut);mt--){const Wt=ut+S[mt+1]-S[G],dt=S[mt+1]-S[mt],Pt=S[G]-S[mt]<ut?1:Wt/dt;if(Math.abs(Pt)<1e-6)break;const vt=Pt*Pt,Dt=Pt*Wt-.5*vt*dt,Ft=Pt*dt/o,zt=K[mt+1],Zt=K[mt][0]-zt[0],jt=K[mt][1]-zt[1];Et+=Ft/Dt*(zt[0]*Pt*Wt+.5*vt*(Wt*Zt-dt*zt[0])-vt*Pt*dt*Zt/3),Lt+=Ft/Dt*(zt[1]*Pt*Wt+.5*vt*(Wt*jt-dt*zt[1])-vt*Pt*dt*jt/3),Bt+=Ft}for(let mt=G+1;mt<x&&!(S[mt-1]>S[G]+ut);mt++){const Wt=ut-S[mt-1]+S[G],dt=S[mt]-S[mt-1],Pt=S[mt]-S[G]<ut?1:Wt/dt;if(Math.abs(Pt)<1e-6)break;const vt=Pt*Pt,Dt=Pt*Wt-.5*vt*dt,Ft=Pt*dt/o,zt=K[mt-1],Zt=K[mt][0]-zt[0],jt=K[mt][1]-zt[1];Et+=Ft/Dt*(zt[0]*Pt*Wt+.5*vt*(Wt*Zt-dt*zt[0])-vt*Pt*dt*Zt/3),Lt+=Ft/Dt*(zt[1]*Pt*Wt+.5*vt*(Wt*jt-dt*zt[1])-vt*Pt*dt*jt/3),Bt+=Ft}A.push(Et/Bt),A.push(Lt/Bt)}A.push(et),A.push(nt);for(let G=0,Et=0;G<x;G++)K[G][0]=A[Et++],K[G][1]=A[Et++]}var p=f(51919);const Y=q.Z.getLogger("esri.views.2d.engine.webgl.WGLLabelTemplate"),At=function Ot(K){const o=new Map;return g=>(o.has(g)||o.set(g,K(g)),o.get(g))}(K=>{let o=0;if(0===K)return 1/0;for(;!(K%2);)o++,K/=2;return o}),yt=K=>Math.floor(127*K+127),Mt=K=>Math.floor(K*a.JS),gt=K=>Math.round(K*(254/360));class Ct extends p.Z{constructor(o,g,x,S){super(o,x.font?.size,x.haloSize||0,x.font?.size,x.color&&(0,P.aH)(x.color)||0,x.haloColor&&(0,P.aH)(x.haloColor)||0,x.horizontalAlignment,x.verticalAlignment,(0,J.NS)(g.labelPlacement)?xt.v2.MAP:xt.v2.SCREEN,x.font?.decoration,!1,x.angle||0,x.xoffset,x.yoffset,x.lineWidth,x.lineHeight,null,null,!1,null,null,x.backgroundColor&&(0,P.aH)(x.backgroundColor),x.borderLineColor&&(0,P.aH)(x.borderLineColor),x.borderLineSize),this._outLineLabelAngle=0,this._refPlacementPadding=0,this._refPlacementDirX=0,this._refPlacementDirY=0,this._refOffsetX=0,this._refOffsetY=0,this._zoomLevel=0,this.geometryType=u.LW.LABEL,this._allowOverrun=g.allowOverrun??!1,this._repeatLabel=g.repeatLabel??!0,this._labelPosition=g.labelPosition??"curved";const C=function lt(K,o){const g=!!K.minScale&&o.scaleToZoom(K.minScale)||0;return(0,U.uZ)(g,0,25.5)}(g,S),A=function rt(K,o){const g=!!K.maxScale&&o.scaleToZoom(K.maxScale)||255;return(0,U.uZ)(g,0,25.5)}(g,S),et=g.labelPlacement,[nt,$]=(0,J.qv)(et);this._xAlignD=nt,this._yAlignD=$,this._minZoom=C,this._maxZoom=A,this._minBackgroundZoom=C,this._maxBackgroundZoom=A,this._refPlacementPadding=(0,j.F2)(x.haloSize)+a.XT,this._repeatLabelDistance=g.repeatLabelDistance?(0,j.F2)(g.repeatLabelDistance):128;const ut=Q.Gq.load(o);ut.sdf=!0,this._materialKey=ut.data}static fromLabelClass(o,g){if("esriServerLinePlacementCenterAlong"===o.labelPlacement){const x=o.symbol;x.xoffset=0,x.yoffset=0,x.angle=0,x.font.decoration="none"}return new Ct(o.materialKey,o,o.symbol,g)}get _shapedBox(){return this._shapingInfo.bounds}setZoomLevel(o){this._zoomLevel=o}bindReferenceTemplate(o){let g=(0,J.g)(this._xAlignD),x=(0,J.tf)(this._yAlignD);if(this._refOffsetX=0,this._refOffsetY=0,null==o)return void(this._refSymbolAndPlacementOffset=(0,T.Jz)(0,0,yt(g),yt(x)));if("circle"===o.boundsType&&(g||x)){const A=Math.sqrt(g*g+x*x);g/=A,x/=A}const S=Math.max(o.height,o.width);this._refSymbolAndPlacementOffset=(0,T.Jz)(4*this._refPlacementPadding,S,yt(g),yt(x)),this._referenceSize=S,this._refPlacementDirX=g,this._refPlacementDirY=x,this._refOffsetX=o.xOffset,this._refOffsetY=o.yOffset}_write(o,g){if(null==this._shapingInfo)return;const x=this._shapingInfo,S=g.getDisplayId(),C="esriGeometryPolygon"===g.geometryType?g.readLegacyCentroid():g.readLegacyGeometry();if(C)switch(this._current={out:o,inId:S,inShaping:x,zoomLevel:this._zoomLevel},"esriGeometryPolyline"===g.geometryType&&"curved"===this._labelPosition&&(this._borderLineColor||this._backgroundColor)&&Y.warnOnce("TextSymbol properties 'borderLineColor', 'borderLineSize', and 'backgroundColor' are not supported in curved labels"),g.geometryType){case"esriGeometryPolyline":this._placeLineLabels(C);break;case"esriGeometryPoint":case"esriGeometryPolygon":this._placePointLabels(C);break;default:((K,o="mapview-labeling")=>{Y.error(new Z.Z(o,K))})(`Geometry of type ${g.geometryType} is not supported`)}}_isVisible(o,g){const x=Mt(this._current.zoomLevel);return Mt(o)<=x&&x<=Mt(g)}_placePointLabels(o){const{out:g,inId:x,inShaping:S}=this._current;this._writeGlyphs(g,x,o,S)}_placeLineLabels(o){const g=function W(K,o){const g=o;for(let x=0;x<K.length;x++){let S=K[x];O(S,g);const C=[];C.push(S[0]);for(let A=1;A<S.length;A++){const[et,nt]=S[A-1],[$,ut]=S[A],G=Math.round($-et),Et=Math.round(ut-nt);C.push([G,Et])}K[x]=C,S=C}return K}(o.paths,this._current.inShaping.bounds.width),x=this._placeSubdivGlyphs.bind(this),S=(this._shapedBox.width+this._repeatLabelDistance)/2;for(const C of g)E(C,S,x,this._repeatLabel)}_placeSubdivGlyphs(o,g,x,S){const C=At(g),A=this._shapedBox.width/2,et=Math.sqrt(this._repeatLabelDistance)/2,nt=Math.min(x,S-x),$=this._current.inShaping.isMultiline?25:Math.log2(nt/(et+A/2)),ut=0===g?$:Math.min(C,$),G=Math.max(this._minZoom,this._current.zoomLevel+1-ut),Et=this._current.zoomLevel-G,Lt=this._shapedBox.width/2*2**Et;this._current.inShaping.isMultiline?0===g&&this._placeStraight(o,G):this._allowOverrun&&Et<0?this._placeStraightAlong(o,this._minZoom):"parallel"===this._labelPosition?this._placeStraightAlong(o,G):"curved"===this._labelPosition&&this._placeCurved(o,G,Lt)}_placeStraight(o,g){const{out:x,inId:S,inShaping:C}=this._current,A=Math.ceil(o.angle*(180/Math.PI)%360),et=Math.ceil((o.angle*(180/Math.PI)+180)%360);this._outLineLabelAngle=gt(A),this._writeGlyphs(x,S,o,C,g),this._outLineLabelAngle=gt(et),this._writeGlyphs(x,S,o,C,g)}_placeCurved(o,g,x){const{out:S,inId:C}=this._current;S.metricStart(C,g,o.x,o.y,0,0,0,0);const A=o.clone(),et=o.angle*(180/Math.PI)%360,nt=(o.angle*(180/Math.PI)+180)%360;this._outLineLabelAngle=gt(et),this._placeFirst(A,g,1),this._placeBack(o,A,g,x,1),this._placeForward(o,A,g,x,1),this._outLineLabelAngle=gt(nt),this._placeFirst(A,g,0),this._placeBack(o,A,g,x,0),this._placeForward(o,A,g,x,0),S.metricEnd()}_placeStraightAlong(o,g){const{out:x,inId:S,inShaping:C}=this._current;x.metricStart(S,g,o.x,o.y,0,0,0,0);const A=o.clone(),et=o.angle*(180/Math.PI)%360,nt=(o.angle*(180/Math.PI)+180)%360,$=C.glyphs.length>0&&(this._borderLineColor||this._backgroundColor);if(this._maxBackgroundZoom=25,this._minBackgroundZoom=Math.max(g,0),$){const ut=Q.Gq.load(this._materialKey);ut.textureBinding=C.glyphs[0].textureBinding;const G=(0,ot.b)((0,b.c)(),-o.angle),[Et,Lt]=C.shapeBackground(G);this._outLineLabelAngle=gt(et),x.recordStart(S,ut.data,this.geometryType,!0),this._writeBackgroundGeometry(x,S,o,Et,Lt),x.recordEnd(),this._outLineLabelAngle=gt(nt),x.recordStart(S,ut.data,this.geometryType,!0),this._writeBackgroundGeometry(x,S,o,Et,Lt),x.recordEnd()}this._outLineLabelAngle=gt(et),this._placeFirst(A,g,1,!0),this._outLineLabelAngle=gt(nt),this._placeFirst(A,g,0,!0),x.metricEnd()}_placeBack(o,g,x,S,C){const A=o.clone();let et=o.backwardLength+0;for(;A.prev()&&!(et>=S);)this._placeOnSegment(A,g,et,x,-1,C),et+=A.length+0}_placeForward(o,g,x,S,C){const A=o.clone();let et=o.remainingLength+0;for(;A.next()&&!(et>=S);)this._placeOnSegment(A,g,et,x,1,C),et+=A.length+0}_placeFirst(o,g,x,S=!1){const C=o,A=this._current.inShaping,et=A.glyphs,nt=this._current.zoomLevel,{out:$,inId:ut}=this._current;for(const G of et){const Et=G.x>A.bounds.x?x:1-x,Lt=Et*o.remainingLength+(1-Et)*o.backwardLength,Bt=Math.abs(G.x+G.width/2-A.bounds.x),mt=Math.max(0,nt+Math.log2(Bt/(Lt+0))),Wt=Math.max(g,S?0:mt);if(G.maxZoom=25,G.angle=o.angle+(1-x)*Math.PI,G.minZoom=Wt,this._writeGlyph($,ut,C.x,C.y,G),x&&this._isVisible(G.minZoom,G.maxZoom)){const dt=G.bounds;$.metricBoxWrite(dt.center[0],dt.center[1],dt.width,dt.height)}}}_placeOnSegment(o,g,x,S,C,A){const et=this._current.inShaping.glyphs,{out:nt,inId:$}=this._current,ut=this._current.inShaping,G=this._current.zoomLevel,Bt={x:o.x+x*-C*(o.dx/o.length),y:o.y+x*-C*(o.dy/o.length)};for(const mt of et){const Wt=mt.x>ut.bounds.x?A:1-A;if(!(Wt&&1===C||!Wt&&-1===C))continue;const dt=Math.abs(mt.x+mt.width/2-ut.bounds.x),Pt=Math.max(0,G+Math.log2(dt/x)-.1),vt=Math.max(S,G+Math.log2(dt/(x+o.length+0)));if(0!==Pt&&(mt.angle=o.angle+(1-A)*Math.PI,mt.minZoom=vt,mt.maxZoom=Pt,this._writeGlyph(nt,$,Bt.x,Bt.y,mt),A&&this._isVisible(mt.minZoom,mt.maxZoom))){const Dt=mt.bounds;nt.metricBoxWrite(Dt.center[0]+(o.x-g.x),Dt.center[1]+(o.y-g.y),Dt.width,Dt.height)}}}_writeGlyphs(o,g,x,S,C=this._minZoom){if(x.x<0||x.x>=512||x.y<0||x.y>=512)return;if(S.glyphs.length>0&&(this._borderLineColor||this._backgroundColor)){const G=Q.Gq.load(this._materialKey);G.textureBinding=S.glyphs[0].textureBinding,o.recordStart(g,G.data,this.geometryType,!0),this._writeBackgroundGeometry(o,g,x,S.bounds,S.background),o.recordEnd()}const A=x.x+this._refOffsetX,et=x.y-this._refOffsetY;for(const G of S.glyphs)G.minZoom=C,G.maxZoom=this._maxZoom,this._writeGlyph(o,g,A,et,G);const ut=S.boundsT;o.metricStart(g,C,A,et,this._refPlacementDirX,this._refPlacementDirY,this._referenceSize,this._materialKey),o.metricBoxWrite(ut.center[0],ut.center[1],ut.width,ut.height),o.metricEnd()}_writeVertexCommon(o,g,x,S){const C=this._color,A=this._haloColor,et=(0,T.Jz)(0,0,this._size,this._haloSize),nt=Math.max(S.minZoom,this._minZoom),$=Math.min(S.maxZoom,this._maxZoom),ut=(0,T.Jz)(Mt(nt),Mt($),this._outLineLabelAngle,0);o.vertexWrite(x),o.vertexWrite(g),o.vertexWrite(C),o.vertexWrite(A),o.vertexWrite(et),o.vertexWrite(this._refSymbolAndPlacementOffset),o.vertexWrite(ut)}_writeBackgroundVertex(o,g,x,S,C,A){const et=(0,T.Jz)(0,0,this._size,this._haloSize),nt=(0,T.Jz)(0,0,0,0),$=(0,T.Jz)(Mt(this._minBackgroundZoom),Mt(this._maxBackgroundZoom),this._outLineLabelAngle,1);o.vertexWrite(x),o.vertexWrite(g),o.vertexWrite(S),o.vertexWrite(nt),o.vertexWrite(et),o.vertexWrite(this._refSymbolAndPlacementOffset),o.vertexWrite($),o.vertexWrite(C),o.vertexWrite(A),o.vertexEnd()}}var wt=f(18752),Yt=f(1825);class ee{constructor(o,g,x){this._geometryType=o,this._idField=g,this._templateStore=x}update(o,g){null!=o.mesh.labels&&(this._labelTemplates=this._createLabelTemplates(o.mesh.labels,g)),this._schema=o}_createLabelTemplates(o,g){const x=new Map;if("simple"===o.type){for(const S of o.classes){const C=Ct.fromLabelClass(S,g);x.set(S.index,C)}return x}for(const S in o.classes){const C=o.classes[S];for(const A of C){const et=Ct.fromLabelClass(A,g);x.set(A.index,et)}}return x}get templates(){return this._templateStore}analyze(o,g,x,S,C,A,et){var nt=this;return(0,F.Z)(function*(){if((0,pt.Hc)(et))return;let $;"dictionary"===x?.type&&($=yield x.analyze(nt._idField,o.copy(),g,C,A,et));let ut=0;for(;o.next();){let G=null;if(G=$?$[ut++]:null!=S&&(0,k.nE)(o.getDisplayId())&&1!==o.readAttribute("cluster_count")?S.match(nt._idField,o,nt._geometryType,C,A):x.match(nt._idField,o,nt._geometryType,C,A),o.setGroupId(G),(0,Yt.Sl)(G)){const Et=nt._templateStore.getDynamicTemplateGroup(G).templates;for(const Lt of Et)Lt&&Lt.analyze&&Lt.analyze(nt._templateStore,o,C,A)}}return yield(0,V.j)(),nt._templateStore.finalize(et)})()}analyzeGraphics(o,g,x,S,C,A){var et=this;return(0,F.Z)(function*(){if((0,pt.Hc)(A))return;const nt=o.getCursor();for(x&&(yield x.analyze(et._idField,nt.copy(),g,S,C,A));nt.next();){let $=nt.getGroupId();if(null!=$&&-1!==$||($=x?.match(et._idField,nt,nt.geometryType,S,C),nt.setGroupId($)),(0,Yt.Sl)($)){const ut=et._templateStore.getDynamicTemplateGroup($).templates;for(const G of ut)G&&G.analyze&&G.analyze(et._templateStore,nt,S,C)}nt.setGroupId($)}return yield(0,V.j)(),et._templateStore.finalize(A)})()}writeGraphic(o,g,x,S){const C=g.getGroupId(),A=g.getDisplayId(),et=this._templateStore.getTemplateGroup(C);if(o.featureStart(g.insertAfter,0),null!=A){if((0,Yt.Sl)(C))for(const nt of et.templates)nt&&nt.bindFeature(g,null,null);if(et){for(const nt of et.templates)nt&&nt.write(o,g,x,S);o.featureEnd()}}}writeCursor(o,g,x,S,C,A,et){const nt=g.getGroupId(),$=g.getDisplayId(),ut=this._templateStore.getTemplateGroup(nt),G=ut.templates,Et=this._getSortKeyValue(g,ut);if(o.featureStart(0,Et),null!=$&&G){if((0,Yt.Sl)(nt))for(const Lt of G)Lt.bindFeature(g,x,S);for(const Lt of G)Lt.write(o,g,C,et);if(G.length&&null!=A){const Lt=A&&this._findLabelRef(G);this._writeLabels(o,g,A,Lt,C,et)}o.featureEnd()}}_getSortKeyValue(o,g){const x=this._schema.mesh.sortKey;if(null==x)return 0;let S=0;return S=!0===x.byRenderer&&null!=g.sortKey?g.sortKey:null!=x.fieldIndex?o.getComputedNumericAtIndex(x.fieldIndex):o.readAttribute(null!=x.field?x.field:this._idField),S*="asc"===x.order?1:-1,null==S||isNaN(S)?0:S}_findLabelRef(o){for(const g of o)if(g instanceof wt.Z)return g;return null}_writeLabels(o,g,x,S,C,A){for(const et of x)if(null!=et&&et){const{glyphs:nt,rtl:$,index:ut}=et,G=this._labelTemplates.get(ut);if(!G)continue;G.setZoomLevel(C),G.bindReferenceTemplate(S),G.bindTextInfo(nt,$),G.write(o,g,null,A)}}}},88337:(Kt,St,f)=>{f.d(St,{Z:()=>P});var F=f(23841),ft=f(31478),pt=f(12225),V=f(67831),k=f(9545),Z=f(33359),q=f(25293),U=f(39351),j=f(39406),ot=f(5254),b=f(18716);const xt=3.14159265359/180,P=a=>class extends a{constructor(...u){super(...u),this.angle=0,this.xOffset=0,this.yOffset=0,this.width=0,this.height=0,this.boundsType="square",this._anchorX=0,this._anchorY=0,this._computedWidth=0,this._computedHeight=0,this._allowBorrowing=!0,this._vertexBoundsScaleX=1,this._vertexBoundsScaleY=1,this.geometryType=j.LW.MARKER}_write(u,T,Q,at){const it=T.getDisplayId();u.recordStart(it,this._materialKey,this.geometryType,!0),this._writeGeometry(u,T,it,Q,at),u.recordEnd()}_writeGeometry(u,T,Q,at,it){if(null!=this._markerPlacement)return this._writePlacedMarkers(u,T,at,it);if(this._allowBorrowing=!0,!it&&"esriGeometryPoint"===T.geometryType){const d=T.getX(),_=T.getY();return!u.hasAggregates&&u.hasPixelBufferEnabled&&(d<0||d>=513||_<0||_>=513)?void 0:this._writeVertices(u,Q,this._getPos(d,_),d,_)}const st=it?it.asOptimized():"esriGeometryPolygon"===T.geometryType?T.readCentroid():T.readGeometryForDisplay();if(null!=st){if(st.isPoint){const[d,_]=st.coords;return!u.hasAggregates&&u.hasPixelBufferEnabled&&(d<0||d>=512||_<0||_>=512)?void 0:this._writeVertices(u,Q,this._getPos(d,_),d,_)}st.forEachVertex((d,_)=>{const v=2*U.i9;d<-v||d>=v||_<-v||_>=v||this._writeVertices(u,Q,this._getPos(d,_),d,_)})}}_writePlacedMarkers(u,T,Q,at){const it=at||Z.z.fromFeatureSetReaderCIM(T);if(!it)return;const d=q.i.getPlacement(it,-1,this._markerPlacement,(0,F.F2)(1),u.tileKey,Q.geometryEngine);if(!d)return;this._allowBorrowing="esriGeometryPolygon"!==T.geometryType;const _=T.getDisplayId(),v=(0,k.c)(),E=(0,pt.c)();let W=d.next();for(;null!=W;){const O=W.tx,p=-W.ty;O>=-128&&O<=640&&p>=-128&&p<=640&&(this._applyTransformation(E,v,-W.getAngle()/xt),this._writeVertices(u,_,this._getPos(O,p),O,p)),W=d.next()}}_writeVertices(u,T,Q,at,it){const st=b.mE.load(this._materialKey);return st.symbologyType===j.mD.HEATMAP?this._writeHeatmapVertices(u,T,Q):this._writeMarkerVertices(u,T,st,Q,at,it)}_writeMarkerVertices(u,T,Q,at,it,st){const d=Q.vvRotation,_=u.vertexCount();let v=this._computedWidth*this._vertexBoundsScaleX,E=this._computedHeight*this._vertexBoundsScaleY;if(this.angle){const L=Math.max(v,E);v=L,E=L}if(d){const L=Math.max(this.xOffset,this.yOffset);v+=L,E+=L}this._allowBorrowing&&u.vertexBounds(it+this.xOffset,st-this.yOffset,v,E),u.vertexWrite(at),u.vertexWrite(this._offsetUpperLeft),u.vertexWrite(this._texUpperLeft),u.vertexWrite(this._bitestAndDistRatio),u.vertexWrite(T),u.vertexWrite(this._fillColor),u.vertexWrite(this._outlineColor),u.vertexWrite(this._sizeOutlineWidth),u.vertexWrite(this._minMaxZoom),u.vertexEnd(),u.vertexWrite(at),u.vertexWrite(this._offsetUpperRight),u.vertexWrite(this._texUpperRight),u.vertexWrite(this._bitestAndDistRatio),u.vertexWrite(T),u.vertexWrite(this._fillColor),u.vertexWrite(this._outlineColor),u.vertexWrite(this._sizeOutlineWidth),u.vertexWrite(this._minMaxZoom),u.vertexEnd(),u.vertexWrite(at),u.vertexWrite(this._offsetBottomLeft),u.vertexWrite(this._texBottomLeft),u.vertexWrite(this._bitestAndDistRatio),u.vertexWrite(T),u.vertexWrite(this._fillColor),u.vertexWrite(this._outlineColor),u.vertexWrite(this._sizeOutlineWidth),u.vertexWrite(this._minMaxZoom),u.vertexEnd(),u.vertexWrite(at),u.vertexWrite(this._offsetBottomRight),u.vertexWrite(this._texBottomRight),u.vertexWrite(this._bitestAndDistRatio),u.vertexWrite(T),u.vertexWrite(this._fillColor),u.vertexWrite(this._outlineColor),u.vertexWrite(this._sizeOutlineWidth),u.vertexWrite(this._minMaxZoom),u.vertexEnd(),this._writeIndices(u,_)}_writeHeatmapVertices(u,T,Q){const at=u.vertexCount();u.vertexWrite(Q),u.vertexWrite(this._offsetUpperLeft),u.vertexWrite(T),u.vertexEnd(),u.vertexWrite(Q),u.vertexWrite(this._offsetUpperRight),u.vertexWrite(T),u.vertexEnd(),u.vertexWrite(Q),u.vertexWrite(this._offsetBottomLeft),u.vertexWrite(T),u.vertexEnd(),u.vertexWrite(Q),u.vertexWrite(this._offsetBottomRight),u.vertexWrite(T),u.vertexEnd(),this._writeIndices(u,at)}_writeIndices(u,T){u.indexWrite(T+0),u.indexWrite(T+1),u.indexWrite(T+2),u.indexWrite(T+1),u.indexWrite(T+3),u.indexWrite(T+2)}_applyTransformation(u,T,Q=0){Q?(0,ft.b)(u,xt*Q):(0,ft.c)(u),(0,ft.t)(u,u,(0,k.f)(this.xOffset,-this.yOffset)),this.angle&&(0,ft.r)(u,u,xt*this.angle);const at=this._computedWidth,it=this._computedHeight,st=-(.5+this._anchorX)*at,d=-(.5-this._anchorY)*it;(0,V.s)(T,st,d),(0,V.t)(T,T,u),this._offsetUpperLeft=(0,ot.UJ)(16*T[0],16*T[1]),(0,V.s)(T,st+at,d),(0,V.t)(T,T,u),this._offsetUpperRight=(0,ot.UJ)(16*T[0],16*T[1]),(0,V.s)(T,st,d+it),(0,V.t)(T,T,u),this._offsetBottomLeft=(0,ot.UJ)(16*T[0],16*T[1]),(0,V.s)(T,st+at,d+it),(0,V.t)(T,T,u),this._offsetBottomRight=(0,ot.UJ)(16*T[0],16*T[1])}_computeSize(u,T,Q,at,it,st,d,_){const v=u*Q,E=T*Q;if(st.sdf&&!d){const rt=T,Ot=at+2;u=Math.min((_&&u>T?v:u)+Ot,v),T=Math.min(rt+Ot,E)}else u=v,T=E;const L=U.qu/Math.max(v,E),B=.5*(v-u)*L,W=.5*(E-T)*L,O=st.rect.x+U.s4+B,p=st.rect.y+U.s4+W,Y=O+st.width-2*B,m=p+st.height-2*W,c=Math.floor(O),H=Math.floor(p),_t=Math.ceil(Y),tt=Math.ceil(m);u*=(_t-c)/(Y-O),T*=(tt-H)/(m-p),this._texUpperLeft=(0,ot.UJ)(c,H),this._texUpperRight=(0,ot.UJ)(_t,H),this._texBottomLeft=(0,ot.UJ)(c,tt),this._texBottomRight=(0,ot.UJ)(_t,tt),this._anchorX*=v/u,this._anchorY*=E/T,T*=it,this._computedWidth=u*=it,this._computedHeight=T}_getPos(u,T){return(0,ot.UJ)(Math.round(8*u),Math.round(8*T))}}},44526:(Kt,St,f)=>{f.d(St,{Z:()=>it});var F=f(23841),ft=f(33359),pt=f(25293),V=f(39351),k=f(39406),Z=f(5254),q=f(18716),U=f(25797);const ot=(0,Z.UJ)(4,4),b=(0,Z.UJ)(16,4),xt=(0,Z.UJ)(4,2),J=(0,Z.UJ)(4,6),P=[xt,xt,J,J],a=[xt,J,xt,J],u=[J,J,ot,ot],T=[ot,ot,J,J],Q=[J,ot,J,ot],at=[ot,J,ot,J],it=st=>class extends st{constructor(...d){super(...d),this._isCIM=!1,this._vertexBoundsScale=1,this.geometryType=k.LW.TEXT,this._aux=(0,Z.Jz)(0,0,this._referenceSize,this._bitset)}bindTextInfo(d,_){this._shapingInfo=d?.length?(0,U.Nr)(d,_,{scale:this._scale,angle:this._angle,xOffset:this._xOffset,yOffset:this._yOffset,hAlign:this._xAlignD,vAlign:this._yAlignD,maxLineWidth:Math.max(32,Math.min(this._lineWidth,512)),lineHeight:V.uk*Math.max(.25,Math.min(this._lineHeight,4)),decoration:this._decoration,isCIM:this._isCIM,hasBackground:!!this._backgroundColor,borderLineSize:this._borderLineSize}):null}_write(d,_,v,E){const L=_.getDisplayId();this._writeGeometry(d,_,L,v,E)}_writeGeometry(d,_,v,E,L){const B=this._shapingInfo;if(null==B)return;if(this._textPlacement)return this._writePlacedText(d,v,B,E,_,L);const W=L?L.asOptimized():"esriGeometryPolygon"===_.geometryType?_.readCentroid():_.readGeometryForDisplay();if(null!=W){if(W.isPoint){const[O,p]=W.coords;return!d.hasAggregates&&d.hasPixelBufferEnabled&&(O<0||O>=512||p<0||p>=512)?void 0:this._writeGlyphs(d,v,{x:O,y:p},B)}W.forEachVertex((O,p)=>this._writeGlyphs(d,v,{x:O,y:p},B))}}_writePlacedText(d,_,v,E,L,B){const W=this._textPlacement,O=B||ft.z.fromFeatureSetReaderCIM(L);if(!O)return;const Y=pt.i.getPlacement(O,-1,W,(0,F.F2)(1),d.tileKey,E.geometryEngine);if(!Y)return;const m=v.bounds,c=Math.sqrt(m.height*m.height+m.width*m.width);let H,_t,tt;for(;H=Y.next();)if(_t=H.tx,tt=-H.ty,_t+c>=0&&_t-c<512&&tt+c>=0&&tt-c<512){const lt=-H.getAngle();v.setRotation(lt),this._writeGlyphs(d,_,{x:_t,y:tt},v),v.setRotation(-lt)}}_writeGlyphs(d,_,v,E){const L=q.m2.load(this._materialKey),B=(0,Z.UJ)(Math.round(8*v.x),Math.round(8*v.y)),W=this._vertexBoundsScale,{bounds:O,background:p,glyphs:Y}=E;Y.length>0&&(this._borderLineColor||this._backgroundColor)&&(L.textureBinding=Y[0].textureBinding,d.recordStart(_,L.data,this.geometryType,!0),this._writeBackgroundGeometry(d,_,v,O,p),d.recordEnd());const m=2*Math.max(O.width,O.height);for(const c of E.glyphs)L.textureBinding=c.textureBinding,d.recordStart(_,L.data,this.geometryType,!0),d.vertexBounds(v.x+O.x+this._xOffset,v.y+O.y-this._yOffset,m*W,m*W),this._writeVertices(d,_,B,c),d.recordEnd()}_writeGlyph(d,_,v,E,L){const B=q.m2.load(this._materialKey),W=(0,Z.UJ)(Math.round(8*v),Math.round(8*E));B.textureBinding=L.textureBinding,d.recordStart(_,B.data,this.geometryType,!0);const O=L.bounds,p=this._vertexBoundsScale;d.vertexBounds(v+O.x*p,E+O.y*p,O.width*p,O.height*p),this._writeVertices(d,_,W,L),d.recordEnd()}_writeVertices(d,_,v,E){const L=d.vertexCount();this._writeVertexCommon(d,_,v,E),d.vertexWrite(E.offsets.upperLeft),d.vertexWrite(E.texcoords.upperLeft),d.vertexEnd(),this._writeVertexCommon(d,_,v,E),d.vertexWrite(E.offsets.upperRight),d.vertexWrite(E.texcoords.upperRight),d.vertexEnd(),this._writeVertexCommon(d,_,v,E),d.vertexWrite(E.offsets.lowerLeft),d.vertexWrite(E.texcoords.lowerLeft),d.vertexEnd(),this._writeVertexCommon(d,_,v,E),d.vertexWrite(E.offsets.lowerRight),d.vertexWrite(E.texcoords.lowerRight),d.vertexEnd(),d.indexWrite(L+0),d.indexWrite(L+1),d.indexWrite(L+2),d.indexWrite(L+1),d.indexWrite(L+3),d.indexWrite(L+2)}_writeVertexCommon(d,_,v,E){const L=this._color,B=this._haloColor,W=(0,Z.Jz)(0,0,this._referenceSize,this._bitset),O=(0,Z.Jz)(0,0,this._size,this._haloSize);d.vertexWrite(v),d.vertexWrite(_),d.vertexWrite(L),d.vertexWrite(B),d.vertexWrite(O),d.vertexWrite(W),d.vertexWrite(this._minMaxZoom)}_writeBackgroundVertex(d,_,v,E,L,B){const W=(0,Z.Jz)(0,1,this._referenceSize,this._bitset),O=(0,Z.Jz)(0,0,this._size,this._haloSize),p=(0,Z.Jz)(0,0,0,0);d.vertexWrite(v),d.vertexWrite(_),d.vertexWrite(E),d.vertexWrite(p),d.vertexWrite(O),d.vertexWrite(W),d.vertexWrite(this._minMaxZoom),d.vertexWrite(L),d.vertexWrite(B),d.vertexEnd()}_writeBackgroundQuad(d,_,v,E,L,B){const W=d.vertexCount();this._writeBackgroundVertex(d,_,v,E,L.upperLeft,B[0]),this._writeBackgroundVertex(d,_,v,E,L.upperRight,B[1]),this._writeBackgroundVertex(d,_,v,E,L.lowerLeft,B[2]),this._writeBackgroundVertex(d,_,v,E,L.lowerRight,B[3]),d.indexWrite(W+0),d.indexWrite(W+1),d.indexWrite(W+2),d.indexWrite(W+1),d.indexWrite(W+3),d.indexWrite(W+2)}_writeBackgroundGeometry(d,_,v,E,L){const B=(0,Z.UJ)(Math.round(8*v.x),Math.round(8*v.y)),{x:W,y:O,width:p,height:Y}=E,m=2*Math.max(p,Y);if(d.vertexBounds(v.x+W+this._xOffset,v.y+O-this._yOffset,m*this._vertexBoundsScale,m*this._vertexBoundsScale),this._backgroundColor&&this._writeBackgroundQuad(d,_,B,this._backgroundColor,L.main,[b,b,b,b]),this._borderLineColor||this._backgroundColor){const c=!!this._borderLineColor&&!!this._borderLineSize&&this._borderLineSize>0,[H,_t,tt,lt,rt]=c?[P,P,a,a,this._borderLineColor]:[u,T,Q,at,this._backgroundColor];this._writeBackgroundQuad(d,_,B,rt,L.top,H),this._writeBackgroundQuad(d,_,B,rt,L.bot,_t),this._writeBackgroundQuad(d,_,B,rt,L.left,tt),this._writeBackgroundQuad(d,_,B,rt,L.right,lt)}}}},18752:(Kt,St,f)=>{f.d(St,{Z:()=>J});var F=f(23841),ft=f(12225),pt=f(9545),V=f(7547),k=f(81295),Z=f(39351),q=f(39406),U=f(5254),j=f(18716),ot=f(50114),b=f(88337),xt=f(94358);class J extends((0,b.Z)(xt.Z)){constructor(a,u,T,Q,at,it,st,d,_,v,E,L,B,W,O,p,Y,m,c,H,_t,tt,lt,rt){super(),this.angle=Q,this.height=st,this.width=it,this.xOffset=u*c,this.yOffset=T*c,this._markerPlacement=H||void 0,this._effects=_t||void 0,this._anchorX=p,this._anchorY=Y,this._minMaxZoom=(0,U.UJ)(Math.round(tt*Z.JS),Math.round(lt*Z.JS));const Ot=(W===V.v2.MAP?Z.$6:Z.yc)|(E?Z.SQ:0)|(B?Z.pZ:0)|(L?Z.rL:0),At=O&&O.sdf,yt=j.mE.load(a);yt.sdf=At,yt.pattern=!0,yt.textureBinding=O.textureBinding,this._materialKey=yt.data,this._fillColor=at,this._outlineColor=_,this._sizeOutlineWidth=(0,U.Jz)(Math.round(Math.min(Math.sqrt(128*it),255)),Math.round(Math.min(Math.sqrt(128*st),255)),Math.round(Math.min(Math.sqrt(128*v),255)),Math.round(Math.min(Math.sqrt(128*d),255))),yt.symbologyType===q.mD.PIE_CHART?(st*=m*c,this._computedWidth=it*=m*c,this._computedHeight=st,this._texUpperLeft=(0,U.UJ)(0,1),this._texUpperRight=(0,U.UJ)(1,1),this._texBottomLeft=(0,U.UJ)(0,0),this._texBottomRight=(0,U.UJ)(1,0)):this._computeSize(it,st,m,v,c,O,yt.hasSizeVV(),rt);const Mt=Math.round(64*m);this._bitestAndDistRatio=(0,U.UJ)(Ot,Mt);const gt=(0,pt.c)(),Ct=(0,ft.c)();this._applyTransformation(Ct,gt)}static fromCIMMarker(a,u,T){const it=a.size,st=(u&&u.width||1)/(u&&u.height||1)*a.scaleX,d=a.scaleSymbolsProportionally&&a.frameHeight?it/a.frameHeight:1,_=(0,k.t2)(a.color),v=(0,k.t2)(a.outlineColor),E=(0,F.F2)(it),L=E*st,B=(0,F.F2)(a.offsetX||0),W=(0,F.F2)(a.offsetY||0),O=(0,F.F2)(a.outlineWidth||0)*d,p=a.alignment||V.v2.SCREEN,Y=(0,F.F2)(a.referenceSize),[m,c]=(0,ot._f)(a.scaleInfo,T);let H=a.rotation||0;a.rotateClockwise||(H=-H);let _t=0,tt=0;const lt=a.anchorPoint;lt&&(a.isAbsoluteAnchorPoint?it&&(_t=lt.x/(it*st),tt=lt.y/it):(_t=lt.x,tt=lt.y));const rt=new J(a.materialKey,B,W,H,_,L,E,Y,v,O,a.colorLocked,a.scaleSymbolsProportionally,!1,p,u,_t,tt,a.sizeRatio,a.scaleFactor??1,a.markerPlacement,a.effects,m,c,!0);return rt._vertexBoundsScaleX=a.maxVVSize?a.maxVVSize/L:1,rt._vertexBoundsScaleY=a.maxVVSize?a.maxVVSize/E:1,rt}static fromPictureMarker(a,u){const T=Math.round((0,F.F2)(a.width)),Q=Math.round((0,F.F2)(a.height)),at=Z.gr,it=Math.round((0,F.F2)(a.xoffset||0)),st=Math.round((0,F.F2)(a.yoffset||0)),d=new J(a.materialKey,it,st,a.angle,at,T,Q,Q,0,0,!1,!1,!1,V.v2.SCREEN,u,0,0,1,1,null,null,ot.g4,ot.Ir,!1);return d._vertexBoundsScaleX=a.maxVVSize?a.maxVVSize/a.width:1,d._vertexBoundsScaleY=a.maxVVSize?a.maxVVSize/a.height:1,d}static fromSimpleMarker(a,u){const T=a.style,Q=(0,k.aH)(a.color),at=Math.round((0,F.F2)(a.size));let it=at;"esriSMSTriangle"===T&&(it*=u.height/u.width);const st=Math.round((0,F.F2)(a.xoffset||0)),d=Math.round((0,F.F2)(a.yoffset||0)),_=a.outline,v=0|(_?.color&&(0,k.aH)(_.color)),E=0|(_?.width&&Math.round((0,F.F2)(_.width))),L=new J(a.materialKey,st,d,a.angle??0,Q,at,it,it,v,E,!1,!1,"esriSMSCross"===T||"esriSMSX"===T,V.v2.SCREEN,u,0,0,2,1,null,null,ot.g4,ot.Ir,!1);return L.boundsType="esriSMSCircle"===T?"circle":"square",L._vertexBoundsScaleX=a.maxVVSize?a.maxVVSize/a.size:1,L._vertexBoundsScaleY=a.maxVVSize?a.maxVVSize/a.size:1,L}static fromLineSymbolMarker(a,u){const T=(0,k.aH)(a.color),at=Math.round((0,F.F2)(6*a.lineWidth)),it=at,st="cross"===a.style||"x"===a.style;let d;switch(a.placement){case"begin-end":d=V.Tx.Both;break;case"begin":d=V.Tx.JustBegin;break;case"end":d=V.Tx.JustEnd;break;default:d=V.Tx.None}const _={type:"CIMMarkerPlacementAtExtremities",angleToLine:!0,offset:0,extremityPlacement:d,offsetAlongLine:0},v=new J(a.materialKey,0,0,0,T,at,it,it/6,T,st?Math.round((0,F.F2)(a.lineWidth)):0,!1,!1,st,V.v2.MAP,u,0,0,2,1,_,null,ot.g4,ot.Ir,!1);return v.boundsType="circle"===a.style?"circle":"square",v}}},94358:(Kt,St,f)=>{f.d(St,{Z:()=>pt});var F=f(33359),ft=f(73608);class pt{constructor(){this._materialKey=null}bindFeature(k,Z,q){}write(k,Z,q,U){if(this._effects&&this._effects.length>0){let j=F.z.fromFeatureSetReaderCIM(Z);if(j){j.invertY();const ot=ft.j.executeEffects(this._effects,j,k.tileKey,U.geometryEngine);for(;j=ot.next();)j.invertY(),this._write(k,Z,U,j)}}else this._write(k,Z,U)}_write(k,Z,q,U){}}},1825:(Kt,St,f)=>{f.d(St,{Wr:()=>ze,Sl:()=>ge});var F=f(15861),ft=f(26584),pt=f(63290),V=f(10699),k=f(24837),Z=f(39406),q=f(18716),U=f(23841),j=f(80991),ot=f(81295),b=f(39351),xt=f(43289),J=f(5254),P=f(50114),a=f(87526),T=(f(11915),f(58774)),Q=f(13160),at=f(88071);function it(n,e,r,s,i,l,h){x=0;const y=(s-r)*l,M=i&&i.length,w=M?(i[0]-r)*l:y;let I,N,D,z,R,X=st(e,r,0,0,w,l,!0);if(X&&X.next!==X.prev){if(M&&(X=function O(n,e,r,s,i,l){const h=new Array;for(let y=0,M=s.length;y<M;y++){const w=st(n,e,0,s[y]*l,y<M-1?s[y+1]*l:r*l,l,!1);w===w.next&&(w.steiner=!0),h.push(W(w))}h.sort(Mt);for(const y of h)i=p(y,i);return i}(e,r,s,i,X,l)),y>80*l){I=D=e[0+r*l],N=z=e[1+r*l];for(let ht=l;ht<w;ht+=l){const ct=e[ht+r*l],Tt=e[ht+1+r*l];I=Math.min(I,ct),N=Math.min(N,Tt),D=Math.max(D,ct),z=Math.max(z,Tt)}R=Math.max(D-I,z-N),R=0!==R?1/R:0}_(X,n,l,I,N,R,h,0)}}function st(n,e,r,s,i,l,h){let y;if(h===function lt(n,e,r,s,i,l){let h=0;for(let y=s,M=i-l;y<i;y+=l)h+=(n[M+e*l]-n[y+e*l])*(n[y+1+e*l]+n[M+1+e*l]),M=y;return h}(n,e,0,s,i,l)>0)for(let M=s;M<i;M+=l)y=L(M+e*l,n[M+e*l],n[M+1+e*l],y);else for(let M=i-l;M>=s;M-=l)y=L(M+e*l,n[M+e*l],n[M+1+e*l],y);return y&&yt(y,y.next)&&(B(y),y=y.next),y}function d(n,e=n){if(!n)return n;let r,s=n;do{if(r=!1,s.steiner||!yt(s,s.next)&&0!==H(s.prev,s,s.next))s=s.next;else{if(B(s),s=e=s.prev,s===s.next)break;r=!0}}while(r||s!==e);return e}function _(n,e,r,s,i,l,h,y){if(!n)return;!y&&l&&(n=m(n,s,i,l));let M=n;for(;n.prev!==n.next;){const w=n.prev,I=n.next;if(l?E(n,s,i,l):v(n))e.push(w.index/r+h),e.push(n.index/r+h),e.push(I.index/r+h),B(n),n=I.next,M=I.next;else if((n=I)===M){y?1===y?_(n=gt(n,e,r,h),e,r,s,i,l,h,2):2===y&&Ct(n,e,r,s,i,l,h):_(d(n),e,r,s,i,l,h,1);break}}}function v(n){const e=n.prev,r=n,s=n.next;if(H(e,r,s)>=0)return!1;let i=n.next.next;const l=i;let h=0;for(;i!==n.prev&&(0===h||i!==l);){if(h++,rt(e.x,e.y,r.x,r.y,s.x,s.y,i.x,i.y)&&H(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function E(n,e,r,s){const i=n.prev,l=n,h=n.next;if(H(i,l,h)>=0)return!1;const w=i.x>l.x?i.x>h.x?i.x:h.x:l.x>h.x?l.x:h.x,I=i.y>l.y?i.y>h.y?i.y:h.y:l.y>h.y?l.y:h.y,N=At(i.x<l.x?i.x<h.x?i.x:h.x:l.x<h.x?l.x:h.x,i.y<l.y?i.y<h.y?i.y:h.y:l.y<h.y?l.y:h.y,e,r,s),D=At(w,I,e,r,s);let z=n.prevZ,R=n.nextZ;for(;z&&z.z>=N&&R&&R.z<=D;){if(z!==n.prev&&z!==n.next&&rt(i.x,i.y,l.x,l.y,h.x,h.y,z.x,z.y)&&H(z.prev,z,z.next)>=0||(z=z.prevZ,R!==n.prev&&R!==n.next&&rt(i.x,i.y,l.x,l.y,h.x,h.y,R.x,R.y)&&H(R.prev,R,R.next)>=0))return!1;R=R.nextZ}for(;z&&z.z>=N;){if(z!==n.prev&&z!==n.next&&rt(i.x,i.y,l.x,l.y,h.x,h.y,z.x,z.y)&&H(z.prev,z,z.next)>=0)return!1;z=z.prevZ}for(;R&&R.z<=D;){if(R!==n.prev&&R!==n.next&&rt(i.x,i.y,l.x,l.y,h.x,h.y,R.x,R.y)&&H(R.prev,R,R.next)>=0)return!1;R=R.nextZ}return!0}function L(n,e,r,s){const i=K.create(n,e,r);return s?(i.next=s.next,i.prev=s,s.next.prev=i,s.next=i):(i.prev=i,i.next=i),i}function B(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function W(n){let e=n,r=n;do{(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next}while(e!==n);return r}function p(n,e){const r=function Y(n,e){let r=e;const s=n.x,i=n.y;let l,h=-1/0;do{if(i<=r.y&&i>=r.next.y&&r.next.y!==r.y){const D=r.x+(i-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(D<=s&&D>h){if(h=D,D===s){if(i===r.y)return r;if(i===r.next.y)return r.next}l=r.x<r.next.x?r:r.next}}r=r.next}while(r!==e);if(!l)return null;if(s===h)return l.prev;const y=l,M=l.x,w=l.y;let I,N=1/0;for(r=l.next;r!==y;)s>=r.x&&r.x>=M&&s!==r.x&&rt(i<w?s:h,i,M,w,i<w?h:s,i,r.x,r.y)&&(I=Math.abs(i-r.y)/(s-r.x),(I<N||I===N&&r.x>l.x)&&Ot(r,n)&&(l=r,N=I)),r=r.next;return l}(n,e);if(!r)return e;const s=ee(r,n);return d(s,s.next),d(r,r.next)}function m(n,e,r,s){let i;for(;i!==n;i=i.next){if(i=i||n,null===i.z&&(i.z=At(i.x,i.y,e,r,s)),i.prev.next!==i||i.next.prev!==i)return i.prev.next=i,i.next.prev=i,m(n,e,r,s);i.prevZ=i.prev,i.nextZ=i.next}return n.prevZ.nextZ=null,n.prevZ=null,function c(n){let e,r=1;for(;;){let s,i=n;n=null,e=null;let l=0;for(;i;){l++,s=i;let h=0;for(;h<r&&s;h++)s=s.nextZ;let y=r;for(;h>0||y>0&&s;){let M;0===h?(M=s,s=s.nextZ,y--):0!==y&&s?i.z<=s.z?(M=i,i=i.nextZ,h--):(M=s,s=s.nextZ,y--):(M=i,i=i.nextZ,h--),e?e.nextZ=M:n=M,M.prevZ=e,e=M}i=s}if(e.nextZ=null,r*=2,l<2)return n}}(n)}function H(n,e,r){return(e.y-n.y)*(r.x-e.x)-(e.x-n.x)*(r.y-e.y)}function _t(n,e,r,s){return!!(yt(n,e)&&yt(r,s)||yt(n,s)&&yt(r,e))||H(n,e,r)>0!=H(n,e,s)>0&&H(r,s,n)>0!=H(r,s,e)>0}function rt(n,e,r,s,i,l,h,y){return(i-h)*(e-y)-(n-h)*(l-y)>=0&&(n-h)*(s-y)-(r-h)*(e-y)>=0&&(r-h)*(l-y)-(i-h)*(s-y)>=0}function Ot(n,e){return H(n.prev,n,n.next)<0?H(n,e,n.next)>=0&&H(n,n.prev,e)>=0:H(n,e,n.prev)<0||H(n,n.next,e)<0}function At(n,e,r,s,i){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=32767*(n-r)*i)|n<<8))|n<<4))|n<<2))|n<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-s)*i)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function yt(n,e){return n.x===e.x&&n.y===e.y}function Mt(n,e){return n.x-e.x}function gt(n,e,r,s){let i=n;do{const l=i.prev,h=i.next.next;!yt(l,h)&&_t(l,i,i.next,h)&&Ot(l,h)&&Ot(h,l)&&(e.push(l.index/r+s),e.push(i.index/r+s),e.push(h.index/r+s),B(i),B(i.next),i=n=h),i=i.next}while(i!==n);return i}function Ct(n,e,r,s,i,l,h){let y=n;do{let M=y.next.next;for(;M!==y.prev;){if(y.index!==M.index&&wt(y,M)){let w=ee(y,M);return y=d(y,y.next),w=d(w,w.next),_(y,e,r,s,i,l,h,0),void _(w,e,r,s,i,l,h,0)}M=M.next}y=y.next}while(y!==n)}function wt(n,e){return n.next.index!==e.index&&n.prev.index!==e.index&&!function tt(n,e){let r=n;do{if(r.index!==n.index&&r.next.index!==n.index&&r.index!==e.index&&r.next.index!==e.index&&_t(r,r.next,n,e))return!0;r=r.next}while(r!==n);return!1}(n,e)&&Ot(n,e)&&Ot(e,n)&&function Yt(n,e){let r=n,s=!1;const i=(n.x+e.x)/2,l=(n.y+e.y)/2;do{r.y>l!=r.next.y>l&&r.next.y!==r.y&&i<(r.next.x-r.x)*(l-r.y)/(r.next.y-r.y)+r.x&&(s=!s),r=r.next}while(r!==n);return s}(n,e)}function ee(n,e){const r=K.create(n.index,n.x,n.y),s=K.create(e.index,e.x,e.y),i=n.next,l=e.prev;return n.next=e,e.prev=n,r.next=i,i.prev=r,s.next=r,r.prev=s,l.next=s,s.prev=l,s}class K{constructor(){this.index=0,this.x=0,this.y=0,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}static create(e,r,s){const i=x<o.length?o[x++]:new K;return i.index=e,i.x=r,i.y=s,i.prev=null,i.next=null,i.z=null,i.prevZ=null,i.nextZ=null,i.steiner=!1,i}}const o=new Array;let x=0;for(let n=0;n<8096;n++)o.push(new K);const C=new Q.bN(0,0,0,1,0),A=new Q.bN(0,0,0,1,0);function et(n,e,r){let s=0;for(let i=1;i<r;i++)s+=(n[2*(e+i)]-n[2*(e+i-1)])*(n[2*(e+i)+1]+n[2*(e+i-1)+1]);return s}function nt(n,e,r,s,i){let l=0;for(let y=r;y<s;y+=3){const M=2*(n[y]-i),w=2*(n[y+1]-i),I=2*(n[y+2]-i);l+=Math.abs((e[M]-e[I])*(e[w+1]-e[M+1])-(e[M]-e[w])*(e[I+1]-e[M+1]))}return l}C.setExtent(b.i9),A.setExtent(b.i9);var mt=f(7547),Wt=f(33359),dt=f(46519);const Ft=n=>class extends n{constructor(...e){super(...e),this.tessellationProperties={},this._tessellationOptions={halfWidth:0,pixelCoordRatio:1,offset:0},this.geometryType=Z.LW.LINE}writeGeometry(e,r,s,i){this._writeGeometry(e,r,s,i)}_initializeTessellator(e){const r=q.a.load(this._materialKey),s=q.dk.load(this._materialKey),i=this._tessellationOptions,h=this.tessellationProperties._halfWidth<b.do&&!e&&!(r.vvSizeFieldStops||r.vvSizeMinMaxValue||r.vvSizeScaleStops||r.vvSizeUnitValue);this.tessellationProperties.minMaxZoom=this._minMaxZoom,i.wrapDistance=65535,i.textured=this._isDashed||this._hasPattern,i.offset=this.tessellationProperties.offset,i.halfWidth=this.tessellationProperties._halfWidth;const y=h?0:1,M=(0,q.CA)(s)?Zt:zt;this._lineTessellator=new dt.z(M(this.tessellationProperties,y,y),jt(this.tessellationProperties),h)}_write(e,r,s,i){const l="esriGeometryPoint"===r.geometryType;e.recordStart(r.getDisplayId(),this._materialKey,this.geometryType,l),this._writeGeometry(e,r,i,l),e.recordEnd()}_writeGeometry(e,r,s,i){const l=s||Wt.z.fromFeatureSetReaderCIM(r);if(!l)return;const h=this._getLines(l,i);null!=h&&this._writeVertices(e,r,h)}_getLines(e,r){return function Bt(n,e){A.setPixelMargin(e);const r=A,s=-e,i=b.i9+e;let l=[],h=!1;if(!n.nextPath())return null;let y=!0;for(;y;){n.seekPathStart();const M=[];if(!n.pathSize)return null;r.reset(Q.Vl.LineString),n.nextPoint();let w=n.x,I=n.y;if(h)r.moveTo(w,I);else{if(w<s||w>i||I<s||I>i){h=!0;continue}M.push({x:w,y:I})}let N=!1;for(;n.nextPoint();)if(w=n.x,I=n.y,h)r.lineTo(w,I);else{if(w<s||w>i||I<s||I>i){N=!0;break}M.push({x:w,y:I})}if(N)h=!0;else{if(h){const D=r.resultWithStarts();if(D)for(const z of D)l.push(z)}else l.push({line:M,start:0});y=n.nextPath(),h=!1}}return l=l.filter(M=>M.line.length>1),0===l.length?null:l}(e,r?256:16)}_writeVertices(e,r,s){const i=r.getDisplayId(),l=e.vertexCount(),h=this.tessellationProperties,y=this._tessellationOptions;h.out=e,h.id=i,h.indexCount=0,h.vertexCount=0,h.offset=l,y.capType=this._capType,y.joinType=this._joinType;const M=q.dk.load(this._materialKey);this.tessellationProperties.key=(0,q.CA)(M)?M:q.a.load(this._materialKey);for(const{line:w,start:I}of s)y.initialDistance=I%65535,this._lineTessellator.tessellate(w,y)}},zt=(n,e,r)=>(s,i,l,h,y,M,w,I,N,D,z)=>{const R=(0,J.UJ)(z,Math.ceil(16*n._halfWidth)),X=(0,J.Jz)(Math.round(16*w),Math.round(16*I),Math.round(16*N),Math.round(16*D)),ht=(0,J.Jz)(16*y,16*M,0,n._bitset),ct=n.out;return ct.vertexBounds(s,i,e,r),ct.vertexWrite((0,J.UJ)(8*s,8*i)),ct.vertexWrite(n.id),ct.vertexWrite(n._fillColor),ct.vertexWrite(X),ct.vertexWrite(R),ct.vertexWrite(n._tl),ct.vertexWrite(n._br),ct.vertexWrite(ht),ct.vertexWrite((0,J.UJ)(Math.ceil(16*n._halfReferenceWidth),0)),ct.vertexWrite(n.minMaxZoom),ct.vertexEnd(),n.offset+n.vertexCount++},Zt=(n,e,r)=>(s,i,l,h,y,M,w,I,N,D,z)=>{const R=(0,J.UJ)(16*n._halfWidth,16*n._halfReferenceWidth),X=(0,J.Jz)(16*w+128,16*I+128,16*N+128,16*D+128),ht=n.out,ct=n._bitset<<24|n.id;ht.vertexBounds(s,i,e,r),ht.vertexWrite((0,J.UJ)(8*s,8*i)),ht.vertexWrite(ct),ht.vertexWrite(n._fillColor);const Tt=(0,q.Xp)(n.key);return Tt||(ht.vertexWrite(0),ht.vertexWrite(0)),ht.vertexWrite(0),ht.vertexWrite(R),ht.vertexWrite(X),Tt||ht.vertexWrite(n.minMaxZoom),ht.vertexEnd(),n.offset+n.vertexCount++},jt=n=>(e,r,s)=>{const i=n.out;i.indexWrite(e),i.indexWrite(r),i.indexWrite(s),n.indexCount+=3};var Qt=f(94358);class Gt extends(Ft(Qt.Z)){constructor(e,r,s,i,l,h,y,M,w,I,N,D,z,R,X,ht,ct,Tt,bt,It){super();const Rt=q.a.load(e);r&&(Rt.sdf=r.sdf,Rt.pattern=!0,Rt.textureBinding=r.textureBinding),this._capType=i,this._joinType=l,this._miterLimitCosine=(0,P.NW)(h),this.tessellationProperties._fillColor=y,this.tessellationProperties._tl=M,this.tessellationProperties._br=w,this._hasPattern=I,this._isDashed=N,this._zOrder=ct,this._effects=Tt||null,this._minMaxZoom=(0,J.UJ)(Math.round(bt*b.JS),Math.round(It*b.JS)),this._materialKey=Rt.data,this.tessellationProperties._bitset=(z?b.SQ:0)|(R?b.WD:0)|(D?b.Wq:0)|(X?b.GS:0),this.tessellationProperties._halfWidth=.5*s,this.tessellationProperties._halfReferenceWidth=.5*ht,this.tessellationProperties.offset=0,this._initializeTessellator(!1)}static fromCIMLine(e,r,s){const i=e.color,l=e.scaleFactor||1,h=!!e.dashTemplate;let y=e.cap;h&&y===mt.RL.ROUND&&(y=mt.RL.SQUARE);const M=e.join,w=(0,U.F2)(e.width)*l,I=(0,U.F2)(e.referenceWidth),N=(0,U.F2)(e.miterLimit),D=i&&(0,ot.t2)(i)||0,[z,R]=(0,P._f)(e.scaleInfo,s);if(!r)return new Gt(e.materialKey,r,w,y,M,N,D,0,0,!1,h,e.scaleDash??!1,e.colorLocked??!1,!1,e.sampleAlphaOnly,I,e.zOrder,e.effects,z,R);const{rect:ht,width:ct,height:Tt}=r,bt=ht.x+b.s4,It=ht.y+b.s4,Rt=bt+ct,Ht=It+Tt,Xt=(0,J.UJ)(bt,It),ie=(0,J.UJ)(Rt,Ht);return new Gt(e.materialKey,r,w,y,M,N,D,Xt,ie,!0,h,e.scaleDash??!1,e.colorLocked??!1,!1,e.sampleAlphaOnly,I,e.zOrder,e.effects,z,R)}static fromFillOutline(e){const r=q.dk.load(e.materialKey);return(0,q.CA)(r)&&e.outline&&"esriSLSSolid"===e.outline?.style?Gt.fromSimpleLine({hash:"",materialKey:e.materialKey,...e.outline},null,!0):null}static fromSimpleLine(e,r,s=!1){const{color:i}=e,l="esriSLSSolid"!==e.style&&"esriSLSNull"!==e.style,h=(0,a.ws)(e.cap||"round"),y=(0,a.xV)(e.join||"round");let M=i&&"esriSLSNull"!==e.style&&(0,ot.aH)(i)||0;"esriSLSNull"===e.style&&(M=0);const w=(0,U.F2)(e.width),I=e.miterLimit;if(!r)return new Gt(e.materialKey,r,w,h,y,I,M,0,0,!1,l,!0,!1,s,!1,w,0,null,P.g4,P.Ir);const{rect:N,width:D,height:z}=r,R=N.x+b.s4,X=N.y+b.s4,ht=R+D,ct=X+z,Tt=(0,J.UJ)(R,X),bt=(0,J.UJ)(ht,ct);return new Gt(e.materialKey,r,w,h,y,I,M,Tt,bt,!0,l,!0,!1,s,!1,w,0,null,P.g4,P.Ir)}static fromPictureLineSymbol(e,r,s,i){return pt.Z.getLogger("esri.views.2d.engine.webgl.WGLLineTemplate").error("PictureLineSymbol support does not exist!"),null}}const $t=n=>class extends n{constructor(...e){super(...e),this.forceLibtess=!1,this._bitset=0,this._lineTemplate=null,this.geometryType=Z.LW.FILL}_maybeAddLineTemplate(e){this._lineTemplate=Gt.fromFillOutline(e)}_write(e,r,s,i){const l="esriGeometryPoint"===r.geometryType,h=q.dk.load(this._materialKey);e.recordStart(r.getDisplayId(),this._materialKey,this.geometryType,l),this._writeGeometry(e,r,h,i,l),(0,q.CA)(h)&&null!=this._lineTemplate&&this._lineTemplate.writeGeometry(e,r,i,l),e.recordEnd()}_writeGeometry(e,r,s,i,l){const h=this._getGeometry(r,i,l);if(null==h)return;const y=[];if(!(h.maxLength>100)&&!this.forceLibtess&&function $(n,e){const{coords:r,lengths:s,hasIndeterminateRingOrder:i}=e,h=n;if(i)return!1;let y=0;for(let M=0;M<s.length;){let w=M,I=s[M],N=et(r,y,I);const D=[];for(;++w<s.length;){const ht=s[w],ct=et(r,y+I,ht);if(!(ct>0))break;N+=ct,D.push(y+I),I+=ht}const z=h.length;it(h,r,y,y+I,D,2,0);const R=nt(h,r,z,h.length,0),X=Math.abs(N);if(Math.abs((R-X)/Math.max(1e-7,X))>1e-5)return h.length=0,!1;M=w,y+=I}return!0}(y,h))return void(y.length&&this._writeVertices(e,r,h.coords,h.lengths,s,y));const M=function G(n){const{coords:e,lengths:r}=n,{buffer:s}=(0,T.b)(e,r);return s}(h);this._writeVertices(e,r,M,[M.length/2],s)}_writeVertex(e,r,s,i,l,h){const y=(0,J.UJ)(1*i,1*l);if(e.vertexBounds(i,l,0,0),e.vertexWrite(y),e.vertexWrite(r),s.symbologyType===Z.mD.DOT_DENSITY)e.vertexWriteF32(1/Math.abs(h.readGeometryArea()));else{e.vertexWrite(this.fillColor);const M=(0,q.Xp)(s);M||(e.vertexWrite(this.tl),e.vertexWrite(this.br)),e.vertexWrite(this.aux21),e.vertexWrite(this.aux22),e.vertexWrite(this.aux3),M||e.vertexWrite(this._minMaxZoom)}}_writeVertices(e,r,s,i,l,h){const y=r.getDisplayId(),M=this._bitset<<24|y,w=i.reduce((z,R)=>z+R),I=(0,a.$_)(l.geometryType,l.symbologyType).geometry/4,N=e.vertexCount();e.vertexEnsureSize(I*w);let D=0;if(h)for(const z of h)this._writeVertex(e,M,l,s[2*z],s[2*z+1],r),D++;else for(let z=0;z<s.length;z+=2){const R=Math.round(s[z]),X=Math.round(s[z+1]);this._writeVertex(e,M,l,R,X,r),D++}e.indexEnsureSize(D);for(let z=0;z<D;z++)e.indexWrite(z+N)}_getGeometry(e,r,s){const i=r?.asOptimized()||e.readGeometryForDisplay();return i?function Lt(n,e){if(null==n)return null;if(!function Et(n,e,r){let s=0;for(let i=0;i<n.lengths.length;i++){const l=n.lengths[i];for(let h=0;h<l;h++){const y=n.coords[2*(h+s)],M=n.coords[2*(h+s)+1];if(y<e||y>r||M<e||M>r)return!0}s+=l}return!1}(n,-128,b.i9+128))return n;C.setPixelMargin(e),C.reset(Q.Vl.Polygon);let r=0;for(let h=0;h<n.lengths.length;h++){const y=n.lengths[h];let M=n.coords[2*(0+r)],w=n.coords[2*(0+r)+1];C.moveTo(M,w);for(let I=1;I<y;I++)M=n.coords[2*(I+r)],w=n.coords[2*(I+r)+1],C.lineTo(M,w);C.close(),r+=y}const s=C.result(!1);if(!s)return null;const i=[],l=[];for(const h of s){let y=0;for(const M of h)l.push(M.x),l.push(M.y),y++;i.push(y)}return new at.Z(i,l)}(i,s?256:8):null}};var te=f(13871);const Ut=pt.Z.getLogger("esri.views.2d.engine.webgl.WGLDynamicMeshTemplate");class ne extends Qt.Z{constructor(e){super(),this._ongoingMaterialRequestMap=new Map,this._materialCache=new Map,this._dynamicPropertyMap=new Map,this._cimLayer=e}analyze(e,r,s,i,l){var h=this;return(0,F.Z)(function*(){if(l&&0===l.length)return null;const y=l&&l.length>0,M=r.readLegacyFeature(),w=r.getObjectId(),I=h._materialCache,N=h._cimLayer.materialHash;if(!N)return Ut.error("A Dynamic mesh template must have a material hash value or function!"),null;const D="function"==typeof N?N(M,s,i,w):N,z=I.get(D);if(null!=z)return z;const R=h._ongoingMaterialRequestMap.get(D);if(R)return R;const X=h._cimLayer,ht=(0,te.S)(X.cim,h._cimLayer.materialOverrides);ht.mosaicHash=D;const{type:ct,url:Tt}=X,bt={cim:ht,type:ct,mosaicHash:D,url:Tt,size:null,dashTemplate:null,text:null,fontName:null,objectId:w,animatedSymbolProperties:null};switch(ct){case"marker":bt.size=(0,j.hf)(X.size,M,s,i),bt.animatedSymbolProperties=(0,j.hf)(X.animatedSymbolProperties,M,s,i);break;case"line":bt.dashTemplate=X.dashTemplate;break;case"text":bt.text=(0,j.hf)(X.text,M,s,i),bt.fontName=(0,j.hf)(X.fontName,M,s,i)}const It=e.getMosaicItem(bt,l).then(Rt=>(y||(h._ongoingMaterialRequestMap.delete(D),I.set(D,Rt)),Rt)).catch(Rt=>(h._ongoingMaterialRequestMap.delete(D),Ut.error(".analyze()",Rt.message),null));return y||h._ongoingMaterialRequestMap.set(D,It),It})()}}var kt=f(84450);class le extends($t(ne)){constructor(e,r,s){if(super(e),this._minMaxZoom=(0,J.UJ)(Math.round(r*b.JS),Math.round(s*b.JS)),(0,j.wO)(e.color))this._dynamicPropertyMap.set("fillColor",(N,D,z)=>{const R=e.color(N,D,z);return R&&(0,ot.t2)(R)||0});else{const I=e.color;this.fillColor=I&&(0,ot.t2)(I)||0}const i="CIMMarkerPlacementInsidePolygon"===e.cim.placement?.type&&e.cim.placement.shiftOddRows?2:1,l=e.height;(0,j.wO)(l)?this._dynamicPropertyMap.set("_height",(N,D,z)=>l(N,D,z)*i):this._height=(l||0)*i;const h=e.offsetX;(0,j.wO)(h)?this._dynamicPropertyMap.set("_offsetX",(N,D,z)=>(0,U.F2)(h(N,D,z))):this._offsetX=(0,U.F2)(h||0);const y=e.offsetY;(0,j.wO)(y)?this._dynamicPropertyMap.set("_offsetY",(N,D,z)=>(0,U.F2)(-y(N,D,z))):this._offsetY=(0,U.F2)(-y||0);const M=e.scaleX;(0,j.wO)(M)?this._dynamicPropertyMap.set("_scaleX",M):this._scaleX=M||1;const w=e.angle;if((0,j.wO)(w)?this._dynamicPropertyMap.set("_angle",(N,D,z)=>(0,xt.s5)(w(N,D,z))):this._angle=(0,xt.s5)(w)||0,null!=e.effects){const I=e.effects;(0,j.wO)(I)?this._dynamicPropertyMap.set("_effects",I):this._effects=I}this._cimFillLayer=e,this._bitset=(e.colorLocked?b.SQ:0)|(e.applyRandomOffset?b.Ux:0)|(e.sampleAlphaOnly?b.GS:0)|(e.hasUnresolvedReplacementColor?b.av:0),this._fillMaterialKey=e.materialKey}static fromCIMFill(e,r){const[s,i]=(0,P._f)(e.scaleInfo,r);return new le(e,s,i)}bindFeature(e,r,s){const i=e.readLegacyFeature();this._dynamicPropertyMap.forEach((I,N)=>{this[N]=I(i,r,s)});const l=q.dk.load(this._fillMaterialKey),h=this._materialCache,y=(0,this._cimFillLayer.materialHash)(i,r,s),M=h.get(y);let w=null;if(M&&(0,kt.ok)(M.spriteMosaicItem)&&(w=M.spriteMosaicItem),w){const{rect:I,width:N,height:D}=w,z=I.x+b.s4,R=I.y+b.s4,X=z+N,ht=R+D;let ct=(0,U.F2)(this._height);ct<=0&&(ct=ht-R),ct<b.oh&&(ct*=b.Kg,this._bitset|=b.gV),ct=Math.round(ct);let Tt=(0,U.F2)(this._height/D*N);Tt<=0&&(Tt=X-z),Tt<b.oh&&(Tt*=b.Kg,this._bitset|=b.zE),Tt=Math.round(Tt);const bt=this._scaleX,It=1;this.tl=(0,J.UJ)(z,R),this.br=(0,J.UJ)(X,ht),this.aux21=(0,J.UJ)(Tt,ct),this.aux22=(0,J.UJ)(this._offsetX,this._offsetY),this.aux3=(0,J.Jz)(bt*b.Kg,It*b.Kg,this._angle,0),l.sdf=w.sdf,l.pattern=!0,l.textureBinding=w.textureBinding}else this.tl=0,this.br=0,this.aux21=0,this.aux22=0,this.aux3=0,l.sdf=!1,l.pattern=!1,l.textureBinding=0;this._materialKey=l.data}}class he extends(Ft(ne)){constructor(e,r,s){super(e),this._minMaxZoom=(0,J.UJ)(Math.round(r*b.JS),Math.round(s*b.JS)),this._cimLineLayer=e;let i=0;(0,j.wO)(e.width)||(i=.5*(0,U.F2)(e.width)),this._dynamicPropertyMap.set("_halfWidth",(N,D,z)=>(0,j.wO)(e.width)?.5*(0,U.F2)(e.width(N,D,z)):i),(0,j.wO)(e.cap)?this._dynamicPropertyMap.set("_capType",e.cap):this._capType=e.cap,(0,j.wO)(e.join)?this._dynamicPropertyMap.set("_joinType",e.join):this._joinType=e.join;const h=e.color;(0,j.wO)(h)?this._dynamicPropertyMap.set("_fillColor",(D,z,R)=>(0,ot.t2)(h(D,z,R))):this._fillColor=h&&(0,ot.t2)(h)||0;const y=e.miterLimit;if((0,j.wO)(y)?this._dynamicPropertyMap.set("_miterLimitCosine",(D,z,R)=>(0,P.NW)(y(D,z,R))):this._miterLimitCosine=(0,P.NW)(y),null!=e.effects){const N=e.effects;(0,j.wO)(N)?this._dynamicPropertyMap.set("_effects",N):this._effects=N}this._scaleFactor=e.scaleFactor||1,this._isDashed=null!=e.dashTemplate,this.tessellationProperties._bitset=(e.colorLocked?b.SQ:0)|(e.scaleDash?b.Wq:0)|(e.sampleAlphaOnly?b.GS:0),this._materialKey=e.materialKey,this._initializeTessellator(!0)}static fromCIMLine(e,r){const[s,i]=(0,P._f)(e.scaleInfo,r);return new he(e,s,i)}bindFeature(e,r,s){const i=e.readLegacyFeature();this._dynamicPropertyMap.forEach((I,N)=>{this[N]=I(i,r,s)}),this._halfWidth*=this._scaleFactor;const l=this._materialCache,h=(0,this._cimLineLayer.materialHash)(i,r,s),y=l.get(h);let M=null;if(y&&(0,kt.ok)(y.spriteMosaicItem)&&(M=y.spriteMosaicItem),M){this._hasPattern=!0;const{rect:I,width:N,height:D}=M,z=I.x+b.s4,R=I.y+b.s4,X=z+N,ht=R+D;this.tessellationProperties._tl=(0,J.UJ)(z,R),this.tessellationProperties._br=(0,J.UJ)(X,ht)}else this._hasPattern=!1,this.tessellationProperties._tl=0,this.tessellationProperties._br=0;this.tessellationProperties._fillColor=this._fillColor,this.tessellationProperties._halfWidth=this._halfWidth,this.tessellationProperties.offset=0,this.tessellationProperties._halfReferenceWidth=this.tessellationProperties._halfWidth;const w=q.a.load(this._materialKey);M&&(w.sdf=M.sdf,w.pattern=!0,w.textureBinding=M.textureBinding),this._materialKey=w.data}}var ve=f(12225),Me=f(9545),Le=f(88337);const Te=(0,Me.c)(),Ee=(0,ve.c)();class ce extends((0,Le.Z)(ne)){constructor(e,r,s){super(e),this._cimMarkerLayer=e,this._minMaxZoom=(0,J.UJ)(Math.round(r*b.JS),Math.round(s*b.JS));const i=e.color;(0,j.wO)(i)?this._dynamicPropertyMap.set("_fillColor",(z,R,X)=>(0,ot.t2)(i(z,R,X))):this._fillColor=(0,ot.t2)(i);const l=e.outlineColor;(0,j.wO)(l)?this._dynamicPropertyMap.set("_outlineColor",(z,R,X)=>(0,ot.t2)(l(z,R,X))):this._outlineColor=(0,ot.t2)(l);const h=e.size;(0,j.wO)(h)?this._dynamicPropertyMap.set("_size",(z,R,X)=>(0,U.F2)(h(z,R,X))):this._size=(0,U.F2)(h)||0;const y=e.scaleX;(0,j.wO)(y)?this._dynamicPropertyMap.set("_scaleX",y):this._scaleX=y;const M=e.offsetX;(0,j.wO)(M)?this._dynamicPropertyMap.set("xOffset",(z,R,X)=>(0,U.F2)(M(z,R,X))):this.xOffset=(0,U.F2)(M)||0;const w=e.offsetY;(0,j.wO)(w)?this._dynamicPropertyMap.set("yOffset",(z,R,X)=>(0,U.F2)(w(z,R,X))):this.yOffset=(0,U.F2)(w)||0;const I=e.outlineWidth;(0,j.wO)(I)?this._dynamicPropertyMap.set("_outlineWidth",(z,R,X)=>(0,U.F2)(I(z,R,X))):this._outlineWidth=(0,U.F2)(I)||0;const N=e.rotation;if((0,j.wO)(N)?this._dynamicPropertyMap.set("_angle",N):this._angle=N||0,null!=e.effects){const D=e.effects;(0,j.wO)(D)?this._dynamicPropertyMap.set("_effects",D):this._effects=D}if(null!=e.markerPlacement){const D=e.markerPlacement;(0,j.wO)(D)?this._dynamicPropertyMap.set("_markerPlacement",D):this._markerPlacement=D}this._scaleFactor=e.scaleFactor??1,this._bitSet=(e.alignment===mt.v2.MAP?b.$6:b.yc)|(e.colorLocked?b.SQ:0)|(e.scaleSymbolsProportionally?b.rL:0),this._materialKey=e.materialKey}static fromCIMMarker(e,r){const[s,i]=(0,P._f)(e.scaleInfo,r);return new ce(e,s,i)}bindFeature(e,r,s){const i=e.readLegacyFeature(),l=e.getObjectId();this._dynamicPropertyMap.forEach((se,De)=>{this[De]=se(i,r,s)});const h=this._cimMarkerLayer.materialHash,y="function"==typeof h?h(i,r,s,l):h,M=this._materialCache.get(y);if(!M||!(0,kt.ok)(M.spriteMosaicItem)||!M.spriteMosaicItem)return void pt.Z.getLogger("esri.views.2d.engine.webgl.WGLDynamicMarkerTemplate").error(new ft.Z("mapview-cim","Encountered an error when binding feature"));const w=M.spriteMosaicItem,I=this._cimMarkerLayer.sizeRatio,N=w.width/w.height*this._scaleX,D=q.mE.load(this._materialKey);D.sdf=w.sdf,D.pattern=!0,D.textureBinding=w.textureBinding,this._materialKey=D.data;const z=this._cimMarkerLayer.rotateClockwise?this._angle:-this._angle,R=this._size,X=R*N,ht=this.xOffset,ct=this.yOffset;this.xOffset*=this._scaleFactor,this.yOffset*=this._scaleFactor;const Tt=this._cimMarkerLayer.scaleSymbolsProportionally&&this._cimMarkerLayer.frameHeight?this._size/(0,U.F2)(this._cimMarkerLayer.frameHeight):1,bt=this._outlineWidth*Tt,It=(0,U.F2)(this._cimMarkerLayer.referenceSize);let Rt=0,Ht=0;const Xt=this._cimMarkerLayer.anchorPoint;Xt&&(this._cimMarkerLayer.isAbsoluteAnchorPoint?this._size&&(Rt=(0,U.F2)(Xt.x)/(this._size*N),Ht=(0,U.F2)(Xt.y)/this._size):(Rt=Xt.x,Ht=Xt.y)),this._anchorX=Rt,this._anchorY=Ht,this._sizeOutlineWidth=(0,J.Jz)(Math.round(Math.min(Math.sqrt(128*X),255)),Math.round(Math.min(Math.sqrt(128*R),255)),Math.round(Math.min(Math.sqrt(128*bt),255)),Math.round(Math.min(Math.sqrt(128*It),255))),this.angle=z;const ie=Math.round(64*I);this._bitestAndDistRatio=(0,J.UJ)(this._bitSet,ie),this._computeSize(X,R,I,bt,this._scaleFactor,w,D.hasSizeVV(),!0),this._applyTransformation(Ee,Te),this.xOffset=ht,this.yOffset=ct}}var fe=f(61261),Se=f(44526),me=f(32954);class ue extends((0,Se.Z)(ne)){constructor(e,r,s){super(e),this._horizontalAlignment="center",this._verticalAlignment="middle",this._textToGlyphs=new Map,this._minMaxZoom=(0,J.UJ)(Math.round(r*b.JS),Math.round(s*b.JS));const i=e.scaleFactor||1;this._cimTextLayer=e;const l=e.color;(0,j.wO)(l)?this._dynamicPropertyMap.set("_color",(ht,ct,Tt)=>(0,ot.t2)(l(ht,ct,Tt))):this._color=(0,ot.t2)(l);const h=e.outlineColor;let y,w,N;if((0,j.wO)(h)?this._dynamicPropertyMap.set("_haloColor",(ht,ct,Tt)=>(0,ot.t2)(h(ht,ct,Tt))):this._haloColor=(0,ot.t2)(h),(0,j.wO)(e.size)||(y=Math.min(Math.round((0,U.F2)(e.size*e.sizeRatio)),127)),this._dynamicPropertyMap.set("_size",(X,ht,ct)=>(0,j.wO)(e.size)?Math.min(Math.round((0,U.F2)(e.size(X,ht,ct)*e.sizeRatio)),127):y),(0,j.wO)(e.outlineSize)?this._dynamicPropertyMap.set("_haloSize",(ht,ct,Tt)=>Math.min(Math.floor(5*(0,U.F2)(e.outlineSize(ht,ct,Tt)*e.sizeRatio)),127)):this._haloSize=Math.min(Math.floor(5*(0,U.F2)(e.outlineSize*e.sizeRatio)),127),(0,j.wO)(e.offsetX)||(w=Math.round((0,U.F2)(e.offsetX*e.sizeRatio))),this._dynamicPropertyMap.set("_xOffset",(X,ht,ct)=>(0,j.wO)(e.offsetX)?Math.round((0,U.F2)(e.offsetX(X,ht,ct)*e.sizeRatio)):w),(0,j.wO)(e.offsetY)||(N=Math.round((0,U.F2)(e.offsetY*e.sizeRatio))),this._dynamicPropertyMap.set("_yOffset",(X,ht,ct)=>(0,j.wO)(e.offsetY)?Math.round((0,U.F2)(e.offsetY(X,ht,ct)*e.sizeRatio)):N),(0,j.wO)(e.angle)?this._dynamicPropertyMap.set("_angle",e.angle):this._angle=e.angle,(0,j.wO)(e.horizontalAlignment)?this._dynamicPropertyMap.set("_horizontalAlignment",e.horizontalAlignment):this._horizontalAlignment=e.horizontalAlignment,(0,j.wO)(e.verticalAlignment)?this._dynamicPropertyMap.set("_verticalAlignment",e.verticalAlignment):this._verticalAlignment=e.verticalAlignment,null!=e.effects){const X=e.effects;(0,j.wO)(X)?this._dynamicPropertyMap.set("_effects",X):this._effects=X}if(null!=e.markerPlacement){const X=e.markerPlacement;(0,j.wO)(X)?this._dynamicPropertyMap.set("_markerPlacement",X):this._textPlacement=X}(0,j.wO)(e.text)?this._dynamicPropertyMap.set("_text",e.text):this._text=e.text,this._backgroundColor=e.backgroundColor&&(0,ot.t2)(e.backgroundColor),this._borderLineColor=e.borderLineColor&&(0,ot.t2)(e.borderLineColor),this._borderLineSize=e.borderLineWidth,this._scaleFactor=i;const z=Math.min(Math.round((0,U.F2)(e.referenceSize*e.sizeRatio)),127);this._referenceSize=Math.round(Math.sqrt(256*z)),this._materialKey=e.materialKey;const R=q.qr.load(this._materialKey);R.sdf=!0,this._bitset=(e.alignment===mt.v2.MAP?1:0)|(e.colorLocked?1:0)<<1,this._materialKey=R.data,this._decoration="none",this._lineHeight=1,this._lineWidth=512,this._isCIM=!0}static fromCIMText(e,r){const[s,i]=(0,P._f)(e.scaleInfo,r);return new ue(e,s,i)}analyze(e,r,s,i){var l=()=>super.analyze,h=this;return(0,F.Z)(function*(){const y=r.readLegacyFeature(),M=function Pe(n,e,r,s){return"string"==typeof n.text?n.text:"function"==typeof n.text?n.text(e,r,s)??"":""}(h._cimTextLayer,y,s,i),w=yield l().call(h,e,r,s,i,(0,me._)(M));return w?.glyphMosaicItems&&h._textToGlyphs.set(M,w.glyphMosaicItems),w})()}bindFeature(e,r,s){const i=e.readLegacyFeature();if(this._dynamicPropertyMap.forEach((h,y)=>{this[y]=h(i,r,s)}),!this._text||0===this._text.length)return void(this._shapingInfo=null);this._size*=this._scaleFactor,this._scale=this._size/b.iD,this._xOffset*=this._scaleFactor,this._yOffset*=this._scaleFactor,this._xAlignD=(0,fe.kH)(this._horizontalAlignment??"center"),this._yAlignD=(0,fe.b7)(this._verticalAlignment??"baseline");const l=this._textToGlyphs.get(this._text)??[];this.bindTextInfo(l,!1)}}class Jt extends($t(Qt.Z)){constructor(e,r,s,i,l,h,y,M,w,I,N,D,z,R,X,ht){super(),this._effects=R||void 0;const ct=q.dk.load(e);r&&(ct.sdf=r.sdf,ct.pattern=!0,ct.textureBinding=r.textureBinding),this.fillColor=s,this.tl=i,this.br=l,this.aux21=(0,J.UJ)(h,y),this.aux22=(0,J.UJ)(M,w),this.aux3=(0,J.Jz)(I,N,D,0),this._bitset=z,this._minMaxZoom=(0,J.UJ)(Math.round(X*b.JS),Math.round(ht*b.JS)),this._materialKey=ct.data}static fromCIMFill(e,r,s){const i=e.color,l=i&&(0,ot.t2)(i)||0,h=e.materialKey,[y,M]=(0,P._f)(e.scaleInfo,s);let w=(e.colorLocked?b.SQ:0)|(e.applyRandomOffset?b.Ux:0)|(e.sampleAlphaOnly?b.GS:0)|(e.hasUnresolvedReplacementColor?b.av:0);if(!r)return new Jt(h,null,l,0,0,0,0,0,0,0,0,0,w,e.effects,y,M);const{rect:I,width:N,height:D}=r,z=e.scaleX||1,R=I.x+b.s4,X=I.y+b.s4,ht=R+N,ct=X+D,Tt=(0,U.F2)(e.height);let bt=z*Tt;"CIMHatchFill"===e.cim.type&&(bt*=N/D);let It=Tt;It<=0&&(It=ct-X),It<b.oh&&(It*=b.Kg,w|=b.gV),It=Math.round(It);let Rt=bt;Rt<=0&&(Rt=ht-R),Rt<b.oh&&(Rt*=b.Kg,w|=b.zE),Rt=Math.round(Rt);const Ht=(0,U.F2)(e.offsetX||0),Xt=(0,U.F2)(-e.offsetY||0),ie=(0,J.UJ)(R,X),se=(0,J.UJ)(ht,ct);return new Jt(h,r,l,ie,se,Rt,It,Ht,Xt,b.Kg,b.Kg,(0,xt.s5)(e.angle),w,e.effects,y,M)}static fromSimpleFill(e,r,s=!1){const{color:i}=e,l=i&&"esriSFSNull"!==e.style&&(0,ot.aH)(i)||0;let h=s?b.SQ:0;const y=e.materialKey;let M;if(r){const{rect:w,width:I,height:N,pixelRatio:D}=r,z=w.x+b.s4,R=w.y+b.s4,X=z+I,ht=R+N,ct=(0,J.UJ)(z,R),Tt=(0,J.UJ)(X,ht);let bt=I/D;bt<b.oh&&(bt*=b.Kg,h|=b.zE),bt=Math.round(bt);let It=N/D;It<b.oh&&(It*=b.Kg,h|=b.gV),It=Math.round(It),M=new Jt(y,r,l,ct,Tt,bt,It,0,0,b.Kg,b.Kg,0,h,null,P.g4,P.Ir)}else M=new Jt(y,null,l,0,0,0,0,0,0,0,0,0,h,null,P.g4,P.Ir);return M._maybeAddLineTemplate(e),M}static fromPictureFill(e,r,s=!1){const i=b.gr,{rect:l,width:h,height:y}=r,M=l.x+b.s4,w=l.y+b.s4,I=M+h,N=w+y,D=(0,J.UJ)(M,w),z=(0,J.UJ)(I,N);let R=s?b.SQ:0,X=(0,U.F2)(e.width);X<b.oh&&(X*=b.Kg,R|=b.zE),X=Math.round(X);let ht=(0,U.F2)(e.height);ht<b.oh&&(ht*=b.Kg,R|=b.gV),ht=Math.round(ht);const ct=(0,U.F2)(e.xoffset),Tt=(0,U.F2)(-e.yoffset),It=new Jt(e.materialKey,r,i,D,z,X,ht,ct,Tt,b.Kg*e.xscale,b.Kg*e.yscale,0,R,null,P.g4,P.Ir);return It._maybeAddLineTemplate(e),It}}var oe=f(18752),ye=f(51919);class We{constructor(){this._resolver=null}isHeld(){return!!this._resolver}acquire(){var e=this;return(0,F.Z)(function*(){e._resolver?(yield e._resolver.promise,yield e.acquire()):e._resolver=(0,V.hh)()})()}release(){const e=this._resolver;this._resolver=null,e?.resolve()}}function _e(){return(_e=(0,F.Z)(function*(n,e,r){try{yield n.acquire(),yield e(r),n.release()}catch(s){throw n.release(),s}})).apply(this,arguments)}var ae=f(51584);const Vt=pt.Z.getLogger("esri.views.2d.engine.webgl.mesh.templates.WGLTemplateStore"),pe={sortKey:null,templates:new Array},de={isOutline:!1,placement:null,symbologyType:Z.mD.DEFAULT,vvFlags:0},be={...k.eG,hash:JSON.stringify(k.eG),materialKey:(0,q.jj)(Z.LW.MARKER,de)},Ie={...k.wW,hash:JSON.stringify(k.wW),materialKey:(0,q.jj)(Z.LW.LINE,de)},Ce={...k.lj,hash:JSON.stringify(k.lj),materialKey:(0,q.jj)(Z.LW.FILL,de)};function Nt(n,e){const r=n.length;return n.push(null),e.then(s=>n[r]=s),n}function ge(n){return null!=n&&!!(1&n)}class ze{constructor(e,r){this._idCounter=1,this._templateIdCounter=1,this._idToTemplateGroup=new Map,this._symbolToTemplate=new Map,this._fetchQueue=[],this._idToResolver=new Map,this._cimTemplateCache=new Map,this._cimAnalyses=[],this._lock=new We,this._fetchResource=e,this._tileInfo=r}get _markerError(){return this._errorTemplates.marker[0]}get _fillError(){return this._errorTemplates.fill[0]}get _lineError(){return this._errorTemplates.line[0]}get _textError(){return this._errorTemplates.line[0]}createTemplateGroup(e,r,s=null){this._initErrorTemplates();const i=e.hash,l=this._symbolToTemplate.get(i);if(null!=l)return l;const h=new Array,y={sortKey:s,templates:h};r&&this._createMeshTemplates(h,r,!0),this._createMeshTemplates(h,e,!1);const M=this._createGroupId("expanded-cim"===e.type&&Be(e));return this._idToTemplateGroup.set(M,y),this._symbolToTemplate.set(i,M),M}getTemplateGroup(e){return this._idToTemplateGroup.get(e)??pe}getDynamicTemplateGroup(e){return this._idToTemplateGroup.has(e)?(ge(e)||Vt.error("mapview-template-store",`Id ${e} does not refer to a dynamic template`),this._idToTemplateGroup.get(e)):pe}getMosaicItem(e,r){const s=this._createTemplateId(),i=new Promise(l=>this._idToResolver.set(s,l));return this._fetchQueue.push({symbol:e,id:s,glyphIds:r}),i}finalize(e){return this._fetchQueue.length||this._lock.isHeld()?function we(n,e,r){return _e.apply(this,arguments)}(this._lock,this._fetchAllQueuedResources.bind(this),e):Promise.resolve()}_initErrorTemplates(){this._errorTemplates||(this._errorTemplates={fill:this._createMeshTemplates([],Ce,!1),marker:this._createMeshTemplates([],be,!1),line:this._createMeshTemplates([],Ie,!1)})}_fetchAllQueuedResources(e){if(!this._fetchQueue.length)return Promise.resolve();const r=this._fetchQueue,s=this._cimAnalyses;return this._fetchQueue=[],this._cimAnalyses=[],Promise.all(s).then(()=>this._fetchResource(r,e).then(i=>{for(const{id:l,mosaicItem:h}of i)this._idToResolver.get(l)(h),this._idToResolver.delete(l)})).catch(i=>{(0,V.D_)(i)?this._fetchQueue=this._fetchQueue.concat(r):function Oe(n){return"worker:port-closed"===n.name}(i)||Vt.error(new ft.Z("mapview-template-store","Unable to fetch requested texture resources",i))})}_createGroupId(e){return this._idCounter++<<1|(e?1:0)}_createTemplateId(){return this._templateIdCounter++}_createSMS(e){var r=this;return(0,F.Z)(function*(){const{spriteMosaicItem:s}=yield r.getMosaicItem(e);return(0,kt.ok)(s,Vt)?oe.Z.fromSimpleMarker(e,s):r._markerError})()}_createPMS(e){var r=this;return(0,F.Z)(function*(){const{spriteMosaicItem:s}=yield r.getMosaicItem(e);return(0,kt.ok)(s,Vt)?oe.Z.fromPictureMarker(e,s):r._markerError})()}_createSFS(e,r){var s=this;return(0,F.Z)(function*(){const{spriteMosaicItem:i}=yield s.getMosaicItem(e);return(0,kt.ok)(i,Vt)?Jt.fromSimpleFill(e,i,r):s._fillError})()}_createPFS(e,r){var s=this;return(0,F.Z)(function*(){const{spriteMosaicItem:i}=yield s.getMosaicItem(e);return(0,kt.ok)(i,Vt)?Jt.fromPictureFill(e,i,r):s._fillError})()}_createSLS(e,r){var s=this;return(0,F.Z)(function*(){const{spriteMosaicItem:i}=yield s.getMosaicItem(e);return(0,kt.ok)(i,Vt)?Gt.fromSimpleLine(e,i):s._lineError})()}_createLMS(e){var r=this;return(0,F.Z)(function*(){const{spriteMosaicItem:s}=yield r.getMosaicItem(e);return(0,kt.ok)(s,Vt)?oe.Z.fromLineSymbolMarker(e,s):r._markerError})()}_createTS(e){var r=this;return(0,F.Z)(function*(){const{glyphMosaicItems:s}=yield r.getMosaicItem(e);return ye.Z.fromText(e,s??[])})()}_createCIMText(e){var r=this;return(0,F.Z)(function*(){const{glyphMosaicItems:s}=yield r.getMosaicItem((0,ae.x)(e),(0,me._)(e.text));return(0,kt.ok)(s,Vt)?ye.Z.fromCIMText(e,s,r._tileInfo):r._textError})()}_createCIMFill(e){var r=this;return(0,F.Z)(function*(){const{spriteMosaicItem:s}=yield r.getMosaicItem((0,ae.x)(e));return(0,kt.ok)(s,Vt)?Jt.fromCIMFill(e,s,r._tileInfo):r._fillError})()}_createCIMLine(e){var r=this;return(0,F.Z)(function*(){const{spriteMosaicItem:s}=yield r.getMosaicItem((0,ae.x)(e));return(0,kt.ok)(s,Vt)?Gt.fromCIMLine(e,s,r._tileInfo):r._lineError})()}_createCIMMarker(e){var r=this;return(0,F.Z)(function*(){const{spriteMosaicItem:s}=yield r.getMosaicItem((0,ae.x)(e));return(0,kt.ok)(s,Vt)?oe.Z.fromCIMMarker(e,s,r._tileInfo):r._markerError})()}_createCIM(e){var r=this;return(0,F.Z)(function*(){const s=e.templateHash;let i=r._cimTemplateCache.get(s);if(null!=i)return i;switch(e.type){case"marker":i=yield r._createCIMMarker(e);break;case"line":i=yield r._createCIMLine(e);break;case"fill":i=yield r._createCIMFill(e);break;case"text":i=yield r._createCIMText(e)}return r._cimTemplateCache.set(s,i),i})()}_createDynamicCIM(e){var r=this;return(0,F.Z)(function*(){const s=e.templateHash;let i=r._cimTemplateCache.get(s);if(null!=i)return i;switch(e.type){case"marker":i=ce.fromCIMMarker(e,r._tileInfo);break;case"line":i=he.fromCIMLine(e,r._tileInfo);break;case"fill":i=le.fromCIMFill(e,r._tileInfo);break;case"text":i=ue.fromCIMText(e,r._tileInfo)}return r._cimTemplateCache.set(s,i),i})()}_createPrimitiveMeshTemplates(e,r,s){switch(r.type){case"esriSMS":return Nt(e,this._createSMS(r));case"esriPMS":return Nt(e,this._createPMS(r));case"esriSFS":return Nt(e,this._createSFS(r,s));case"line-marker":return Nt(e,this._createLMS(r));case"esriPFS":return Nt(e,this._createPFS(r,s));case"esriSLS":return Nt(e,this._createSLS(r,!1));case"esriTS":return Nt(e,this._createTS(r));default:return Vt.error("Unable to create mesh template for unknown symbol type {: $ }{symbol.type}"),e}}_createMeshTemplates(e,r,s){if(r.type.includes("3d"))return Vt.error("3D symbols are not supported with MapView"),e;if("expanded-cim"===r.type){for(const i of r.layers)Nt(e,"function"==typeof i.materialHash?this._createDynamicCIM(i):this._createCIM(i));return e}if("composite-symbol"===r.type){for(const i of r.layers)this._createPrimitiveMeshTemplates(e,i,s);return e}return"cim"===r.type||"label"===r.type||"web-style"===r.type?e:this._createPrimitiveMeshTemplates(e,r,s)}}const Be=n=>{if(!n.layers)return!1;for(const e of n.layers)if("function"==typeof e.materialHash)return!0;return!1}},51919:(Kt,St,f)=>{f.d(St,{Z:()=>J});var F=f(986),ft=f(23841),pt=f(7547),V=f(61261),k=f(81295),Z=f(39351),q=f(5254),U=f(18716),j=f(50114),ot=f(44526),b=f(94358);class J extends((0,ot.Z)(b.Z)){constructor(a,u,T,Q,at,it,st,d,_,v,E,L,B,W,O,p,Y,m,c,H,_t,tt,lt,rt){super(),this._xOffset=(0,ft.F2)(B),this._yOffset=(0,ft.F2)(W),this._decoration=v||"none",this._backgroundColor=tt,this._borderLineColor=lt,this._borderLineSize=rt,this._color=at,this._haloColor=it,this._haloSize=Math.min(Math.floor(5*(0,ft.F2)((0,ft.t_)(T))),127),this._size=Math.min(Math.round((0,ft.F2)(u)),127);const Ot=Math.min(Math.round((0,ft.F2)(Q||u)),127);this._referenceSize=Math.round(Math.sqrt(256*Ot)),this._scale=this._size/Z.iD,this._angle=L,this._justify=(0,V.Hd)(st||"center"),this._xAlignD=(0,V.kH)(st||"center"),this._yAlignD=(0,V.b7)(d||"baseline"),this._baseline="baseline"===(d||"baseline"),this._bitset=(_===pt.v2.MAP?1:0)|(E?1:0)<<1;const At=U.m2.load(a);At.sdf=!0,this._materialKey=At.data,this._lineWidth=(0,ft.F2)(O)||512,this._lineHeight=p||1,this._textPlacement=Y,this._effects=m,this._isCIM=c??!1,this._minMaxZoom=(0,q.UJ)(Math.round(H*Z.JS),Math.round(_t*Z.JS))}static fromText(a,u){const T=a.font?.size,Q=new J(a.materialKey,T,a.haloSize||0,T,a.color&&(0,k.aH)(a.color)||0,a.haloColor&&(0,k.aH)(a.haloColor)||0,a.horizontalAlignment,a.verticalAlignment,pt.v2.SCREEN,a.font?.decoration,!1,a.angle||0,a.xoffset||0,a.yoffset||0,a.lineWidth||0,a.lineHeight||0,null,null,!1,j.g4,j.Ir,a.backgroundColor&&(0,k.aH)(a.backgroundColor),a.borderLineColor&&(0,k.aH)(a.borderLineColor),a.borderLineSize),[,at]=(0,F.E)(a.text);return Q.bindTextInfo(u??[],at),Q._vertexBoundsScale=a.maxVVSize&&T?a.maxVVSize/T:1,Q}static fromCIMText(a,u,T){const Q=a.scaleFactor||1,at=a.size*a.sizeRatio*Q,[it,st]=(0,j._f)(a.scaleInfo,T),d=new J(a.materialKey,at,a.outlineSize*a.sizeRatio,a.referenceSize,(0,k.t2)(a.color),(0,k.t2)(a.outlineColor),a.horizontalAlignment,a.verticalAlignment,a.alignment,a.decoration,a.colorLocked??!1,a.angle,a.offsetX*a.sizeRatio*Q,a.offsetY*a.sizeRatio*Q,a.lineWidth||512,1,a.markerPlacement,a.effects,!0,it,st,a.backgroundColor?(0,k.t2)(a.backgroundColor):void 0,a.borderLineColor?(0,k.t2)(a.borderLineColor):void 0,a.borderLineWidth),[,_]=(0,F.E)(a.text);return d.bindTextInfo(u,_),d._vertexBoundsScale=a.maxVVSize?a.maxVVSize/at:1,d}}},50114:(Kt,St,f)=>{f.d(St,{Fv:()=>k,Ir:()=>ft,NW:()=>q,TK:()=>Z,_f:()=>J,g4:()=>F,lu:()=>pt});const F=0,ft=100;function pt(P,a,u){return P[0]=a[0]-u[0],P[1]=a[1]-u[1],P}function V(P,a){return Math.sqrt(P*P+a*a)}function k(P){const a=V(P[0],P[1]);P[0]/=a,P[1]/=a}function Z(P,a){return V(P[0]-a[0],P[1]-a[1])}function q(P=2){return 1/Math.max(P,1)}function J(P,a){return[!!P?.minScale&&a.scaleToZoom(P.minScale)||F,!!P?.maxScale&&a.scaleToZoom(P.maxScale)||ft]}},32940:(Kt,St,f)=>{f.d(St,{fL:()=>ot});var F=f(15861),ft=f(85931),pt=f(26584),V=f(63290),k=f(93961),Z=f(46679),q=f(39236),U=f(51584);const j=V.Z.getLogger("esri/views/2d/engine/webgl/util/Matcher");function ot(d,_,v,E){return b.apply(this,arguments)}function b(){return(b=(0,F.Z)(function*(d,_,v,E){switch(d.type){case"simple":case"heatmap":return xt.fromBasicRenderer(d,_,v,E);case"map":return a.fromUVRenderer(d,_,v,E);case"interval":return P.fromCBRenderer(d,_,v,E);case"dictionary":return st.fromDictionaryRenderer(d,_,v,E);case"pie-chart":return J.fromPieChartRenderer(d,_,v,E);case"subtype":return J.fromSubtypes(d,_,v,E)}})).apply(this,arguments)}class xt{constructor(){this.type="feature",this._defaultResult=null}static fromBasicRenderer(_,v,E,L){return(0,F.Z)(function*(){const B=new xt;if(_.symbol){const W=yield(0,U.B)(_.symbol,E,L),O=v.createTemplateGroup(W,null);B.setDefault(O)}return B})()}static fromPieChartRenderer(_,v,E,L){return(0,F.Z)(function*(){const B=new xt;if(_.markerSymbol){const W=yield(0,U.B)(_.markerSymbol,E,L);let O;_.fillSymbol&&(O=yield(0,U.B)(_.fillSymbol,E,L));const p=v.createTemplateGroup(W,O);B.setDefault(p)}return B})()}size(){return 1}getDefault(){return this._defaultResult}setDefault(_){this._defaultResult=_}match(_,v,E,L,B){return this.getDefault()}analyze(_,v,E,L,B,W){return(0,F.Z)(function*(){return null})()}}class J extends xt{constructor(_,v){super(),this._subMatchers=_,this._subtypeField=v}static fromSubtypes(_,v,E,L){return(0,F.Z)(function*(){const B=new Map,W=[];for(const O in _.renderers){const p=parseInt(O,10),Y=ot(_.renderers[O],v,E,L).then(m=>B.set(p,m));W.push(Y)}return yield Promise.all(W),new J(B,_.subtypeField)})()}match(_,v,E,L,B){const W=v.readAttribute(this._subtypeField),O=this._subMatchers.get(W);return O?O.match(_,v,E,L,B):null}}class P extends xt{constructor(_,v,E,L){super(),this.type="interval",this._intervals=[],this._isMaxInclusive=v,this._fieldIndex=L,this._field=_,this._normalizationInfo=E}static fromCBRenderer(_,v,E,L){return(0,F.Z)(function*(){const{isMaxInclusive:B,normalizationField:W,normalizationTotal:O,normalizationType:p}=_,m=new P(_.field,B,{normalizationField:W,normalizationTotal:O,normalizationType:p},_.fieldIndex),c=yield(0,U.B)(_.backgroundFillSymbol,E,L);yield Promise.all(_.intervals.map(function(){var _t=(0,F.Z)(function*(tt){const lt=yield(0,U.B)(tt.symbol,E,L),rt=v.createTemplateGroup(lt,c);m.add({min:tt.min,max:tt.max},rt)});return function(tt){return _t.apply(this,arguments)}}()));const H=yield(0,U.B)(_.defaultSymbol,E,L);if(H){const _t=v.createTemplateGroup(H,c);m.setDefault(_t)}return m})()}add(_,v){this._intervals.push({interval:_,result:v}),this._intervals.sort((E,L)=>E.interval.min-L.interval.min)}size(){return super.size()+this._intervals.length}match(_,v,E,L,B){if(null==this._fieldIndex&&!this._field)return this.getDefault();const W=null!=this._fieldIndex?v.getComputedNumericAtIndex(this._fieldIndex):this._getValueFromField(v);if(null==W||isNaN(W)||W===1/0||W===-1/0)return this.getDefault();for(let O=0;O<this._intervals.length;O++){const{interval:p,result:Y}=this._intervals[O];if(W>=p.min&&(this._isMaxInclusive?W<=p.max:W<p.max))return Y}return this.getDefault()}_needsNormalization(){const _=this._normalizationInfo;return _&&(_.normalizationField||_.normalizationTotal||_.normalizationType)}_getValueFromField(_){const v=_.readAttribute(this._field);if(!this._needsNormalization()||null==v)return v;const{normalizationField:E,normalizationTotal:L,normalizationType:B}=this._normalizationInfo,W=_.readAttribute(E)??1;if(B)switch(B){case"esriNormalizeByField":return W?v/W:void 0;case"esriNormalizeByLog":return Math.log(v)*Math.LOG10E;case"esriNormalizeByPercentOfTotal":return v/L*100;default:return void j.error(`Found unknown normalization type: ${B}`)}else j.error("Normalization is required, but no type was set!")}}class a extends xt{constructor(_,v,E){super(),this.type="map",this._nullResult=null,this._resultsMap=new Map,this._fields=[],this._fieldsIndex=E,this._fields=_,this._seperator=v||""}static fromUVRenderer(_,v,E,L){return(0,F.Z)(function*(){const B=_.fieldDelimiter,W=[_.field];_.field2&&W.push(_.field2),_.field3&&W.push(_.field3);const O=yield(0,U.B)(_.backgroundFillSymbol,E,L),p=new a(W,B,_.fieldIndex);yield Promise.all(_.map.map(function(){var m=(0,F.Z)(function*(c,H){const _t=yield(0,U.B)(c.symbol,E,L),lt=v.createTemplateGroup(_t,O,H+1);"<Null>"===c.value?p.setNullResult(lt):p.add(c.value,lt)});return function(c,H){return m.apply(this,arguments)}}()));const Y=yield(0,U.B)(_.defaultSymbol,E,L);if(Y){const c=v.createTemplateGroup(Y,O,Number.MAX_SAFE_INTEGER);p.setDefault(c)}return p})()}setNullResult(_){this._nullResult=_}add(_,v){this._resultsMap.set(_.toString(),v)}size(){return super.size()+this._resultsMap.size}match(_,v,E,L,B){if(null==this._fieldsIndex&&!this._fields)return this.getDefault();const W=null!=this._fieldsIndex?v.getComputedStringAtIndex(this._fieldsIndex):this._getValueFromFields(v);if(null!==this._nullResult&&(null==W||""===W||"<Null>"===W))return this._nullResult;if(null==W)return this.getDefault();const O=W.toString();return this._resultsMap.has(O)?this._resultsMap.get(O):this.getDefault()}_getValueFromFields(_){const v=[];for(const E of this._fields){const L=_.readAttribute(E);v.push(null==L||""===L?"<Null>":L)}return v.join(this._seperator)}}function T(){return(T=(0,F.Z)(function*(d,_){const v=d||1;if("number"==typeof v)return(L,B,W)=>v;const E=yield(0,Z.Yi)(v,_.spatialReference,_.fields);return(L,B,W)=>(0,q.Z)(E,L,{$view:W},_.geometryType,B)||1})).apply(this,arguments)}let Q;function at(){return it.apply(this,arguments)}function it(){return(it=(0,F.Z)(function*(){return Q||(Q=f.e(3250).then(f.bind(f,3250))),Q})).apply(this,arguments)}class st extends xt{constructor(_,v,E,L,B,W){super(),this.type="dictionary",this._groupIdCache=new k.z(100),this._loader=_,this._fieldMap=_.fieldMap,this._symbolFields=_.getSymbolFields(),this._templates=v,this._info=E,this._scaleFn=L,this._schemaUtilsModule=B,this._symbolOptions=W}static fromDictionaryRenderer(_,v,E,L){return(0,F.Z)(function*(){const[{DictionaryLoader:B},W]=yield Promise.all([Promise.resolve().then(f.bind(f,29996)),at()]),O=new B(_.url,_.config,_.fieldMap);yield O.fetchResources({spatialReference:E.spatialReference,fields:E.fields});const p=yield function u(d,_){return T.apply(this,arguments)}(_.scaleExpression,E);return new st(O,v,E,p,W,_.symbolOptions)})()}_analyzeFeature(_,v,E,L,B){var W=this;return(0,F.Z)(function*(){const O=_.readLegacyFeature(),p=W._scaleFn(O,E,L),Y=W._attributeHash(O)+"-"+p,m=W._groupIdCache.get(Y);if(m)return m;const c={...L,spatialReference:W._info.spatialReference,abortOptions:B,fields:W._info.fields},H=yield W._loader.getSymbolAsync(O,c),_t=W._schemaUtilsModule.createSymbolSchema(H,W._symbolOptions),tt=(0,U.B)(_t,W._info,v,B).then(lt=>{if("expanded-cim"!==lt?.type)return j.error(new pt.Z("mapview-bad-type",`Found unexpected type ${lt?.type} in dictionary response`)),null;lt.hash+="-"+p;for(const rt of lt.layers)rt.scaleFactor=p,rt.templateHash+="-"+p;return W._templates.createTemplateGroup(lt,null)});return W._groupIdCache.put(Y,tt,1),tt})()}analyze(_,v,E,L,B,W){var O=this;return(0,F.Z)(function*(){const p=v.getCursor(),Y=[];for(;p.next();)Y.push(O._analyzeFeature(p,E,L,B,W));return Promise.all(Y).then(m=>m.filter(ft.pC))})()}match(_,v,E,L,B){return null}_attributeHash(_){let v="";for(const E of this._symbolFields){const L=this._fieldMap?.[E];L&&(v+=_.attributes[L]+"-")}return v}}},84450:(Kt,St,f)=>{f.d(St,{ok:()=>ft});var F=f(26584);function ft(pt,V){return!pt||!("name"in pt)||(V&&V.error(new F.Z(pt.name,pt.message,pt.details)),!1)}},75734:(Kt,St,f)=>{f.d(St,{Z:()=>ft});class ft{get length(){return this._pos}constructor(V,k){this._pos=0;const Z=k?this._roundToNearest(k,V.BYTES_PER_ELEMENT):40;this._array=new ArrayBuffer(Z),this._buffer=new V(this._array),this._ctor=V,this._i16View=new Int16Array(this._array)}_roundToNearest(V,k){const Z=Math.round(V);return 1===k?Z:Z+(k-Z%k)}_ensureSize(V){if(this._pos+V>=this._buffer.length){const k=this._roundToNearest(1.25*(this._array.byteLength+V*this._buffer.BYTES_PER_ELEMENT),this._buffer.BYTES_PER_ELEMENT),Z=new ArrayBuffer(k),q=new this._ctor(Z);q.set(this._buffer,0),this._array=Z,this._buffer=q,this._i16View=new Int16Array(this._array)}}ensureSize(V){this._ensureSize(V)}writeF32(V){this._ensureSize(1);const k=this._pos;return new Float32Array(this._array,4*this._pos,1)[0]=V,this._pos++,k}push(V){this._ensureSize(1);const k=this._pos;return this._buffer[this._pos++]=V,k}writeFixed(V){this._buffer[this._pos++]=V}setValue(V,k){this._buffer[V]=k}i1616Add(V,k,Z){this._i16View[2*V]+=k,this._i16View[2*V+1]+=Z}getValue(V){return this._buffer[V]}incr(V){if(this._buffer.length<V)throw new Error("Increment index overflows the target buffer");this._buffer[V]++}decr(V){this._buffer[V]--}writeRegion(V){this._ensureSize(V.length);const k=this._pos;return this._buffer.set(V,this._pos),this._pos+=V.length,k}writeManyFrom(V,k,Z){this._ensureSize(Z-k);for(let q=k;q!==Z;q++)this.writeFixed(V._buffer[q])}buffer(){const V=this._array.slice(0,4*this._pos);return this.destroy(),V}toArray(){return[...this._buffer]}seek(V){this._pos=V}destroy(){this._array=null,this._buffer=null}}},55376:(Kt,St,f)=>{function F(ft,pt,V,k){const Z=ft.clone(),q=1<<Z.level,U=Z.col+pt,j=Z.row+V;return k&&U<0?(Z.col=U+q,Z.world-=1):U>=q?(Z.col=U-q,Z.world+=1):Z.col=U,Z.row=j,Z}f.d(St,{M:()=>F})},32954:(Kt,St,f)=>{function F(ft){if(null==ft)return[];const pt=new Array(ft.length);for(let V=0;V<ft.length;V++)pt[V]=ft.charCodeAt(V);return pt}f.d(St,{_:()=>F})}}]);