"use strict";(self.webpackChunkCRIS=self.webpackChunkCRIS||[]).push([[1590],{90301:(R,d,t)=>{t.d(d,{JZ:()=>u,RL:()=>M,eY:()=>p});var l=t(15861),o=t(10699),r=t(30217),h=t(49966),_=t(9545),x=t(57477),g=t(14403),m=t(80738),E=t(67969),O=t(18952),B=t(31548);function u(a){return a&&"render"in a}function M(a){const e=document.createElement("canvas");return e.width=a.width,e.height=a.height,a.render(e.getContext("2d")),e}class p extends x.s{constructor(e=null,i=!1){super(),this.blendFunction="standard",this._sourceWidth=0,this._sourceHeight=0,this._textureInvalidated=!1,this._texture=null,this.stencilRef=0,this.coordScale=[1,1],this._height=void 0,this.pixelRatio=1,this.resolution=0,this.rotation=0,this._source=null,this._width=void 0,this.x=0,this.y=0,this.immutable=i,this.source=e,this.requestRender=this.requestRender.bind(this)}destroy(){this._texture&&(this._texture.dispose(),this._texture=null),null!=this._uploadStatus&&(this._uploadStatus.controller.abort(),this._uploadStatus=null)}get isSourceScaled(){return this.width!==this._sourceWidth||this.height!==this._sourceHeight}get height(){return void 0!==this._height?this._height:this._sourceHeight}set height(e){this._height=e}get source(){return this._source}set source(e){null==e&&null==this._source||(this._source=e,this.invalidateTexture(),this.requestRender())}get width(){return void 0!==this._width?this._width:this._sourceWidth}set width(e){this._width=e}beforeRender(e){super.beforeRender(e),this.updateTexture(e)}setSourceAsync(e,i){var s=this;return(0,l.Z)(function*(){null!=s._uploadStatus&&s._uploadStatus.controller.abort();const c=new AbortController,n=(0,o.hh)();return(0,o.$F)(i,()=>c.abort()),(0,o.$F)(c,D=>n.reject(D)),s._uploadStatus={controller:c,resolver:n},s.source=e,n.promise})()}invalidateTexture(){this._textureInvalidated||(this._textureInvalidated=!0,this._source instanceof HTMLImageElement?(this._sourceHeight=this._source.naturalHeight,this._sourceWidth=this._source.naturalWidth):this._source&&(this._sourceHeight=this._source.height,this._sourceWidth=this._source.width))}updateTransitionProperties(e,i){e>=64&&(this.fadeTransitionEnabled=!1,this.inFadeTransition=!1),super.updateTransitionProperties(e,i)}setTransform(e){const i=(0,r.g)(this.transforms.dvs),[s,c]=e.toScreenNoRotation([0,0],[this.x,this.y]),n=this.resolution/this.pixelRatio/e.resolution,D=n*this.width,v=n*this.height,C=Math.PI*this.rotation/180;(0,r.h)(i,i,(0,_.f)(s,c)),(0,r.h)(i,i,(0,_.f)(D/2,v/2)),(0,r.r)(i,i,-C),(0,r.h)(i,i,(0,_.f)(-D/2,-v/2)),(0,r.l)(i,i,(0,_.f)(D,v)),(0,r.m)(this.transforms.dvs,e.displayViewMat3,i)}setSamplingProfile(e){this._texture&&(e.mips&&!this._texture.descriptor.hasMipmap&&this._texture.generateMipmap(),this._texture.setSamplingMode(e.samplingMode))}bind(e,i){this._texture&&e.bindTexture(this._texture,i)}updateTexture({context:e,painter:i}){var s=this;return(0,l.Z)(function*(){if(!s._textureInvalidated)return;if(s._textureInvalidated=!1,s._texture||(s._texture=s._createTexture(e)),!s.source)return void s._texture.setData(null);s._texture.resize(s._sourceWidth,s._sourceHeight);const c=function P(a){return u(a)?a instanceof g.Z?a.getRenderedRasterPixels()?.renderedRasterPixels:M(a):a}(s.source);try{if(null!=s._uploadStatus){const{controller:n,resolver:D}=s._uploadStatus,v={signal:n.signal},{width:C,height:T}=s,I=s._texture;yield i.textureUploadManager.enqueueTextureUpdate({data:c,texture:I,width:C,height:T},v),D.resolve(),s._uploadStatus=null}else s._texture.setData(c);s.ready()}catch(n){(0,o.H9)(n)}})()}onDetach(){this.destroy()}_createTransforms(){return{dvs:(0,h.c)()}}_createTexture(e){const i=this.immutable&&e.type===m.zO.WEBGL2,s=new B.X;return s.internalFormat=i?E.lP.RGBA8:E.VI.RGBA,s.wrapMode=E.e8.CLAMP_TO_EDGE,s.isImmutable=i,s.width=this._sourceWidth,s.height=this._sourceHeight,new O.x(e,s)}}},14403:(R,d,t)=>{t.d(d,{Z:()=>l});class l{constructor(r,h,_){this.pixelBlock=r,this.extent=h,this.originalPixelBlock=_}get width(){return null!=this.pixelBlock?this.pixelBlock.width:0}get height(){return null!=this.pixelBlock?this.pixelBlock.height:0}render(r){const h=this.pixelBlock;if(null==h)return;const _=this.filter({extent:this.extent,pixelBlock:this.originalPixelBlock??h});if(null==_.pixelBlock)return;_.pixelBlock.maskIsAlpha&&(_.pixelBlock.premultiplyAlpha=!0);const x=_.pixelBlock.getAsRGBA(),g=r.createImageData(_.pixelBlock.width,_.pixelBlock.height);g.data.set(x),r.putImageData(g,0,0)}getRenderedRasterPixels(){const r=this.filter({extent:this.extent,pixelBlock:this.pixelBlock});return null==r.pixelBlock?null:(r.pixelBlock.maskIsAlpha&&(r.pixelBlock.premultiplyAlpha=!0),{width:r.pixelBlock.width,height:r.pixelBlock.height,renderedRasterPixels:new Uint8Array(r.pixelBlock.getAsRGBA().buffer)})}}},54126:(R,d,t)=>{t.r(d),t.d(d,{default:()=>a});var l=t(15861),o=t(17626),r=t(63290),h=t(10699),_=t(77712),E=(t(90912),t(85931),t(8314),t(76898)),O=t(91757),B=t(37384),u=t(67802),M=t(45611),P=t(94421);let p=class extends((0,P.Z)((0,B.y)(M.Z))){update(e){this._strategy.update(e).catch(i=>{(0,h.D_)(i)||r.Z.getLogger(this).error(i)}),this.notifyChange("updating")}attach(){this._bitmapContainer=new O.c,this.container.addChild(this._bitmapContainer),this._strategy=new u.Z({container:this._bitmapContainer,fetchSource:this.fetchBitmapData.bind(this),requestUpdate:this.requestUpdate.bind(this)})}detach(){this._strategy.destroy(),this._strategy=null,this.container.removeChild(this._bitmapContainer),this._bitmapContainer.removeAllChildren()}moveStart(){}viewChange(){}moveEnd(){this.requestUpdate()}fetchBitmapData(e,i,s){return this.layer.fetchImageBitmap(e,i,s)}doRefresh(){var e=this;return(0,l.Z)(function*(){e.requestUpdate()})()}isUpdating(){return this._strategy.updating||this.updateRequested}};(0,o._)([(0,_.Cb)()],p.prototype,"_strategy",void 0),(0,o._)([(0,_.Cb)()],p.prototype,"updating",void 0),p=(0,o._)([(0,E.j)("esri.views.2d.layers.BaseDynamicLayerView2D")],p);const a=p},94421:(R,d,t)=>{t.d(d,{Z:()=>O});var l=t(17626),o=t(63290),r=t(10699),h=t(32917),_=t(77712),E=(t(90912),t(85931),t(8314),t(76898));const O=B=>{let u=class extends B{initialize(){this.addHandles((0,h.on)(()=>this.layer,"refresh",M=>{this.doRefresh(M.dataChanged).catch(P=>{(0,r.D_)(P)||o.Z.getLogger(this).error(P)})}),"RefreshableLayerView")}};return(0,l._)([(0,_.Cb)()],u.prototype,"layer",void 0),u=(0,l._)([(0,E.j)("esri.layers.mixins.RefreshableLayerView")],u),u}}}]);