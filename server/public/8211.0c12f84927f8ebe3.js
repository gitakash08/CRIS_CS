"use strict";(self.webpackChunkCRIS=self.webpackChunkCRIS||[]).push([[8211],{36161:(it,K,w)=>{w.d(K,{I:()=>V,v:()=>U});var H=w(21286);function V(O,M,b=0){const n=(0,H.uZ)(O,0,D);for(let a=0;a<4;a++)M[b+a]=Math.floor(256*L(n*k[a]))}function U(O,M=0){let b=0;for(let n=0;n<4;n++)b+=O[M+n]*G[n];return b}const k=[1,256,65536,16777216],G=[1/256,1/65536,1/16777216,1/4294967296],D=U(new Uint8ClampedArray([255,255,255,255]));function L(O){return O-Math.floor(O)}},13160:(it,K,w)=>{var V,U,b;w.d(K,{E9:()=>k,I6:()=>L,Vl:()=>V,bN:()=>D}),(b=V||(V={}))[b.Unknown=0]="Unknown",b[b.Point=1]="Point",b[b.LineString=2]="LineString",b[b.Polygon=3]="Polygon";class k{constructor(n,a){this.x=n,this.y=a}clone(){return new k(this.x,this.y)}equals(n,a){return n===this.x&&a===this.y}isEqual(n){return n.x===this.x&&n.y===this.y}setCoords(n,a){this.x=n,this.y=a}normalize(){const n=this.x,a=this.y,p=Math.sqrt(n*n+a*a);this.x/=p,this.y/=p}rightPerpendicular(){const n=this.x;this.x=this.y,this.y=-n}move(n,a){this.x+=n,this.y+=a}assign(n){this.x=n.x,this.y=n.y}assignAdd(n,a){this.x=n.x+a.x,this.y=n.y+a.y}assignSub(n,a){this.x=n.x-a.x,this.y=n.y-a.y}rotate(n,a){const p=this.x,y=this.y;this.x=p*n-y*a,this.y=p*a+y*n}scale(n){this.x*=n,this.y*=n}length(){const n=this.x,a=this.y;return Math.sqrt(n*n+a*a)}static distance(n,a){const p=a.x-n.x,y=a.y-n.y;return Math.sqrt(p*p+y*y)}static add(n,a){return new k(n.x+a.x,n.y+a.y)}static sub(n,a){return new k(n.x-a.x,n.y-a.y)}}class G{constructor(n,a,p){this.ratio=n,this.x=a,this.y=p}}class D{constructor(n,a,p,y=8,g=8){this._lines=[],this._starts=[],this.validateTessellation=!0,this._pixelRatio=y,this._pixelMargin=g,this._tileSize=512*y,this._dz=n,this._yPos=a,this._xPos=p}setPixelMargin(n){n!==this._pixelMargin&&(this._pixelMargin=n,this.setExtent(this._extent))}setExtent(n){this._extent=n,this._finalRatio=this._tileSize/n*(1<<this._dz);let a=this._pixelRatio*this._pixelMargin;a/=this._finalRatio;const p=n>>this._dz;a>p&&(a=p),this._margin=a,this._xmin=p*this._xPos-a,this._ymin=p*this._yPos-a,this._xmax=this._xmin+p+2*a,this._ymax=this._ymin+p+2*a}reset(n){this._type=n,this._lines=[],this._starts=[],this._line=null,this._start=0}moveTo(n,a){this._pushLine(),this._prevIsIn=this._isIn(n,a),this._moveTo(n,a,this._prevIsIn),this._prevPt=new k(n,a),this._firstPt=new k(n,a),this._dist=0}lineTo(n,a){const p=this._isIn(n,a),y=new k(n,a),g=k.distance(this._prevPt,y);let m,T,v,x,J,j,z,B;if(p)this._prevIsIn?this._lineTo(n,a,!0):(m=this._prevPt,T=y,v=this._intersect(T,m),this._start=this._dist+g*(1-this._r),this._lineTo(v.x,v.y,!0),this._lineTo(T.x,T.y,!0));else if(this._prevIsIn)T=this._prevPt,m=y,v=this._intersect(T,m),this._lineTo(v.x,v.y,!0),this._lineTo(m.x,m.y,!1);else{const I=this._prevPt,P=y;if(I.x<=this._xmin&&P.x<=this._xmin||I.x>=this._xmax&&P.x>=this._xmax||I.y<=this._ymin&&P.y<=this._ymin||I.y>=this._ymax&&P.y>=this._ymax)this._lineTo(P.x,P.y,!1);else{const F=[];if((I.x<this._xmin&&P.x>this._xmin||I.x>this._xmin&&P.x<this._xmin)&&(x=(this._xmin-I.x)/(P.x-I.x),B=I.y+x*(P.y-I.y),B<=this._ymin?j=!1:B>=this._ymax?j=!0:F.push(new G(x,this._xmin,B))),(I.x<this._xmax&&P.x>this._xmax||I.x>this._xmax&&P.x<this._xmax)&&(x=(this._xmax-I.x)/(P.x-I.x),B=I.y+x*(P.y-I.y),B<=this._ymin?j=!1:B>=this._ymax?j=!0:F.push(new G(x,this._xmax,B))),(I.y<this._ymin&&P.y>this._ymin||I.y>this._ymin&&P.y<this._ymin)&&(x=(this._ymin-I.y)/(P.y-I.y),z=I.x+x*(P.x-I.x),z<=this._xmin?J=!1:z>=this._xmax?J=!0:F.push(new G(x,z,this._ymin))),(I.y<this._ymax&&P.y>this._ymax||I.y>this._ymax&&P.y<this._ymax)&&(x=(this._ymax-I.y)/(P.y-I.y),z=I.x+x*(P.x-I.x),z<=this._xmin?J=!1:z>=this._xmax?J=!0:F.push(new G(x,z,this._ymax))),0===F.length)this._lineTo(J?this._xmax:this._xmin,j?this._ymax:this._ymin,!0);else if(F.length>1&&F[0].ratio>F[1].ratio)this._start=this._dist+g*F[1].ratio,this._lineTo(F[1].x,F[1].y,!0),this._lineTo(F[0].x,F[0].y,!0);else{this._start=this._dist+g*F[0].ratio;for(let N=0;N<F.length;N++)this._lineTo(F[N].x,F[N].y,!0)}this._lineTo(P.x,P.y,!1)}}this._dist+=g,this._prevIsIn=p,this._prevPt=y}close(){if(this._line.length>2){const n=this._firstPt,a=this._prevPt;n.x===a.x&&n.y===a.y||this.lineTo(n.x,n.y);const p=this._line;let y=p.length;for(;y>=4&&(p[0].x===p[1].x&&p[0].x===p[y-2].x||p[0].y===p[1].y&&p[0].y===p[y-2].y);)p.pop(),p[0].x=p[y-2].x,p[0].y=p[y-2].y,--y}}result(n=!0){return this._pushLine(),0===this._lines.length?null:(this._type===V.Polygon&&n&&O.simplify(this._tileSize,this._margin*this._finalRatio,this._lines),this._lines)}resultWithStarts(){if(this._type!==V.LineString)throw new Error("Only valid for lines");this._pushLine();const n=this._lines,a=n.length;if(0===a)return null;const p=[];for(let y=0;y<a;y++)p.push({line:n[y],start:this._starts[y]||0});return p}_isIn(n,a){return n>=this._xmin&&n<=this._xmax&&a>=this._ymin&&a<=this._ymax}_intersect(n,a){let p,y,g;if(a.x>=this._xmin&&a.x<=this._xmax)y=a.y<=this._ymin?this._ymin:this._ymax,g=(y-n.y)/(a.y-n.y),p=n.x+g*(a.x-n.x);else if(a.y>=this._ymin&&a.y<=this._ymax)p=a.x<=this._xmin?this._xmin:this._xmax,g=(p-n.x)/(a.x-n.x),y=n.y+g*(a.y-n.y);else{y=a.y<=this._ymin?this._ymin:this._ymax,p=a.x<=this._xmin?this._xmin:this._xmax;const m=(p-n.x)/(a.x-n.x),T=(y-n.y)/(a.y-n.y);m<T?(g=m,y=n.y+m*(a.y-n.y)):(g=T,p=n.x+T*(a.x-n.x))}return this._r=g,new k(p,y)}_pushLine(){this._line&&(this._type===V.Point?this._line.length>0&&(this._lines.push(this._line),this._starts.push(this._start)):this._type===V.LineString?this._line.length>1&&(this._lines.push(this._line),this._starts.push(this._start)):this._type===V.Polygon&&this._line.length>3&&(this._lines.push(this._line),this._starts.push(this._start))),this._line=[],this._start=0}_moveTo(n,a,p){this._type!==V.Polygon?p&&(n=Math.round((n-(this._xmin+this._margin))*this._finalRatio),a=Math.round((a-(this._ymin+this._margin))*this._finalRatio),this._line.push(new k(n,a))):(p||(n<this._xmin&&(n=this._xmin),n>this._xmax&&(n=this._xmax),a<this._ymin&&(a=this._ymin),a>this._ymax&&(a=this._ymax)),n=Math.round((n-(this._xmin+this._margin))*this._finalRatio),a=Math.round((a-(this._ymin+this._margin))*this._finalRatio),this._line.push(new k(n,a)),this._isH=!1,this._isV=!1)}_lineTo(n,a,p){let y,g;if(this._type!==V.Polygon)if(p){if(n=Math.round((n-(this._xmin+this._margin))*this._finalRatio),a=Math.round((a-(this._ymin+this._margin))*this._finalRatio),this._line.length>0&&(y=this._line[this._line.length-1],y.equals(n,a)))return;this._line.push(new k(n,a))}else this._line&&this._line.length>0&&this._pushLine();else if(p||(n<this._xmin&&(n=this._xmin),n>this._xmax&&(n=this._xmax),a<this._ymin&&(a=this._ymin),a>this._ymax&&(a=this._ymax)),n=Math.round((n-(this._xmin+this._margin))*this._finalRatio),a=Math.round((a-(this._ymin+this._margin))*this._finalRatio),this._line&&this._line.length>0){y=this._line[this._line.length-1];const m=y.x===n,T=y.y===a;if(m&&T)return;this._isH&&m||this._isV&&T?(y.x=n,y.y=a,g=this._line[this._line.length-2],g.x===n&&g.y===a?(this._line.pop(),this._line.length<=1?(this._isH=!1,this._isV=!1):(g=this._line[this._line.length-2],this._isH=g.x===n,this._isV=g.y===a)):(this._isH=g.x===n,this._isV=g.y===a)):(this._line.push(new k(n,a)),this._isH=m,this._isV=T)}else this._line.push(new k(n,a))}}class L{setExtent(n){this._ratio=4096===n?1:4096/n}get validateTessellation(){return this._ratio<1}reset(n){this._lines=[],this._line=null}moveTo(n,a){this._line&&this._lines.push(this._line),this._line=[];const p=this._ratio;this._line.push(new k(n*p,a*p))}lineTo(n,a){const p=this._ratio;this._line.push(new k(n*p,a*p))}close(){const n=this._line;n&&!n[0].isEqual(n[n.length-1])&&n.push(n[0])}result(){return this._line&&this._lines.push(this._line),0===this._lines.length?null:this._lines}}!function(b){b[b.sideLeft=0]="sideLeft",b[b.sideRight=1]="sideRight",b[b.sideTop=2]="sideTop",b[b.sideBottom=3]="sideBottom"}(U||(U={}));class O{static simplify(n,a,p){if(!p)return;const y=-a,g=n+a,m=-a,T=n+a,v=[],x=[],J=p.length;for(let z=0;z<J;++z){const B=p[z];if(!B||B.length<2)continue;let I,P=B[0];const F=B.length;for(let N=1;N<F;++N)I=B[N],P.x===I.x&&(P.x<=y&&(P.y>I.y?(v.push(z),v.push(N),v.push(U.sideLeft),v.push(-1)):(x.push(z),x.push(N),x.push(U.sideLeft),x.push(-1))),P.x>=g&&(P.y<I.y?(v.push(z),v.push(N),v.push(U.sideRight),v.push(-1)):(x.push(z),x.push(N),x.push(U.sideRight),x.push(-1)))),P.y===I.y&&(P.y<=m&&(P.x<I.x?(v.push(z),v.push(N),v.push(U.sideTop),v.push(-1)):(x.push(z),x.push(N),x.push(U.sideTop),x.push(-1))),P.y>=T&&(P.x>I.x?(v.push(z),v.push(N),v.push(U.sideBottom),v.push(-1)):(x.push(z),x.push(N),x.push(U.sideBottom),x.push(-1)))),P=I}if(0===v.length||0===x.length)return;O.fillParent(p,x,v),O.fillParent(p,v,x);const j=[];O.calcDeltas(j,x,v),O.calcDeltas(j,v,x),O.addDeltas(j,p)}static fillParent(n,a,p){const y=p.length,g=a.length;for(let m=0;m<g;m+=4){const T=a[m],v=a[m+1],x=a[m+2],J=n[T][v-1],j=n[T][v];let z=8092,B=-1;for(let I=0;I<y;I+=4){if(p[I+2]!==x)continue;const P=p[I],F=p[I+1],N=n[P][F-1],st=n[P][F];switch(x){case U.sideLeft:case U.sideRight:if(M(J.y,N.y,st.y)&&M(j.y,N.y,st.y)){const rt=Math.abs(st.y-N.y);rt<z&&(z=rt,B=I)}break;case U.sideTop:case U.sideBottom:if(M(J.x,N.x,st.x)&&M(j.x,N.x,st.x)){const rt=Math.abs(st.x-N.x);rt<z&&(z=rt,B=I)}}}a[m+3]=B}}static calcDeltas(n,a,p){const y=a.length;for(let g=0;g<y;g+=4){const T=O.calcDelta(g,a,p,[]);n.push(a[g]),n.push(a[g+1]),n.push(a[g+2]),n.push(T)}}static calcDelta(n,a,p,y){const g=a[n+3];if(-1===g)return 0;const m=y.length;return m>1&&y[m-2]===g?0:(y.push(g),O.calcDelta(g,p,a,y)+1)}static addDeltas(n,a){const p=n.length;let y=0;for(let g=0;g<p;g+=4){const m=n[g+3];m>y&&(y=m)}for(let g=0;g<p;g+=4){const m=a[n[g]],T=n[g+1],v=y-n[g+3];switch(n[g+2]){case U.sideLeft:m[T-1].x-=v,m[T].x-=v,1===T&&(m[m.length-1].x-=v),T===m.length-1&&(m[0].x-=v);break;case U.sideRight:m[T-1].x+=v,m[T].x+=v,1===T&&(m[m.length-1].x+=v),T===m.length-1&&(m[0].x+=v);break;case U.sideTop:m[T-1].y-=v,m[T].y-=v,1===T&&(m[m.length-1].y-=v),T===m.length-1&&(m[0].y-=v);break;case U.sideBottom:m[T-1].y+=v,m[T].y+=v,1===T&&(m[m.length-1].y+=v),T===m.length-1&&(m[0].y+=v)}}}}const M=(b,n,a)=>b>=n&&b<=a||b>=a&&b<=n},26996:(it,K,w)=>{w.d(K,{Y:()=>k,m:()=>G});var H=w(36161),V=w(21286);const U=D=>"vertical"===D||"horizontal"===D||"cross"===D||"esriSFSCross"===D||"esriSFSVertical"===D||"esriSFSHorizontal"===D;function k(D,L,O){const M=(0,V.fp)(Math.ceil(O)),b=U(L)?8*M:16*M,n=2*M;D.width=b,D.height=b;const a=D.getContext("2d");a.strokeStyle="#FFFFFF",a.lineWidth=M,a.beginPath(),"vertical"!==L&&"cross"!==L&&"esriSFSCross"!==L&&"esriSFSVertical"!==L||(a.moveTo(b/2,-n),a.lineTo(b/2,b+n)),"horizontal"!==L&&"cross"!==L&&"esriSFSCross"!==L&&"esriSFSHorizontal"!==L||(a.moveTo(-n,b/2),a.lineTo(b+n,b/2)),"forward-diagonal"!==L&&"diagonal-cross"!==L&&"esriSFSDiagonalCross"!==L&&"esriSFSForwardDiagonal"!==L||(a.moveTo(-n,-n),a.lineTo(b+n,b+n),a.moveTo(b-n,-n),a.lineTo(b+n,n),a.moveTo(-n,b-n),a.lineTo(n,b+n)),"backward-diagonal"!==L&&"diagonal-cross"!==L&&"esriSFSBackwardDiagonal"!==L&&"esriSFSDiagonalCross"!==L||(a.moveTo(b+n,-n),a.lineTo(-n,b+n),a.moveTo(n,-n),a.lineTo(-n,n),a.moveTo(b+n,b-n),a.lineTo(b-n,b+n)),a.stroke();const p=a.getImageData(0,0,D.width,D.height),y=new Uint8Array(p.data);let g;for(let m=0;m<y.length;m+=4)g=y[m+3]/255,y[m]=y[m]*g,y[m+1]=y[m+1]*g,y[m+2]=y[m+2]*g;return[y,D.width,D.height]}function G(D,L){const O="Butt"===L,M="Square"===L,b=!O&&!M;D.length%2==1&&(D=[...D,...D]);const n=15.5;let p=0;for(const B of D)p+=B;const y=Math.round(p*n),g=new Float32Array(31*y),m=7.75;let T=0,v=0,x=.5,J=!0;for(const B of D){for(T=v,v+=B*n;x<=v;){let I=.5;for(;I<31;){const P=(I-.5)*y+x-.5,F=b?(I-n)*(I-n):Math.abs(I-n);g[P]=J?O?Math.max(Math.max(T+m-x,F),Math.max(x-v+m,F)):F:b?Math.min((x-T)*(x-T)+F,(x-v)*(x-v)+F):M?Math.min(Math.max(x-T,F),Math.max(v-x,F)):Math.min(Math.max(x-T+m,F),Math.max(v+m-x,F)),I++}x++}J=!J}const j=g.length,z=new Uint8Array(4*j);for(let B=0;B<j;++B){const I=(b?Math.sqrt(g[B]):g[B])/n;(0,H.I)(I,z,4*B)}return[z,y,31]}},86575:(it,K,w)=>{w.d(K,{DQ:()=>O,FM:()=>H,Or:()=>M,RD:()=>V,k3:()=>n,nF:()=>D,sX:()=>p,yF:()=>U});const H=Number.POSITIVE_INFINITY,V=Math.PI,U=2*V,k=128/V,D=V/180,L=1/Math.LN2;function O(g,m){return(g%=m)>=0?g:g+m}function M(g){return O(g*k,256)}function n(g){return Math.log(g)*L}function p(g,m,T){return g*(1-T)+m*T}},84439:(it,K,w)=>{w.d(K,{Z:()=>H});class H{constructor(U=0,k=0,G=0,D=0){this.x=U,this.y=k,this.width=G,this.height=D}get isEmpty(){return this.width<=0||this.height<=0}union(U){this.x=Math.min(this.x,U.x),this.y=Math.min(this.y,U.y),this.width=Math.max(this.width,U.width),this.height=Math.max(this.height,U.height)}}},26268:(it,K,w)=>{w.d(K,{Z:()=>L});var H=w(8314),V=w(39406),U=w(44589),k=w(8650),G=w(13382);const D=(O,M)=>O.key.level-M.key.level!=0?O.key.level-M.key.level:O.key.row-M.key.row!=0?O.key.row-M.key.row:O.key.col-M.key.col;class L extends U.Z{constructor(M){super(),this._tileInfoView=M}renderChildren(M){this.sortChildren(D),this.setStencilReference(M),super.renderChildren(M)}createRenderParams(M){const{state:b}=M,n=super.createRenderParams(M);return n.requiredLevel=this._tileInfoView.getClosestInfoForScale(b.scale).level,n.displayLevel=this._tileInfoView.tileInfo.scaleToZoom(b.scale),n}prepareRenderPasses(M){const b=super.prepareRenderPasses(M);return b.push(M.registerRenderPass({name:"stencil",brushes:[G.Z],drawPhase:V.jx.DEBUG|V.jx.MAP|V.jx.HIGHLIGHT,target:()=>this.getStencilTarget()})),(0,H.Z)("esri-tiles-debug")&&b.push(M.registerRenderPass({name:"tileInfo",brushes:[k.Z],drawPhase:V.jx.DEBUG,target:()=>this.children})),b}getStencilTarget(){return this.children}setStencilReference(M){let b=1;for(const n of this.children)n.stencilRef=b++}}},43783:(it,K,w)=>{w.d(K,{I:()=>k});var H=w(30217),V=w(57477),U=w(58098);class k extends V.s{constructor(D,L,O,M,b,n,a=b,p=n){super(),this.triangleCountReportedInDebug=0,this.triangleCount=0,this.texture=null,this.key=new U.Z(D),this.resolution=L,this.x=O,this.y=M,this.width=b,this.height=n,this.rangeX=a,this.rangeY=p}destroy(){this.texture&&(this.texture.dispose(),this.texture=null)}setTransform(D){const L=this.resolution/(D.resolution*D.pixelRatio),O=this.transforms.tileMat3,[M,b]=D.toScreenNoRotation([0,0],[this.x,this.y]);(0,H.s)(O,this.width/this.rangeX*L,0,0,0,this.height/this.rangeY*L,0,M,b,1),(0,H.m)(this.transforms.dvs,D.displayViewMat3,O)}}},95394:(it,K,w)=>{w.r(K),w.d(K,{default:()=>ye});var H=w(15861),V=w(17626),U=w(88879),k=w(58817),G=w(63290),D=w(62208),L=w(10699),O=w(77712),b=(w(90912),w(76898)),n=w(84682),a=w(65401),p=w(37053),y=w(919),g=w(21726),m=w(97347),T=w(84439);class v{constructor(t,s){this._width=0,this._height=0,this._free=[],this._width=t,this._height=s,this._free.push(new T.Z(0,0,t,s))}get width(){return this._width}get height(){return this._height}allocate(t,s){if(t>this._width||s>this._height)return new T.Z;let e=null,i=-1;for(let r=0;r<this._free.length;++r){const o=this._free[r];t<=o.width&&s<=o.height&&(null===e||o.y<=e.y&&o.x<=e.x)&&(e=o,i=r)}return null===e?new T.Z:(this._free.splice(i,1),e.width<e.height?(e.width>t&&this._free.push(new T.Z(e.x+t,e.y,e.width-t,s)),e.height>s&&this._free.push(new T.Z(e.x,e.y+s,e.width,e.height-s))):(e.width>t&&this._free.push(new T.Z(e.x+t,e.y,e.width-t,e.height)),e.height>s&&this._free.push(new T.Z(e.x,e.y+s,t,e.height-s))),new T.Z(e.x,e.y,t,s))}release(t){for(let s=0;s<this._free.length;++s){const e=this._free[s];if(e.y===t.y&&e.height===t.height&&e.x+e.width===t.x)e.width+=t.width;else if(e.x===t.x&&e.width===t.width&&e.y+e.height===t.y)e.height+=t.height;else if(t.y===e.y&&t.height===e.height&&t.x+t.width===e.x)e.x=t.x,e.width+=t.width;else{if(t.x!==e.x||t.width!==e.width||t.y+t.height!==e.y)continue;e.y=t.y,e.height+=t.height}this._free.splice(s,1),this.release(t)}this._free.push(t)}}var x=w(67969),J=w(18952),j=w(31548);class z{constructor(t,s,e){this.width=0,this.height=0,this._dirties=[],this._glyphData=[],this._currentPage=0,this._glyphIndex={},this._textures=[],this._rangePromises=new Map,this.width=t,this.height=s,this._glyphSource=e,this._binPack=new v(t-4,s-4),this._glyphData.push(new Uint8Array(t*s)),this._dirties.push(!0),this._textures.push(void 0)}getGlyphItems(t,s){const e=[],i=this._glyphSource,r=new Set;for(const c of s){const u=Math.floor(.00390625*c);r.add(u)}const l=[];return r.forEach(c=>{const u=t+c;if(this._rangePromises.has(u))l.push(this._rangePromises.get(u));else{const _=i.getRange(t,c).then(()=>{this._rangePromises.delete(u)},()=>{this._rangePromises.delete(u)});this._rangePromises.set(u,_),l.push(_)}}),Promise.all(l).then(()=>{let c=this._glyphIndex[t];c||(c={},this._glyphIndex[t]=c);for(const u of s){const _=c[u];if(_){e[u]={sdf:!0,rect:_.rect,metrics:_.metrics,page:_.page,code:u};continue}const S=i.getGlyph(t,u);if(!S?.metrics)continue;const f=S.metrics;let d;if(0===f.width)d=new T.Z(0,0,0,0);else{const R=f.width+6,A=f.height+6;let E=R%4?4-R%4:4,Z=A%4?4-A%4:4;1===E&&(E=5),1===Z&&(Z=5),d=this._binPack.allocate(R+E,A+Z),d.isEmpty&&(this._dirties[this._currentPage]||(this._glyphData[this._currentPage]=null),this._currentPage=this._glyphData.length,this._glyphData.push(new Uint8Array(this.width*this.height)),this._dirties.push(!0),this._textures.push(void 0),this._binPack=new v(this.width-4,this.height-4),d=this._binPack.allocate(R+E,A+Z));const Q=this._glyphData[this._currentPage],q=S.bitmap;let tt,Y;if(q)for(let X=0;X<A;X++){tt=R*X,Y=this.width*(d.y+X+1)+d.x;for(let ot=0;ot<R;ot++)Q[Y+ot+1]=q.at(tt+ot)}}c[u]={rect:d,metrics:f,tileIDs:null,page:this._currentPage},e[u]={sdf:!0,rect:d,metrics:f,page:this._currentPage,code:u},this._dirties[this._currentPage]=!0}return e})}removeGlyphs(t){for(const s in this._glyphIndex){const e=this._glyphIndex[s];if(!e)continue;let i;for(const r in e)if(i=e[r],i.tileIDs.delete(t),0===i.tileIDs.size){const o=this._glyphData[i.page],l=i.rect;let c,u;for(let _=0;_<l.height;_++)for(c=this.width*(l.y+_)+l.x,u=0;u<l.width;u++)o[c+u]=0;delete e[r],this._dirties[i.page]=!0}}}bind(t,s,e,i=0){if(!this._textures[e]){const o=new j.X;o.pixelFormat=x.VI.ALPHA,o.wrapMode=x.e8.CLAMP_TO_EDGE,o.width=this.width,o.height=this.height,this._textures[e]=new J.x(t,o,new Uint8Array(this.width*this.height))}const r=this._textures[e];r.setSamplingMode(s),this._dirties[e]&&r.setData(this._glyphData[e]),t.bindTexture(r,i),this._dirties[e]=!1}destroy(){this.dispose()}dispose(){this._glyphData.length=0,this._binPack=null;for(const t of this._textures)t&&t.dispose();this._textures.length=0}}var B=w(84792),I=w(24192);class P{constructor(t){if(this._metrics=[],!t)return void(this._allBitmaps=null);const s=new Map;let e=0;for(;t.next();)switch(t.tag()){case 1:{const o=t.getMessage();for(;o.next();)switch(o.tag()){case 3:{const l=o.getMessage();let c,u,_,S,f,d,C;for(;l.next();)switch(l.tag()){case 1:c=l.getUInt32();break;case 2:u=l.getBytes();break;case 3:_=l.getUInt32();break;case 4:S=l.getUInt32();break;case 5:f=l.getSInt32();break;case 6:d=l.getSInt32();break;case 7:C=l.getUInt32();break;default:l.skip()}if(l.release(),c){const R=u?.length??0;this._metrics[c]={width:_,height:S,left:f,top:d,advance:C,startOffset:e,length:R},s.set(c,u),e+=R}break}default:o.skip()}o.release();break}default:t.skip()}const i=new Uint8Array(e),r=this._metrics;for(const[o,l]of s){const{startOffset:c,length:u}=r[o];if(l)for(let _=0;_<u;++_)i[c+_]=l[_]}this._allBitmaps=i}getMetrics(t){return this._metrics[t]}getBitmap(t){if(!this._allBitmaps)return;const s=this._metrics[t];if(void 0===s)return;const{startOffset:e,length:i}=s;return 0!==i?new st(this._allBitmaps,e,i):void 0}}class F{constructor(){this._ranges=[]}get ranges(){return this._ranges}getRange(t){return this._ranges[t]}addRange(t,s){this._ranges[t]=s}}class N{constructor(t){this._glyphInfo={},this._baseURL=t}getRange(t,s){const e=this._getFontStack(t);if(e.getRange(s))return Promise.resolve();const i=256*s,r=i+255;if(this._baseURL){const o=this._baseURL.replace("{fontstack}",t).replace("{range}",i+"-"+r);return(0,B.Z)(o,{responseType:"array-buffer"}).then(l=>{e.addRange(s,new P(new I.Z(new Uint8Array(l.data),new DataView(l.data))))}).catch(()=>{e.addRange(s,new P)})}return e.addRange(s,new P),Promise.resolve()}getGlyph(t,s){const e=this._getFontStack(t);if(!e)return;const i=Math.floor(s/256),r=e.getRange(i);return r?{metrics:r.getMetrics(s),bitmap:r.getBitmap(s)}:void 0}_getFontStack(t){let s=this._glyphInfo[t];return s||(s=this._glyphInfo[t]=new F),s}}class st{constructor(t,s,e){this._array=t,this._start=s,this.length=e}at(t){return 0<=t&&t<this.length?this._array[this._start+t]:void 0}}var rt=w(26996);class ct{constructor(t,s,e=0){this._size=[],this._mosaicsData=[],this._textures=[],this._dirties=[],this._maxItemSize=0,this._currentPage=0,this._pageWidth=0,this._pageHeight=0,this._mosaicRects={},this.pixelRatio=1,(t<=0||s<=0)&&console.error("Sprites mosaic defaultWidth and defaultHeight must be greater than zero!"),this._pageWidth=t,this._pageHeight=s,e>0&&(this._maxItemSize=e),this._binPack=new v(t-4,s-4)}destroy(){this.dispose()}dispose(){this._binPack=null,this._mosaicsData.length=0,this._mosaicRects={};for(const t of this._textures)t&&t.dispose();this._textures.length=0}getWidth(t){return t>=this._size.length?-1:this._size[t][0]}getHeight(t){return t>=this._size.length?-1:this._size[t][1]}getPageSize(t){return t>=this._size.length?null:this._size[t]}setSpriteSource(t){if(this.dispose(),this.pixelRatio=t.devicePixelRatio,0===this._mosaicsData.length){this._binPack=new v(this._pageWidth-4,this._pageHeight-4);const s=Math.floor(this._pageWidth),e=Math.floor(this._pageHeight),i=new Uint32Array(s*e);this._mosaicsData[0]=i,this._dirties.push(!0),this._size.push([this._pageWidth,this._pageHeight]),this._textures.push(void 0)}this._sprites=t}getSpriteItem(t,s=!1){let e,i,r=this._mosaicRects[t];if(r)return r;if(!this._sprites||"loaded"!==this._sprites.loadStatus||(t&&t.startsWith("dasharray-")?([e,i]=this._rasterizeDash(t),s=!0):e=this._sprites.getSpriteInfo(t),!e?.width||!e.height||e.width<0||e.height<0))return null;const o=e.width,l=e.height,[c,u,_]=this._allocateImage(o,l);return c.width<=0?null:(this._copy(c,e,u,_,s,i),r={rect:c,width:o,height:l,sdf:e.sdf,simplePattern:!1,pixelRatio:e.pixelRatio,page:u},this._mosaicRects[t]=r,r)}getSpriteItems(t){const s={};for(const e of t)s[e.name]=this.getSpriteItem(e.name,e.repeat);return s}getMosaicItemPosition(t,s){const e=this.getSpriteItem(t,s),i=e&&e.rect;return i?(i.width=e.width,i.height=e.height,{tl:[i.x+2,i.y+2],br:[i.x+2+e.width,i.y+2+e.height],page:e.page}):null}bind(t,s,e=0,i=0){if(e>=this._size.length||e>=this._mosaicsData.length)return;if(!this._textures[e]){const o=new j.X;o.wrapMode=x.e8.CLAMP_TO_EDGE,o.width=this._size[e][0],o.height=this._size[e][1],this._textures[e]=new J.x(t,o,new Uint8Array(this._mosaicsData[e].buffer))}const r=this._textures[e];r.setSamplingMode(s),this._dirties[e]&&r.setData(new Uint8Array(this._mosaicsData[e].buffer)),t.bindTexture(r,i),this._dirties[e]=!1}static _copyBits(t,s,e,i,r,o,l,c,u,_,S){let f=i*s+e,d=c*o+l;if(S){d-=o;for(let C=-1;C<=_;C++,f=((C+_)%_+i)*s+e,d+=o)for(let R=-1;R<=u;R++)r[d+R]=t[f+(R+u)%u]}else for(let C=0;C<_;C++){for(let R=0;R<u;R++)r[d+R]=t[f+R];f+=s,d+=o}}_copy(t,s,e,i,r,o){if(!this._sprites||"loaded"!==this._sprites.loadStatus||e>=this._mosaicsData.length)return;const l=new Uint32Array(o?o.buffer:this._sprites.image.buffer),c=this._mosaicsData[e];c&&l||console.error("Source or target images are uninitialized!"),ct._copyBits(l,o?s.width:this._sprites.width,s.x,s.y,c,i[0],t.x+2,t.y+2,s.width,s.height,r),this._dirties[e]=!0}_allocateImage(t,s){t+=2,s+=2;const e=Math.max(t,s);if(this._maxItemSize&&this._maxItemSize<e){const l=new T.Z(0,0,t,s);return this._mosaicsData.push(new Uint32Array(t*s)),this._dirties.push(!0),this._size.push([t,s]),this._textures.push(void 0),[l,this._mosaicsData.length-1,[t,s]]}let i=t%4?4-t%4:4,r=s%4?4-s%4:4;1===i&&(i=5),1===r&&(r=5);const o=this._binPack.allocate(t+i,s+r);return o.width<=0?(this._dirties[this._currentPage]||(this._mosaicsData[this._currentPage]=null),this._currentPage=this._mosaicsData.length,this._mosaicsData.push(new Uint32Array(this._pageWidth*this._pageHeight)),this._dirties.push(!0),this._size.push([this._pageWidth,this._pageHeight]),this._textures.push(void 0),this._binPack=new v(this._pageWidth-4,this._pageHeight-4),this._allocateImage(t,s)):[o,this._currentPage,[this._pageWidth,this._pageHeight]]}_rasterizeDash(t){const e=t.match(/\[(.*?)\]/);if(!e)return null;const i=e[1].split(",").map(Number),r=t.slice(t.lastIndexOf("-")+1),[o,l,c]=(0,rt.m)(i,r);return[{x:0,y:0,width:l,height:c,sdf:!0,pixelRatio:1},new Uint8Array(o.buffer)]}}var et=w(58098);class Dt{constructor(t,s,e){this._layer=t,this._styleRepository=s,this.devicePixelRatio=e,this._spriteMosaic=null,this._glyphMosaic=null,this._connection=null,this._spriteSourceAbortController=null,this._startOptionsInputSignal=null,this._inputSignalEventListener=null}destroy(){this._connection?.close(),this._connection=null,this._styleRepository=null,this._layer=null,this._spriteMosaic?.destroy(),this._spriteMosaic=null,this._glyphMosaic=null,this._spriteSourceAbortController=(0,D.IM)(this._spriteSourceAbortController),this._spriteSourcePromise=null,this._inputSignalEventListener&&this._startOptionsInputSignal?.removeEventListener("abort",this._inputSignalEventListener),this._startOptionsInputSignal=null,this._inputSignalEventListener=null}get spriteMosaic(){return this._spriteSourcePromise.then(()=>this._spriteMosaic)}get glyphMosaic(){return this._glyphMosaic}start(t){var s=this;return(0,H.Z)(function*(){s._requestSprite(t);const e=s._layer.currentStyleInfo.glyphsUrl,i=new N(e?(0,g.fl)(e,{...s._layer.customParameters,token:s._layer.apiKey}):null);s._glyphMosaic=new z(1024,1024,i),s._broadcastPromise=(0,m.bA)("WorkerTileHandler",{client:s,schedule:t.schedule,signal:t.signal}).then(r=>{if(s._layer&&(s._connection?.close(),s._connection=r,s._layer&&!s._connection.closed)){const o=r.broadcast("setStyle",s._layer.currentStyleInfo.style,t);Promise.all(o).catch(l=>(0,L.H9)(l))}})})()}_requestSprite(t){this._spriteSourceAbortController?.abort();const s=new AbortController;this._spriteSourceAbortController=s;const e=t?.signal;this._inputSignalEventListener&&this._startOptionsInputSignal?.removeEventListener("abort",this._inputSignalEventListener),this._startOptionsInputSignal=null,e&&(this._inputSignalEventListener=function Pt(h){return()=>h.abort()}(s),e.addEventListener("abort",this._inputSignalEventListener,{once:!0}));const{signal:i}=s,r={...t,signal:i};this._spriteSourcePromise=this._layer.loadSpriteSource(this.devicePixelRatio,r),this._spriteSourcePromise.then(o=>{(0,L.r9)(i),this._spriteMosaic=new ct(1024,1024,250),this._spriteMosaic.setSpriteSource(o)})}updateStyle(t){var s=this;return(0,H.Z)(function*(){return yield s._broadcastPromise,s._broadcastPromise=Promise.all(s._connection.broadcast("updateStyle",t)),s._broadcastPromise})()}setSpriteSource(t){const s=new ct(1024,1024,250);return s.setSpriteSource(t),this._spriteMosaic=s,this._spriteSourcePromise=Promise.resolve(t),this._spriteSourceAbortController=null,s}setStyle(t,s){var e=this;return(0,H.Z)(function*(){yield e._broadcastPromise,e._styleRepository=t,e._requestSprite();const i=new N(e._layer.currentStyleInfo.glyphsUrl?(0,g.fl)(e._layer.currentStyleInfo.glyphsUrl,{...e._layer.customParameters,token:e._layer.apiKey}):null);return e._glyphMosaic=new z(1024,1024,i),e._broadcastPromise=Promise.all(e._connection.broadcast("setStyle",s)),e._broadcastPromise})()}fetchTileData(t,s){return this._getRefKeys(t,s).then(e=>{const i=this._layer.sourceNameToSource,r=[];for(const o in i)r.push(o);return this._getSourcesData(r,e,s)})}parseTileData(t,s){const e=t&&t.data;if(!e)return Promise.resolve(null);const{sourceName2DataAndRefKey:i,transferList:r}=e;return 0===Object.keys(i).length?Promise.resolve(null):this._broadcastPromise.then(()=>this._connection.invoke("createTileAndParse",{key:t.key.id,sourceName2DataAndRefKey:i,styleLayerUIDs:t.styleLayerUIDs},{...s,transferList:r}))}getSprites(t){var s=this;return(0,H.Z)(function*(){return yield s._spriteSourcePromise,s._spriteMosaic.getSpriteItems(t)})()}getGlyphs(t){return this._glyphMosaic.getGlyphItems(t.font,t.codePoints)}_getTilePayload(t,s,e){var i=this;return(0,H.Z)(function*(){const r=et.Z.pool.acquire(t.id),o=i._layer.sourceNameToSource[s],{level:l,row:c,col:u}=r;et.Z.pool.release(r);try{return{protobuff:yield o.requestTile(l,c,u,e),sourceName:s}}catch(_){if((0,L.D_)(_))throw _;return{protobuff:null,sourceName:s}}})()}_getRefKeys(t,s){const e=this._layer.sourceNameToSource,i=new Array;for(const r in e){const o=e[r].getRefKey(t,s);i.push(o)}return Promise.allSettled(i)}_getSourcesData(t,s,e){const i=[];for(let r=0;r<s.length;r++){const o=s[r],l="fulfilled"===o.status?o.value:null;if(null==l||null==t[r])i.push(null);else{const c=this._getTilePayload(l,t[r],e);i.push(c)}}return Promise.allSettled(i).then(r=>{const o={},l=[];for(let c=0;c<r.length;c++){const u=r[c],_="fulfilled"===u.status?u.value:null,S=_?.protobuff;if(!_||!S?.byteLength)continue;const f=s[c],d="fulfilled"===f.status?f.value:null;d&&(o[_.sourceName]={refKey:d.id,protobuff:S},l.push(S))}return{sourceName2DataAndRefKey:o,transferList:l}})}}var Mt=w(93961),pt=w(84378);const At=(h,t)=>h+1/(1<<2*t);class Ot{constructor(t,s){this._tiles=new Map,this._tileCache=new Mt.z(40,e=>e.dispose()),this._viewSize=[0,0],this._visibleTiles=new Map,this.acquireTile=t.acquireTile,this.releaseTile=t.releaseTile,this.tileInfoView=t.tileInfoView,this._container=s}destroy(){for(const[t,s]of this._tiles)s.dispose();this._tiles=null,this._tileCache.clear(),this._tileCache=null}update(t){this._updateCacheSize(t);const s=this.tileInfoView,e=s.getTileCoverage(t.state,0,!0,"smallest");if(!e)return!0;const{spans:i,lodInfo:r}=e,{level:o}=r,l=this._tiles,c=new Set,u=new Set;for(const{row:S,colFrom:f,colTo:d}of i)for(let C=f;C<=d;C++){const R=et.Z.getId(o,S,r.normalizeCol(C),r.getWorldForColumn(C)),A=this._getOrAcquireTile(R);c.add(R),A.processed()?this._addToContainer(A):u.add(new et.Z(R))}for(const[S,f]of l)f.isCoverage=c.has(S);for(const S of u)this._findPlaceholdersForMissingTiles(S,c);let _=!1;for(const[S,f]of l)f.neededForCoverage=c.has(S),f.neededForCoverage||f.isHoldingForFade&&s.intersects(e,f.key)&&c.add(S),f.isFading&&(_=!0);for(const[S,f]of this._tiles)c.has(S)||this._releaseTile(S);return pt.Z.pool.release(e),!_}clear(){this._tiles.clear(),this._tileCache.clear(),this._visibleTiles.clear()}clearCache(){this._tileCache.clear()}_findPlaceholdersForMissingTiles(t,s){const e=[];for(const[r,o]of this._tiles)this._addPlaceholderChild(e,o,t,s);const i=e.reduce(At,0);Math.abs(1-i)<1e-6||this._addPlaceholderParent(t.id,s)}_addPlaceholderChild(t,s,e,i){s.key.level<=e.level||!s.hasData()||function Et(h,t){const s=t.level-h.level;return h.row===t.row>>s&&h.col===t.col>>s&&h.world===t.world}(e,s.key)&&(this._addToContainer(s),i.add(s.id),t.push(s.key.level-e.level))}_addPlaceholderParent(t,s){const e=this._tiles;let i=t;for(;;){if(i=Ut(i),!i||s.has(i))return;const r=e.get(i);if(r&&r.hasData())return this._addToContainer(r),void s.add(r.id)}}_getOrAcquireTile(t){let s=this._tiles.get(t);return s||(s=this._tileCache.pop(t),s||(s=this.acquireTile(new et.Z(t))),this._tiles.set(t,s),s)}_releaseTile(t){const s=this._tiles.get(t);this.releaseTile(s),this._removeFromContainer(s),this._tiles.delete(t),s.hasData()?this._tileCache.put(t,s,1):s.dispose()}_addToContainer(t){let s;const e=[],i=this._container;if(i.contains(t))return;const r=this._visibleTiles;for(const[o,l]of r)this._canConnectDirectly(t,l)&&e.push(l),null==s&&this._canConnectDirectly(l,t)&&(s=l);if(null!=s){for(const o of e)s.childrenTiles.delete(o),t.childrenTiles.add(o),o.parentTile=t;s.childrenTiles.add(t),t.parentTile=s}else for(const o of e)t.childrenTiles.add(o),o.parentTile=t;r.set(t.id,t),i.addChild(t)}_removeFromContainer(t){if(this._visibleTiles.delete(t.id),this._container.removeChild(t),null!=t.parentTile){t.parentTile.childrenTiles.delete(t);for(const s of t.childrenTiles)null!=t.parentTile&&t.parentTile.childrenTiles.add(s)}for(const s of t.childrenTiles)s.parentTile=t.parentTile;t.parentTile=null,t.childrenTiles.clear()}_canConnectDirectly(t,s){const e=t.key;let{level:i,row:r,col:o,world:l}=s.key;const c=this._visibleTiles;for(;i>0;){if(i--,r>>=1,o>>=1,e.level===i&&e.row===r&&e.col===o&&e.world===l)return!0;if(c.has(`${i}/${r}/${o}/${l}`))return!1}return!1}_updateCacheSize(t){const s=t.state.size;if(s[0]===this._viewSize[0]&&s[1]===this._viewSize[1])return;const e=Math.ceil(s[0]/512)+1,i=Math.ceil(s[1]/512)+1;this._viewSize[0]=s[0],this._viewSize[1]=s[1],this._tileCache.maxSize=5*e*i}}function Ut(h){const[t,s,e,i]=h.split("/"),r=parseInt(t,10);return 0===r?null:`${r-1}/${parseInt(s,10)>>1}/${parseInt(e,10)>>1}/${parseInt(i,10)}`}w(8314);var ut=w(30217),lt=w(49966),mt=w(55713);class Ft{constructor(t){this.xTile=0,this.yTile=0,this.hash=0,this.priority=1,this.colliders=[],this.textVertexRanges=[],this.iconVertexRanges=[],this.tile=t}}class kt{constructor(){this.tileSymbols=[],this.parts=[{startTime:0,startOpacity:0,targetOpacity:0,show:!1},{startTime:0,startOpacity:0,targetOpacity:0,show:!1}],this.show=!1}}function xt(h,t,s,e,i,r){const o=s-i;if(o>=0)return(t>>o)+(e-(r<<o))*(h>>o);const l=-o;return t-(r-(e<<l))*(h>>l)<<l}class St{constructor(t,s,e){this._rows=Math.ceil(s/e),this._columns=Math.ceil(t/e),this._cellSize=e,this.cells=new Array(this._rows);for(let i=0;i<this._rows;i++){this.cells[i]=new Array(this._columns);for(let r=0;r<this._columns;r++)this.cells[i][r]=[]}}getCell(t,s){const e=Math.min(Math.max(Math.floor(s/this._cellSize),0),this._rows-1),i=Math.min(Math.max(Math.floor(t/this._cellSize),0),this._columns-1);return this.cells[e]&&this.cells[e][i]||null}getCellSpan(t,s,e,i){return[Math.min(Math.max(Math.floor(t/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(s/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(e/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(i/this._cellSize),0),this.rows-1)]}get cellSize(){return this._cellSize}get columns(){return this._columns}get rows(){return this._rows}}function Bt(h,t,s,e,i){const r=h.layerData.get(i);if(r.type===y.al.SYMBOL){for(const o of e){const l=o.unique;let c;if(o.selectedForRendering){const u=l.parts[0],_=u.startOpacity,S=u.targetOpacity;h.allSymbolsFadingOut=h.allSymbolsFadingOut&&0===S;const f=s?Math.floor(127*_)|S<<7:S?255:0;c=f<<24|f<<16|f<<8|f}else c=0;for(const[u,_]of o.iconVertexRanges)for(let S=u;S<u+_;S+=4)r.iconOpacity[S/4]=c;if(o.selectedForRendering){const u=l.parts[1],_=u.startOpacity,S=u.targetOpacity;h.allSymbolsFadingOut=h.allSymbolsFadingOut&&0===S;const f=s?Math.floor(127*_)|S<<7:S?255:0;c=f<<24|f<<16|f<<8|f}else c=0;for(const[u,_]of o.textVertexRanges)for(let S=u;S<u+_;S+=4)r.textOpacity[S/4]=c}r.lastOpacityUpdate=t,r.opacityChanged=!0}}var $=w(83994),at=w(49353);class yt{constructor(t,s){this.layerUIDs=[],this.isDestroyed=!1,this._data=t;let e=1;const i=new Uint32Array(t);this.layerUIDs=[];const r=i[e++];for(let o=0;o<r;o++)this.layerUIDs[o]=i[e++];this.bufferDataOffset=e,s&&(this.layer=s.getStyleLayerByUID(this.layerUIDs[0]))}get isPreparedForRendering(){return null==this._data}get offset(){return this.bufferDataOffset}get data(){return this._data}destroy(){this.isDestroyed||(this.doDestroy(),this._data=null,this.isDestroyed=!0)}prepareForRendering(t){null!=this._data&&(this.doPrepareForRendering(t,this._data,this.bufferDataOffset),this._data=null)}}class Ht extends yt{constructor(t,s){super(t,s),this.type=y.al.LINE,this.lineIndexStart=0,this.lineIndexCount=0;const e=new Uint32Array(t);let i=this.bufferDataOffset;this.lineIndexStart=e[i++],this.lineIndexCount=e[i++];const r=e[i++];if(r>0){this.patternMap=new Map;for(let o=0;o<r;o++){const l=e[i++],c=e[i++],u=e[i++];this.patternMap.set(l,[c,u])}}this.bufferDataOffset=i}get memoryUsed(){return(this.data?.byteLength??0)+(this.vao?.usedMemory??0)}hasData(){return this.lineIndexCount>0}triangleCount(){return this.lineIndexCount/3}doDestroy(){this.vao=(0,D.M2)(this.vao)}doPrepareForRendering(t,s,e){const i=new Uint32Array(s),r=new Int32Array(i.buffer),o=i[e++],l=$.f.createVertex(t,x.l1.STATIC_DRAW,new Int32Array(r.buffer,4*e,o));e+=o;const c=i[e++],u=$.f.createIndex(t,x.l1.STATIC_DRAW,new Uint32Array(i.buffer,4*e,c));e+=c;const _=this.layer.lineMaterial;this.vao=new at.U(t,_.getAttributeLocations(),_.getLayoutInfo(),{geometry:l},u)}}class Nt extends yt{constructor(t,s){super(t,s),this.type=y.al.FILL,this.fillIndexStart=0,this.fillIndexCount=0,this.outlineIndexStart=0,this.outlineIndexCount=0;const e=new Uint32Array(t);let i=this.bufferDataOffset;this.fillIndexStart=e[i++],this.fillIndexCount=e[i++],this.outlineIndexStart=e[i++],this.outlineIndexCount=e[i++];const r=e[i++];if(r>0){this.patternMap=new Map;for(let o=0;o<r;o++){const l=e[i++],c=e[i++],u=e[i++];this.patternMap.set(l,[c,u])}}this.bufferDataOffset=i}get memoryUsed(){return(this.data?.byteLength??0)+(this.fillVAO?.usedMemory??0)+(this.outlineVAO?.usedMemory??0)}hasData(){return this.fillIndexCount>0||this.outlineIndexCount>0}triangleCount(){return(this.fillIndexCount+this.outlineIndexCount)/3}doDestroy(){this.fillVAO=(0,D.M2)(this.fillVAO),this.outlineVAO=(0,D.M2)(this.outlineVAO)}doPrepareForRendering(t,s,e){const i=new Uint32Array(s),r=new Int32Array(i.buffer),o=i[e++],l=$.f.createVertex(t,x.l1.STATIC_DRAW,new Int32Array(r.buffer,4*e,o));e+=o;const c=i[e++],u=$.f.createIndex(t,x.l1.STATIC_DRAW,new Uint32Array(i.buffer,4*e,c));e+=c;const _=i[e++],S=$.f.createVertex(t,x.l1.STATIC_DRAW,new Int32Array(r.buffer,4*e,_));e+=_;const f=i[e++],d=$.f.createIndex(t,x.l1.STATIC_DRAW,new Uint32Array(i.buffer,4*e,f));e+=f;const C=this.layer,R=C.fillMaterial,A=C.outlineMaterial;this.fillVAO=new at.U(t,R.getAttributeLocations(),R.getLayoutInfo(),{geometry:l},u),this.outlineVAO=new at.U(t,A.getAttributeLocations(),A.getLayoutInfo(),{geometry:S},d)}}class Wt extends yt{constructor(t,s,e){super(t,s),this.type=y.al.SYMBOL,this.iconPerPageElementsMap=new Map,this.glyphPerPageElementsMap=new Map,this.symbolInstances=[],this.isIconSDF=!1,this.opacityChanged=!1,this.lastOpacityUpdate=0,this.symbols=[];const i=new Uint32Array(t),r=new Int32Array(t),o=new Float32Array(t);let l=this.bufferDataOffset;this.isIconSDF=!!i[l++];const c=i[l++];for(let f=0;f<c;f++){const d=i[l++],C=i[l++],R=i[l++];this.iconPerPageElementsMap.set(d,[C,R])}const u=i[l++];for(let f=0;f<u;f++){const d=i[l++],C=i[l++],R=i[l++];this.glyphPerPageElementsMap.set(d,[C,R])}const _=i[l++],S=i[l++];this.iconOpacity=new Int32Array(_),this.textOpacity=new Int32Array(S),l=function zt(h,t,s,e,i,r){const o=t[e++];for(let l=0;l<o;l++){const c=new Ft(r);c.xTile=t[e++],c.yTile=t[e++],c.hash=t[e++],c.priority=t[e++];const u=t[e++];for(let f=0;f<u;f++){const d=t[e++],C=t[e++],R=t[e++],A=t[e++],E=!!t[e++],Z=t[e++],Q=s[e++],q=s[e++],tt=t[e++],Y=t[e++];c.colliders.push({xTile:d,yTile:C,dxPixels:R,dyPixels:A,hard:E,partIndex:Z,width:tt,height:Y,minLod:Q,maxLod:q})}const _=h[e++];for(let f=0;f<_;f++)c.textVertexRanges.push([h[e++],h[e++]]);const S=h[e++];for(let f=0;f<S;f++)c.iconVertexRanges.push([h[e++],h[e++]]);i.push(c)}return e}(i,r,o,l,this.symbols,e),this.bufferDataOffset=l}get memoryUsed(){return(this.data?.byteLength??0)+(this.iconVAO?.usedMemory??0)+(this.textVAO?.usedMemory??0)+(0,mt.Xw)(this.iconOpacity)+(0,mt.Xw)(this.textOpacity)}hasData(){return this.iconPerPageElementsMap.size>0||this.glyphPerPageElementsMap.size>0}triangleCount(){let t=0;for(const[s,e]of this.iconPerPageElementsMap)t+=e[1];for(const[s,e]of this.glyphPerPageElementsMap)t+=e[1];return t/3}doDestroy(){this.iconVAO=(0,D.M2)(this.iconVAO),this.textVAO=(0,D.M2)(this.textVAO)}updateOpacityInfo(){if(!this.opacityChanged)return;this.opacityChanged=!1;const t=this.iconOpacity,s=this.iconVAO.vertexBuffers.opacity;t.length>0&&t.byteLength===s.byteLength&&s.setSubData(t,0,0,t.length);const e=this.textOpacity,i=this.textVAO.vertexBuffers.opacity;e.length>0&&e.byteLength===i.byteLength&&i.setSubData(e,0,0,e.length)}doPrepareForRendering(t,s,e){const i=new Uint32Array(s),r=new Int32Array(i.buffer),o=i[e++],l=$.f.createVertex(t,x.l1.STATIC_DRAW,new Int32Array(r.buffer,4*e,o));e+=o;const c=i[e++],u=$.f.createIndex(t,x.l1.STATIC_DRAW,new Uint32Array(i.buffer,4*e,c));e+=c;const _=i[e++],S=$.f.createVertex(t,x.l1.STATIC_DRAW,new Int32Array(r.buffer,4*e,_));e+=_;const f=i[e++],d=$.f.createIndex(t,x.l1.STATIC_DRAW,new Uint32Array(i.buffer,4*e,f));e+=f;const C=$.f.createVertex(t,x.l1.STATIC_DRAW,this.iconOpacity.buffer),R=$.f.createVertex(t,x.l1.STATIC_DRAW,this.textOpacity.buffer),A=this.layer,E=A.iconMaterial,Z=A.textMaterial;this.iconVAO=new at.U(t,E.getAttributeLocations(),E.getLayoutInfo(),{geometry:l,opacity:C},u),this.textVAO=new at.U(t,Z.getAttributeLocations(),Z.getLayoutInfo(),{geometry:S,opacity:R},d)}}class Zt extends yt{constructor(t,s){super(t,s),this.type=y.al.CIRCLE,this.circleIndexStart=0,this.circleIndexCount=0;const e=new Uint32Array(t);let i=this.bufferDataOffset;this.circleIndexStart=e[i++],this.circleIndexCount=e[i++],this.bufferDataOffset=i}get memoryUsed(){return(this.data?.byteLength??0)+(this.vao?.usedMemory??0)}hasData(){return this.circleIndexCount>0}triangleCount(){return this.circleIndexCount/3}doDestroy(){this.vao=(0,D.M2)(this.vao)}doPrepareForRendering(t,s,e){const i=new Uint32Array(s),r=new Int32Array(i.buffer),o=i[e++],l=$.f.createVertex(t,x.l1.STATIC_DRAW,new Int32Array(r.buffer,4*e,o));e+=o;const c=i[e++],u=$.f.createIndex(t,x.l1.STATIC_DRAW,new Uint32Array(i.buffer,4*e,c));e+=c;const _=this.layer.circleMaterial;this.vao=new at.U(t,_.getAttributeLocations(),_.getLayoutInfo(),{geometry:l},u)}}var ht=w(47132),bt=w(43783);class ft extends bt.I{constructor(t,s,e,i,r,o,l,c=null){super(t,s,e,i,r,o,4096,4096),this.styleRepository=l,this._memCache=c,this.type="vector-tile",this._referenced=0,this._hasSymbolBuckets=!1,this._memoryUsedByLayerData=0,this.layerData=new Map,this.status="loading",this.allSymbolsFadingOut=!1,this.lastOpacityUpdate=0,this.symbols=new Map,this.isCoverage=!1,this.neededForCoverage=!1,this.decluttered=!1,this.parentTile=null,this.childrenTiles=new Set,this._processed=!1,this._referenced=1,this.id=t.id}get hasSymbolBuckets(){return this._hasSymbolBuckets}get isFading(){return this._hasSymbolBuckets&&performance.now()-this.lastOpacityUpdate<ht.v7}get isHoldingForFade(){return this._hasSymbolBuckets&&(!this.allSymbolsFadingOut||performance.now()-this.lastOpacityUpdate<ht.v7)}get wasRequested(){return"errored"===this.status||"loaded"===this.status||"reloading"===this.status}setData(t){this.changeDataImpl(t),this.requestRender(),this.ready(),this._processed=!0}deleteLayerData(t){let s=!1;for(const e of t){const i=this.layerData.get(e);i&&(this._memoryUsedByLayerData-=i.memoryUsed,i.type===y.al.SYMBOL&&this.symbols.delete(e)&&(s=!0),i.destroy(),this.layerData.delete(e))}this._memCache?.updateSize(this.key.id,this,this._memoryUsedByLayerData),s&&this.emit("symbols-changed"),this.requestRender()}processed(){return this._processed}hasData(){return this.layerData.size>0}dispose(){"unloaded"!==this.status&&(wt.delete(this),ft._destroyRenderBuckets(this.layerData),this.layerData=null,this._memoryUsedByLayerData=0,this.destroy(),this.status="unloaded")}release(){return 0==--this._referenced&&(this.dispose(),this.stage=null,!0)}retain(){++this._referenced}get referenced(){return this._referenced}get memoryUsed(){return this._memoryUsedByLayerData+256}changeDataImpl(t){let s=!1;if(t){const{bucketsWithData:e,emptyBuckets:i}=t,r=this._createRenderBuckets(e);if(i&&i.byteLength>0){const o=new Uint32Array(i);for(const l of o)this._deleteLayerData(l)}for(const[o,l]of r)this._deleteLayerData(o),l.type===y.al.SYMBOL&&(this.symbols.set(o,l.symbols),s=!0),this._memoryUsedByLayerData+=l.memoryUsed,this.layerData.set(o,l);this._memCache?.updateSize(this.key.id,this,this.memoryUsed)}this._hasSymbolBuckets=!1;for(const[e,i]of this.layerData)i.type===y.al.SYMBOL&&(this._hasSymbolBuckets=!0);s&&this.emit("symbols-changed")}attachWithContext(t){this.stage={context:t,trashDisplayObject(s){s.processDetach()},untrashDisplayObject:()=>!1}}setTransform(t){super.setTransform(t);const s=this.resolution/(t.resolution*t.pixelRatio),e=this.width/this.rangeX*s,i=this.height/this.rangeY*s,r=[0,0];t.toScreen(r,[this.x,this.y]);const o=this.transforms.tileUnitsToPixels;(0,ut.g)(o),(0,ut.h)(o,o,r),(0,ut.r)(o,o,Math.PI*t.rotation/180),(0,ut.c)(o,o,[e,i,1])}_createTransforms(){return{dvs:(0,lt.c)(),tileMat3:(0,lt.c)(),tileUnitsToPixels:(0,lt.c)()}}static _destroyRenderBuckets(t){if(!t)return;const s=new Set;for(const e of t.values())s.has(e)||(e.destroy(),s.add(e));t.clear()}_createRenderBuckets(t){const s=new Map,e=new Map;for(const i of t){const r=this._deserializeBucket(i,e);for(const o of r.layerUIDs)s.set(o,r)}return s}_deserializeBucket(t,s){let e=s.get(t);if(e)return e;switch(new Uint32Array(t)[0]){case y.al.FILL:e=new Nt(t,this.styleRepository);break;case y.al.LINE:e=new Ht(t,this.styleRepository);break;case y.al.SYMBOL:e=new Wt(t,this.styleRepository,this);break;case y.al.CIRCLE:e=new Zt(t,this.styleRepository)}return s.set(t,e),e}_deleteLayerData(t){if(!this.layerData.has(t))return;const s=this.layerData.get(t);this._memoryUsedByLayerData-=s.memoryUsed,s.destroy(),this.layerData.delete(t)}}const wt=new Map;var Qt=w(37922),W=w(1268);function jt(h,t,s,e,i,r){const{iconRotationAlignment:o,textRotationAlignment:l,iconTranslate:c,iconTranslateAnchor:u,textTranslate:_,textTranslateAnchor:S}=e;let f=0;for(const d of h.colliders){const[C,R]=0===d.partIndex?c:_,A=0===d.partIndex?u:S,E=d.minLod<=r&&r<=d.maxLod;f+=E?0:1,d.enabled=E,d.xScreen=d.xTile*i[0]+d.yTile*i[3]+i[6],d.yScreen=d.xTile*i[1]+d.yTile*i[4]+i[7],A===W.fD.MAP?(d.xScreen+=s*C-t*R,d.yScreen+=t*C+s*R):(d.xScreen+=C,d.yScreen+=R),W.aF.VIEWPORT===(0===d.partIndex?o:l)?(d.dxScreen=d.dxPixels,d.dyScreen=d.dyPixels):(d.dxScreen=s*(d.dxPixels+d.width/2)-t*(d.dyPixels+d.height/2)-d.width/2,d.dyScreen=t*(d.dxPixels+d.width/2)+s*(d.dyPixels+d.height/2)-d.height/2)}h.colliders.length>0&&f===h.colliders.length&&(h.unique.show=!1)}class Gt{constructor(t,s,e,i,r,o){this._symbols=t,this._styleRepository=i,this._zoom=r,this._currentLayerCursor=0,this._currentSymbolCursor=0,this._styleProps=new Map,this._allNeededMatrices=new Map,this._gridIndex=new St(s,e,ht.cn),this._si=Math.sin(Math.PI*o/180),this._co=Math.cos(Math.PI*o/180);for(const l of t)for(const c of l.symbols)this._allNeededMatrices.has(c.tile)||this._allNeededMatrices.set(c.tile,(0,lt.a)(c.tile.transforms.tileUnitsToPixels))}work(t){const s=this._gridIndex;function e(r){const o=r.xScreen+r.dxScreen,l=r.yScreen+r.dyScreen,c=o+r.width,u=l+r.height,[_,S,f,d]=s.getCellSpan(o,l,c,u);for(let C=S;C<=d;C++)for(let R=_;R<=f;R++){const A=s.cells[C][R];for(const E of A){const Z=E.xScreen+E.dxScreen,Q=E.yScreen+E.dyScreen;if(!(c<Z||o>Z+E.width||u<Q||l>Q+E.height))return!0}}return!1}const i=performance.now();for(;this._currentLayerCursor<this._symbols.length;this._currentLayerCursor++,this._currentSymbolCursor=0){const r=this._symbols[this._currentLayerCursor],o=this._getProperties(r.styleLayerUID);for(;this._currentSymbolCursor<r.symbols.length;this._currentSymbolCursor++){if(this._currentSymbolCursor%100==99&&performance.now()-i>t)return!1;const l=r.symbols[this._currentSymbolCursor];if(!l.unique.show)continue;jt(l,this._si,this._co,o,this._allNeededMatrices.get(l.tile),this._zoom);const c=l.unique;if(!c.show)continue;const{iconAllowOverlap:u,iconIgnorePlacement:_,textAllowOverlap:S,textIgnorePlacement:f}=o;for(const d of l.colliders){if(!d.enabled)continue;const C=c.parts[d.partIndex];C.show&&!(d.partIndex?S:u)&&e(d)&&(d.hard?c.show=!1:C.show=!1)}if(c.show)for(const d of l.colliders){if(!d.enabled||(d.partIndex?f:_)||!c.parts[d.partIndex].show)continue;const C=d.xScreen+d.dxScreen,R=d.yScreen+d.dyScreen,A=C+d.width,E=R+d.height,[Z,Q,q,tt]=this._gridIndex.getCellSpan(C,R,A,E);for(let Y=Q;Y<=tt;Y++)for(let X=Z;X<=q;X++)this._gridIndex.cells[Y][X].push(d)}}}return!0}_getProperties(t){const s=this._styleProps.get(t);if(s)return s;const e=this._zoom,i=this._styleRepository.getStyleLayerByUID(t),r=i.getLayoutValue("symbol-placement",e)!==W.R.POINT;let o=i.getLayoutValue("icon-rotation-alignment",e);o===W.aF.AUTO&&(o=r?W.aF.MAP:W.aF.VIEWPORT);let l=i.getLayoutValue("text-rotation-alignment",e);l===W.aF.AUTO&&(l=r?W.aF.MAP:W.aF.VIEWPORT);const c=i.getPaintValue("icon-translate",e),u=i.getPaintValue("icon-translate-anchor",e),_=i.getPaintValue("text-translate",e),S=i.getPaintValue("text-translate-anchor",e),f={iconAllowOverlap:i.getLayoutValue("icon-allow-overlap",e),iconIgnorePlacement:i.getLayoutValue("icon-ignore-placement",e),textAllowOverlap:i.getLayoutValue("text-allow-overlap",e),textIgnorePlacement:i.getLayoutValue("text-ignore-placement",e),iconRotationAlignment:o,textRotationAlignment:l,iconTranslateAnchor:u,iconTranslate:c,textTranslateAnchor:S,textTranslate:_};return this._styleProps.set(t,f),f}}function qt(h,t){if(h.priority-t.priority)return h.priority-t.priority;const s=h.tile.key,e=t.tile.key;return s.world-e.world?s.world-e.world:s.level-e.level?s.level-e.level:s.row-e.row?s.row-e.row:s.col-e.col?s.col-e.col:h.xTile-t.xTile?h.xTile-t.xTile:h.yTile-t.yTile}class Jt{get running(){return this._running}constructor(t,s,e,i,r,o){this._visibleTiles=t,this._symbolRepository=s,this._createCollisionJob=e,this._assignTileSymbolsOpacity=i,this._symbolLayerSorter=r,this._isLayerVisible=o,this._selectionJob=null,this._selectionJobCompleted=!1,this._collisionJob=null,this._collisionJobCompleted=!1,this._opacityJob=null,this._opacityJobCompleted=!1,this._running=!0}setScreenSize(t,s){this._screenWidth===t&&this._screenHeight===s||this.restart(),this._screenWidth=t,this._screenHeight=s}restart(){this._selectionJob=null,this._selectionJobCompleted=!1,this._collisionJob=null,this._collisionJobCompleted=!1,this._opacityJob=null,this._opacityJobCompleted=!1,this._running=!0}continue(t){if(this._selectionJob||(this._selectionJob=this._createSelectionJob()),!this._selectionJobCompleted){const s=performance.now();if(!this._selectionJob.work(t)||(this._selectionJobCompleted=!0,0===(t=Math.max(0,t-(performance.now()-s)))))return!1}if(this._collisionJob||(this._collisionJob=this._createCollisionJob(this._selectionJob.sortedSymbols,this._screenWidth,this._screenHeight)),!this._collisionJobCompleted){const s=performance.now();if(!this._collisionJob.work(t)||(this._collisionJobCompleted=!0,0===(t=Math.max(0,t-(performance.now()-s)))))return!1}if(this._opacityJob||(this._opacityJob=this._createOpacityJob()),!this._opacityJobCompleted){const s=performance.now();if(!this._opacityJob.work(t)||(this._opacityJobCompleted=!0,0===(t=Math.max(0,t-(performance.now()-s)))))return!1}return this._running=!1,!0}_createSelectionJob(){const t=this._symbolRepository.uniqueSymbols;for(let c=0;c<t.length;c++){const u=t[c];for(let _=0;_<u.uniqueSymbols.length;_++){const S=u.uniqueSymbols[_];for(const f of S.tileSymbols)f.selectedForRendering=!1}}const s=[];let e=0,i=0;const r=this._isLayerVisible,l=this._symbolLayerSorter;return{work:function o(c){let u;const _=performance.now();for(;i<t.length;i++,e=0){const S=t[i],f=S.styleLayerUID;if(!r(f)){s[i]||(s[i]={styleLayerUID:f,symbols:[]});continue}s[i]=s[i]||{styleLayerUID:f,symbols:[]};const d=s[i];for(;e<S.uniqueSymbols.length;e++){if(u=S.uniqueSymbols[e],e%100==99&&performance.now()-_>c)return!1;let C=null,R=!1,A=!1;for(const E of u.tileSymbols)if(!A||!R){const Z=E.tile;(!C||Z.isCoverage||Z.neededForCoverage&&!R)&&(C=E,(Z.neededForCoverage||Z.isCoverage)&&(A=!0),Z.isCoverage&&(R=!0))}if(C.selectedForRendering=!0,A){d.symbols.push(C),u.show=!0;for(const E of u.parts)E.show=!0}else u.show=!1}}for(const S of s)S.symbols.sort(qt);return!0},get sortedSymbols(){return s.sort(l)}}}_createOpacityJob(){const t=this._assignTileSymbolsOpacity,s=this._visibleTiles;let e=0;function i(r,o){const l=r.symbols;for(const[c,u]of l)Kt(u,o);t(r,o);for(const c of r.childrenTiles)i(c,o)}return{work(r){const o=performance.now();for(;e<s.length;e++){if(performance.now()-o>r)return!1;const l=s[e];null==l.parentTile&&i(l,performance.now())}return!0}}}}function Kt(h,t){for(const s of h){const e=s.unique;for(const i of e.parts)i.startOpacity+=(t-i.startTime)/ht.v7*(i.targetOpacity>.5?1:-1),i.startOpacity=Math.min(Math.max(i.startOpacity,0),1),i.startTime=t,i.targetOpacity=e.show&&i.show?1:0}}class te{constructor(t,s,e){this.tileCoordRange=t,this._visibleTiles=s,this._createUnique=e,this._tiles=new Map,this._uniqueSymbolsReferences=new Map}get uniqueSymbols(){return null==this._uniqueSymbolLayerArray&&(this._uniqueSymbolLayerArray=this._createUniqueSymbolLayerArray()),this._uniqueSymbolLayerArray}add(t,s){this._uniqueSymbolLayerArray=null;let e=this._tiles.get(t.id);e||(e={symbols:new Map},this._tiles.set(t.id,e));const i=new Map;if(s)for(const l of s)e.symbols.has(l)&&(i.set(l,e.symbols.get(l)),e.symbols.delete(l));else for(const[l,c]of t.layerData)e.symbols.has(l)&&(i.set(l,e.symbols.get(l)),e.symbols.delete(l));this._removeSymbols(i);const r=t.symbols,o=new Map;for(const[l,c]of r){let u=c.length;if(u>=32){let _=this.tileCoordRange;do{_/=2,u/=4}while(u>8&&_>64);const S=new St(this.tileCoordRange,this.tileCoordRange,_);o.set(l,{flat:c,index:S}),e.symbols.set(l,{flat:c,index:S});for(const f of c)S.getCell(f.xTile,f.yTile).push(f)}else o.set(l,{flat:c}),e.symbols.set(l,{flat:c})}this._addSymbols(t.key,r)}deleteStyleLayers(t){this._uniqueSymbolLayerArray=null;for(const[s,e]of this._tiles){const i=new Map;for(const r of t)e.symbols.has(r)&&(i.set(r,e.symbols.get(r)),e.symbols.delete(r));this._removeSymbols(i),0===e.symbols.size&&this._tiles.delete(s)}}removeTile(t){this._uniqueSymbolLayerArray=null;const s=this._tiles.get(t.id);if(!s)return;const e=new Map;for(const[i,r]of t.symbols)s.symbols.has(i)&&(e.set(i,s.symbols.get(i)),s.symbols.delete(i));this._removeSymbols(e),0===s.symbols.size&&this._tiles.delete(t.id)}_removeSymbols(t){for(const[s,{flat:e}]of t)for(const i of e){const r=i.unique,o=r.tileSymbols,l=o.length-1;for(let c=0;c<l;c++)if(o[c]===i){o[c]=o[l];break}if(o.length=l,0===l){const c=this._uniqueSymbolsReferences.get(s);c.delete(r),0===c.size&&this._uniqueSymbolsReferences.delete(s)}i.unique=null}}_addSymbols(t,s){if(0===s.size)return;const e=this._visibleTiles;for(const i of e)i.parentTile||i.key.world!==t.world||i.key.level===t.level&&!i.key.equals(t)||this._matchSymbols(i,t,s);for(const[i,r]of s)for(const o of r)if(null==o.unique){const l=this._createUnique();o.unique=l,l.tileSymbols.push(o);let c=this._uniqueSymbolsReferences.get(i);c||(c=new Set,this._uniqueSymbolsReferences.set(i,c)),c.add(l)}}_matchSymbols(t,s,e){if(t.key.level>s.level){const r=t.key.level-s.level;if(t.key.row>>r!==s.row||t.key.col>>r!==s.col)return}if(s.level>t.key.level){const r=s.level-t.key.level;if(s.row>>r!==t.key.row||s.col>>r!==t.key.col)return}if(s.equals(t.key)){for(const r of t.childrenTiles)this._matchSymbols(r,s,e);return}const i=new Map;for(const[r,o]of e){const l=[];for(const S of o){const f=xt(this.tileCoordRange,S.xTile,s.level,s.col,t.key.level,t.key.col),d=xt(this.tileCoordRange,S.yTile,s.level,s.row,t.key.level,t.key.row);f>=0&&f<this.tileCoordRange&&d>=0&&d<this.tileCoordRange&&l.push({symbol:S,xTransformed:f,yTransformed:d})}const c=[],u=t.key.level<s.level?1:1<<t.key.level-s.level,_=this._tiles.get(t.id).symbols.get(r);if(_){const S=_.flat;for(const f of l){let d,C=!1;const R=f.xTransformed,A=f.yTransformed;d=null!=_.index?_.index.getCell(R,A):S;const E=f.symbol,Z=E.hash;for(const Q of d)if(Z===Q.hash&&Math.abs(R-Q.xTile)<=u&&Math.abs(A-Q.yTile)<=u){const q=Q.unique;E.unique=q,q.tileSymbols.push(E),C=!0;break}C||c.push(E)}}c.length>0&&i.set(r,c)}for(const r of t.childrenTiles)this._matchSymbols(r,s,i)}_createUniqueSymbolLayerArray(){const t=this._uniqueSymbolsReferences,s=new Array(t.size);let e,i=0;for(const[r,o]of t){const l=new Array(o.size);e=0;for(const c of o)l[e++]=c;s[i]={styleLayerUID:r,uniqueSymbols:l},i++}return s}}class se{constructor(t,s){this.styleRepository=t,this._tileToHandle=new Map,this._viewState={scale:0,rotation:0,center:[0,0],size:[0,0]},this._declutterViewState={scale:0,rotation:0,center:[0,0],size:[0,0]},this._completed=!1,this._fading=(0,Qt.t)(!1),this._symbolRepository=new te(4096,s,()=>new kt),this._symbolDeclutterer=new Jt(s,this._symbolRepository,(e,i,r)=>new Gt(e,i,r,this.styleRepository,this._zoom,this._viewState.rotation),(e,i)=>{e.allSymbolsFadingOut=!0,e.lastOpacityUpdate=i,function Vt(h,t,s){for(const[e,i]of h.symbols)Bt(h,t,s,i,e)}(e,i,!0),e.decluttered=!0,e.requestRender()},(e,i)=>this.styleRepository.getStyleLayerByUID(e.styleLayerUID).z-this.styleRepository.getStyleLayerByUID(i.styleLayerUID).z,e=>{const i=this.styleRepository.getStyleLayerByUID(e);if(this._zoom+1e-6<i.minzoom||this._zoom-1e-6>=i.maxzoom)return!1;const r=i.getLayoutProperty("visibility");return!r||r.getValue()!==W.EE.NONE})}get fading(){return this._fading.value}addTile(t){t.decluttered=!1,this._tileToHandle.set(t,t.on("symbols-changed",()=>{this._symbolRepository.add(t),this.restartDeclutter()})),this._symbolRepository.add(t),this.restartDeclutter()}removeTile(t){const s=this._tileToHandle.get(t);s&&(this._symbolRepository.removeTile(t),this.restartDeclutter(),s.remove(),this._tileToHandle.delete(t))}update(t,s){return this._zoom=t,this._viewState={scale:s.scale,rotation:s.rotation,center:[s.center[0],s.center[1]],size:[s.size[0],s.size[1]]},this._continueDeclutter(),this._completed}restartDeclutter(){this._completed=!1,this._symbolDeclutterer.restart(),this._notifyUnstable()}clear(){this._completed=!1,this._symbolRepository=null,this._symbolDeclutterer.restart(),this._tileToHandle.forEach(t=>t.remove()),this._tileToHandle.clear()}get stale(){return this._zoom!==this._declutterZoom||this._viewState.size[0]!==this._declutterViewState.size[0]||this._viewState.size[1]!==this._declutterViewState.size[1]||this._viewState.scale!==this._declutterViewState.scale||this._viewState.rotation!==this._declutterViewState.rotation}deleteStyleLayers(t){this._symbolRepository.deleteStyleLayers(t)}_continueDeclutter(){this._completed&&!this.stale||(this._symbolDeclutterer.running||(this._declutterZoom=this._zoom,this._declutterViewState.center[0]=this._viewState.center[0],this._declutterViewState.center[1]=this._viewState.center[1],this._declutterViewState.rotation=this._viewState.rotation,this._declutterViewState.scale=this._viewState.scale,this._declutterViewState.size[0]=this._viewState.size[0],this._declutterViewState.size[1]=this._viewState.size[1],this._symbolDeclutterer.restart()),this._symbolDeclutterer.setScreenSize(this._viewState.size[0],this._viewState.size[1]),this._completed=this._symbolDeclutterer.continue(ht.JM),this._completed&&this._scheduleNotifyStable())}_scheduleNotifyStable(){null!=this._stableNotificationHandle&&clearTimeout(this._stableNotificationHandle),this._stableNotificationHandle=setTimeout(()=>{this._stableNotificationHandle=null,this._fading.value=!1},1.5*ht.v7)}_notifyUnstable(){null!=this._stableNotificationHandle&&(clearTimeout(this._stableNotificationHandle),this._stableNotificationHandle=null),this._fading.value=!0}}var nt=w(39406);class ie extends bt.I{_createTransforms(){return{dvs:(0,lt.c)(),tileMat3:(0,lt.c)()}}}var re=w(26268);const dt=1e-6;function Tt(h,t){if(h){const s=h.getLayoutProperty("visibility");if(!s||s.getValue()!==W.EE.NONE&&(void 0===h.minzoom||h.minzoom<t+dt)&&(void 0===h.maxzoom||h.maxzoom>=t-dt))return!0}return!1}class ne extends re.Z{constructor(t){super(t),this._backgroundTiles=[],this._pointToCallbacks=new Map}destroy(){this.removeAllChildren(),this._spriteMosaic?.dispose(),this._spriteMosaic=null,this._glyphMosaic?.dispose(),this._glyphMosaic=null,null!=this._symbolFader&&(this._symbolFader.clear(),this._symbolFader=null),this._styleRepository=null,this._backgroundTiles=[],this._pointToCallbacks.clear()}get fading(){return this._symbolFader?.fading??!1}setStyleResources(t,s,e){this._spriteMosaic=t,this._glyphMosaic=s,this._styleRepository=e,null==this._symbolFader&&(this._symbolFader=new se(this._styleRepository,this.children)),this._symbolFader.styleRepository=e}setSpriteMosaic(t){this._spriteMosaic?.dispose(),this._spriteMosaic=t}deleteStyleLayers(t){null!=this._symbolFader&&this._symbolFader.deleteStyleLayers(t)}hitTest(t){var s=this;return(0,H.Z)(function*(){const e=(0,L.hh)();return s._pointToCallbacks.set(t,e),s.requestRender(),e.promise})()}createRenderParams(t){return{...super.createRenderParams(t),renderPass:null,styleLayer:null,styleLayerUID:-1,glyphMosaic:this._glyphMosaic,spriteMosaic:this._spriteMosaic,hasClipping:!!this._clippingInfos}}doRender(t){!this.visible||t.drawPhase!==nt.jx.MAP&&t.drawPhase!==nt.jx.DEBUG||void 0===this._spriteMosaic||super.doRender(t)}addChild(t){return super.addChild(t),null!=this._symbolFader?this._symbolFader.addTile(t):t.decluttered=!0,this.requestRender(),t}removeChild(t){return null!=this._symbolFader&&this._symbolFader.removeTile(t),this.requestRender(),super.removeChild(t)}renderChildren(t){const{drawPhase:s}=t;if(s!==nt.jx.DEBUG){if(this._doRender(t),this._pointToCallbacks.size>0){t.drawPhase=nt.jx.HITTEST;const e=t.painter.effects.hittestVTL;e.bind(t),this._doRender(t),e.draw(t,this._pointToCallbacks),e.unbind(t),t.drawPhase=s}}else super.renderChildren(t)}removeAllChildren(){for(let t=0;t<this.children.length;t++){const s=this.children[t];null!=this._symbolFader&&this._symbolFader.removeTile(s),s.dispose()}super.removeAllChildren()}getStencilTarget(){return this.children.filter(t=>t.neededForCoverage&&t.hasData())}restartDeclutter(){null!=this._symbolFader&&this._symbolFader.restartDeclutter()}_doRender(t){const{context:s}=t,e=this._styleRepository;if(!e)return;const i=e.layers;let r=!0;t.drawPhase===nt.jx.HITTEST&&(r=!1),e.backgroundBucketIds.length>0&&(t.renderPass="background",this._renderBackgroundLayers(t,e.backgroundBucketIds)),super.renderChildren(t),t.drawPhase===nt.jx.MAP&&this._fade(t.displayLevel,t.state);const o=this.children.filter(l=>l.visible&&l.hasData());if(!o||0===o.length)return s.bindVAO(),s.setStencilTestEnabled(!0),void s.setBlendingEnabled(!0);for(const l of o)l.triangleCount=0;s.setStencilWriteMask(0),s.setColorMask(!0,!0,!0,!0),s.setStencilOp(x.xS.KEEP,x.xS.KEEP,x.xS.REPLACE),s.setStencilTestEnabled(!0),s.setBlendingEnabled(!1),s.setDepthTestEnabled(!0),s.setDepthWriteEnabled(!0),s.setDepthFunction(x.wb.LEQUAL),s.setClearDepth(1),s.clear(s.gl.DEPTH_BUFFER_BIT),t.renderPass="opaque";for(let l=i.length-1;l>=0;l--)this._renderStyleLayer(i[l],t,o);s.setDepthWriteEnabled(!1),s.setBlendingEnabled(r),s.setBlendFunctionSeparate(x.zi.ONE,x.zi.ONE_MINUS_SRC_ALPHA,x.zi.ONE,x.zi.ONE_MINUS_SRC_ALPHA),t.renderPass="translucent";for(let l=0;l<i.length;l++)this._renderStyleLayer(i[l],t,o);s.bindVAO(),s.setStencilTestEnabled(!0),s.setBlendingEnabled(!0)}_fade(t,s){null!=this._symbolFader&&(this._symbolFader.update(t,s)||this.requestRender())}_renderStyleLayer(t,s,e){const{painter:i,renderPass:r}=s;if(void 0===t)return;const o=t.getLayoutProperty("visibility");if(o&&o.getValue()===W.EE.NONE)return;let l;switch(t.type){case W.fR.BACKGROUND:return;case W.fR.FILL:if("opaque"!==r&&"translucent"!==s.renderPass)return;l="vtlFill";break;case W.fR.LINE:if("translucent"!==r)return;l="vtlLine";break;case W.fR.CIRCLE:if("translucent"!==r)return;l="vtlCircle";break;case W.fR.SYMBOL:if("translucent"!==r)return;l="vtlSymbol"}if(e=e.filter(t.type===W.fR.SYMBOL?u=>u.decluttered:u=>u.neededForCoverage),"vtlSymbol"!==l){const u=s.displayLevel;if(0===e.length||void 0!==t.minzoom&&t.minzoom>=u+dt||void 0!==t.maxzoom&&t.maxzoom<u-dt)return}const c=t.uid;s.styleLayerUID=c,s.styleLayer=t;for(const u of e)if(u.layerData.has(c)){i.renderObjects(s,e,l);break}}_renderBackgroundLayers(t,s){const{context:e,displayLevel:i,painter:r,state:o}=t,l=this._styleRepository;let c=!1;for(const Q of s)if(l.getLayerById(Q).type===W.fR.BACKGROUND&&Tt(l.getLayerById(Q),i)){c=!0;break}if(!c)return;const u=this._tileInfoView.getTileCoverage(t.state,0,!0,"smallest"),{spans:_,lodInfo:S}=u,{level:f}=S,d=(0,a.Ue)(),C=[];if(this._renderPasses){const Q=this._renderPasses[0];null!=this._clippingInfos&&(Q.brushes[0].prepareState(t),Q.brushes[0].drawMany(t,this._clippingInfos))}const R=this._backgroundTiles;let A,E=0;for(const{row:Q,colFrom:q,colTo:tt}of _)for(let Y=q;Y<=tt;Y++){if(E<R.length)A=R[E],A.key.set(f,Q,S.normalizeCol(Y),S.getWorldForColumn(Y)),this._tileInfoView.getTileBounds(d,A.key,!1),A.x=d[0],A.y=d[3],A.resolution=this._tileInfoView.getTileResolution(f);else{const X=new et.Z(f,Q,S.normalizeCol(Y),S.getWorldForColumn(Y)),ot=this._tileInfoView.getTileBounds((0,a.Ue)(),X),de=this._tileInfoView.getTileResolution(f);A=new ie(X,de,ot[0],ot[3],512,512,4096,4096),R.push(A)}A.setTransform(o),C.push(A),E++}e.setStencilWriteMask(0),e.setColorMask(!0,!0,!0,!0),e.setStencilOp(x.xS.KEEP,x.xS.KEEP,x.xS.REPLACE),e.setStencilFunction(x.wb.EQUAL,0,255);let Z=!0;t.drawPhase===nt.jx.HITTEST&&(Z=!1),e.setStencilTestEnabled(Z);for(const Q of s){const q=l.getLayerById(Q);q.type===W.fR.BACKGROUND&&Tt(q,i)&&(t.styleLayerUID=q.uid,t.styleLayer=q,r.renderObjects(t,C,"vtlBackground"))}pt.Z.pool.release(u)}}var It=w(78364),oe=w(37384),le=w(2584),ae=w(9598);class he extends ae.Z{constructor(){super(...arguments),this._fullCacheLodInfos=null,this._levelByScale={}}getTileParentId(t){const s=et.Z.pool.acquire(t),e=0===s.level?null:et.Z.getId(s.level-1,s.row>>1,s.col>>1,s.world);return et.Z.pool.release(s),e}getTileCoverage(t,s,e=!0,i){const r=super.getTileCoverage(t,s,e,i);if(!r)return r;const o=1<<r.lodInfo.level;return r.spans=r.spans.filter(l=>l.row>=0&&l.row<o),r}scaleToLevel(t){if(this._fullCacheLodInfos||this._initializeFullCacheLODs(this._lodInfos),this._levelByScale[t])return this._levelByScale[t];{const s=this._fullCacheLodInfos;if(t>s[0].scale)return s[0].level;let e,i;for(let r=0;r<s.length-1;r++)if(i=s[r+1],t>i.scale)return e=s[r],e.level+(e.scale-t)/(e.scale-i.scale);return s[s.length-1].level}}_initializeFullCacheLODs(t){let s;s=0===t[0].level?t.map(e=>({level:e.level,resolution:e.resolution,scale:e.scale})):le.Z.create({size:this.tileInfo.size[0],spatialReference:this.tileInfo.spatialReference}).lods.map(r=>({level:r.level,resolution:r.resolution,scale:r.scale}));for(let e=0;e<s.length;e++)this._levelByScale[s[e].scale]=s[e].level;this._fullCacheLodInfos=s}}var Rt=w(8480),ce=w(45611);let _t=class extends((0,oe.y)(ce.Z)){constructor(){super(...arguments),this._styleChanges=[],this._fetchQueue=null,this._parseQueue=null,this._tileHandlerPromise=null,this._isTileHandlerReady=!1}get fading(){return this._vectorTileContainer?.fading??!1}hitTest(h,t){var s=this;return(0,H.Z)(function*(){if(!s._tileHandlerPromise)return null;yield s._tileHandlerPromise;const e=yield s._vectorTileContainer.hitTest(t);if(!e||0===e.length)return null;const i=e[0]-1,r=s._styleRepository,o=r.getStyleLayerByUID(i);if(!o)return null;const l=r.getStyleLayerIndex(o.id);return[{type:"graphic",mapPoint:h,layer:s.layer,graphic:new U.Z({attributes:{layerId:l,layerName:o.id,layerUID:i},layer:s.layer,sourceLayer:s.layer})}]})()}update(h){if(this._tileHandlerPromise&&this._isTileHandlerReady)return h.pixelRatio!==this._tileHandler.devicePixelRatio?(this._start(),void(this._tileHandler.devicePixelRatio=h.pixelRatio)):void(this._styleChanges.length>0?this._tileHandlerPromise=this._applyStyleChanges():(this._fetchQueue.pause(),this._parseQueue.pause(),this._fetchQueue.state=h.state,this._parseQueue.state=h.state,this._tileManager.update(h)||this.requestUpdate(),this._parseQueue.resume(),this._fetchQueue.resume()))}attach(){const{style:h}=this.layer.currentStyleInfo;this._styleRepository=new It.Z(h),this._tileInfoView=new he(this.layer.tileInfo,this.layer.fullExtent),this._vectorTileContainer=new ne(this._tileInfoView),this._tileHandler=new Dt(this.layer,this._styleRepository,window.devicePixelRatio||1),this.container.addChild(this._vectorTileContainer),this._start(),this.addAttachHandles([this.layer.on("paint-change",t=>{if(t.isDataDriven)this._styleChanges.push({type:y.Fr.PAINTER_CHANGED,data:t}),this.requestUpdate();else{const s=this._styleRepository,e=s.getLayerById(t.layer);if(!e)return;const i=e.type===W.fR.SYMBOL;s.setPaintProperties(t.layer,t.paint),i&&this._vectorTileContainer?.restartDeclutter(),this._vectorTileContainer?.requestRender()}}),this.layer.on("layout-change",t=>{const s=this._styleRepository,e=s.getLayerById(t.layer);if(!e)return;const i=(0,n.Hg)(e.layout,t.layout);if(null!=i){if((0,n.uD)(i,"visibility")&&1===function ue(h){if(null==h)return 0;switch(h.type){case"partial":return Object.keys(h.diff).length;case"complete":return Math.max(Object.keys(h.oldValue).length,Object.keys(h.newValue).length);case"collection":return Object.keys(h.added).length+Object.keys(h.changed).length+Object.keys(h.removed).length}}(i))return s.setLayoutProperties(t.layer,t.layout),e.type===W.fR.SYMBOL&&this._vectorTileContainer?.restartDeclutter(),void this._vectorTileContainer?.requestRender();this._styleChanges.push({type:y.Fr.LAYOUT_CHANGED,data:t}),this.requestUpdate()}}),this.layer.on("style-layer-visibility-change",t=>{const s=this._styleRepository,e=s.getLayerById(t.layer);e&&(s.setStyleLayerVisibility(t.layer,t.visibility),e.type===W.fR.SYMBOL&&this._vectorTileContainer?.restartDeclutter(),this._vectorTileContainer?.requestRender())}),this.layer.on("style-layer-change",t=>{this._styleChanges.push({type:y.Fr.LAYER_CHANGED,data:t}),this.requestUpdate()}),this.layer.on("delete-style-layer",t=>{this._styleChanges.push({type:y.Fr.LAYER_REMOVED,data:t}),this.requestUpdate()}),this.layer.on("load-style",()=>this._loadStyle()),this.layer.on("spriteSource-change",t=>{this._styleChanges.push({type:y.Fr.SPRITES_CHANGED,data:t});const s=this._styleRepository.layers;for(const e of s)switch(e.type){case W.fR.SYMBOL:e.getLayoutProperty("icon-image")&&this._styleChanges.push({type:y.Fr.LAYOUT_CHANGED,data:{layer:e.id,layout:e.layout}});break;case W.fR.LINE:e.getPaintProperty("line-pattern")&&this._styleChanges.push({type:y.Fr.PAINTER_CHANGED,data:{layer:e.id,paint:e.paint,isDataDriven:e.isPainterDataDriven()}});break;case W.fR.FILL:e.getLayoutProperty("fill-pattern")&&this._styleChanges.push({type:y.Fr.PAINTER_CHANGED,data:{layer:e.id,paint:e.paint,isDataDriven:e.isPainterDataDriven()}})}this.requestUpdate()})])}detach(){this._stop(),this.container.removeAllChildren(),this._vectorTileContainer=(0,D.SC)(this._vectorTileContainer),this._tileHandler=(0,D.SC)(this._tileHandler)}moveStart(){this.requestUpdate()}viewChange(){this.requestUpdate()}moveEnd(){this.requestUpdate()}supportsSpatialReference(h){return(0,p.fS)(this.layer.tileInfo?.spatialReference,h)}canResume(){let h=super.canResume();const{currentStyleInfo:t}=this.layer;if(h&&t?.layerDefinition){const s=this.view.scale,{minScale:e,maxScale:i}=t.layerDefinition;t?.layerDefinition&&(e&&e<s&&(h=!1),i&&i>s&&(h=!1))}return h}isUpdating(){return this.fading}acquireTile(h){const t=this._createVectorTile(h);return this._updatingHandles.addPromise(this._fetchQueue.push(t.key).then(s=>this._parseQueue.push({key:t.key,data:s})).then(s=>{t.once("attach",()=>this.requestUpdate()),t.setData(s),this.requestUpdate()}).catch(s=>{(0,L.D_)(s)||G.Z.getLogger(this).error(s)})),t}releaseTile(h){const t=h.key.id;this._fetchQueue.abort(t),this._parseQueue.abort(t),this.requestUpdate()}_start(){if(this._stop(),this._tileManager=new Ot({acquireTile:s=>this.acquireTile(s),releaseTile:s=>this.releaseTile(s),tileInfoView:this._tileInfoView},this._vectorTileContainer),!this.layer.currentStyleInfo)return;const h=new AbortController,t=this._tileHandler.start({signal:h.signal}).then(()=>{this._fetchQueue=new Rt.Z({tileInfoView:this._tileInfoView,process:(s,e)=>this._getTileData(s,e),concurrency:15}),this._parseQueue=new Rt.Z({tileInfoView:this._tileInfoView,process:(s,e)=>this._parseTileData(s,e),concurrency:8}),this.requestUpdate(),this._isTileHandlerReady=!0});this._tileHandler.spriteMosaic.then(s=>{this._vectorTileContainer.setStyleResources(s,this._tileHandler.glyphMosaic,this._styleRepository),this.requestUpdate()}),this._tileHandlerAbortController=h,this._tileHandlerPromise=t}_stop(){if(!this._tileHandlerAbortController||!this._vectorTileContainer)return;const h=this._tileHandlerAbortController;h&&h.abort(),this._tileHandlerPromise=null,this._isTileHandlerReady=!1,this._fetchQueue=(0,D.SC)(this._fetchQueue),this._parseQueue=(0,D.SC)(this._parseQueue),this._tileManager=(0,D.SC)(this._tileManager),this._vectorTileContainer.removeAllChildren()}_getTileData(h,t){var s=this;return(0,H.Z)(function*(){return s._tileHandler.fetchTileData(h,t)})()}_parseTileData(h,t){var s=this;return(0,H.Z)(function*(){return s._tileHandler.parseTileData(h,t)})()}_applyStyleChanges(){var h=this;return(0,H.Z)(function*(){h._isTileHandlerReady=!1,h._fetchQueue.pause(),h._parseQueue.pause(),h._fetchQueue.clear(),h._parseQueue.clear(),h._tileManager.clearCache();const t=h._styleChanges;try{yield h._tileHandler.updateStyle(t)}catch(o){G.Z.getLogger(h).error("error applying vector-tiles style update",o.message),h._fetchQueue.resume(),h._parseQueue.resume(),h._isTileHandlerReady=!0}const s=h._styleRepository,e=new Set;t.forEach(o=>{if(o.type!==y.Fr.LAYER_REMOVED)return;const c=s.getLayerById(o.data.layer);c&&e.add(c.uid)});const i=new Set;t.forEach(o=>{let l;switch(o.type){case y.Fr.PAINTER_CHANGED:s.setPaintProperties(o.data.layer,o.data.paint),l=o.data.layer;break;case y.Fr.LAYOUT_CHANGED:s.setLayoutProperties(o.data.layer,o.data.layout),l=o.data.layer;break;case y.Fr.LAYER_REMOVED:return void s.deleteStyleLayer(o.data.layer);case y.Fr.LAYER_CHANGED:s.setStyleLayer(o.data.layer,o.data.index),l=o.data.layer.id;break;case y.Fr.SPRITES_CHANGED:h._vectorTileContainer.setSpriteMosaic(h._tileHandler.setSpriteSource(o.data.spriteSource))}if(l){const c=s.getLayerById(l);c&&i.add(c.uid)}});const r=h._vectorTileContainer.children;if(e.size>0){const o=Array.from(e);h._vectorTileContainer.deleteStyleLayers(o);for(const l of r)l.deleteLayerData(o)}if(h._fetchQueue.resume(),h._parseQueue.resume(),i.size>0){const o=Array.from(i),l=[];for(const c of r){const u=h._updatingHandles.addPromise(h._fetchQueue.push(c.key).then(_=>h._parseQueue.push({key:c.key,data:_,styleLayerUIDs:o})).then(_=>c.setData(_)));l.push(u)}yield Promise.all(l)}h._styleChanges=[],h._isTileHandlerReady=!0,h.requestUpdate()})()}_loadStyle(){var h=this;return(0,H.Z)(function*(){const{style:t}=h.layer.currentStyleInfo,s=(0,k.d9)(t);h._isTileHandlerReady=!1,h._fetchQueue.pause(),h._parseQueue.pause(),h._fetchQueue.clear(),h._parseQueue.clear(),h._styleRepository=new It.Z(s),h._vectorTileContainer.destroy(),h._tileManager.clear(),h._tileHandlerAbortController.abort(),h._tileHandlerAbortController=new AbortController;const{signal:e}=h._tileHandlerAbortController;try{h._tileHandlerPromise=h._tileHandler.setStyle(h._styleRepository,s),yield h._tileHandlerPromise}catch(r){if(!(0,L.D_)(r))throw r}if(e.aborted)return h._fetchQueue.resume(),h._parseQueue.resume(),h._isTileHandlerReady=!0,void h.requestUpdate();const i=yield h._tileHandler.spriteMosaic;h._vectorTileContainer.setStyleResources(i,h._tileHandler.glyphMosaic,h._styleRepository),h._fetchQueue.resume(),h._parseQueue.resume(),h._isTileHandlerReady=!0,h.requestUpdate()})()}_createVectorTile(h){const t=this._tileInfoView.getTileBounds((0,a.Ue)(),h),s=this._tileInfoView.getTileResolution(h.level);return new ft(h,s,t[0],t[3],512,512,this._styleRepository)}};(0,V._)([(0,O.Cb)()],_t.prototype,"_isTileHandlerReady",void 0),_t=(0,V._)([(0,b.j)("esri.views.2d.layers.VectorTileLayerView2D")],_t);const ye=_t}}]);