"use strict";(self.webpackChunkCRIS=self.webpackChunkCRIS||[]).push([[57],{90512:(ae,X,f)=>{f.d(X,{Z:()=>J});var _=f(15861);class J{constructor(){this.declaredRootClass="esri.arcade.featureSetCollection",this._layerById={},this._layerByName={}}add(x,O,U){this._layerById[O]=U,this._layerByName[x]=U}featureSetByName(x,O=!0,U=["*"]){var P=this;return(0,_.Z)(function*(){return void 0===P._layerByName[x]?null:P._layerByName[x]})()}featureSetById(x,O=!0,U=["*"]){var P=this;return(0,_.Z)(function*(){return void 0===P._layerById[x]?null:P._layerById[x]})()}castToText(x=!1){return"object, FeatureSetCollection"}}},20057:(ae,X,f)=>{f.r(X),f.d(X,{constructAssociationMetaDataFeatureSetFromUrl:()=>qe,constructFeatureSet:()=>ee,constructFeatureSetFromPortalItem:()=>tt,constructFeatureSetFromRelationship:()=>He,constructFeatureSetFromUrl:()=>ye,convertToFeatureSet:()=>et,createFeatureSetCollectionFromMap:()=>Xe,createFeatureSetCollectionFromService:()=>Ye,initialiseMetaDataCache:()=>Ve});var _=f(15861),J=f(84792),V=f(90512),x=f(47562),O=f(53997),U=f(88879),P=f(52724),I=f(95896),y=f(47982),R=f(49086),N=f(91510),S=f(57366),c=f(77132),v=f(83947),Z=f(45333),d=f(80774);class F{constructor(){this.field="",this.tofieldname="",this.typeofstat="MIN",this.workingexpr=null}clone(){const e=new F;return e.field=this.field,e.tofieldname=this.tofieldname,e.typeofstat=this.typeofstat,e.workingexpr=this.workingexpr,e}static parseStatField(e,t,r,n){const s=new F;s.field=e;const a=d.WhereClause.create(t,r,n),l=function b(m){if("function"===m.parseTree.type){if(0===m.parseTree.args.value.length)return{name:m.parseTree.name,expr:null};if(m.parseTree.args.value.length>1)throw new y.eS(y.f.MissingStatisticParameters);const e=d.WhereClause.create((0,v.XF)(m.parseTree.args.value[0],c.Bj.Standardised,m.parameters),m.fieldsIndex,m.timeZone);return{name:m.parseTree.name,expr:e}}return null}(a);if(null===l)throw new y.eS(y.f.UnsupportedSqlFunction,{function:""});const i=l.name.toUpperCase().trim();if("MIN"===i){if(s.typeofstat="MIN",s.workingexpr=l.expr,null===a)throw new y.eS(y.f.InvalidFunctionParameters,{function:"min"})}else if("MAX"===i){if(s.typeofstat="MAX",s.workingexpr=l.expr,null===a)throw new y.eS(y.f.InvalidFunctionParameters,{function:"max"})}else if("COUNT"===i)s.typeofstat="COUNT",s.workingexpr=l.expr;else if("STDEV"===i){if(s.typeofstat="STDDEV",s.workingexpr=l.expr,null===a)throw new y.eS(y.f.InvalidFunctionParameters,{function:"stdev"})}else if("SUM"===i){if(s.typeofstat="SUM",s.workingexpr=l.expr,null===a)throw new y.eS(y.f.InvalidFunctionParameters,{function:"sum"})}else if("MEAN"===i){if(s.typeofstat="AVG",s.workingexpr=l.expr,null===a)throw new y.eS(y.f.InvalidFunctionParameters,{function:i})}else if("AVG"===i){if(s.typeofstat="AVG",s.workingexpr=l.expr,null===a)throw new y.eS(y.f.InvalidFunctionParameters,{function:"avg"})}else{if("VAR"!==i)throw new y.eS(y.f.UnsupportedSqlFunction,{function:i});if(s.typeofstat="VAR",s.workingexpr=l.expr,null===a)throw new y.eS(y.f.InvalidFunctionParameters,{function:"var"})}return s}toStatisticsName(){switch(this.typeofstat.toUpperCase()){case"MIN":return"min";case"MAX":return"max";case"SUM":return"sum";case"COUNT":default:return"count";case"VAR":return"var";case"STDDEV":return"stddev";case"AVG":return"avg"}}}var h=f(50011),o=f(31910),p=f(67398),D=f(29535),E=f(65234),w=f(36255),B=f(60466);function G(m){if(!m)return"COUNT";switch(m.toLowerCase()){case"max":return"MAX";case"var":case"variance":return"VAR";case"avg":case"average":case"mean":return"AVG";case"min":return"MIN";case"sum":return"SUM";case"stdev":case"stddev":return"STDDEV";case"count":return"COUNT"}return"COUNT"}class M extends R.Z{constructor(e){super(e),this._decodedStatsfield=[],this._decodedGroupbyfield=[],this._candosimplegroupby=!0,this.phsyicalgroupbyfields=[],this.objectIdField="ROW__ID",this._internalObjectIdField="ROW__ID",this._adaptedFields=[],this.declaredClass="esri.arcade.featureset.actions.Aggregate",this._uniqueIds=1,this._maxQuery=10,this._maxProcessing=10,this._parent=e.parentfeatureset,this._config=e}isTable(){return!0}_getSet(e){var t=this;return(0,_.Z)(function*(){if(null===t._wset){const r=yield t._getFilteredSet("",null,null,null,e);return t._wset=r,t._wset}return t._wset})()}_isInFeatureSet(){return c.dj.InFeatureSet}_nextUniqueName(e){for(;1===e["T"+this._uniqueIds.toString()];)this._uniqueIds++;const t="T"+this._uniqueIds.toString();return e[t]=1,t}_convertToEsriFieldType(e){return e}_initialiseFeatureSet(){const e={};let t=!1,r=1;const n=this._parent?this._parent.getFieldsIndex():new B.Z([]);for(this.objectIdField="ROW__ID",this.globalIdField="";!1===t;){let a=!1;for(let l=0;l<this._config.groupbyfields.length;l++)if(this._config.groupbyfields[l].name.toLowerCase()===this.objectIdField.toLowerCase()){a=!0;break}if(!1===a)for(let l=0;l<this._config.statsfields.length;l++)if(this._config.statsfields[l].name.toLowerCase()===this.objectIdField.toLowerCase()){a=!0;break}!1===a?t=!0:(this.objectIdField="ROW__ID"+r.toString(),r++)}for(const a of this._config.statsfields){const l=new F;l.field=a.name,l.tofieldname=a.name,l.workingexpr=a.expression instanceof d.WhereClause?a.expression:d.WhereClause.create(a.expression,n,this.dateFieldsTimeZoneDefaultUTC),l.typeofstat=G(a.statistic),this._decodedStatsfield.push(l)}this._decodedGroupbyfield=[];for(const a of this._config.groupbyfields){const l={name:a.name,singlefield:null,tofieldname:a.name,expression:a.expression instanceof d.WhereClause?a.expression:d.WhereClause.create(a.expression,n,this.dateFieldsTimeZoneDefaultUTC),sqlType:null};this._decodedGroupbyfield.push(l)}if(null!==this._parent){this.geometryType=this._parent.geometryType,this.spatialReference=this._parent.spatialReference,this.hasM=this._parent.hasM,this.hasZ=this._parent.hasZ,this.typeIdField="";for(const a of this._parent.fields)e[a.name.toUpperCase()]=1;this.types=null}else this.geometryType=c.Qk.point,this.typeIdField="",this.types=null,this.spatialReference=new E.Z({wkid:4326});this.fields=[];const s=new F;s.field=this._nextUniqueName(e),s.tofieldname=this.objectIdField,s.workingexpr=d.WhereClause.create(this._parent.objectIdField,this._parent.getFieldsIndex(),this.dateFieldsTimeZoneDefaultUTC),s.typeofstat="MIN",this._decodedStatsfield.push(s);for(const a of this._decodedGroupbyfield){const l=new w.Z;if(a.name=this._nextUniqueName(e),l.name=a.tofieldname,l.alias=l.name,(0,v.y5)(a.expression)){const i=this._parent.getField((0,v.zR)(a.expression,c.Bj.Standardised));if(!i)throw new y.EN(y.H9.AggregationFieldNotFound);a.name=i.name,a.singlefield=i.name,this.phsyicalgroupbyfields.push(i.name),l.type=i.type,a.sqlType=i.type}else{l.type=this._convertToEsriFieldType((0,v.DT)(a.expression,this._parent.fields));const i=new w.Z;i.name=a.name,i.alias=i.name,this.phsyicalgroupbyfields.push(a.name),this._adaptedFields.push(new P.yN(i,a.expression)),this._candosimplegroupby=!1,a.sqlType=l.type}this.fields.push(l)}if(this._adaptedFields.length>0)for(const a of this._parent.fields)this._adaptedFields.push(new P.$X(a));for(let a=0;a<this._decodedStatsfield.length;a++){const l=new w.Z;let i=null;const u=this._decodedStatsfield[a];u.field=this._nextUniqueName(e),u.tofieldname===this.objectIdField&&(this._internalObjectIdField=u.field),l.name=u.tofieldname,l.alias=l.name;const g=null!==u.workingexpr&&(0,v.y5)(u.workingexpr)?(0,v.zR)(u.workingexpr,c.Bj.Standardised):"";switch(this._decodedStatsfield[a].typeofstat){case"SUM":if(""!==g){if(i=this._parent.getField(g),!i)throw new y.EN(y.H9.AggregationFieldNotFound);l.type=i.type}else l.type="double";break;case"MIN":case"MAX":if(""!==g){if(i=this._parent.getField(g),!i)throw new y.EN(y.H9.AggregationFieldNotFound);l.type=i.type}else l.type="double";break;case"COUNT":l.type="integer";break;case"STDDEV":case"VAR":case"AVG":if(""!==g&&(i=this._parent.getField(g),!i))throw new y.EN(y.H9.AggregationFieldNotFound);l.type="double"}this.fields.push(l)}}_canDoAggregates(){return(0,_.Z)(function*(){return!1})()}_getFeatures(e,t,r,n){var s=this;return(0,_.Z)(function*(){const a=s._maxQuery;return!0===s._checkIfNeedToExpandKnownPage(e,a)?(yield s._expandPagedSet(e,a,0,0,n),s._getFeatures(e,t,r,n)):"success"})()}_getFilteredSet(e,t,r,n,s){var a=this;return(0,_.Z)(function*(){if(""!==e)return new N.Z([],[],!0,null);let l=null;const i={ordered:!1,nowhereclause:!1};if(yield a._ensureLoaded(),null!==r)for(let g=0;g<a._decodedStatsfield.length;g++)if(!0===(0,v.hq)(r,a._decodedStatsfield[g].tofieldname)){i.nowhereclause=!0,r=null;break}if(null!==n){i.ordered=!0;for(let g=0;g<a._decodedStatsfield.length;g++)if(!0===n.scanForField(a._decodedStatsfield[g].tofieldname)){n=null,i.ordered=!1;break}if(null!==n)for(const g of a._decodedGroupbyfield)if(null===g.singlefield&&!0===n.scanForField(g.tofieldname)){n=null,i.ordered=!1;break}}if(!1!==a._candosimplegroupby&&(yield a._parent._canDoAggregates(a.phsyicalgroupbyfields,a._decodedStatsfield,"",null,null))){let g=null;r&&(g=a._reformulateWhereClauseWithoutGroupByFields(r));let T=null;n&&(T=a._reformulateOrderClauseWithoutGroupByFields(n));const L=yield a._parent._getAggregatePagesDataSourceDefinition(a.phsyicalgroupbyfields,a._decodedStatsfield,"",null,g,T,a._internalObjectIdField);return a._checkCancelled(s),l=!0===i.nowhereclause?new N.Z(L._candidates.slice(0).concat(L._known.slice(0)),[],!0===i.ordered&&L._ordered,a._clonePageDefinition(L.pagesDefinition)):new N.Z(L._candidates.slice(0),L._known.slice(0),!0===i.ordered&&L._ordered,a._clonePageDefinition(L.pagesDefinition)),l}let u=a._parent;if(a._adaptedFields.length>0&&(u=new P.Xx({parentfeatureset:a._parent,adaptedFields:a._adaptedFields,extraFilter:null})),!0===i.nowhereclause)l=new N.Z(["GETPAGES"],[],!1,{aggregatefeaturesetpagedefinition:!0,resultOffset:0,resultRecordCount:a._maxQuery,internal:{fullyResolved:!1,workingItem:null,type:"manual",iterator:null,set:[],subfeatureset:new I.Z({parentfeatureset:u,orderbyclause:new S.Z(a.phsyicalgroupbyfields.join(",")+","+a._parent.objectIdField+" ASC")})}});else{let g=u;if(null!==r){let T=null;r&&(T=a._reformulateWhereClauseWithoutGroupByFields(r)),g=new O.Z({parentfeatureset:g,whereclause:T})}l=new N.Z(["GETPAGES"],[],!1,{aggregatefeaturesetpagedefinition:!0,resultOffset:0,resultRecordCount:a._maxQuery,internal:{fullyResolved:!1,workingItem:null,type:"manual",iterator:null,set:[],subfeatureset:new I.Z({parentfeatureset:g,orderbyclause:new S.Z(a.phsyicalgroupbyfields.join(",")+","+a._parent.objectIdField+" ASC")})}})}return l})()}_reformulateWhereClauseWithoutStatsFields(e){for(const t of this._decodedStatsfield)e=(0,v.bB)(e,t.tofieldname,(0,v.zR)(t.workingexpr,c.Bj.Standardised),this._parent.getFieldsIndex());return e}_reformulateWhereClauseWithoutGroupByFields(e){for(const t of this._decodedGroupbyfield)t.tofieldname!==t.name&&(e=(0,v.bB)(e,t.tofieldname,(0,v.zR)(t.expression,c.Bj.Standardised),this._parent.getFieldsIndex()));return e}_reformulateOrderClauseWithoutGroupByFields(e){const t=[];for(const r of this._decodedGroupbyfield)r.tofieldname!==r.name&&t.push({field:r.tofieldname,newfield:r.name});return t.length>0?e.replaceFields(t):e}_clonePageDefinition(e){return null===e?null:!0===e.aggregatefeaturesetpagedefinition?{aggregatefeaturesetpagedefinition:!0,resultRecordCount:e.resultRecordCount,resultOffset:e.resultOffset,internal:e.internal}:this._parent._clonePageDefinition(e)}_refineSetBlock(e,t,r){var n=this;return(0,_.Z)(function*(){return!0===n._checkIfNeedToExpandCandidatePage(e,n._maxQuery)?(yield n._expandPagedSet(e,n._maxQuery,0,0,r),n._refineSetBlock(e,t,r)):(n._checkCancelled(r),n._refineKnowns(e,t),e)})()}_expandPagedSet(e,t,r,n,s){return this._expandPagedSetFeatureSet(e,t,r,n,s)}_getPhysicalPage(e,t,r){var n=this;return(0,_.Z)(function*(){if(!0===e.pagesDefinition.aggregatefeaturesetpagedefinition)return n._sequentialGetPhysicalItem(e,e.pagesDefinition.resultRecordCount,r,[]);const s=yield n._getAgregagtePhysicalPage(e,t,r);for(const a of s){const l={geometry:a.geometry,attributes:{}},i={};for(const u in a.attributes)i[u.toLowerCase()]=a.attributes[u];for(const u of n._decodedGroupbyfield)l.attributes[u.tofieldname]=i[u.name.toLowerCase()];for(const u of n._decodedStatsfield)l.attributes[u.tofieldname]=i[u.field.toLowerCase()];n._featureCache[l.attributes[n.objectIdField]]=new U.Z(l)}return s.length})()}_sequentialGetPhysicalItem(e,t,r,n){return new Promise((s,a)=>{null===e.pagesDefinition.internal.iterator&&(e.pagesDefinition.internal.iterator=e.pagesDefinition.internal.subfeatureset.iterator(r)),!0===e.pagesDefinition.internal.fullyResolved||0===t?s(n.length):this._nextAggregateItem(e,t,r,n,l=>{s(null===l?n.length:this._sequentialGetPhysicalItem(e,t-=1,r,n))},a)})}_nextAggregateItem(e,t,r,n,s,a){try{(0,x.a1)(e.pagesDefinition.internal.iterator.next()).then(l=>{if(null===l)if(null!==e.pagesDefinition.internal.workingItem){const i=this._calculateAndAppendAggregateItem(e.pagesDefinition.internal.workingItem);n.push(i),e.pagesDefinition.internal.workingItem=null,e.pagesDefinition.internal.set.push(i.attributes[this.objectIdField]),e.pagesDefinition.internal.fullyResolved=!0,s(null)}else e.pagesDefinition.internal.fullyResolved=!0,s(null);else{const i=this._generateAggregateHash(l);if(null===e.pagesDefinition.internal.workingItem)e.pagesDefinition.internal.workingItem={features:[l],id:i};else{if(i!==e.pagesDefinition.internal.workingItem.id){const u=this._calculateAndAppendAggregateItem(e.pagesDefinition.internal.workingItem);return n.push(u),e.pagesDefinition.internal.workingItem=null,e.pagesDefinition.internal.set.push(u.attributes[this.objectIdField]),t-=1,e.pagesDefinition.internal.workingItem={features:[l],id:i},void s(u)}e.pagesDefinition.internal.workingItem.features.push(l)}this._nextAggregateItem(e,t,r,n,s,a)}},a)}catch(l){a(l)}}_calculateFieldStat(e,t,r){const n=[];for(let s=0;s<e.features.length;s++)if(null!==t.workingexpr){const a=t.workingexpr.calculateValue(e.features[s]);null!==a&&n.push(a instanceof o.u||a instanceof D.n?a.toNumber():a instanceof p.H?a.toMilliseconds():a)}else n.push(null);switch(t.typeofstat){case"MIN":r.attributes[t.tofieldname]=(0,Z.tj)("min",n,-1);break;case"MAX":r.attributes[t.tofieldname]=(0,Z.tj)("max",n,-1);break;case"SUM":r.attributes[t.tofieldname]=(0,Z.tj)("sum",n,-1);break;case"COUNT":r.attributes[t.tofieldname]=n.length;break;case"VAR":r.attributes[t.tofieldname]=(0,Z.tj)("var",n,-1);break;case"STDDEV":r.attributes[t.tofieldname]=(0,Z.tj)("stddev",n,-1);break;case"AVG":r.attributes[t.tofieldname]=(0,Z.tj)("avg",n,-1)}return!0}_calculateAndAppendAggregateItem(e){const t={attributes:{},geometry:null};for(const n of this._decodedGroupbyfield){const s=n.singlefield?e.features[0].attributes[n.singlefield]:d.WhereClause.convertValueToStorageFormat(n.expression.calculateValue(e.features[0]),n.sqlType);t.attributes[n.tofieldname]=s}for(const n of this._decodedStatsfield)this._calculateFieldStat(e,n,t);const r=[];for(let n=0;n<this._decodedStatsfield.length;n++)r.push(this._calculateFieldStat(e,this._decodedStatsfield[n],t));return this._featureCache[t.attributes[this.objectIdField]]=new U.Z({attributes:t.attributes,geometry:t.geometry}),t}_generateAggregateHash(e){let t="";for(const r of this._decodedGroupbyfield){const n=r.singlefield?e.attributes[r.singlefield]:r.expression.calculateValue(e);t+=null==n?":":":"+n.toString()}return(0,h.F)(t,h.M.String)}_stat(){return(0,_.Z)(function*(){return{calculated:!1}})()}getFeatureByObjectId(){return(0,_.Z)(function*(){return null})()}static registerAction(){R.Z._featuresetFunctions.groupby=function(e,t){return new M({parentfeatureset:this,groupbyfields:e,statsfields:t})}}}var k=f(3482),C=f(79429),A=f(24263),W=f(22386),se=f(6729),le=f(91179),te=f(37053),Y=f(80415),Ee=f(81976),xe=f(26584),Oe=f(8314),Ze=f(10699),oe=f(35391),Ne=f(15283),de=f(2865),Pe=f(20721),Ae=f(17253),ne=f(96854);function ce(){return ce=(0,_.Z)(function*(m,e,t,r){return function ke(m,e,t,r){return he.apply(this,arguments)}(e,yield function je(m,e,t,r){return fe.apply(this,arguments)}(m,e,t,r),t,r)}),ce.apply(this,arguments)}function fe(){return(fe=(0,_.Z)(function*(m,e,t,r){const n={...r},s=function Be(m,e){let t=ne.Z.from(m);t.sourceSpatialReference=t.sourceSpatialReference??e?.sourceSpatialReference??null,(e?.gdbVersion||e?.dynamicDataSource)&&(t=t===m?t.clone():t,t.gdbVersion=m.gdbVersion||e.gdbVersion,t.dynamicDataSource=m.dynamicDataSource?Ne.n.from(m.dynamicDataSource):e.dynamicDataSource);const r=e?.infoFor3D;if(null!=r&&De(m,r)){t=t===m?t.clone():t,t.formatOf3DObjects=null;const{supportedFormats:n,queryFormats:s}=r,a=(0,oe.S0)("model/gltf-binary",n)??(0,oe.Ow)("glb",n),l=(0,oe.S0)("model/gltf+json",n)??(0,oe.Ow)("gtlf",n);for(const i of s){if(i===a){t.formatOf3DObjects=i;break}i!==l||t.formatOf3DObjects||(t.formatOf3DObjects=i)}if(!t.formatOf3DObjects)throw new xe.Z("query:unsupported-3d-query-formats","Could not find any supported 3D object query format. Only supported formats are 3D_glb and 3D_gltf");if(null==t.outFields||!t.outFields.includes("*")){t=t===m?t.clone():t,null==t.outFields&&(t.outFields=[]);const{originX:i,originY:u,originZ:g,translationX:T,translationY:L,translationZ:j,scaleX:K,scaleY:q,scaleZ:H,rotationX:$,rotationY:Q,rotationZ:ie,rotationDeg:re}=r.transformFieldRoles;t.outFields.push(i,u,g,T,L,j,K,q,H,$,Q,ie,re)}}return t}(e,t),a=null!=e.outStatistics?.[0],l=(0,Oe.Z)("featurelayer-pbf-statistics"),i=!a||l;let u;if("pbf"===t?.format&&i)try{u=yield(0,Pe.t)(m,s,n)}catch(g){if("query:parsing-pbf"!==g.name)throw g;t.format="json"}return"json"!==t?.format&&i||(u=yield(0,de.F)(m,s,n)),function Ue(m,e){if(null!=m&&null!=e)for(const t of e){const r=m.get(t.name);r&&Object.assign(t,r.toJSON())}}(t?.fieldsIndex,u.fields),u})).apply(this,arguments)}function he(){return(he=(0,_.Z)(function*(m,e,t,r){const n=t?.infoFor3D;if(!De(m,n)||null==n||!e.assetMaps||!e.features?.length)return Ae.Z.fromJSON(e);const{meshFeatureSetFromJSON:s}=yield(0,Ze.Hl)(Promise.all([f.e(479),f.e(9709),f.e(853),f.e(6453),f.e(8592),f.e(5177)]).then(f.bind(f,75177)),r);return s(m,n,e)})).apply(this,arguments)}function De(m,e){return null!=e&&!0===m.returnGeometry&&"xyFootprint"!==m.multipatchOption&&!m.outStatistics}f(59318),f(85931),f(21726),f(87183),f(67736);var Me=f(90463),We=(f(29132),f(93555),f(24192),f(16730),f(92383),f(24865)),be=(f(82054),f(67010)),Te=(f(6871),f(60776));class ue extends R.Z{constructor(e){super(e),this.declaredClass="esri.arcade.featureset.sources.FeatureLayerDynamic",this._removeGeometry=!1,this._overrideFields=null,this.formulaCredential=null,this._pageJustIds=!1,this._requestStandardised=!1,this._useDefinitionExpression=!0,e.spatialReference&&(this.spatialReference=e.spatialReference),this._transparent=!0,this._maxProcessing=1e3,this._layer=e.layer,this._wset=null,void 0!==e.outFields&&(this._overrideFields=e.outFields),void 0!==e.includeGeometry&&(this._removeGeometry=!1===e.includeGeometry)}_maxQueryRate(){return c.tI}end(){return this._layer}optimisePagingFeatureQueries(e){this._pageJustIds=e}get urlQueryPath(){return this._layer.parsedUrl.path||""}convertQueryToLruCacheKey(e){const t=this.urlQueryPath+","+(0,c.hd)(e.toJSON());return(0,h.F)(t,h.M.String)}loadImpl(){var e=this;return(0,_.Z)(function*(){return!0===e._layer.loaded?(e._initialiseFeatureSet(),e):(yield e._layer.load(),e._initialiseFeatureSet(),e)})()}_initialiseFeatureSet(){if(null==this.spatialReference&&(this.spatialReference=this._layer.spatialReference),this.geometryType=this._layer.geometryType,this.fields=this._layer.fields.slice(0),this.hasZ=!0===this._layer?.capabilities?.data?.supportsZ,this.hasM=!0===this._layer?.capabilities?.data?.supportsM,null!==this._overrideFields)if(1===this._overrideFields.length&&"*"===this._overrideFields[0])this._overrideFields=null;else{const e=[],t=[];for(const r of this.fields)if("oid"===r.type)e.push(r),t.push(r.name);else for(const n of this._overrideFields)if(n.toLowerCase()===r.name.toLowerCase()){e.push(r),t.push(r.name);break}this.fields=e,this._overrideFields=t}if(this._layer.source&&this._layer.source.sourceJSON){const e=this._layer.source.sourceJSON.currentVersion;!0===this._layer.source.sourceJSON.useStandardizedQueries?(this._databaseType=c.Bj.StandardisedNoInterval,null!=e&&e>=10.61&&(this._databaseType=c.Bj.Standardised)):null!=e&&(e>=10.5&&(this._databaseType=c.Bj.StandardisedNoInterval,this._requestStandardised=!0),e>=10.61&&(this._databaseType=c.Bj.Standardised))}this.objectIdField=this._layer.objectIdField;for(const e of this.fields)"global-id"===e.type&&(this.globalIdField=e.name);this._layer instanceof Ee.default?(this.typeIdField=this._layer.subtypeField??"",this.types=this._layer.subtypes):(this.typeIdField=this._layer.typeIdField??"",this.types=this._layer.types)}_isInFeatureSet(){return c.dj.InFeatureSet}_refineSetBlock(e){return(0,_.Z)(function*(){return e})()}_candidateIdTransform(e){return e}_getSet(e){var t=this;return(0,_.Z)(function*(){if(null===t._wset){yield t._ensureLoaded();const r=yield t._getFilteredSet("",null,null,null,e);return t._wset=r,r}return t._wset})()}_runDatabaseProbe(e){var t=this;return(0,_.Z)(function*(){yield t._ensureLoaded();const r=new ne.Z;t.datesInUnknownTimezone&&(r.timeReferenceUnknownClient=!0),r.where=e.replace("OBJECTID",t._layer.objectIdField);try{return yield t._layer.queryObjectIds(r),!0}catch{return!1}})()}_canUsePagination(){return!(!this._layer.capabilities||!this._layer.capabilities.query||!0!==this._layer.capabilities.query.supportsPagination)}_cacheableFeatureSetSourceKey(){return this._layer.url}pbfSupportedForQuery(e){const t=this._layer?.capabilities?.query;return!e.outStatistics&&!0===t?.supportsFormatPBF&&!0===t?.supportsQuantizationEditMode}queryPBF(e){var t=this;return(0,_.Z)(function*(){return e.quantizationParameters={mode:"edit"},(yield function Le(m,e,t,r){return ce.apply(this,arguments)}(t._layer.parsedUrl,e,{format:"pbf"},{})).unquantize()})()}get gdbVersion(){return this._layer&&this._layer.capabilities&&this._layer.capabilities.data&&this._layer.capabilities.data.isVersioned?this._layer.gdbVersion||"SDE.DEFAULT":""}nativeCapabilities(){return{title:this._layer.title??"",source:this,canQueryRelated:!0,capabilities:this._layer.capabilities,databaseType:this._databaseType,requestStandardised:this._requestStandardised}}executeQuery(e,t){e.returnZ=this.hasZ,e.returnM=this.hasM;const r="execute"===t?de.e:"executeForCount"===t?Me.P:We.G,n="execute"===t&&this.pbfSupportedForQuery(e);let s=null;if(this.recentlyUsedQueries){const a=this.convertQueryToLruCacheKey(e);s=this.recentlyUsedQueries.getFromCache(a),null===s&&(s=!0!==n?r(this._layer.parsedUrl.path,e):this.queryPBF(e),this.recentlyUsedQueries.addToCache(a,s),s=s.catch(l=>{throw this.recentlyUsedQueries?.removeFromCache(a),l}))}return this.featureSetQueryInterceptor&&this.featureSetQueryInterceptor.preLayerQueryCallback({layer:this._layer,query:e,method:t}),null===s&&(s=!0!==n?r(this._layer.parsedUrl.path,e):this.queryPBF(e)),s}_getFilteredSet(e,t,r,n,s){var a=this;return(0,_.Z)(function*(){const l=yield a.databaseType();if(a.isTable()&&t&&null!==e&&""!==e)return new N.Z([],[],!0,null);if(a._canUsePagination())return a._getFilteredSetUsingPaging(e,t,r,n,s);let i="",u=!1;null!==n&&a._layer.capabilities&&a._layer.capabilities.query&&!0===a._layer.capabilities.query.supportsOrderBy&&(i=n.constructClause(),u=!0);const g=new ne.Z;a.datesInUnknownTimezone&&(g.timeReferenceUnknownClient=!0),g.where=null===r?null===t?"1=1":"":(0,v.zR)(r,l),a._requestStandardised&&(g.sqlFormat="standard"),g.spatialRelationship=a._makeRelationshipEnum(e),g.outSpatialReference=a.spatialReference,g.orderByFields=""!==i?i.split(","):null,g.geometry=null===t?null:t,g.relationParameter=a._makeRelationshipParam(e);let T=yield a.executeQuery(g,"executeForIds");return null===T&&(T=[]),a._checkCancelled(s),new N.Z([],T,u,null)})()}_expandPagedSet(e,t,r,n,s){return this._expandPagedSetFeatureSet(e,t,r,n,s)}_getFilteredSetUsingPaging(e,t,r,n,s){var a=this;return(0,_.Z)(function*(){let l="",i=!1;null!==n&&a._layer.capabilities&&a._layer.capabilities.query&&!0===a._layer.capabilities.query.supportsOrderBy&&(l=n.constructClause(),i=!0);const u=yield a.databaseType();let g=null===r?null===t?"1=1":"":(0,v.zR)(r,u);a._layer.definitionExpression&&a._useDefinitionExpression&&(g=""!==g?"(("+a._layer.definitionExpression+") AND ("+g+"))":a._layer.definitionExpression);let T=a._maxQueryRate();const L=a._layer.capabilities?.query.maxRecordCount;null!=L&&L<T&&(T=L);let j=null;if(!0===a._pageJustIds)j=new N.Z([],["GETPAGES"],i,{spatialRel:a._makeRelationshipEnum(e),relationParam:a._makeRelationshipParam(e),outFields:a._layer.objectIdField,resultRecordCount:T,resultOffset:0,geometry:null===t?null:t,where:g,orderByFields:l,returnGeometry:!1,returnIdsOnly:"false",internal:{set:[],lastRetrieved:0,lastPage:0,fullyResolved:!1}});else{let K=!0;!0===a._removeGeometry&&(K=!1);const q=a._overrideFields??a._fieldsIncludingObjectId(["*"]);j=new N.Z([],["GETPAGES"],i,{spatialRel:a._makeRelationshipEnum(e),relationParam:a._makeRelationshipParam(e),outFields:q.join(","),resultRecordCount:T,resultOffset:0,geometry:null===t?null:t,where:g,orderByFields:l,returnGeometry:K,returnIdsOnly:"false",internal:{set:[],lastRetrieved:0,lastPage:0,fullyResolved:!1}})}return yield a._expandPagedSet(j,T,0,1,s),j})()}_clonePageDefinition(e){return null===e?null:!0!==e.groupbypage?{groupbypage:!1,spatialRel:e.spatialRel,relationParam:e.relationParam,outFields:e.outFields,resultRecordCount:e.resultRecordCount,resultOffset:e.resultOffset,geometry:e.geometry,where:e.where,orderByFields:e.orderByFields,returnGeometry:e.returnGeometry,returnIdsOnly:e.returnIdsOnly,internal:e.internal}:{groupbypage:!0,spatialRel:e.spatialRel,relationParam:e.relationParam,outFields:e.outFields,resultRecordCount:e.resultRecordCount,useOIDpagination:e.useOIDpagination,generatedOid:e.generatedOid,groupByFieldsForStatistics:e.groupByFieldsForStatistics,resultOffset:e.resultOffset,outStatistics:e.outStatistics,geometry:e.geometry,where:e.where,orderByFields:e.orderByFields,returnGeometry:e.returnGeometry,returnIdsOnly:e.returnIdsOnly,internal:e.internal}}_getPhysicalPage(e,t,r){var n=this;return(0,_.Z)(function*(){const s=e.pagesDefinition.internal.lastRetrieved,a=s,l=e.pagesDefinition.internal.lastPage,i=new ne.Z;n._requestStandardised&&(i.sqlFormat="standard"),n.datesInUnknownTimezone&&(i.timeReferenceUnknownClient=!0),i.spatialRelationship=e.pagesDefinition.spatialRel,i.relationParameter=e.pagesDefinition.relationParam,i.outFields=e.pagesDefinition.outFields.split(","),i.num=e.pagesDefinition.resultRecordCount,i.start=e.pagesDefinition.internal.lastPage,i.geometry=e.pagesDefinition.geometry,i.where=e.pagesDefinition.where,i.orderByFields=""!==e.pagesDefinition.orderByFields?e.pagesDefinition.orderByFields.split(","):null,i.returnGeometry=e.pagesDefinition.returnGeometry,i.outSpatialReference=n.spatialReference;const u=yield n.executeQuery(i,"execute");if(n._checkCancelled(r),e.pagesDefinition.internal.lastPage!==l)return"done";const g=n._layer.objectIdField;for(let T=0;T<u.features.length;T++)e.pagesDefinition.internal.set[a+T]=u.features[T].attributes[g];if(!1===n._pageJustIds)for(let T=0;T<u.features.length;T++)n._featureCache[u.features[T].attributes[g]]=u.features[T];return(void 0===u.exceededTransferLimit&&u.features.length!==e.pagesDefinition.resultRecordCount||!1===u.exceededTransferLimit)&&(e.pagesDefinition.internal.fullyResolved=!0),e.pagesDefinition.internal.lastRetrieved=s+u.features.length,e.pagesDefinition.internal.lastPage+=e.pagesDefinition.resultRecordCount,"done"})()}_fieldsIncludingObjectId(e){if(null===e)return[this.objectIdField];const t=e.slice(0);if(t.includes("*"))return t;let r=!1;for(const n of t)if(n.toUpperCase()===this.objectIdField.toUpperCase()){r=!0;break}return!1===r&&t.push(this.objectIdField),t}_getFeatures(e,t,r,n){var s=this;return(0,_.Z)(function*(){const a=[];if(-1!==t&&void 0===s._featureCache[t]&&a.push(t),!0===s._checkIfNeedToExpandKnownPage(e,s._maxProcessingRate()))return yield s._expandPagedSet(e,s._maxProcessingRate(),0,0,n),s._getFeatures(e,t,r,n);let l=0;for(let T=e._lastFetchedIndex;T<e._known.length;T++){if(e._lastFetchedIndex+=1,l++,void 0===s._featureCache[e._known[T]]){let L=!1;if(null!=s._layer._mode){const j=s._layer._mode;if(void 0!==j._featureMap[e._known[T]]){const K=j._featureMap[e._known[T]];null!==K&&(L=!0,s._featureCache[e._known[T]]=K)}}if(!1===L&&(e._known[T]!==t&&a.push(e._known[T]),a.length>=s._maxProcessingRate()-1))break}if(l>=r&&0===a.length)break}if(0===a.length)return"success";const i=new ne.Z;s._requestStandardised&&(i.sqlFormat="standard"),s.datesInUnknownTimezone&&(i.timeReferenceUnknownClient=!0),i.objectIds=a,i.outFields=s._overrideFields??s._fieldsIncludingObjectId(["*"]),i.returnGeometry=!0,!0===s._removeGeometry&&(i.returnGeometry=!1),i.outSpatialReference=s.spatialReference;const u=yield s.executeQuery(i,"execute");if(s._checkCancelled(n),void 0!==u.error)throw new y.EN(y.H9.RequestFailed,{reason:u.error});const g=s._layer.objectIdField;for(let T=0;T<u.features.length;T++)s._featureCache[u.features[T].attributes[g]]=u.features[T];return"success"})()}_getDistinctPages(e,t,r,n,s,a,l,i,u){var g=this;return(0,_.Z)(function*(){yield g._ensureLoaded();const T=yield g.databaseType();let L=r.parseTree.column;const j=g._layer.fields??[];for(let Q=0;Q<j.length;Q++)if(j[Q].name.toLowerCase()===L.toLowerCase()){L=j[Q].name;break}const K=new ne.Z;g._requestStandardised&&(K.sqlFormat="standard"),g.datesInUnknownTimezone&&(K.timeReferenceUnknownClient=!0);let q=null===a?null===s?"1=1":"":(0,v.zR)(a,T);g._layer.definitionExpression&&g._useDefinitionExpression&&(q=""!==q?"(("+g._layer.definitionExpression+") AND ("+q+"))":g._layer.definitionExpression),K.where=q,K.spatialRelationship=g._makeRelationshipEnum(n),K.relationParameter=g._makeRelationshipParam(n),K.geometry=null===s?null:s,K.returnDistinctValues=!0,K.returnGeometry=!1,K.outFields=[L];const H=yield g.executeQuery(K,"execute");if(g._checkCancelled(u),!H.hasOwnProperty("features"))throw new y.EN(y.H9.InvalidStatResponse);let $=!1;for(let Q=0;Q<j.length;Q++)if(j[Q].name===L){"date"===j[Q].type&&($=!0);break}for(let Q=0;Q<H.features.length;Q++){if($){const ie=H.features[Q].attributes[L];i.push(null!==ie?new Date(ie):ie)}else i.push(H.features[Q].attributes[L]);if(i.length>=l)break}return 0===H.features.length?i:H.features.length===g._layer.capabilities?.query.maxRecordCount&&i.length<l?{calculated:!0,result:yield g._getDistinctPages(e+H.features.length,t,r,n,s,a,l,i,u)}:i})()}_distinctStat(e,t,r,n,s,a,l){var i=this;return(0,_.Z)(function*(){return{calculated:!0,result:yield i._getDistinctPages(0,e,t,r,n,s,a,[],l)}})()}isTable(){return this._layer.isTable||null===this._layer.geometryType||"table"===this._layer.type||""===this._layer.geometryType||"esriGeometryNull"===this._layer.geometryType}_countstat(e,t,r,n){var s=this;return(0,_.Z)(function*(){const a=yield s.databaseType(),l=new ne.Z;if(s._requestStandardised&&(l.sqlFormat="standard"),s.isTable()&&r&&null!==t&&""!==t)return{calculated:!0,result:0};let i=null===n?null===r?"1=1":"":(0,v.zR)(n,a);return s._layer.definitionExpression&&s._useDefinitionExpression&&(i=""!==i?"(("+s._layer.definitionExpression+") AND ("+i+"))":s._layer.definitionExpression),l.where=i,s.datesInUnknownTimezone&&(l.timeReferenceUnknownClient=!0),l.where=i,l.spatialRelationship=s._makeRelationshipEnum(t),l.relationParameter=s._makeRelationshipParam(t),l.geometry=null===r?null:r,l.returnGeometry=!1,{calculated:!0,result:yield s.executeQuery(l,"executeForCount")}})()}_stats(e,t,r,n,s,a,l){var i=this;return(0,_.Z)(function*(){yield i._ensureLoaded();const u=i._layer.capabilities&&i._layer.capabilities.query&&!0===i._layer.capabilities.query.supportsSqlExpression,g=i._layer.capabilities&&i._layer.capabilities.query&&!0===i._layer.capabilities.query.supportsStatistics,T=i._layer.capabilities&&i._layer.capabilities.query&&!0===i._layer.capabilities.query.supportsDistinct;if("count"===e)return T?i._countstat(e,r,n,s):{calculated:!1};if(!1===g||!1===(0,v.y5)(t)&&!1===u||!1===t.isStandardized)return""!==r||null!==s?{calculated:!1}:i._manualStat(e,t,a,l);if("distinct"===e)return!1===T?""!==r||null!==s?{calculated:!1}:i._manualStat(e,t,a,l):i._distinctStat(e,t,r,n,s,a,l);const L=yield i.databaseType();if(i.isTable()&&n&&null!==r&&""!==r)return{calculated:!0,result:null};const j=new ne.Z;i._requestStandardised&&(j.sqlFormat="standard");let K=null===s?null===n?"1=1":"":(0,v.zR)(s,L);i._layer.definitionExpression&&i._useDefinitionExpression&&(K=""!==K?"(("+i._layer.definitionExpression+") AND ("+K+"))":i._layer.definitionExpression),j.where=K,j.spatialRelationship=i._makeRelationshipEnum(r),j.relationParameter=i._makeRelationshipParam(r),j.geometry=null===n?null:n,i.datesInUnknownTimezone&&(j.timeReferenceUnknownClient=!0);const q=new Te.Z;q.statisticType=(0,Z.g3)(e),q.onStatisticField=(0,v.zR)(t,L),q.outStatisticFieldName="ARCADE_STAT_RESULT",j.returnGeometry=!1;let H="ARCADE_STAT_RESULT";j.outStatistics=[q];const $=yield i.executeQuery(j,"execute");if(!$.hasOwnProperty("features")||0===$.features.length)throw new y.EN(y.H9.InvalidStatResponse);let Q=!1;const ie=$.fields??[];for(let re=0;re<ie.length;re++)if("ARCADE_STAT_RESULT"===ie[re].name.toUpperCase()){H=ie[re].name,"date"===ie[re].type&&(Q=!0);break}if(Q){let re=$.features[0].attributes[H];return null!==re&&(re=new Date($.features[0].attributes[H])),{calculated:!0,result:re}}return{calculated:!0,result:$.features[0].attributes[H]}})()}_stat(e,t,r,n,s,a,l){return this._stats(e,t,r,n,s,a,l)}_canDoAggregates(e,t){var r=this;return(0,_.Z)(function*(){yield r._ensureLoaded();let n=!1;const s=r._layer.capabilities?.query,a=!0===s?.supportsSqlExpression;if(null!=s&&!0===s.supportsStatistics&&!0===s.supportsOrderBy&&(n=!0),n)for(let l=0;l<t.length-1;l++)(!1===t[l].workingexpr?.isStandardized||!1===(0,v.y5)(t[l].workingexpr)&&!1===a)&&(n=!1);return!1!==n})()}_makeRelationshipEnum(e){if(e.includes("esriSpatialRelRelation"))return"relation";switch(e){case"esriSpatialRelRelation":return"relation";case"esriSpatialRelIntersects":return"intersects";case"esriSpatialRelContains":return"contains";case"esriSpatialRelOverlaps":return"overlaps";case"esriSpatialRelWithin":return"within";case"esriSpatialRelTouches":return"touches";case"esriSpatialRelCrosses":return"crosses";case"esriSpatialRelEnvelopeIntersects":return"envelope-intersects"}return e}_makeRelationshipParam(e){return e.includes("esriSpatialRelRelation")?e.split(":")[1]:""}_getAggregatePagesDataSourceDefinition(e,t,r,n,s,a,l){var i=this;return(0,_.Z)(function*(){yield i._ensureLoaded();const u=yield i.databaseType();let g="",T=!1,L=!1;null!==a&&i._layer.capabilities&&i._layer.capabilities.query&&!0===i._layer.capabilities.query.supportsOrderBy&&(g=a.constructClause(),L=!0),i._layer.capabilities&&i._layer.capabilities.query&&!1===i._layer.capabilities.query.supportsPagination&&(L=!1,T=!0,g=i._layer.objectIdField);const j=[];for(let $=0;$<t.length;$++){const Q=new Te.Z;Q.onStatisticField=null!==t[$].workingexpr?(0,v.zR)(t[$].workingexpr,u):"",Q.outStatisticFieldName=t[$].field,Q.statisticType=t[$].toStatisticsName(),j.push(Q)}""===g&&(g=e.join(","));let K=i._maxQueryRate();const q=i._layer.capabilities?.query.maxRecordCount;null!=q&&q<K&&(K=q);let H=null===s?null===n?"1=1":"":(0,v.zR)(s,u);return i._layer.definitionExpression&&i._useDefinitionExpression&&(H=""!==H?"(("+i._layer.definitionExpression+") AND ("+H+"))":i._layer.definitionExpression),new N.Z([],["GETPAGES"],L,{groupbypage:!0,spatialRel:i._makeRelationshipEnum(r),relationParam:i._makeRelationshipParam(r),outFields:["*"],useOIDpagination:T,generatedOid:l,resultRecordCount:K,resultOffset:0,groupByFieldsForStatistics:e,outStatistics:j,geometry:null===n?null:n,where:H,orderByFields:g,returnGeometry:!1,returnIdsOnly:!1,internal:{lastMaxId:-1,set:[],lastRetrieved:0,lastPage:0,fullyResolved:!1}})})()}_getAgregagtePhysicalPage(e,t,r){var n=this;return(0,_.Z)(function*(){let s=e.pagesDefinition.where;!0===e.pagesDefinition.useOIDpagination&&(s=""!==s?"("+s+") AND ("+e.pagesDefinition.generatedOid+">"+e.pagesDefinition.internal.lastMaxId.toString()+")":e.pagesDefinition.generatedOid+">"+e.pagesDefinition.internal.lastMaxId.toString());const a=e.pagesDefinition.internal.lastRetrieved,l=a,i=e.pagesDefinition.internal.lastPage,u=new ne.Z;if(n._requestStandardised&&(u.sqlFormat="standard"),u.where=s,u.spatialRelationship=e.pagesDefinition.spatialRel,u.relationParameter=e.pagesDefinition.relationParam,u.outFields=e.pagesDefinition.outFields,u.outStatistics=e.pagesDefinition.outStatistics,u.geometry=e.pagesDefinition.geometry,u.groupByFieldsForStatistics=e.pagesDefinition.groupByFieldsForStatistics,u.num=e.pagesDefinition.resultRecordCount,u.start=e.pagesDefinition.internal.lastPage,u.returnGeometry=e.pagesDefinition.returnGeometry,n.datesInUnknownTimezone&&(u.timeReferenceUnknownClient=!0),u.orderByFields=""!==e.pagesDefinition.orderByFields?e.pagesDefinition.orderByFields.split(","):null,n.isTable()&&u.geometry&&u.spatialRelationship)return[];const g=yield n.executeQuery(u,"execute");if(n._checkCancelled(r),!g.hasOwnProperty("features"))throw new y.EN(y.H9.InvalidStatResponse);const T=[];if(e.pagesDefinition.internal.lastPage!==i)return[];g.features.length>0&&void 0===g.features[0].attributes[e.pagesDefinition.generatedOid]&&(e.pagesDefinition.generatedOid=e.pagesDefinition.generatedOid.toLowerCase());for(let L=0;L<g.features.length;L++)e.pagesDefinition.internal.set[l+L]=g.features[L].attributes[e.pagesDefinition.generatedOid];for(let L=0;L<g.features.length;L++)T.push(new U.Z({attributes:g.features[L].attributes,geometry:null}));return!0===e.pagesDefinition.useOIDpagination?0===g.features.length?e.pagesDefinition.internal.fullyResolved=!0:e.pagesDefinition.internal.lastMaxId=g.features[g.features.length-1].attributes[e.pagesDefinition.generatedOid]:(void 0===g.exceededTransferLimit&&g.features.length!==e.pagesDefinition.resultRecordCount||!1===g.exceededTransferLimit)&&(e.pagesDefinition.internal.fullyResolved=!0),e.pagesDefinition.internal.lastRetrieved=a+g.features.length,e.pagesDefinition.internal.lastPage+=e.pagesDefinition.resultRecordCount,T})()}static create(e,t,r,n,s){const a=new Y.default({url:e,outFields:null===t?["*"]:t});return new ue({layer:a,spatialReference:r,lrucache:n,interceptor:s})}relationshipMetaData(){return this._layer&&this._layer.source&&this._layer.source.sourceJSON?.relationships?this._layer.source.sourceJSON.relationships:[]}serviceUrl(){return(0,c.US)(this._layer.parsedUrl.path)}queryAttachments(e,t,r,n,s){var a=this;return(0,_.Z)(function*(){const l=a._layer.capabilities;if(l?.data.supportsAttachment&&l?.operations.supportsQueryAttachments){const i={objectIds:[e],returnMetadata:s};(t&&t>0||r&&r>0)&&(i.size=[t&&t>0?t:0,r&&r>0?r:t+1]),n&&n.length>0&&(i.attachmentTypes=n),a.featureSetQueryInterceptor&&a.featureSetQueryInterceptor.preLayerQueryCallback({layer:a._layer,query:i,method:"attachments"});const u=yield a._layer.queryAttachments(i),g=[];return u&&u[e]&&u[e].forEach(T=>{const L=a._layer.parsedUrl.path+"/"+e.toString()+"/attachments/"+T.id.toString();let j=null;s&&T.exifInfo&&(j=se.Z.convertJsonToArcade(T.exifInfo,"system",!0)),g.push(new W.Z(T.id,T.name,T.contentType,T.size,L,j,T.keywords??null))}),g}return[]})()}queryRelatedFeatures(e){var t=this;return(0,_.Z)(function*(){const r={f:"json",relationshipId:e.relationshipId.toString(),definitionExpression:e.where,outFields:e.outFields?.join(","),returnGeometry:e.returnGeometry.toString()};null!=e.resultOffset&&(r.resultOffset=e.resultOffset.toString()),null!=e.resultRecordCount&&(r.resultRecordCount=e.resultRecordCount.toString()),e.orderByFields&&(r.orderByFields=e.orderByFields.join(",")),e.objectIds&&e.objectIds.length>0&&(r.objectIds=e.objectIds.join(",")),e.outSpatialReference&&(r.outSR=(0,te.B9)(e.outSpatialReference)),t.featureSetQueryInterceptor&&t.featureSetQueryInterceptor.preRequestCallback({layer:t._layer,queryPayload:r,method:"relatedrecords",url:t._layer.parsedUrl.path+"/queryRelatedRecords"});const n=yield(0,J.Z)(t._layer.parsedUrl.path+"/queryRelatedRecords",{responseType:"json",query:r});if(n.data){const s={},a=n.data;if(a?.relatedRecordGroups){const l=a.spatialReference;for(const i of a.relatedRecordGroups){const u=i.objectId,g=[];for(const T of i.relatedRecords){T.geometry&&(T.geometry.spatialReference=l);const L=new U.Z({geometry:T.geometry?(0,le.im)(T.geometry):null,attributes:T.attributes});g.push(L)}s[u]={features:g,exceededTransferLimit:!0===a.exceededTransferLimit}}}return s}throw new y.EN(y.H9.InvalidRequest)})()}getFeatureByObjectId(e,t){var r=this;return(0,_.Z)(function*(){const n=new ne.Z;n.outFields=t,n.returnGeometry=!1,n.outSpatialReference=r.spatialReference,n.where=r.objectIdField+"="+e.toString(),r.datesInUnknownTimezone&&(n.timeReferenceUnknownClient=!0),r.featureSetQueryInterceptor&&r.featureSetQueryInterceptor.preLayerQueryCallback({layer:r._layer,query:n,method:"execute"});const s=yield(0,de.e)(r._layer.parsedUrl.path,n);return 1===s.features.length?s.features[0]:null})()}getIdentityUser(){var e=this;return(0,_.Z)(function*(){yield e.load();const t=A.id?.findCredential(e._layer.url);return t?t.userId:null})()}getOwningSystemUrl(){var e=this;return(0,_.Z)(function*(){yield e.load();const t=A.id?.findServerInfo(e._layer.url);if(t)return t.owningSystemUrl;let r=e._layer.url;const n=r.toLowerCase().indexOf("/rest/services");if(r=n>-1?r.substring(0,n):r,r){r+="/rest/info";try{const s=yield(0,J.Z)(r,{query:{f:"json"}});let a="";return s.data?.owningSystemUrl&&(a=s.data.owningSystemUrl),a}catch{return""}}return""})()}getDataSourceFeatureSet(){const e=new ue({layer:this._layer,spatialReference:this.spatialReference??void 0,outFields:this._overrideFields??void 0,includeGeometry:!this._removeGeometry,lrucache:this.recentlyUsedQueries??void 0,interceptor:this.featureSetQueryInterceptor??void 0});return e._useDefinitionExpression=!1,e}get preferredTimeZone(){return this._layer.preferredTimeZone??null}get dateFieldsTimeZone(){return this._layer.dateFieldsTimeZone??null}get datesInUnknownTimezone(){return this._layer.datesInUnknownTimezone}get editFieldsInfo(){return this._layer.editFieldsInfo??null}get timeInfo(){return this._layer.timeInfo??null}getFeatureSetInfo(){var e=this;return(0,_.Z)(function*(){if(e.fsetInfo)return e.fsetInfo;let t=null,{parsedUrl:{path:r},serviceItemId:n=null}=e._layer;if(r){const a=yield(0,J.Z)(r,{responseType:"json",query:{f:"json"}});t=a?.data?.name??null,n=a?.data?.serviceItemId??null}const s=e._layer.title&&null!==(e._layer.parent??null);return e.featureSetInfo={layerId:e._layer.layerId,layerName:""===t?null:t,itemId:""===n?null:n,serviceLayerUrl:""===r?null:r,webMapLayerId:s?e._layer.id??null:null,webMapLayerTitle:s?e._layer.title??null:null,className:null,objectClassId:null},e.fsetInfo})()}}var Ge=f(16776);class Ke extends R.Z{constructor(e){super(e),this.declaredClass="esri.arcade.featureset.sources.FeatureLayerRelated",this._findObjectId=-1,this._requestStandardised=!1,this._removeGeometry=!1,this._overrideFields=null,this.featureObjectId=null,e.spatialReference&&(this.spatialReference=e.spatialReference),this._transparent=!0,this._maxProcessing=1e3,this._layer=e.layer,this._wset=null,this._findObjectId=e.objectId,this.featureObjectId=e.objectId,this.relationship=e.relationship,this._relatedLayer=e.relatedLayer,void 0!==e.outFields&&(this._overrideFields=e.outFields),void 0!==e.includeGeometry&&(this._removeGeometry=!1===e.includeGeometry)}_maxQueryRate(){return c.tI}end(){return this._layer}optimisePagingFeatureQueries(){}loadImpl(){var e=this;return(0,_.Z)(function*(){return yield Promise.all([e._layer.load(),e._relatedLayer?.load()]),e._initialiseFeatureSet(),e})()}nativeCapabilities(){return this._relatedLayer.nativeCapabilities()}_initialiseFeatureSet(){if(null==this.spatialReference&&(this.spatialReference=this._layer.spatialReference),this.geometryType=this._relatedLayer.geometryType,this.fields=this._relatedLayer.fields.slice(0),this.hasZ=this._relatedLayer.hasZ,this.hasM=this._relatedLayer.hasM,null!==this._overrideFields)if(1===this._overrideFields.length&&"*"===this._overrideFields[0])this._overrideFields=null;else{const t=[],r=[];for(const n of this.fields)if("oid"===n.type)t.push(n),r.push(n.name);else for(const s of this._overrideFields)if(s.toLowerCase()===n.name.toLowerCase()){t.push(n),r.push(n.name);break}this.fields=t,this._overrideFields=r}const e=this._layer.nativeCapabilities();e&&(this._databaseType=e.databaseType,this._requestStandardised=e.requestStandardised),this.objectIdField=this._relatedLayer.objectIdField,this.globalIdField=this._relatedLayer.globalIdField,this.hasM=this._relatedLayer.supportsM,this.hasZ=this._relatedLayer.supportsZ,this.typeIdField=this._relatedLayer.typeIdField,this.types=this._relatedLayer.types}databaseType(){var e=this;return(0,_.Z)(function*(){return yield e._relatedLayer.databaseType(),e._databaseType=e._relatedLayer._databaseType,e._databaseType})()}isTable(){return this._relatedLayer.isTable()}_isInFeatureSet(){return c.dj.InFeatureSet}_candidateIdTransform(e){return e}_getSet(e){var t=this;return(0,_.Z)(function*(){if(null===t._wset){yield t._ensureLoaded();const r=yield t._getFilteredSet("",null,null,null,e);return t._wset=r,r}return t._wset})()}_changeFeature(e){const t={};for(const r of this.fields)t[r.name]=e.attributes[r.name];return new U.Z({geometry:!0===this._removeGeometry?null:e.geometry,attributes:t})}_getFilteredSet(e,t,r,n,s){var a=this;return(0,_.Z)(function*(){if(yield a.databaseType(),a.isTable()&&t&&null!==e&&""!==e)return new N.Z([],[],!0,null);const l=a._layer.nativeCapabilities();if(!1===l.canQueryRelated)return new N.Z([],[],!0,null);if(l.capabilities?.queryRelated&&l.capabilities.queryRelated.supportsPagination)return a._getFilteredSetUsingPaging(e,t,r,n,s);let i="",u=!1;null!==n&&l.capabilities?.queryRelated&&!0===l.capabilities.queryRelated.supportsOrderBy&&(i=n.constructClause(),u=!0);const g=new be.default;g.objectIds=[a._findObjectId];const T=null!==a._overrideFields?a._overrideFields:a._fieldsIncludingObjectId(a._relatedLayer.fields?a._relatedLayer.fields.map(Q=>Q.name):["*"]);g.outFields=T,g.relationshipId=a.relationship.id,g.where="1=1";let L=!0;!0===a._removeGeometry&&(L=!1),g.returnGeometry=L,a._requestStandardised&&(g.sqlFormat="standard"),g.outSpatialReference=a.spatialReference,g.orderByFields=""!==i?i.split(","):null;const j=yield l.source.queryRelatedFeatures(g);a._checkCancelled(s);const K=j[a._findObjectId]?j[a._findObjectId].features:[],q=[];for(let Q=0;Q<K.length;Q++)a._featureCache[K[Q].attributes[a._relatedLayer.objectIdField]]=K[Q],q.push(K[Q].attributes[a._relatedLayer.objectIdField]);const H=t&&null!==e&&""!==e,$=null!=r;return new N.Z(H||$?q:[],H||$?[]:q,u,null)})()}_fieldsIncludingObjectId(e){if(null===e)return[this.objectIdField];const t=e.slice(0);if(t.includes("*"))return t;let r=!1;for(const n of t)if(n.toUpperCase()===this.objectIdField.toUpperCase()){r=!0;break}return!1===r&&t.push(this.objectIdField),t}_getFilteredSetUsingPaging(e,t,r,n,s){var a=this;return(0,_.Z)(function*(){let l="",i=!1;const u=a._layer.nativeCapabilities();null!==n&&u?.capabilities?.queryRelated&&!0===u.capabilities.queryRelated.supportsOrderBy&&(l=n.constructClause(),i=!0),yield a.databaseType();let T=a._maxQueryRate();const L=u.capabilities?.query.maxRecordCount;null!=L&&L<T&&(T=L);const j=t&&null!==e&&""!==e,K=null!=r;let q=null,H=!0;!0===a._removeGeometry&&(H=!1);const $=null!==a._overrideFields?a._overrideFields:a._fieldsIncludingObjectId(a._relatedLayer.fields?a._relatedLayer.fields.map(Q=>Q.name):["*"]);return q=new N.Z(j||K?["GETPAGES"]:[],j||K?[]:["GETPAGES"],i,{outFields:$.join(","),resultRecordCount:T,resultOffset:0,objectIds:[a._findObjectId],where:"1=1",orderByFields:l,returnGeometry:H,returnIdsOnly:"false",internal:{set:[],lastRetrieved:0,lastPage:0,fullyResolved:!1}}),yield a._expandPagedSet(q,T,0,0,s),q})()}_expandPagedSet(e,t,r,n,s){return this._expandPagedSetFeatureSet(e,t,r,n,s)}_clonePageDefinition(e){return null===e?null:!0!==e.groupbypage?{groupbypage:!1,outFields:e.outFields,resultRecordCount:e.resultRecordCount,resultOffset:e.resultOffset,where:e.where,objectIds:e.objectIds,orderByFields:e.orderByFields,returnGeometry:e.returnGeometry,returnIdsOnly:e.returnIdsOnly,internal:e.internal}:{groupbypage:!0,outFields:e.outFields,resultRecordCount:e.resultRecordCount,useOIDpagination:e.useOIDpagination,generatedOid:e.generatedOid,groupByFieldsForStatistics:e.groupByFieldsForStatistics,resultOffset:e.resultOffset,outStatistics:e.outStatistics,geometry:e.geometry,where:e.where,objectIds:e.objectIds,orderByFields:e.orderByFields,returnGeometry:e.returnGeometry,returnIdsOnly:e.returnIdsOnly,internal:e.internal}}_getPhysicalPage(e,t,r){var n=this;return(0,_.Z)(function*(){const s=e.pagesDefinition.internal.lastRetrieved,a=s,l=e.pagesDefinition.internal.lastPage,i=n._layer.nativeCapabilities(),u=new be.default;!0===n._requestStandardised&&(u.sqlFormat="standard"),u.relationshipId=n.relationship.id,u.objectIds=e.pagesDefinition.objectIds,u.resultOffset=e.pagesDefinition.internal.lastPage,u.resultRecordCount=e.pagesDefinition.resultRecordCount,u.outFields=e.pagesDefinition.outFields.split(","),u.where=e.pagesDefinition.where,u.orderByFields=""!==e.pagesDefinition.orderByFields?e.pagesDefinition.orderByFields.split(","):null,u.returnGeometry=e.pagesDefinition.returnGeometry,u.outSpatialReference=n.spatialReference;const g=yield i.source.queryRelatedFeatures(u);if(n._checkCancelled(r),e.pagesDefinition.internal.lastPage!==l)return 0;const T=g[n._findObjectId]?g[n._findObjectId].features:[];for(let j=0;j<T.length;j++)e.pagesDefinition.internal.set[a+j]=T[j].attributes[n._relatedLayer.objectIdField];for(let j=0;j<T.length;j++)n._featureCache[T[j].attributes[n._relatedLayer.objectIdField]]=T[j];return T.length!==e.pagesDefinition.resultRecordCount&&(!g[n._findObjectId]||!1===g[n._findObjectId].exceededTransferLimit)&&(e.pagesDefinition.internal.fullyResolved=!0),e.pagesDefinition.internal.lastRetrieved=s+T.length,e.pagesDefinition.internal.lastPage+=e.pagesDefinition.resultRecordCount,T.length})()}_getFeatures(e,t,r,n){var s=this;return(0,_.Z)(function*(){const a=[];-1!==t&&void 0===s._featureCache[t]&&a.push(t);const l=s._maxQueryRate();if(!0===s._checkIfNeedToExpandKnownPage(e,l))return yield s._expandPagedSet(e,l,0,0,n),s._getFeatures(e,t,r,n);let i=0;for(let u=e._lastFetchedIndex;u<e._known.length&&(i++,i<=r&&(e._lastFetchedIndex+=1),!("GETPAGES"!==e._known[u]&&void 0===s._featureCache[e._known[u]]&&(e._known[u]!==t&&a.push(e._known[u]),a.length>r)))&&!(i>=r&&0===a.length);u++);if(0===a.length)return"success";throw new y.EN(y.H9.MissingFeatures)})()}_refineSetBlock(e,t,r){return(0,_.Z)(function*(){return e})()}_stat(e,t,r,n,s,a,l){return(0,_.Z)(function*(){return{calculated:!1}})()}get gdbVersion(){return this._relatedLayer.gdbVersion}_canDoAggregates(e,t,r,n,s){return(0,_.Z)(function*(){return!1})()}relationshipMetaData(){return this._relatedLayer.relationshipMetaData()}serviceUrl(){return this._relatedLayer.serviceUrl()}queryAttachments(e,t,r,n,s){return this._relatedLayer.queryAttachments(e,t,r,n,s)}getFeatureByObjectId(e,t){return this._relatedLayer.getFeatureByObjectId(e,t)}getOwningSystemUrl(){return this._relatedLayer.getOwningSystemUrl()}getIdentityUser(){return this._relatedLayer.getIdentityUser()}getDataSourceFeatureSet(){return this._relatedLayer}get preferredTimeZone(){return this._relatedLayer?.preferredTimeZone??null}get dateFieldsTimeZone(){return this._relatedLayer?.dateFieldsTimeZone??null}get datesInUnknownTimezone(){return this._relatedLayer?.datesInUnknownTimezone}get editFieldsInfo(){return this._relatedLayer?.editFieldsInfo??null}get timeInfo(){return this._relatedLayer?.timeInfo??null}getFeatureSetInfo(){var e=this;return(0,_.Z)(function*(){return e.fsetInfo??e._layer.featureSetInfo})()}}var z=f(53791),Qe=f(55463);function Ve(){null===z.Z.applicationCache&&(z.Z.applicationCache=new z.Z)}function pe(m,e){return _e.apply(this,arguments)}function _e(){return(_e=(0,_.Z)(function*(m,e){if(z.Z.applicationCache){const t=z.Z.applicationCache.getLayerInfo(m);if(t){const s=yield t;return new Y.default({url:m,outFields:e,sourceJSON:s})}const r=new Y.default({url:m,outFields:e}),n=(0,_.Z)(function*(){return yield r.load(),r.sourceJSON})();if(z.Z.applicationCache){z.Z.applicationCache.setLayerInfo(m,n);try{return yield n,r}catch(s){throw z.Z.applicationCache.clearLayerInfo(m),s}}return yield n,r}return new Y.default({url:m,outFields:e})})).apply(this,arguments)}function ye(m,e,t,r,n){return ge.apply(this,arguments)}function ge(){return(ge=(0,_.Z)(function*(m,e,t,r,n,s=null){return ee(yield pe(m,["*"]),e,t,r,n,s)})).apply(this,arguments)}function ee(m,e=null,t=null,r=!0,n=null,s=null){if(m instanceof Y.default||(0,x.$)(m)){const l={layer:m,spatialReference:e,outFields:t,includeGeometry:r,lrucache:n,interceptor:s};return m.url||!m.source?new ue(l):new Ge.Z(l)}const a=ee(m.parent,e,t,r,n,s);return a.filter(d.WhereClause.create(m.parent.subtypeField+"="+m.subtypeCode.toString(),m.parent.fieldsIndex,a.dateFieldsTimeZoneDefaultUTC))}function me(){return(me=(0,_.Z)(function*(m){if(null!==z.Z.applicationCache){const t=z.Z.applicationCache.getLayerInfo(m);if(null!==t)return t}const e=(0,_.Z)(function*(){const t=yield(0,J.Z)(m,{responseType:"json",query:{f:"json"}});return t.data?t.data:null})();if(null!==z.Z.applicationCache){z.Z.applicationCache.setLayerInfo(m,e);try{return yield e}catch(t){throw z.Z.applicationCache.clearLayerInfo(m),t}}return e})).apply(this,arguments)}function Fe(){return(Fe=(0,_.Z)(function*(m,e){const t="QUERYDATAELEMTS:"+e.toString()+":"+m;if(null!==z.Z.applicationCache){const n=z.Z.applicationCache.getLayerInfo(t);if(null!==n)return n}const r=(0,_.Z)(function*(){const n=yield(0,J.Z)(m+"/queryDataElements",{method:"post",responseType:"json",query:{layers:JSON.stringify([e.toString()]),f:"json"}});if(n.data){const s=n.data;if(s.layerDataElements?.[0])return s.layerDataElements[0]}throw new y.EN(y.H9.DataElementsNotFound)})();if(null!==z.Z.applicationCache){z.Z.applicationCache.setLayerInfo(t,r);try{return yield r}catch(n){throw z.Z.applicationCache.clearLayerInfo(t),n}}return r})).apply(this,arguments)}function Re(m){return Se.apply(this,arguments)}function Se(){return(Se=(0,_.Z)(function*(m){if(null!==z.Z.applicationCache){const t=z.Z.applicationCache.getLayerInfo(m);if(null!==t)return t}const e=(0,_.Z)(function*(){const t=yield(0,J.Z)(m,{responseType:"json",query:{f:"json"}});if(t.data){const r=t.data;return r.layers||(r.layers=[]),r.tables||(r.tables=[]),r}return{layers:[],tables:[]}})();if(null!==z.Z.applicationCache){z.Z.applicationCache.setLayerInfo(m,e);try{return yield e}catch(t){throw z.Z.applicationCache.clearLayerInfo(m),t}}return e})).apply(this,arguments)}function qe(m,e){return Ie.apply(this,arguments)}function Ie(){return Ie=(0,_.Z)(function*(m,e){const t={metadata:null,networkId:-1,unVersion:3,terminals:[],queryelem:null,layerNameLkp:{},lkp:null},r=yield Re(m);if(t.metadata=r,void 0!==r.controllerDatasetLayers?.utilityNetworkLayerId&&null!==r.controllerDatasetLayers.utilityNetworkLayerId){if(r.layers)for(const a of r.layers)t.layerNameLkp[a.id]=a.name;if(r.tables)for(const a of r.tables)t.layerNameLkp[a.id]=a.name;const n=r.controllerDatasetLayers.utilityNetworkLayerId;t.networkId=n;const s=yield function Je(m,e){return Fe.apply(this,arguments)}(m,n);if(s){t.queryelem=s,t.queryelem?.dataElement&&void 0!==t.queryelem.dataElement.schemaGeneration&&(t.unVersion=t.queryelem.dataElement.schemaGeneration),t.lkp={},t.queryelem.dataElement.domainNetworks||(t.queryelem.dataElement.domainNetworks=[]);for(const l of t.queryelem.dataElement.domainNetworks){for(const i of l.edgeSources??[]){const u={layerId:i.layerId,sourceId:i.sourceId,className:t.layerNameLkp[i.layerId]??null};u.className&&(t.lkp[u.className]=u)}for(const i of l.junctionSources??[]){const u={layerId:i.layerId,sourceId:i.sourceId,className:t.layerNameLkp[i.layerId]??null};u.className&&(t.lkp[u.className]=u)}}if(t.queryelem.dataElement.terminalConfigurations)for(const l of t.queryelem.dataElement.terminalConfigurations)for(const i of l.terminals)t.terminals.push({terminalId:i.terminalId,terminalName:i.terminalName});const a=yield function ze(m){return me.apply(this,arguments)}(m+"/"+n);if(void 0!==a.systemLayers?.associationsTableId&&null!==a.systemLayers.associationsTableId){const l=[];t.unVersion>=4&&(l.push("STATUS"),l.push("PERCENTALONG"));let i=yield ye(m+"/"+a.systemLayers.associationsTableId.toString(),e,["OBJECTID","FROMNETWORKSOURCEID","TONETWORKSOURCEID","FROMGLOBALID","TOGLOBALID","TOTERMINALID","FROMTERMINALID","ASSOCIATIONTYPE","ISCONTENTVISIBLE","GLOBALID",...l],!1,null,null);return yield i.load(),t.unVersion>=4&&(i=i.filter(d.WhereClause.create("STATUS NOT IN (1, 2, 3, 4, 5, 6, 7, 9, 10, 11, 12, 13, 14, 15, 17, 18, 19, 20, 21, 22, 23, 25, 26, 27, 28, 29, 30, 31, 33, 34, 35, 36, 37, 38, 39, 41, 42, 43, 44, 45, 46, 47, 49, 50, 51, 52, 53, 54, 55, 57, 58, 59, 60, 61, 62, 63)",i.getFieldsIndex(),i.dateFieldsTimeZoneDefaultUTC)),yield i.load()),{lkp:t.lkp,associations:i,unVersion:t.unVersion,terminals:t.terminals}}return{associations:null,unVersion:t.unVersion,lkp:null,terminals:[]}}return{associations:null,unVersion:t.unVersion,lkp:null,terminals:[]}}return{associations:null,unVersion:t.unVersion,lkp:null,terminals:[]}}),Ie.apply(this,arguments)}function He(m,e,t){return ve.apply(this,arguments)}function ve(){return(ve=(0,_.Z)(function*(m,e,t,r=null,n=null,s=!0,a=null,l=null){let i=m.serviceUrl();if(!i)return null;i="/"===i.charAt(i.length-1)?i+e.relatedTableId.toString():i+"/"+e.relatedTableId.toString();const u=yield ye(i,r,n,s,a,l);return new Ke({layer:m,relatedLayer:u,relationship:e,objectId:t,spatialReference:r,outFields:n,includeGeometry:s,lrucache:a,interceptor:l})})).apply(this,arguments)}O.Z.registerAction(),M.registerAction(),I.Z.registerAction(),k.Z.registerAction(),C.Z.registerAction();class $e extends V.Z{constructor(e,t=null,r=null,n=null){super(),this._map=e,this._overridespref=t,this._lrucache=r,this._interceptor=n,this._instantLayers=[]}_makeAndAddFeatureSet(e,t=!0,r=null){const n=ee(e,this._overridespref,null===r?["*"]:r,t,this._lrucache,this._interceptor);return this._instantLayers.push({featureset:n,opitem:e,includeGeometry:t,outFields:JSON.stringify(r)}),n}featureSetByName(e,t=!0,r=null){var n=this;return(0,_.Z)(function*(){if(void 0!==n._map.loaded&&void 0!==n._map.load&&!1===n._map.loaded)return yield n._map.load(),n.featureSetByName(e,t,r);null===r&&(r=["*"]),r=(r=r.slice(0)).sort();const s=JSON.stringify(r);for(let i=0;i<n._instantLayers.length;i++){const u=n._instantLayers[i];if(u.opitem.title===e&&u.includeGeometry===t&&u.outFields===s)return n._instantLayers[i].featureset}const a=[],l=n._map.allLayers.find(i=>{if(i instanceof Y.default){if(i.title===e)return!0}else if((0,x.$)(i)){if(i.title===e)return!0;a.push(i)}return!1});if(l)return n._makeAndAddFeatureSet(l,t,r);if(n._map.tables){const i=n._map.tables.find(u=>!!(u.title&&u.title===e||u.title&&u.title===e));if(i){if(i instanceof Y.default)return n._makeAndAddFeatureSet(i,t,r);if(!i._materializedTable){const u=i.outFields?i:{...i,outFields:["*"]};i._materializedTable=new Y.default(u)}return yield i._materializedTable.load(),n._makeAndAddFeatureSet(i._materializedTable,t,r)}}for(const i of a){if("not-loaded"===i.loadStatus||"loading"===i.loadStatus)try{yield i.load()}catch{}const u=i.sublayers.find(g=>g.title===e);if(u)return n._makeAndAddFeatureSet(u,t,r)}return null})()}featureSetById(e,t=!0,r=["*"]){var n=this;return(0,_.Z)(function*(){if(void 0!==n._map.loaded&&void 0!==n._map.load&&!1===n._map.loaded)return yield n._map.load(),n.featureSetById(e,t,r);null===r&&(r=["*"]),r=(r=r.slice(0)).sort();const s=JSON.stringify(r);for(let i=0;i<n._instantLayers.length;i++){const u=n._instantLayers[i];if(u.opitem.id===e&&u.includeGeometry===t&&u.outFields===s)return n._instantLayers[i].featureset}const a=[],l=n._map.allLayers.find(i=>{if(i instanceof Y.default){if(i.id===e)return!0}else if((0,x.$)(i)){if(i.id===e)return!0;a.push(i)}return!1});if(l)return n._makeAndAddFeatureSet(l,t,r);if(n._map.tables){const i=n._map.tables.find(u=>u.id===e);if(i){if(i instanceof Y.default)return n._makeAndAddFeatureSet(i,t,r);if(!i._materializedTable){const u={...i,outFields:["*"]};i._materializedTable=new Y.default(u)}return yield i._materializedTable.load(),n._makeAndAddFeatureSet(i._materializedTable,t,r)}}for(const i of a){if("not-loaded"===i.loadStatus||"loading"===i.loadStatus)try{yield i.load()}catch{}const u=i.sublayers.find(g=>g.id===e);if(u)return n._makeAndAddFeatureSet(u,t,r)}return null})()}}class we extends V.Z{constructor(e,t=null,r=null,n=null){super(),this._url=e,this._overridespref=t,this._lrucache=r,this._interceptor=n,this.metadata=null,this._instantLayers=[]}get url(){return this._url}_makeAndAddFeatureSet(e,t=!0,r=null){const n=ee(e,this._overridespref,null===r?["*"]:r,t,this._lrucache);return this._instantLayers.push({featureset:n,opitem:e,includeGeometry:t,outFields:JSON.stringify(r)}),n}_loadMetaData(){var e=this;return(0,_.Z)(function*(){const t=yield Re(e._url);return e.metadata=t,t})()}load(){return this._loadMetaData()}clone(){return new we(this._url,this._overridespref,this._lrucache,this._interceptor)}featureSetByName(e,t=!0,r=null){var n=this;return(0,_.Z)(function*(){null===r&&(r=["*"]),r=(r=r.slice(0)).sort();const s=JSON.stringify(r);for(let i=0;i<n._instantLayers.length;i++){const u=n._instantLayers[i];if(u.opitem.title===e&&u.includeGeometry===t&&u.outFields===s)return n._instantLayers[i].featureset}const a=yield n._loadMetaData();let l=null;for(const i of a.layers??[])i.name===e&&(l=i);if(!l)for(const i of a.tables??[])i.name===e&&(l=i);if(l){const i=yield pe(n._url+"/"+l.id,["*"]);return n._makeAndAddFeatureSet(i,t,r)}return null})()}featureSetById(e,t=!0,r=["*"]){var n=this;return(0,_.Z)(function*(){null===r&&(r=["*"]),r=(r=r.slice(0)).sort();const s=JSON.stringify(r);e=null!=e?e.toString():"";for(let i=0;i<n._instantLayers.length;i++){const u=n._instantLayers[i];if(u.opitem.id===e&&u.includeGeometry===t&&u.outFields===s)return n._instantLayers[i].featureset}const a=yield n._loadMetaData();let l=null;for(const i of a.layers??[])null!=i.id&&i.id.toString()===e&&(l=i);if(!l)for(const i of a.tables??[])null!=i.id&&i.id.toString()===e&&(l=i);if(l){const i=yield pe(n._url+"/"+l.id,["*"]);return n._makeAndAddFeatureSet(i,t,r)}return null})()}}function Xe(m,e,t=null,r=null){return new $e(m,e,t,r)}function Ye(m,e,t=null,r=null){return new we(m,e,t,r)}function et(m,e,t,r,n){if(null===m)return null;if(m instanceof Y.default){switch(e){case"datasource":return ee(m,n,m.outFields,!0,t,r).getDataSourceFeatureSet();case"parent":case"root":return ee(m,n,m.outFields,!0,t,r)}return null}if((0,x.$)(m)){switch(e){case"datasource":return ee(m,n,m.outFields,!0,t,r).getDataSourceFeatureSet();case"parent":case"root":return ee(m,n,m.outFields,!0,t,r)}return null}if((0,x.a0)(m)){switch(e){case"datasource":return ee(m.parent,n,m.parent.outFields,!0,t,r).getDataSourceFeatureSet();case"parent":case"root":return ee(m,n,m.parent.outFields,!0,t,r)}return null}if(m instanceof R.Z)switch(e){case"datasource":return m.getDataSourceFeatureSet();case"parent":return m;case"root":return m.getRootFeatureSet()}return null}function tt(m,e,t,r,n,s,a){return Ce.apply(this,arguments)}function Ce(){return(Ce=(0,_.Z)(function*(m,e,t,r,n,s,a,l=null){if(z.Z.applicationCache){const u=z.Z.applicationCache.getLayerInfo(m+":"+s.url);if(u){const g=yield u;return ee(new Y.default({url:(0,c.US)(g.url)+"/"+e,outFields:["*"]}),t,r,n,a,l)}}const i=new Qe.default({id:m,portal:s}).load();z.Z.applicationCache&&z.Z.applicationCache.setLayerInfo(m+":"+s.url,i);try{const u=yield i;return ee(new Y.default({url:(0,c.US)(u.url??"")+"/"+e,outFields:["*"]}),t,r,n,a,l)}catch(u){throw z.Z.applicationCache&&z.Z.applicationCache.clearLayerInfo(m+":"+s.url),u}})).apply(this,arguments)}},52724:(ae,X,f)=>{f.d(X,{$X:()=>c,QP:()=>v,TO:()=>Z,Xx:()=>b,yN:()=>d});var _=f(15861),J=f(88879),V=f(27187),x=f(47982),O=f(49086),U=f(91510),P=f(77132),I=f(83947),y=f(62208),R=f(80774),N=f(65234);class S{constructor(h){this.field=h,this.sqlRewritable=!1}postInitialization(h,o){}}class c extends S{constructor(h){super(h),this.sqlRewritable=!0}extractValue(h){return h.attributes[this.field.name]}rewriteSql(h){return{rewritten:this.sqlRewritable,where:h}}}class v extends S{constructor(h,o,p){super((0,P.JW)(h)),this.originalField=h,this.sqlRewritable=!0,this.field.name=o,this.field.alias=p}rewriteSql(h,o){return{rewritten:this.sqlRewritable,where:(0,I.bB)(h,this.field.name,this.originalField.name,o.getFieldsIndex())}}extractValue(h){return h.attributes[this.originalField.name]}}let Z=(()=>{class F extends S{constructor(o,p,D){super(o),this.codefield=p,this.lkp=D,this.reverseLkp={};for(const E in D)this.reverseLkp[D[E]]=E;this.sqlRewritable=!0}rewriteSql(o,p){const D=this.evaluateNodeToWhereClause(o.parseTree,P.Bj.Standardised,this.field.name,this.codefield instanceof R.WhereClause?(0,I.zR)(this.codefield,P.Bj.Standardised):this.codefield,o.parameters);return D.includes(F.BADNESS)?{rewritten:!1,where:o}:{rewritten:this.sqlRewritable,where:R.WhereClause.create(D,p._parent.getFieldsIndex(),p.dateFieldsTimeZoneDefaultUTC)}}evaluateNodeToWhereClause(o,p,D=null,E=null,w){let B,G,M,k;switch(o.type){case"interval":return(0,I.TE)(this.evaluateNodeToWhereClause(o.value,p,D,E,w),o.qualifier,o.op);case"case-expression":{let C=" CASE ";"simple"===o.format&&(C+=this.evaluateNodeToWhereClause(o.operand,p,D,F.BADNESS,w));for(let A=0;A<o.clauses.length;A++)C+=" WHEN "+this.evaluateNodeToWhereClause(o.clauses[A].operand,p,D,F.BADNESS,w)+" THEN "+this.evaluateNodeToWhereClause(o.clauses[A].value,p,D,F.BADNESS,w);return null!==o.else&&(C+=" ELSE "+this.evaluateNodeToWhereClause(o.else,p,D,F.BADNESS,w)),C+=" END ",C}case"parameter":{const C=w[o.value.toLowerCase()];if("string"==typeof C)return"'"+C.toString().replaceAll("'","''")+"'";if((0,P.J_)(C)||(0,P.T4)(C))return(0,I.vn)(C,p);if((0,P._U)(C))return(0,I.wF)(C,p);if((0,P.NP)(C))return(0,I.mA)(C,p);if((0,P.$A)(C))return(0,I.av)(C,p);if(C instanceof Array){const A=[];for(let W=0;W<C.length;W++)"string"==typeof C[W]?A.push("'"+C[W].toString().replaceAll("'","''")+"'"):(0,P.J_)(C[W])||(0,P.T4)(C[W])?A.push((0,I.vn)(C[W],p)):(0,P._U)(C[W])?A.push((0,I.wF)(C[W],p)):(0,P.NP)(C[W])?A.push((0,I.mA)(C[W],p)):(0,P.$A)(C[W])?A.push((0,I.av)(C[W],p)):A.push(C[W].toString());return A}return C.toString()}case"expression-list":G=[];for(const C of o.value)G.push(this.evaluateNodeToWhereClause(C,p,D,E,w));return G;case"unary-expression":return" ( NOT "+this.evaluateNodeToWhereClause(o.expr,p,D,F.BADNESS,w)+" ) ";case"binary-expression":switch(o.operator){case"AND":return" ("+this.evaluateNodeToWhereClause(o.left,p,D,E,w)+" AND "+this.evaluateNodeToWhereClause(o.right,p,D,E,w)+") ";case"OR":return" ("+this.evaluateNodeToWhereClause(o.left,p,D,E,w)+" OR "+this.evaluateNodeToWhereClause(o.right,p,D,E,w)+") ";case"IS":if("null"!==o.right.type)throw new x.eS(x.f.UnsupportedIsRhs);return" ("+this.evaluateNodeToWhereClause(o.left,p,D,E,w)+" IS NULL )";case"ISNOT":if("null"!==o.right.type)throw new x.eS(x.f.UnsupportedIsRhs);return" ("+this.evaluateNodeToWhereClause(o.left,p,D,E,w)+" IS NOT NULL )";case"IN":if(B=[],"expression-list"===o.right.type){if("column-reference"===o.left.type&&o.left.column.toUpperCase()===this.field.name.toUpperCase()){const C=[];let A=!0;for(const W of o.right.value){if("string"!==W.type){A=!1;break}if(void 0===this.lkp[W.value]){A=!1;break}C.push(this.lkp[W.value].toString())}if(A)return" ("+this.evaluateNodeToWhereClause(o.left,p,D,E,w)+" IN ("+C.join(",")+")) "}return B=this.evaluateNodeToWhereClause(o.right,p,D,E,w)," ("+this.evaluateNodeToWhereClause(o.left,p,D,E,w)+" IN ("+B.join(",")+")) "}return k=this.evaluateNodeToWhereClause(o.right,p,D,E,w),k instanceof Array?" ("+this.evaluateNodeToWhereClause(o.left,p,D,E,w)+" IN ("+k.join(",")+")) ":" ("+this.evaluateNodeToWhereClause(o.left,p,D,E,w)+" IN ("+k+")) ";case"NOT IN":if(B=[],"expression-list"===o.right.type){if("column-reference"===o.left.type&&o.left.column.toUpperCase()===this.field.name.toUpperCase()){const C=[];let A=!0;for(const W of o.right.value){if("string"!==W.type){A=!1;break}if(void 0===this.lkp[W.value]){A=!1;break}C.push(this.lkp[W.value].toString())}if(A)return" ("+this.evaluateNodeToWhereClause(o.left,p,D,E,w)+" NOT IN ("+C.join(",")+")) "}return B=this.evaluateNodeToWhereClause(o.right,p,D,E,w)," ("+this.evaluateNodeToWhereClause(o.left,p,D,E,w)+" NOT IN ("+B.join(",")+")) "}return k=this.evaluateNodeToWhereClause(o.right,p,D,E,w),k instanceof Array?" ("+this.evaluateNodeToWhereClause(o.left,p,D,E,w)+" NOT IN ("+k.join(",")+")) ":" ("+this.evaluateNodeToWhereClause(o.left,p,D,E,w)+" NOT IN ("+k+")) ";case"BETWEEN":return M=this.evaluateNodeToWhereClause(o.right,p,D,F.BADNESS,w)," ("+this.evaluateNodeToWhereClause(o.left,p,D,F.BADNESS,w)+" BETWEEN "+M[0]+" AND "+M[1]+" ) ";case"NOTBETWEEN":return M=this.evaluateNodeToWhereClause(o.right,p,D,F.BADNESS,w)," ("+this.evaluateNodeToWhereClause(o.left,p,D,F.BADNESS,w)+" NOT BETWEEN "+M[0]+" AND "+M[1]+" ) ";case"LIKE":return""!==o.escape?" ("+this.evaluateNodeToWhereClause(o.left,p,D,F.BADNESS,w)+" LIKE "+this.evaluateNodeToWhereClause(o.right,p,D,F.BADNESS,w)+" ESCAPE '"+o.escape+"') ":" ("+this.evaluateNodeToWhereClause(o.left,p,D,F.BADNESS,w)+" LIKE "+this.evaluateNodeToWhereClause(o.right,p,D,F.BADNESS,w)+") ";case"NOT LIKE":return""!==o.escape?" ("+this.evaluateNodeToWhereClause(o.left,p,D,F.BADNESS,w)+" NOT LIKE "+this.evaluateNodeToWhereClause(o.right,p,D,F.BADNESS,w)+" ESCAPE '"+o.escape+"') ":" ("+this.evaluateNodeToWhereClause(o.left,p,D,F.BADNESS,w)+" NOT LIKE "+this.evaluateNodeToWhereClause(o.right,p,D,F.BADNESS,w)+") ";case"<>":case"=":if("column-reference"===o.left.type&&"string"===o.right.type){if(o.left.column.toUpperCase()===this.field.name.toUpperCase()&&void 0!==this.lkp[o.right.value.toString()])return" ("+E+" "+o.operator+" "+this.lkp[o.right.value.toString()].toString()+") "}else if("column-reference"===o.right.type&&"string"===o.left.type&&o.right.column.toUpperCase()===this.field.name.toUpperCase())return" ("+this.lkp[o.right.value.toString()].toString()+" "+o.operator+" "+E+") ";return" ("+this.evaluateNodeToWhereClause(o.left,p,D,F.BADNESS,w)+" "+o.operator+" "+this.evaluateNodeToWhereClause(o.right,p,D,F.BADNESS,w)+") ";case"<":case">":case">=":case"<=":case"*":case"-":case"+":case"/":case"||":return" ("+this.evaluateNodeToWhereClause(o.left,p,D,F.BADNESS,w)+" "+o.operator+" "+this.evaluateNodeToWhereClause(o.right,p,D,F.BADNESS,w)+") "}case"null":return"null";case"boolean":return!0===o.value?"1":"0";case"string":return"'"+o.value.toString().replaceAll("'","''")+"'";case"timestamp":return`timestamp '${o.value}'`;case"date":return`date '${o.value}'`;case"time":return`time '${o.value}'`;case"number":return o.value.toString();case"current-time":return(0,I.vR)("date"===o.mode,p);case"column-reference":return D&&D.toLowerCase()===o.column.toLowerCase()?"("+E+")":o.column;case"data-type":return o.value;case"function":{const C=this.evaluateNodeToWhereClause(o.args,p,D,F.BADNESS,w);return(0,I.fz)(o.name,C,p)}}throw new x.eS(x.f.UnsupportedSyntax,{node:o.type})}extractValue(o){return this.codefield instanceof R.WhereClause?this.reverseLkp[R.WhereClause.convertValueToStorageFormat(this.codefield.calculateValueCompiled(o))]:this.reverseLkp[o.attributes[this.codefield]]}}return F.BADNESS="_!!!_BAD_LKP_!!!!",F})();class d extends S{constructor(h,o){super(h),this._sql=o}rewriteSql(h,o){return{rewritten:!0,where:(0,I.bB)(h,this.field.name,(0,I.zR)(this._sql,P.Bj.Standardised),o.getFieldsIndex())}}extractValue(h){return R.WhereClause.convertValueToStorageFormat(this._sql.calculateValueCompiled(h),this.field.type)}}class b extends O.Z{static findField(h,o){for(const p of h)if(p.name.toLowerCase()===o.toString().toLowerCase())return p;return null}constructor(h){super(h),this._calcFunc=null,this.declaredClass="esri.arcade.featureset.actions.Adapted",this.adaptedFields=[],this._extraFilter=null,this._extraFilter=h.extraFilter,this._parent=h.parentfeatureset,this._maxProcessing=30,this.adaptedFields=h.adaptedFields}_initialiseFeatureSet(){null!==this._parent?(this.geometryType=this._parent.geometryType,this.objectIdField=this._parent.objectIdField,this.globalIdField=this._parent.globalIdField,this.spatialReference=this._parent.spatialReference,this.hasM=this._parent.hasM,this.hasZ=this._parent.hasZ,this.typeIdField=this._parent.typeIdField,this.types=this._parent.types):(this.spatialReference=new N.Z({wkid:4326}),this.objectIdField="",this.globalIdField="",this.geometryType=P.Qk.point,this.typeIdField="",this.types=null),this.fields=[];for(const h of this.adaptedFields)h.postInitialization(this,this._parent),this.fields.push(h.field)}_getSet(h){var o=this;return(0,_.Z)(function*(){if(null===o._wset){yield o._ensureLoaded();let p=null;return p=o._extraFilter?yield o._getFilteredSet("",null,null,null,h):yield o._parent?._getSet(h),o._checkCancelled(h),(0,y.O3)(p),o._wset=new U.Z(p._candidates.slice(0),p._known.slice(0),p._ordered,o._clonePageDefinition(p.pagesDefinition)),o._wset}return o._wset})()}_isInFeatureSet(h){return this._parent._isInFeatureSet(h)}_getFeatures(h,o,p,D){var E=this;return(0,_.Z)(function*(){const w=[];-1!==o&&void 0===E._featureCache[o]&&w.push(o);const B=E._maxQueryRate();if(!0===E._checkIfNeedToExpandKnownPage(h,B))return yield E._expandPagedSet(h,B,0,0,D),E._getFeatures(h,o,p,D);let G=0;for(let C=h._lastFetchedIndex;C<h._known.length&&(G++,G<=p&&(h._lastFetchedIndex+=1),!(void 0===E._featureCache[h._known[C]]&&(h._known[C]!==o&&w.push(h._known[C]),w.length>=B)));C++);if(0===w.length)return"success";h=new U.Z([],w,h._ordered,null);const M=Math.min(w.length,p);yield E._parent?._getFeatures(h,-1,M,D),E._checkCancelled(D);const k=[];for(let C=0;C<M;C++){const A=E._parent?._featureFromCache(w[C]);void 0!==A&&k.push({geometry:A.geometry,attributes:A.attributes,id:w[C]})}for(const C of k){const A=[];for(const W of E.adaptedFields)A[W.field.name]=W.extractValue(C);E._featureCache[C.id]=new J.Z({attributes:A,geometry:(0,V.r1)(C.geometry)})}return"success"})()}_fetchAndRefineFeatures(){return(0,_.Z)(function*(){throw new x.EN(x.H9.NeverReach)})()}_getFilteredSet(h,o,p,D,E){var w=this;return(0,_.Z)(function*(){let B=!1;const G=w._reformulateWithoutAdaptions(p);B=G.cannot,p=G.where;let M=!1;if(null!==D){M=!0;const A=[];for(const W of w.adaptedFields)if(!(W instanceof c)&&!0===D.scanForField(W.field.name)){if(!(W instanceof v)){D=null,M=!1;break}A.push({field:W.field.name,newfield:W.originalField.name})}D&&A.length>0&&(D=D.replaceFields(A))}null!==p?null!==w._extraFilter&&(p=(0,I.$e)(w._extraFilter,p)):p=w._extraFilter,yield w._ensureLoaded();const k=yield w._parent._getFilteredSet(h,o,p,D,E);let C;return w._checkCancelled(E),C=!0===B?new U.Z(k._candidates.slice(0).concat(k._known.slice(0)),[],!0===M&&k._ordered,w._clonePageDefinition(k.pagesDefinition)):new U.Z(k._candidates.slice(0),k._known.slice(0),!0===M&&k._ordered,w._clonePageDefinition(k.pagesDefinition)),C})()}_reformulateWithoutAdaptions(h){const o={cannot:!1,where:h};if(null!==h)for(const p of this.adaptedFields)if(!0===(0,I.hq)(h,p.field.name)){const D=p.rewriteSql(h,this);if(!0!==D.rewritten){o.cannot=!0,o.where=null;break}o.where=D.where}return o}_stat(h,o,p,D,E,w,B){var G=this;return(0,_.Z)(function*(){let M=!1,k=G._reformulateWithoutAdaptions(o);if(M=k.cannot,o=k.where,k=G._reformulateWithoutAdaptions(E),M=M||k.cannot,null!==(E=k.where)?null!==G._extraFilter&&(E=(0,I.$e)(G._extraFilter,E)):E=G._extraFilter,!0===M)return null===E&&""===p&&null===D?G._manualStat(h,o,w,B):{calculated:!1};const C=yield G._parent._stat(h,o,p,D,E,w,B);return!1===C.calculated?null===E&&""===p&&null===D?G._manualStat(h,o,w,B):{calculated:!1}:C})()}_canDoAggregates(h,o,p,D,E){var w=this;return(0,_.Z)(function*(){if(null===w._parent)return!1;for(let M=0;M<h.length;M++)for(const k of w.adaptedFields)if(h[M].toLowerCase()===k.field.name.toLowerCase()&&!(k instanceof c))return!1;const B=[];for(let M=0;M<o.length;M++){const k=o[M];if(null!==k.workingexpr){const C=w._reformulateWithoutAdaptions(k.workingexpr);if(C.cannot)return!1;const A=k.clone();A.workingexpr=C.where,B.push(A)}else B.push(k)}const G=w._reformulateWithoutAdaptions(E);return!G.cannot&&(null!==(E=G.where)?null!==w._extraFilter&&(E=(0,I.$e)(w._extraFilter,E)):E=w._extraFilter,w._parent._canDoAggregates(h,B,p,D,E))})()}_getAggregatePagesDataSourceDefinition(h,o,p,D,E,w,B){var G=this;return(0,_.Z)(function*(){if(null===G._parent)throw new x.EN(x.H9.NeverReach);const M=[];for(let C=0;C<o.length;C++){const A=o[C];if(null!==A.workingexpr){const W=G._reformulateWithoutAdaptions(A.workingexpr);if(W.cannot)throw new x.EN(x.H9.NeverReach);const se=A.clone();se.workingexpr=W.where,M.push(se)}else M.push(A)}const k=G._reformulateWithoutAdaptions(E);if(k.cannot)throw new x.EN(x.H9.NeverReach);return null!==(E=k.where)?null!==G._extraFilter&&(E=(0,I.$e)(G._extraFilter,E)):E=G._extraFilter,G._parent._getAggregatePagesDataSourceDefinition(h,M,p,D,E,w,B)})()}}},53997:(ae,X,f)=>{f.d(X,{Z:()=>R});var _=f(15861),J=f(47982),V=f(49086),x=f(91510),O=f(77132),U=f(83947),P=f(10699),I=f(80774),y=f(65234);class R extends V.Z{constructor(S){super(S),this.declaredClass="esri.arcade.featureset.actions.AttributeFilter",this._maxProcessing=1e3,this._parent=S.parentfeatureset,S.whereclause instanceof I.WhereClause?(this._whereclause=S.whereclause,this._whereClauseFunction=null):(this._whereClauseFunction=S.whereclause,this._whereclause=null)}_initialiseFeatureSet(){null!==this._parent?(this.fields=this._parent.fields.slice(0),this.geometryType=this._parent.geometryType,this.objectIdField=this._parent.objectIdField,this.globalIdField=this._parent.globalIdField,this.spatialReference=this._parent.spatialReference,this.hasM=this._parent.hasM,this.hasZ=this._parent.hasZ,this.typeIdField=this._parent.typeIdField,this.types=this._parent.types):(this.fields=[],this.typeIdField="",this.objectIdField="",this.globalIdField="",this.spatialReference=new y.Z({wkid:4326}),this.geometryType=O.Qk.point)}_getSet(S){var c=this;return(0,_.Z)(function*(){if(null===c._wset){yield c._ensureLoaded();const v=yield c._parent._getFilteredSet("",null,c._whereclause,null,S);return c._checkCancelled(S),c._wset=null!==c._whereClauseFunction?new x.Z(v._candidates.slice(0).concat(v._known.slice(0)),[],v._ordered,c._clonePageDefinition(v.pagesDefinition)):new x.Z(v._candidates.slice(0),v._known.slice(0),v._ordered,c._clonePageDefinition(v.pagesDefinition)),c._wset}return c._wset})()}_isInFeatureSet(S){let c=this._parent?._isInFeatureSet(S);return c===O.dj.NotInFeatureSet?c:(c=this._idstates[S],void 0===c?O.dj.Unknown:c)}_getFeature(S,c,v){return this._parent._getFeature(S,c,v)}_getFeatures(S,c,v,Z){return this._parent._getFeatures(S,c,v,Z)}_featureFromCache(S){return this._parent._featureFromCache(S)}executeWhereClause(S){return this._whereclause?.testFeature(S)??!1}executeWhereClauseDeferred(S){var c=this;return(0,_.Z)(function*(){if(null!==c._whereClauseFunction){const v=c._whereClauseFunction(S);return(0,P.y8)(v),v}return c.executeWhereClause(S)})()}_fetchAndRefineFeatures(S,c,v){var Z=this;return(0,_.Z)(function*(){const d=new x.Z([],S,!1,null),b=Math.min(c,S.length);if(yield Z._parent?._getFeatures(d,-1,b,v),Z._checkCancelled(v),null==Z._whereClauseFunction){for(let h=0;h<b;h++){const o=Z._parent?._featureFromCache(S[h]);Z._idstates[S[h]]=!0===Z.executeWhereClause(o)?O.dj.InFeatureSet:O.dj.NotInFeatureSet}return"success"}const F=[];for(let h=0;h<b;h++){const o=Z._parent?._featureFromCache(S[h]);F.push(yield Z.executeWhereClauseDeferred(o))}for(let h=0;h<c;h++)Z._idstates[S[h]]=!0===F[h]?O.dj.InFeatureSet:O.dj.NotInFeatureSet;return"success"})()}_getFilteredSet(S,c,v,Z,d){var b=this;return(0,_.Z)(function*(){null!==b._whereClauseFunction||(null!==v?null!==b._whereclause&&(v=(0,U.$e)(b._whereclause,v)):v=b._whereclause),yield b._ensureLoaded();const F=yield b._parent._getFilteredSet(S,c,v,Z,d);let h;return b._checkCancelled(d),h=null!==b._whereClauseFunction?new x.Z(F._candidates.slice(0).concat(F._known.slice(0)),[],F._ordered,b._clonePageDefinition(F.pagesDefinition)):new x.Z(F._candidates.slice(0),F._known.slice(0),F._ordered,b._clonePageDefinition(F.pagesDefinition)),h})()}_stat(S,c,v,Z,d,b,F){var h=this;return(0,_.Z)(function*(){if(null!==h._whereClauseFunction)return null===d&&""===v&&null===Z?h._manualStat(S,c,b,F):{calculated:!1};let o=h._whereclause;null!==d&&null!==h._whereclause&&(o=(0,U.$e)(h._whereclause,d));const p=yield h._parent._stat(S,c,v,Z,o,b,F);return!1===p.calculated?null===d&&""===v&&null===Z?h._manualStat(S,c,b,F):{calculated:!1}:p})()}_canDoAggregates(S,c,v,Z,d){var b=this;return(0,_.Z)(function*(){return null===b._whereClauseFunction&&(null!==d?null!==b._whereclause&&(d=(0,U.$e)(b._whereclause,d)):d=b._whereclause,null!==b._parent&&b._parent._canDoAggregates(S,c,v,Z,d))})()}_getAggregatePagesDataSourceDefinition(S,c,v,Z,d,b,F){var h=this;return(0,_.Z)(function*(){if(null===h._parent)throw new J.EN(J.H9.NeverReach);return null!==d?null!==h._whereclause&&(d=(0,U.$e)(h._whereclause,d)):d=h._whereclause,h._parent._getAggregatePagesDataSourceDefinition(S,c,v,Z,d,b,F)})()}static registerAction(){V.Z._featuresetFunctions.filter=function(S){if("function"==typeof S)return new R({parentfeatureset:this,whereclause:S});let c=null;return S instanceof I.WhereClause&&(c=S),new R({parentfeatureset:this,whereclause:c})}}getFieldsIndex(){return this._parent.getFieldsIndex()}}},95896:(ae,X,f)=>{f.d(X,{Z:()=>P});var _=f(15861),J=f(47562),V=f(47982),x=f(49086),O=f(91510),U=f(57366);class P extends x.Z{constructor(y){super(y),this._orderbyclause=null,this.declaredClass="esri.arcade.featureset.actions.OrderBy",this._maxProcessing=100,this._orderbyclause=y.orderbyclause,this._parent=y.parentfeatureset}_getSet(y){var R=this;return(0,_.Z)(function*(){if(null===R._wset){yield R._ensureLoaded();const N=yield R._getFilteredSet("",null,null,R._orderbyclause,y);return R._checkCancelled(y),R._wset=N,R._wset}return R._wset})()}manualOrderSet(y,R){var N=this;return(0,_.Z)(function*(){const S=yield N.getIdColumnDictionary(y,[],-1,R);N._orderbyclause?.order(S);const c=new O.Z([],[],!0,null);for(let v=0;v<S.length;v++)c._known.push(S[v].id);return c})()}getIdColumnDictionary(y,R,N,S){var c=this;return(0,_.Z)(function*(){if(N<y._known.length-1){const v=c._maxQueryRate();if("GETPAGES"===y._known[N+1])return yield(0,J.a1)(c._parent._expandPagedSet(y,v,0,0,S)),c.getIdColumnDictionary(y,R,N,S);let Z=N+1;const d=[];for(;Z<y._known.length&&"GETPAGES"!==y._known[Z];)d.push(y._known[Z]),Z++;N+=d.length;const b=yield(0,J.a1)(c._parent._getFeatureBatch(d,S));c._checkCancelled(S);for(const F of b)R.push({id:F.attributes[c.objectIdField],feature:F});return c.getIdColumnDictionary(y,R,N,S)}return y._candidates.length>0?(yield(0,J.a1)(c._refineSetBlock(y,c._maxProcessingRate(),S)),c._checkCancelled(S),c.getIdColumnDictionary(y,R,N,S)):R})()}_isInFeatureSet(y){return this._parent._isInFeatureSet(y)}_getFeatures(y,R,N,S){return this._parent._getFeatures(y,R,N,S)}_featureFromCache(y){if(void 0===this._featureCache[y]){const R=this._parent._featureFromCache(y);return void 0===R?void 0:null===R?null:(this._featureCache[y]=R,R)}return this._featureCache[y]}_fetchAndRefineFeatures(){return(0,_.Z)(function*(){throw new V.EN(V.H9.NeverReach)})()}_getFilteredSet(y,R,N,S,c){var v=this;return(0,_.Z)(function*(){yield v._ensureLoaded();const Z=yield v._parent._getFilteredSet(y,R,N,null===S?v._orderbyclause:S,c);v._checkCancelled(c);const d=new O.Z(Z._candidates.slice(0),Z._known.slice(0),Z._ordered,v._clonePageDefinition(Z.pagesDefinition));let b=!0;if(Z._candidates.length>0&&(b=!1),!1===d._ordered){let F=yield v.manualOrderSet(d,c);return!1===b&&(null===R&&null===N||(F=new O.Z(F._candidates.slice(0).concat(F._known.slice(0)),[],F._ordered,v._clonePageDefinition(F.pagesDefinition)))),F}return d})()}static registerAction(){x.Z._featuresetFunctions.orderBy=function(y){return""===y?this:new P({parentfeatureset:this,orderbyclause:new U.Z(y)})}}getFieldsIndex(){return this._parent.getFieldsIndex()}}},79429:(ae,X,f)=>{f.d(X,{Z:()=>U});var _=f(15861),J=f(47982),V=f(49086),x=f(91510),O=f(77132);class U extends V.Z{constructor(I){super(I),this._topnum=0,this.declaredClass="esri.arcade.featureset.actions.Top",this._countedin=0,this._maxProcessing=100,this._topnum=I.topnum,this._parent=I.parentfeatureset}_getSet(I){var y=this;return(0,_.Z)(function*(){if(null===y._wset){yield y._ensureLoaded();const R=yield y._parent._getSet(I);return y._wset=new x.Z(R._candidates.slice(0),R._known.slice(0),!1,y._clonePageDefinition(R.pagesDefinition)),y._setKnownLength(y._wset)>y._topnum&&(y._wset._known=y._wset._known.slice(0,y._topnum)),y._setKnownLength(y._wset)>=y._topnum&&(y._wset._candidates=[]),y._wset}return y._wset})()}_setKnownLength(I){return I._known.length>0&&"GETPAGES"===I._known[I._known.length-1]?I._known.length-1:I._known.length}_isInFeatureSet(I){const y=this._parent._isInFeatureSet(I);if(y===O.dj.NotInFeatureSet)return y;const R=this._idstates[I];return R===O.dj.InFeatureSet||R===O.dj.NotInFeatureSet?R:y===O.dj.InFeatureSet&&void 0===R?this._countedin<this._topnum?(this._idstates[I]=O.dj.InFeatureSet,this._countedin++,O.dj.InFeatureSet):(this._idstates[I]=O.dj.NotInFeatureSet,O.dj.NotInFeatureSet):O.dj.Unknown}_expandPagedSet(I,y,R,N,S){var c=this;return(0,_.Z)(function*(){if(null===c._parent)throw new J.EN(J.H9.NotImplemented);if(y>c._topnum&&(y=c._topnum),c._countedin>=c._topnum&&I.pagesDefinition.internal.set.length<=I.pagesDefinition.resultOffset){let Z=I._known.length;return Z>0&&"GETPAGES"===I._known[Z-1]&&(I._known.length=Z-1),Z=I._candidates.length,Z>0&&"GETPAGES"===I._candidates[Z-1]&&(I._candidates.length=Z-1),"success"}const v=yield c._parent._expandPagedSet(I,y,R,N,S);return c._setKnownLength(I)>c._topnum&&(I._known.length=c._topnum),c._setKnownLength(I)>=c._topnum&&(I._candidates.length=0),v})()}_getFeatures(I,y,R,N){var S=this;return(0,_.Z)(function*(){const c=[],v=S._maxQueryRate();if(!0===S._checkIfNeedToExpandKnownPage(I,v))return yield S._expandPagedSet(I,v,0,0,N),S._getFeatures(I,y,R,N);-1!==y&&void 0===S._featureCache[y]&&c.push(y);let Z=0;for(let F=I._lastFetchedIndex;F<I._known.length&&(Z++,Z<=R&&(I._lastFetchedIndex+=1),!(void 0===S._featureCache[I._known[F]]&&(I._known[F]!==y&&c.push(I._known[F]),c.length>v)));F++);if(0===c.length)return"success";const d=new x.Z([],c,!1,null),b=Math.min(c.length,R);yield S._parent._getFeatures(d,-1,b,N);for(let F=0;F<b;F++){const h=S._parent._featureFromCache(c[F]);void 0!==h&&(S._featureCache[c[F]]=h)}return"success"})()}_getFilteredSet(I,y,R,N,S){var c=this;return(0,_.Z)(function*(){yield c._ensureLoaded();const v=yield c._getSet(S);return new x.Z(v._candidates.slice(0).concat(v._known.slice(0)),[],!1,c._clonePageDefinition(v.pagesDefinition))})()}_refineKnowns(I,y){let R=0,N=null;const S=[];for(let c=0;c<I._candidates.length;c++){const v=this._isInFeatureSet(I._candidates[c]);if(v===O.dj.InFeatureSet){if(I._known.push(I._candidates[c]),R+=1,null===N?N={start:c,end:c}:N.end===c-1?N.end=c:(S.push(N),N={start:c,end:c}),I._known.length>=this._topnum)break}else if(v===O.dj.NotInFeatureSet)null===N?N={start:c,end:c}:N.end===c-1?N.end=c:(S.push(N),N={start:c,end:c}),R+=1;else if(v===O.dj.Unknown)break;if(R>=y)break}null!==N&&S.push(N);for(let c=S.length-1;c>=0;c--)I._candidates.splice(S[c].start,S[c].end-S[c].start+1);this._setKnownLength(I)>this._topnum&&(I._known=I._known.slice(0,this._topnum)),this._setKnownLength(I)>=this._topnum&&(I._candidates=[])}_stat(){return(0,_.Z)(function*(){return{calculated:!1}})()}_canDoAggregates(){return(0,_.Z)(function*(){return!1})()}static registerAction(){V.Z._featuresetFunctions.top=function(I){return new U({parentfeatureset:this,topnum:I})}}getFieldsIndex(){return this._parent.getFieldsIndex()}}},16776:(ae,X,f)=>{f.d(X,{Z:()=>v});var _=f(15861),J=f(88879),V=f(47982),x=f(49086),O=f(91510),U=f(77132),P=f(83947),I=f(21674),y=f(80415),R=f(81976),N=f(41638),S=f(36255),c=f(96854);class v extends x.Z{constructor(d){super(d),this.declaredClass="esri.arcade.featureset.sources.FeatureLayerMemory",this._removeGeometry=!1,this._overrideFields=null,this._forceIsTable=!1,d.spatialReference&&(this.spatialReference=d.spatialReference),this._transparent=!0,this._maxProcessing=1e3,this._layer=d.layer,this._wset=null,!0===d.isTable&&(this._forceIsTable=!0),void 0!==d.outFields&&(this._overrideFields=d.outFields),void 0!==d.includeGeometry&&(this._removeGeometry=!1===d.includeGeometry)}_maxQueryRate(){return U.tI}end(){return this._layer}optimisePagingFeatureQueries(){}loadImpl(){var d=this;return(0,_.Z)(function*(){return!0===d._layer.loaded?(d._initialiseFeatureSet(),d):(yield d._layer.load(),d._initialiseFeatureSet(),d)})()}get gdbVersion(){return""}_initialiseFeatureSet(){if(null==this.spatialReference&&(this.spatialReference=this._layer.spatialReference),this.geometryType=this._layer.geometryType,this.fields=this._layer.fields.slice(0),null!==this._overrideFields)if(1===this._overrideFields.length&&"*"===this._overrideFields[0])this._overrideFields=null;else{const d=[],b=[];for(const F of this.fields)if("oid"===F.type)d.push(F),b.push(F.name);else for(const h of this._overrideFields)if(h.toLowerCase()===F.name.toLowerCase()){d.push(F),b.push(F.name);break}this.fields=d,this._overrideFields=b}this.objectIdField=this._layer.objectIdField;for(const d of this.fields)"global-id"===d.type&&(this.globalIdField=d.name);this._databaseType=U.Bj.Standardised,this.hasZ=!0===this._layer?.capabilities?.data?.supportsZ,this.hasM=!0===this._layer?.capabilities?.data?.supportsM,this._layer instanceof R.default?(this.typeIdField=this._layer.subtypeField??"",this.types=this._layer.subtypes):(this.typeIdField=this._layer.typeIdField??"",this.types=this._layer.types)}isTable(){return this._forceIsTable||this._layer.isTable||"table"===this._layer.type||!this._layer.geometryType}_isInFeatureSet(){return U.dj.InFeatureSet}_candidateIdTransform(d){return d}_getSet(d){var b=this;return(0,_.Z)(function*(){if(null===b._wset){yield b._ensureLoaded();const F=yield b._getFilteredSet("",null,null,null,d);return b._wset=F,F}return b._wset})()}_changeFeature(d){const b={};for(const F of this.fields)b[F.name]=d.attributes[F.name];return new J.Z({geometry:!0===this._removeGeometry?null:d.geometry,attributes:b})}_getFilteredSet(d,b,F,h,o){var p=this;return(0,_.Z)(function*(){let D="",E=!1;if(null!==h&&(D=h.constructClause(),E=!0),p.isTable()&&b&&null!==d&&""!==d)return new O.Z([],[],!0,null);const w=new c.Z;w.returnZ=p.hasZ,w.returnM=p.hasM,w.where=null===F?null===b?"1=1":"":(0,P.zR)(F,U.Bj.Standardised),w.spatialRelationship=p._makeRelationshipEnum(d),w.outSpatialReference=p.spatialReference,w.orderByFields=""!==D?D.split(","):null,w.geometry=null===b?null:b,w.returnGeometry=!0,w.relationParameter=p._makeRelationshipParam(d);const B=yield p._layer.queryFeatures(w);if(null===B)return new O.Z([],[],E,null);p._checkCancelled(o);const G=[];return B.features.forEach(M=>{const k=M.attributes[p._layer.objectIdField];G.push(k),p._featureCache[k]=p._changeFeature(M)}),new O.Z([],G,E,null)})()}_makeRelationshipEnum(d){if(d.includes("esriSpatialRelRelation"))return"relation";switch(d){case"esriSpatialRelRelation":return"relation";case"esriSpatialRelIntersects":return"intersects";case"esriSpatialRelContains":return"contains";case"esriSpatialRelOverlaps":return"overlaps";case"esriSpatialRelWithin":return"within";case"esriSpatialRelTouches":return"touches";case"esriSpatialRelCrosses":return"crosses";case"esriSpatialRelEnvelopeIntersects":return"envelope-intersects"}return d}_makeRelationshipParam(d){return d.includes("esriSpatialRelRelation")?d.split(":")[1]:""}_queryAllFeatures(){var d=this;return(0,_.Z)(function*(){if(d._wset)return d._wset;const b=new c.Z;if(b.where="1=1",yield d._ensureLoaded(),d._layer.source&&d._layer.source.items){const o=[];return d._layer.source.items.forEach(p=>{const D=p.attributes[d._layer.objectIdField];o.push(D),d._featureCache[D]=d._changeFeature(p)}),d._wset=new O.Z([],o,!1,null),d._wset}b.returnZ=d.hasZ,b.returnM=d.hasM;const F=yield d._layer.queryFeatures(b),h=[];return F.features.forEach(o=>{const p=o.attributes[d._layer.objectIdField];h.push(p),d._featureCache[p]=d._changeFeature(o)}),d._wset=new O.Z([],h,!1,null),d._wset})()}_getFeatures(d,b,F){var h=this;return(0,_.Z)(function*(){const o=[];-1!==b&&void 0===h._featureCache[b]&&o.push(b);for(let p=d._lastFetchedIndex;p<d._known.length&&(d._lastFetchedIndex+=1,!(void 0===h._featureCache[d._known[p]]&&(d._known[p]!==b&&o.push(d._known[p]),o.length>F)));p++);if(0===o.length)return"success";throw new V.EN(V.H9.MissingFeatures)})()}_refineSetBlock(d){return(0,_.Z)(function*(){return d})()}_stat(){return(0,_.Z)(function*(){return{calculated:!1}})()}_canDoAggregates(){return(0,_.Z)(function*(){return!1})()}relationshipMetaData(){return[]}static _cloneAttr(d){const b={};for(const F in d)b[F]=d[F];return b}nativeCapabilities(){return{title:this._layer.title??"",canQueryRelated:!1,source:this,capabilities:this._layer.capabilities,databaseType:this._databaseType,requestStandardised:!0}}static create(d,b){let F=d.layerDefinition.objectIdField;const h=d.layerDefinition.typeIdField??"",o=[];if(d.layerDefinition.types)for(const C of d.layerDefinition.types)o.push(N.Z.fromJSON(C));let p=d.layerDefinition.geometryType;void 0===p&&(p=d.featureSet.geometryType||"");let D=d.featureSet.features;const E=b.toJSON();if(!F){let C=!1;for(const A of d.layerDefinition.fields)if("oid"===A.type||"esriFieldTypeOID"===A.type){F=A.name,C=!0;break}if(!1===C){let A="FID",W=!0,se=0;for(;W;){let te=!0;for(const Y of d.layerDefinition.fields)if(Y.name===A){te=!1;break}!0===te?W=!1:(se++,A="FID"+se.toString())}d.layerDefinition.fields.push({type:"esriFieldTypeOID",name:A,alias:A});const le=[];for(let te=0;te<D.length;te++)le.push({geometry:d.featureSet.features[te].geometry,attributes:d.featureSet.features[te].attributes?this._cloneAttr(d.featureSet.features[te].attributes):{}}),le[te].attributes[A]=te;D=le,F=A}}const w=[];for(const C of d.layerDefinition.fields)w.push(C instanceof S.Z?C:S.Z.fromJSON(C));let B=p;switch(B||(B=""),B){case"esriGeometryPoint":B="point";break;case"esriGeometryPolyline":B="polyline";break;case"esriGeometryPolygon":B="polygon";break;case"esriGeometryEnvelope":B="extent";break;case"esriGeometryMultipoint":B="multipoint";break;case"":case"esriGeometryNull":B="esriGeometryNull"}if("esriGeometryNull"!==B)for(const C of D)C.geometry&&!(C.geometry instanceof I.Z)&&(C.geometry.type=B,void 0===C.geometry.spatialReference&&(C.geometry.spatialReference=E));else for(const C of D)C.geometry&&(C.geometry=null);const G={outFields:["*"],source:D,fields:w,hasZ:!0===d?.layerDefinition?.hasZ||!0===d?.featureSet?.hasZ,hasM:!0===d?.layerDefinition?.hasM||!0===d?.featureSet?.hasM,types:o,typeIdField:h,objectIdField:F,spatialReference:b},M="esriGeometryNull"===B||null===B;M||(G.geometryType=B);const k=new y.default(G);return new v({layer:k,spatialReference:b,isTable:M})}queryAttachments(){return(0,_.Z)(function*(){return[]})()}getFeatureByObjectId(d){var b=this;return(0,_.Z)(function*(){const F=new c.Z;F.where=b.objectIdField+"="+d.toString(),F.returnZ=b.hasZ,F.returnM=b.hasM;const h=yield b._layer.queryFeatures(F);return 1===h.features.length?h.features[0]:null})()}getOwningSystemUrl(){return(0,_.Z)(function*(){return""})()}getIdentityUser(){return(0,_.Z)(function*(){return""})()}get preferredTimeZone(){return this._layer.preferredTimeZone??null}get dateFieldsTimeZone(){return this._layer.dateFieldsTimeZone??null}get datesInUnknownTimezone(){return this._layer?.datesInUnknownTimezone}get editFieldsInfo(){return this._layer?.editFieldsInfo}get timeInfo(){return this._layer?.timeInfo}getFeatureSetInfo(){var d=this;return(0,_.Z)(function*(){const b=d._layer.title&&d._layer.parent;return d.fsetInfo??{layerId:null,layerName:null,itemId:null,serviceLayerUrl:null,webMapLayerId:b?d._layer.id??null:null,webMapLayerTitle:b?d._layer.title??null:null,className:null,objectClassId:null}})()}}},57366:(ae,X,f)=>{function _(V,x){return V===x?0:null===V?-1:null===x?1:V<x?-1:1}f.d(X,{Z:()=>J});class J{constructor(x){const O=x.split(",");this._fields=[],this._directions=[];for(let U=0;U<O.length;U++){const P=O[U].match(/\S+/g);this._fields.push(P[0]),2===P.length?"asc"===P[1].toLowerCase()?this._directions.push(1):this._directions.push(0):this._directions.push(1)}}constructClause(){let x="";for(let O=0;O<this._fields.length;O++)0!==O&&(x+=","),x+=this._fields[O],x+=1===this._directions[O]?" ASC":" DESC";return x}order(x){x.sort((O,U)=>{for(let P=0;P<this._fields.length;P++){const I=this.featureValue(O.feature,this._fields[P],P),y=this.featureValue(U.feature,this._fields[P],P);let R=0;if(R=1===this._directions[P]?_(I,y):-1*_(I,y),0!==R)return R}return 0})}scanForField(x){for(let O=0;O<this._fields.length;O++)if(this._fields[O].toLowerCase().trim()===x.toLowerCase().trim())return!0;return!1}replaceFields(x){let O="";for(let U=0;U<this._fields.length;U++){0!==U&&(O+=",");let P=this._fields[U];for(const I of x)if(P.toLowerCase()===I.field.toLowerCase()){P=I.newfield;break}O+=P,O+=1===this._directions[U]?" ASC":" DESC"}return new J(O)}featureValue(x,O,U){const P=x.attributes[O];if(void 0!==P)return P;for(const I in x.attributes)if(O.toLowerCase()===I.toLowerCase())return this._fields[U]=I,x.attributes[I];return null}}},87183:(ae,X,f)=>{f.d(X,{Z:()=>c});var R,_=f(17626),J=f(86810),V=f(77712),x=f(90912),P=(f(85931),f(8314),f(76898));const N={1:{id:1,rotation:0,mirrored:!1},2:{id:2,rotation:0,mirrored:!0},3:{id:3,rotation:180,mirrored:!1},4:{id:4,rotation:180,mirrored:!0},5:{id:5,rotation:-90,mirrored:!0},6:{id:6,rotation:90,mirrored:!1},7:{id:7,rotation:90,mirrored:!0},8:{id:8,rotation:-90,mirrored:!1}};let S=R=class extends J.wq{constructor(v){super(v),this.contentType=null,this.exifInfo=null,this.id=null,this.globalId=null,this.keywords=null,this.name=null,this.parentGlobalId=null,this.parentObjectId=null,this.size=null,this.url=null}get orientationInfo(){const{exifInfo:v}=this,Z=function I(v){const{exifInfo:Z,exifName:d,tagName:b}=v;if(!Z||!d||!b)return null;const F=Z.find(h=>h.name===d);return F?function y(v){const{tagName:Z,tags:d}=v;return d&&Z&&d.find(F=>F.name===Z)?.value||null}({tagName:b,tags:F.tags}):null}({exifName:"Exif IFD0",tagName:"Orientation",exifInfo:v});return N[Z]||null}clone(){return new R({contentType:this.contentType,exifInfo:this.exifInfo,id:this.id,globalId:this.globalId,keywords:this.keywords,name:this.name,parentGlobalId:this.parentGlobalId,parentObjectId:this.parentObjectId,size:this.size,url:this.url})}};(0,_._)([(0,V.Cb)({type:String})],S.prototype,"contentType",void 0),(0,_._)([(0,V.Cb)()],S.prototype,"exifInfo",void 0),(0,_._)([(0,V.Cb)({readOnly:!0})],S.prototype,"orientationInfo",null),(0,_._)([(0,V.Cb)({type:x.z8})],S.prototype,"id",void 0),(0,_._)([(0,V.Cb)({type:String})],S.prototype,"globalId",void 0),(0,_._)([(0,V.Cb)({type:String})],S.prototype,"keywords",void 0),(0,_._)([(0,V.Cb)({type:String})],S.prototype,"name",void 0),(0,_._)([(0,V.Cb)({json:{read:!1}})],S.prototype,"parentGlobalId",void 0),(0,_._)([(0,V.Cb)({json:{read:!1}})],S.prototype,"parentObjectId",void 0),(0,_._)([(0,V.Cb)({type:x.z8})],S.prototype,"size",void 0),(0,_._)([(0,V.Cb)({json:{read:!1}})],S.prototype,"url",void 0),S=R=(0,_._)([(0,P.j)("esri.layers.support.AttachmentInfo")],S);const c=S}}]);