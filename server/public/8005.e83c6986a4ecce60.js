"use strict";(self.webpackChunkCRIS=self.webpackChunkCRIS||[]).push([[8005],{50011:(ke,me,p)=>{p.d(me,{F:()=>Pe,M:()=>h});const h={Base64:0,Hex:1,String:2,Raw:3},d=8,$=(1<<d)-1;function V(g,j){const y=(65535&g)+(65535&j);return(g>>16)+(j>>16)+(y>>16)<<16|65535&y}function pe(g,j,y,c,f,m){return V(function K(g,j){return g<<j|g>>>32-j}(V(V(j,g),V(c,m)),f),y)}function A(g,j,y,c,f,m,_){return pe(j&y|~j&c,g,j,f,m,_)}function I(g,j,y,c,f,m,_){return pe(j&c|y&~c,g,j,f,m,_)}function Y(g,j,y,c,f,m,_){return pe(j^y^c,g,j,f,m,_)}function le(g,j,y,c,f,m,_){return pe(y^(j|~c),g,j,f,m,_)}function Pe(g,j=h.Hex){const y=j||h.Base64,c=function be(g,j){g[j>>5]|=128<<j%32,g[14+(j+64>>>9<<4)]=j;let y=1732584193,c=-271733879,f=-1732584194,m=271733878;for(let _=0;_<g.length;_+=16){const xe=y,Me=c,Se=f,he=m;y=A(y,c,f,m,g[_],7,-680876936),m=A(m,y,c,f,g[_+1],12,-389564586),f=A(f,m,y,c,g[_+2],17,606105819),c=A(c,f,m,y,g[_+3],22,-1044525330),y=A(y,c,f,m,g[_+4],7,-176418897),m=A(m,y,c,f,g[_+5],12,1200080426),f=A(f,m,y,c,g[_+6],17,-1473231341),c=A(c,f,m,y,g[_+7],22,-45705983),y=A(y,c,f,m,g[_+8],7,1770035416),m=A(m,y,c,f,g[_+9],12,-1958414417),f=A(f,m,y,c,g[_+10],17,-42063),c=A(c,f,m,y,g[_+11],22,-1990404162),y=A(y,c,f,m,g[_+12],7,1804603682),m=A(m,y,c,f,g[_+13],12,-40341101),f=A(f,m,y,c,g[_+14],17,-1502002290),c=A(c,f,m,y,g[_+15],22,1236535329),y=I(y,c,f,m,g[_+1],5,-165796510),m=I(m,y,c,f,g[_+6],9,-1069501632),f=I(f,m,y,c,g[_+11],14,643717713),c=I(c,f,m,y,g[_],20,-373897302),y=I(y,c,f,m,g[_+5],5,-701558691),m=I(m,y,c,f,g[_+10],9,38016083),f=I(f,m,y,c,g[_+15],14,-660478335),c=I(c,f,m,y,g[_+4],20,-405537848),y=I(y,c,f,m,g[_+9],5,568446438),m=I(m,y,c,f,g[_+14],9,-1019803690),f=I(f,m,y,c,g[_+3],14,-187363961),c=I(c,f,m,y,g[_+8],20,1163531501),y=I(y,c,f,m,g[_+13],5,-1444681467),m=I(m,y,c,f,g[_+2],9,-51403784),f=I(f,m,y,c,g[_+7],14,1735328473),c=I(c,f,m,y,g[_+12],20,-1926607734),y=Y(y,c,f,m,g[_+5],4,-378558),m=Y(m,y,c,f,g[_+8],11,-2022574463),f=Y(f,m,y,c,g[_+11],16,1839030562),c=Y(c,f,m,y,g[_+14],23,-35309556),y=Y(y,c,f,m,g[_+1],4,-1530992060),m=Y(m,y,c,f,g[_+4],11,1272893353),f=Y(f,m,y,c,g[_+7],16,-155497632),c=Y(c,f,m,y,g[_+10],23,-1094730640),y=Y(y,c,f,m,g[_+13],4,681279174),m=Y(m,y,c,f,g[_],11,-358537222),f=Y(f,m,y,c,g[_+3],16,-722521979),c=Y(c,f,m,y,g[_+6],23,76029189),y=Y(y,c,f,m,g[_+9],4,-640364487),m=Y(m,y,c,f,g[_+12],11,-421815835),f=Y(f,m,y,c,g[_+15],16,530742520),c=Y(c,f,m,y,g[_+2],23,-995338651),y=le(y,c,f,m,g[_],6,-198630844),m=le(m,y,c,f,g[_+7],10,1126891415),f=le(f,m,y,c,g[_+14],15,-1416354905),c=le(c,f,m,y,g[_+5],21,-57434055),y=le(y,c,f,m,g[_+12],6,1700485571),m=le(m,y,c,f,g[_+3],10,-1894986606),f=le(f,m,y,c,g[_+10],15,-1051523),c=le(c,f,m,y,g[_+1],21,-2054922799),y=le(y,c,f,m,g[_+8],6,1873313359),m=le(m,y,c,f,g[_+15],10,-30611744),f=le(f,m,y,c,g[_+6],15,-1560198380),c=le(c,f,m,y,g[_+13],21,1309151649),y=le(y,c,f,m,g[_+4],6,-145523070),m=le(m,y,c,f,g[_+11],10,-1120210379),f=le(f,m,y,c,g[_+2],15,718787259),c=le(c,f,m,y,g[_+9],21,-343485551),y=V(y,xe),c=V(c,Me),f=V(f,Se),m=V(m,he)}return[y,c,f,m]}(function M(g){const j=[];for(let y=0,c=g.length*d;y<c;y+=d)j[y>>5]|=(g.charCodeAt(y/d)&$)<<y%32;return j}(g),g.length*d);switch(y){case h.Raw:return c;case h.Hex:return function ge(g){const j="0123456789abcdef",y=[];for(let c=0,f=4*g.length;c<f;c++)y.push(j.charAt(g[c>>2]>>c%4*8+4&15)+j.charAt(g[c>>2]>>c%4*8&15));return y.join("")}(c);case h.String:return function ue(g){const j=[];for(let y=0,c=32*g.length;y<c;y+=d)j.push(String.fromCharCode(g[y>>5]>>>y%32&$));return j.join("")}(c);case h.Base64:return function u(g){const c=[];for(let f=0,m=4*g.length;f<m;f+=3){const _=(g[f>>2]>>f%4*8&255)<<16|(g[f+1>>2]>>(f+1)%4*8&255)<<8|g[f+2>>2]>>(f+2)%4*8&255;for(let xe=0;xe<4;xe++)c.push(8*f+6*xe>32*g.length?"=":"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(_>>6*(3-xe)&63))}return c.join("")}(c)}}},28005:(ke,me,p)=>{p.r(me),p.d(me,{default:()=>zn});var h=p(15861),d=p(17626),V=(p(29132),p(74333)),M=p(26584),ue=p(63290),ge=p(10699),u=p(77712),A=(p(90912),p(85931),p(8314)),I=p(76898),Y=p(83274),le=p(44917),be=p(82054),Pe=p(88071),g=p(83761),j=p(88159),y=p(95737),c=p(37118),f=p(5464),m=p(37053),_=p(66385),xe=p(91179);class he{constructor(){this._featureLookup=new Map}static getInstance(){return he.instance||(he.instance=new he),he.instance}static resetInstance(){he.instance&&(he.instance=null)}deleteFromStore(t){t.forEach(o=>{this._featureLookup.delete(o)})}readFromStoreByList(t){const o=[];return t.forEach(i=>{const a=this.readFromStoreById(i);a&&o.push(a)}),o}readFromStoreById(t){return this._featureLookup.get(t)??null}writeToStore(t,o,i){const a=[];return t.forEach(s=>{if(!s?.id)return;s.properties||(s.properties=[]);let l,v=null;if(i&&s.properties[i]&&(v=(0,be.GH)(s.properties[i])),"originId"in s&&"destinationId"in s&&(s.properties.ESRI__ORIGIN_ID=s.originId,s.properties.ESRI__DESTINATION_ID=s.destinationId),s.properties[o]=s.id,s.id&&this._featureLookup.has(s.id)&&this._featureLookup.get(s.id).attributes){const E=this._featureLookup.get(s.id),b=JSON.parse(JSON.stringify(Object.assign(E.attributes,s.properties)));i&&s.properties[i]&&(b[i]=(0,xe.im)(s.properties[i])),l=new _.u_(v?JSON.parse(JSON.stringify(v)):E?.geometry?JSON.parse(JSON.stringify(E.geometry)):null,b,null,s.properties[o])}else l=new _.u_(v?JSON.parse(JSON.stringify(v)):null,s.properties,null,s.properties[o]);this._featureLookup.set(s.id,l),a.push(l)}),a}}var Re=p(24263),Ce=p(84792);let x=class extends g.Z{constructor(e){super(e),this.resultRows=[]}};(0,d._)([(0,u.Cb)()],x.prototype,"resultRows",void 0),x=(0,d._)([(0,I.j)("esri.rest.knowledgeGraph.GraphQueryResult")],x);const U=x;let k=class extends g.Z{constructor(e){super(e),this.resultRowsStream=new ReadableStream}};(0,d._)([(0,u.Cb)()],k.prototype,"resultRowsStream",void 0),k=(0,d._)([(0,I.j)("esri.rest.knowledgeGraph.GraphQueryResult")],k);const ae=k;var re=p(86810),S=p(65234);let W=class extends re.wq{constructor(e){super(e),this.name=null,this.unique=null,this.ascending=null,this.description=null,this.fieldNames=null}};(0,d._)([(0,u.Cb)({type:String,json:{write:!0}})],W.prototype,"name",void 0),(0,d._)([(0,u.Cb)({type:Boolean,json:{write:!0}})],W.prototype,"unique",void 0),(0,d._)([(0,u.Cb)({type:Boolean,json:{write:!0}})],W.prototype,"ascending",void 0),(0,d._)([(0,u.Cb)({type:String,json:{write:!0}})],W.prototype,"description",void 0),(0,d._)([(0,u.Cb)({type:[String],json:{write:!0}})],W.prototype,"fieldNames",void 0),W=(0,d._)([(0,I.j)("esri.rest.knowledgeGraph.FieldIndex")],W);const Oe=W;let z=class extends re.wq{constructor(e){super(e),this.name=null,this.alias=null,this.fieldType=null,this.geometryType=null,this.hasM=null,this.hasZ=null,this.nullable=null,this.editable=null,this.required=null,this.defaultVisibility=null,this.systemMaintained=null,this.role=null,this.defaultValue=null}};(0,d._)([(0,u.Cb)({type:String,json:{write:!0}})],z.prototype,"name",void 0),(0,d._)([(0,u.Cb)({type:String,json:{write:!0}})],z.prototype,"alias",void 0),(0,d._)([(0,u.Cb)({type:String,json:{write:!0}})],z.prototype,"fieldType",void 0),(0,d._)([(0,u.Cb)({type:String,json:{write:!0}})],z.prototype,"geometryType",void 0),(0,d._)([(0,u.Cb)({type:Boolean,json:{write:!0}})],z.prototype,"hasM",void 0),(0,d._)([(0,u.Cb)({type:Boolean,json:{write:!0}})],z.prototype,"hasZ",void 0),(0,d._)([(0,u.Cb)({type:Boolean,json:{write:!0}})],z.prototype,"nullable",void 0),(0,d._)([(0,u.Cb)({type:Boolean,json:{write:!0}})],z.prototype,"editable",void 0),(0,d._)([(0,u.Cb)({type:Boolean,json:{write:!0}})],z.prototype,"required",void 0),(0,d._)([(0,u.Cb)({type:Boolean,json:{write:!0}})],z.prototype,"defaultVisibility",void 0),(0,d._)([(0,u.Cb)({type:Boolean,json:{write:!0}})],z.prototype,"systemMaintained",void 0),(0,d._)([(0,u.Cb)()],z.prototype,"role",void 0),(0,d._)([(0,u.Cb)({type:Object,json:{type:String,write:{writer:(e,t)=>{t.defaultValue=null!=e?e.toString():null}}}})],z.prototype,"defaultValue",void 0),z=(0,d._)([(0,I.j)("esri.rest.knowledgeGraph.GraphProperty")],z);const Je=z;let J=class extends re.wq{constructor(e){super(e),this.name=null,this.alias=null,this.role=null,this.strict=null,this.properties=null,this.fieldIndexes=null}};(0,d._)([(0,u.Cb)({type:String,json:{write:!0}})],J.prototype,"name",void 0),(0,d._)([(0,u.Cb)({type:String,json:{write:!0}})],J.prototype,"alias",void 0),(0,d._)([(0,u.Cb)({type:String,json:{write:!0}})],J.prototype,"role",void 0),(0,d._)([(0,u.Cb)({type:Boolean,json:{write:!0}})],J.prototype,"strict",void 0),(0,d._)([(0,u.Cb)({type:[Je],json:{write:!0}})],J.prototype,"properties",void 0),(0,d._)([(0,u.Cb)({type:[Oe],json:{write:!0}})],J.prototype,"fieldIndexes",void 0),J=(0,d._)([(0,I.j)("esri.rest.knowledgeGraph.GraphObjectType")],J);const Xe=J;let ze=class extends Xe{constructor(e){super(e)}};ze=(0,d._)([(0,I.j)("esri.rest.knowledgeGraph.EntityType")],ze);const Be=ze;let Qe=class extends Xe{constructor(e){super(e),this.endPoints=[]}};(0,d._)([(0,u.Cb)()],Qe.prototype,"endPoints",void 0),Qe=(0,d._)([(0,I.j)("esri.rest.knowledgeGraph.RelationshipType")],Qe);const qe=Qe;let we=class extends re.wq{constructor(e){super(e),this.timestamp=null,this.spatialReference=null,this.strict=null,this.objectIdField=null,this.globalIdField=null,this.arcgisManaged=null,this.identifierInfo=null,this.searchIndexes=null,this.entityTypes=null,this.relationshipTypes=null}};(0,d._)([(0,u.Cb)({type:Date,json:{type:Number,write:{writer:(e,t)=>{t.timestamp=e?.getTime()}}}})],we.prototype,"timestamp",void 0),(0,d._)([(0,u.Cb)({type:S.Z,json:{write:!0}})],we.prototype,"spatialReference",void 0),(0,d._)([(0,u.Cb)({type:Boolean,json:{write:!0}})],we.prototype,"strict",void 0),(0,d._)([(0,u.Cb)({type:String,json:{write:!0}})],we.prototype,"objectIdField",void 0),(0,d._)([(0,u.Cb)({type:String,json:{write:!0}})],we.prototype,"globalIdField",void 0),(0,d._)([(0,u.Cb)()],we.prototype,"arcgisManaged",void 0),(0,d._)([(0,u.Cb)()],we.prototype,"identifierInfo",void 0),(0,d._)([(0,u.Cb)()],we.prototype,"searchIndexes",void 0),(0,d._)([(0,u.Cb)({type:[Be],json:{write:!0}})],we.prototype,"entityTypes",void 0),(0,d._)([(0,u.Cb)({type:[qe],json:{write:!0}})],we.prototype,"relationshipTypes",void 0),we=(0,d._)([(0,I.j)("esri.rest.knowledgeGraph.DataModel")],we);const ie=we;let F=class extends re.wq{constructor(e){super(e),this.capabilities=[],this.supportsSearch=!1,this.supportedQueryFormats=[],this.allowGeometryUpdates=!1,this.searchMaxRecordCount=null,this.serviceCapabilities=null,this.maxRecordCount=null,this.description="",this.copyrightText="",this.units="",this.spatialReference=null,this.currentVersion=null,this.dateFieldsTimeReference=null,this.serviceItemId="",this.supportsDocuments=!1,this.dataEditingNotSupported=!1,this.schemaEditingNotSupported=!1}};(0,d._)([(0,u.Cb)({type:[String],json:{write:!0}})],F.prototype,"capabilities",void 0),(0,d._)([(0,u.Cb)({type:Boolean,json:{write:!0}})],F.prototype,"supportsSearch",void 0),(0,d._)([(0,u.Cb)({type:[String],json:{write:!0}})],F.prototype,"supportedQueryFormats",void 0),(0,d._)([(0,u.Cb)({type:Boolean,json:{write:!0}})],F.prototype,"allowGeometryUpdates",void 0),(0,d._)([(0,u.Cb)({type:Number,json:{write:!0}})],F.prototype,"searchMaxRecordCount",void 0),(0,d._)([(0,u.Cb)({type:Object,json:{write:!0}})],F.prototype,"serviceCapabilities",void 0),(0,d._)([(0,u.Cb)({type:Number,json:{write:!0}})],F.prototype,"maxRecordCount",void 0),(0,d._)([(0,u.Cb)({type:String,json:{write:!0}})],F.prototype,"description",void 0),(0,d._)([(0,u.Cb)({type:String,json:{write:!0}})],F.prototype,"copyrightText",void 0),(0,d._)([(0,u.Cb)({type:String,json:{write:!0}})],F.prototype,"units",void 0),(0,d._)([(0,u.Cb)({type:Object,json:{write:!0}})],F.prototype,"spatialReference",void 0),(0,d._)([(0,u.Cb)({type:Number,json:{write:!0}})],F.prototype,"currentVersion",void 0),(0,d._)([(0,u.Cb)({type:Object,json:{write:!0}})],F.prototype,"dateFieldsTimeReference",void 0),(0,d._)([(0,u.Cb)({type:String,json:{write:!0}})],F.prototype,"serviceItemId",void 0),(0,d._)([(0,u.Cb)({type:Boolean,json:{write:!0}})],F.prototype,"supportsDocuments",void 0),(0,d._)([(0,u.Cb)({type:Boolean,json:{write:!0}})],F.prototype,"dataEditingNotSupported",void 0),(0,d._)([(0,u.Cb)({type:Boolean,json:{write:!0}})],F.prototype,"schemaEditingNotSupported",void 0),F=(0,d._)([(0,I.j)("esri.rest.knowledgeGraph.ServiceDefinition")],F);const X=F;let N=class extends re.wq{constructor(e){super(e),this.dataModel=null,this.serviceDefinition=null}};(0,d._)([(0,u.Cb)({type:String,json:{write:!0}})],N.prototype,"url",void 0),(0,d._)([(0,u.Cb)({type:ie,json:{write:!0}})],N.prototype,"dataModel",void 0),(0,d._)([(0,u.Cb)({type:X,json:{write:!0}})],N.prototype,"serviceDefinition",void 0),N=(0,d._)([(0,I.j)("esri.rest.knowledgeGraph.KnowledgeGraph")],N);const ve=N;var Ge=p(54346);const st="esri/rest/knowledgeGraph/wasmInterface/";let et,_t=null;function Fe(){return Et.apply(this,arguments)}function Et(){return Et=(0,h.Z)(function*(){const e=_t??et;if(e)return e;const t=(0,A.Z)("wasm-simd");return et=function Ar(e){return wt.apply(this,arguments)}(t),et}),Et.apply(this,arguments)}function wt(){return(wt=(0,h.Z)(function*(e){if(e){const{default:o}=yield p.e(4133).then(p.bind(p,94133)).then(i=>i.a);return o({locateFile:i=>(0,Ge.V)(st+i)})}const{default:t}=yield p.e(6908).then(p.bind(p,36908)).then(o=>o.a);return t({locateFile:o=>(0,Ge.V)(st+o)})})).apply(this,arguments)}var fr=p(72854),tt=p(72642),Ne=p(55214),Tt=p(21674);function mr(e,t){const o=new t.ArrayValue;return o.deleteLater(),e.forEach(i=>{o.add_value(Mt(i,t))}),o}function gr(e,t){const o=new t.ObjectValue;o.deleteLater();for(const[i,a]of Object.entries(e))o.set_key_value(i,Mt(a,t));return o}function xt(e,t){if(e instanceof fr.Z)return function Br(e,t){const o=new t.GeometryValue;o.deleteLater(),o.geometry_type=o.geometry_type=t.esriGeometryType.esriGeometryMultipoint,o.has_z=e.hasZ,o.has_m=e.hasM;const i=[],a=[];a[0]=e.points.length;let s=0;return e.points.forEach(l=>{l.forEach(v=>{i[s]=v,s++})}),o.coords=new Float64Array(i),o.lengths=new Uint32Array(a),o}(e,t);if(e instanceof tt.Z)return function Qr(e,t){const o=new t.GeometryValue;o.deleteLater(),o.geometry_type=t.esriGeometryType.esriGeometryPoint,o.has_z=e.hasZ,o.has_m=e.hasM;const i=[],a=[];a[0]=1,i[0]=e.x,i[1]=e.y;let s=2;return e.hasZ&&(i[s]=e.z,s++),e.hasM&&(i[s]=e.m,s++),o.coords=new Float64Array(i),o.lengths=new Uint32Array(a),o}(e,t);if(e instanceof Ne.Z||e instanceof c.Z)return function zr(e,t){const o=new t.GeometryValue;o.deleteLater(),o.has_z=e.hasZ,o.has_m=e.hasM;const i=[],a=[];let s=[];e instanceof Ne.Z?(o.geometry_type=t.esriGeometryType.esriGeometryPolyline,s=e.paths):e instanceof c.Z&&(o.geometry_type=t.esriGeometryType.esriGeometryPolygon,s=e.rings);let l=0,v=0;return s.forEach(E=>{let b=0;E.forEach(w=>{b++,w.forEach(G=>{i[v]=G,v++})}),a[l]=b,l++}),o.coords=new Float64Array(i),o.lengths=new Uint32Array(a),o}(e,t);throw new M.Z("knowledge-graph:unsupported-geometry","Only Point, Multipoint, Polyline, and Polygon geometry are supported by ArcGIS Knowledge",{geometry:e})}function Mt(e,t){if(null==e)return"";if("object"!=typeof e||e instanceof Date)return e;if(e instanceof Tt.Z)return xt(e,t);if(Array.isArray(e)){const o=new t.ArrayValue;return o.deleteLater(),e.forEach(i=>{o.add_value(Mt(i,t))}),o}return gr(e,t)}let lt=class extends re.wq{constructor(e){super(e),this.properties=null}};(0,d._)([(0,u.Cb)({json:{write:!0}})],lt.prototype,"properties",void 0),lt=(0,d._)([(0,I.j)("esri.rest.knowledgeGraph.GraphObject")],lt);const It=lt;let rt=class extends It{constructor(e){super(e),this.typeName=null,this.id=null}};(0,d._)([(0,u.Cb)({type:String,json:{write:!0}})],rt.prototype,"typeName",void 0),(0,d._)([(0,u.Cb)({type:String,json:{write:!0}})],rt.prototype,"id",void 0),rt=(0,d._)([(0,I.j)("esri.rest.knowledgeGraph.GraphNamedObject")],rt);const br=rt;let pt=class extends br{constructor(e){super(e),this.layoutGeometry=null}};(0,d._)([(0,u.Cb)({type:tt.Z,json:{write:!0}})],pt.prototype,"layoutGeometry",void 0),pt=(0,d._)([(0,I.j)("esri.rest.knowledgeGraph.Entity")],pt);const vr=pt;let We=class extends br{constructor(e){super(e),this.originId=null,this.destinationId=null,this.layoutGeometry=null}};(0,d._)([(0,u.Cb)({type:String,json:{write:!0}})],We.prototype,"originId",void 0),(0,d._)([(0,u.Cb)({type:String,json:{write:!0}})],We.prototype,"destinationId",void 0),(0,d._)([(0,u.Cb)({type:Ne.Z,json:{write:!0}})],We.prototype,"layoutGeometry",void 0),We=(0,d._)([(0,I.j)("esri.rest.Relationship.Relationship")],We);const Cr=We;function dt(e,t){if(!e.typeName)throw new M.Z("knowledge-graph:no-type-name","You must indicate the entity/relationship named object type to apply edits");if(e instanceof vr){const o=new t.EntityValue;o.deleteLater(),o.type_name=e.typeName;for(const[i,a]of Object.entries(e.properties))o.set_key_value(i,_r(a,t));return e.id&&o.set_id(e.id),o}if(e instanceof Cr){const o=new t.RelationshipValue;o.deleteLater(),o.type_name=e.typeName;for(const[i,a]of Object.entries(e.properties))o.set_key_value(i,_r(a,t));return e.id&&o.set_id(e.id),e.originId&&e.destinationId&&o.set_related_entity_ids(e.originId,e.destinationId),o}throw new M.Z("knowledge-graph:applyEdits-encoding-failure","Could not determine the type of a named graph object passed to the encoder")}function _r(e,t){return null==e?"":"object"!=typeof e||e instanceof Date?e:e instanceof Tt.Z?xt(e,t):""}let Ae=class extends g.Z{constructor(e){super(e),this.name=null,this.supportedCategory=null,this.analyzers=[],this.searchProperties=new Map}};(0,d._)([(0,u.Cb)()],Ae.prototype,"name",void 0),(0,d._)([(0,u.Cb)()],Ae.prototype,"supportedCategory",void 0),(0,d._)([(0,u.Cb)()],Ae.prototype,"analyzers",void 0),(0,d._)([(0,u.Cb)()],Ae.prototype,"searchProperties",void 0),Ae=(0,d._)([(0,I.j)("esri.rest.knowledgeGraph.SearchIndex")],Ae);const Hr=Ae;var ut,ct,yt,Lt,Dt,St,Rt,e;function Kr(e){return e.deleteLater(),new Be(Gt(e))}function Vr(e){return e.deleteLater(),new Oe({name:e.name,unique:e.unique,ascending:e.ascending,description:e.description,fieldNames:qr(e.fields)})}function Gt(e){return{name:e.name,alias:e.alias,role:ut[e.role.value]?ut[e.role.value]:null,strict:e.strict,properties:en(e.properties),fieldIndexes:tn(e.field_indexes)}}function Yr(e){return e.deleteLater(),new Je({alias:e.alias,name:e.name,fieldType:ct[e.field_type.value]?ct[e.field_type.value]:null,geometryType:yt[e.geometry_type.value]?yt[e.geometry_type.value]:null,hasM:e.has_m,hasZ:e.has_z,nullable:e.nullable,editable:e.editable,required:e.required,defaultVisibility:e.default_visibility,systemMaintained:e.system_maintained,role:St[e.role.value],defaultValue:e.default_value})}function Jr(e){e.deleteLater();const t=Gt(e),o=[];for(let i=0;i<e.end_points.size();i++){const a=e.end_points.get(i);o.push({originEntityType:a.origin_entity_type,destinationEntityType:a.dest_entity_type})}return new qe(Object.assign({endPoints:o},t))}function Xr(e){const t=[];for(let o=0;o<e.size();o++)t.push(Kr(e.get(o)));return t}function qr(e){const t=[];for(let o=0;o<e.size();o++)t.push(e.get(o));return t}function en(e){const t=[];for(let o=0;o<e.size();o++)t.push(Yr(e.get(o)));return t}function tn(e){const t=[];for(let o=0;o<e.size();o++)t.push(Vr(e.get(o)));return t}function rn(e){const t=[];for(let o=0;o<e.size();o++)t.push(Jr(e.get(o)));return t}function nn(e){const t=[];for(let o=0;o<e.size();o++){const i=new Hr,a=e.get(0);i.name=a.name,i.supportedCategory=Dt[a.supported_category.value];const s=a.analyzers.size();for(let l=0;l<s;l++)i.analyzers.push({name:a.analyzers.get(l).name});for(let l=0;l<a.search_properties.keys().size();l++){const v=a.search_properties.keys().get(l),E=a.search_properties.get(v),b=[];for(let w=0;w<E.property_names.size();w++)b.push(E.property_names.get(w));i.searchProperties.set(v,{propertyNames:b})}t.push(i)}return t}(e=ut||(ut={}))[e.Regular=0]="Regular",e[e.Provenance=1]="Provenance",e[e.Document=2]="Document",function(e){e[e.esriFieldTypeSmallInteger=0]="esriFieldTypeSmallInteger",e[e.esriFieldTypeInteger=1]="esriFieldTypeInteger",e[e.esriFieldTypeSingle=2]="esriFieldTypeSingle",e[e.esriFieldTypeDouble=3]="esriFieldTypeDouble",e[e.esriFieldTypeString=4]="esriFieldTypeString",e[e.esriFieldTypeDate=5]="esriFieldTypeDate",e[e.esriFieldTypeOID=6]="esriFieldTypeOID",e[e.esriFieldTypeGeometry=7]="esriFieldTypeGeometry",e[e.esriFieldTypeBlob=8]="esriFieldTypeBlob",e[e.esriFieldTypeRaster=9]="esriFieldTypeRaster",e[e.esriFieldTypeGUID=10]="esriFieldTypeGUID",e[e.esriFieldTypeGlobalID=11]="esriFieldTypeGlobalID",e[e.esriFieldTypeXML=12]="esriFieldTypeXML",e[e.esriFieldTypeBigInteger=13]="esriFieldTypeBigInteger",e[e.esriFieldTypeDateOnly=14]="esriFieldTypeDateOnly",e[e.esriFieldTypeTimeOnly=15]="esriFieldTypeTimeOnly",e[e.esriFieldTypeTimestampOffset=16]="esriFieldTypeTimestampOffset"}(ct||(ct={})),function(e){e[e.esriGeometryNull=0]="esriGeometryNull",e[e.esriGeometryPoint=1]="esriGeometryPoint",e[e.esriGeometryMultipoint=2]="esriGeometryMultipoint",e[e.esriGeometryPolyline=3]="esriGeometryPolyline",e[e.esriGeometryPolygon=4]="esriGeometryPolygon",e[e.esriGeometryEnvelope=5]="esriGeometryEnvelope",e[e.esriGeometryAny=6]="esriGeometryAny",e[e.esriGeometryMultiPatch=7]="esriGeometryMultiPatch"}(yt||(yt={})),function(e){e[e.esriMethodHintUNSPECIFIED=0]="esriMethodHintUNSPECIFIED",e[e.esriUUIDESRI=1]="esriUUIDESRI",e[e.esriUUIDRFC4122=2]="esriUUIDRFC4122"}(Lt||(Lt={})),function(e){e[e.esriTypeUNSPECIFIED=0]="esriTypeUNSPECIFIED",e[e.esriTypeEntity=1]="esriTypeEntity",e[e.esriTypeRelationship=2]="esriTypeRelationship",e[e.esriTypeBoth=4]="esriTypeBoth"}(Dt||(Dt={})),function(e){e[e.esriGraphPropertyUNSPECIFIED=0]="esriGraphPropertyUNSPECIFIED",e[e.esriGraphPropertyRegular=1]="esriGraphPropertyRegular",e[e.esriGraphPropertyDocumentName=2]="esriGraphPropertyDocumentName",e[e.esriGraphPropertyDocumentTitle=3]="esriGraphPropertyDocumentTitle",e[e.esriGraphPropertyDocumentUrl=4]="esriGraphPropertyDocumentUrl",e[e.esriGraphPropertyDocumentText=5]="esriGraphPropertyDocumentText",e[e.esriGraphPropertyDocumentKeywords=6]="esriGraphPropertyDocumentKeywords",e[e.esriGraphPropertyDocumentContentType=7]="esriGraphPropertyDocumentContentType",e[e.esriGraphPropertyDocumentMetadata=8]="esriGraphPropertyDocumentMetadata",e[e.esriGraphPropertyDocumentFileExtension=9]="esriGraphPropertyDocumentFileExtension"}(St||(St={})),function(e){e[e.esriIdentifierInfoTypeUNSPECIFIED=0]="esriIdentifierInfoTypeUNSPECIFIED",e[e.esriIdentifierInfoTypeDatabaseNative=1]="esriIdentifierInfoTypeDatabaseNative",e[e.esriIdentifierInfoTypeUniformProperty=2]="esriIdentifierInfoTypeUniformProperty"}(Rt||(Rt={}));let jt=class extends It{constructor(e){super(e)}};jt=(0,d._)([(0,I.j)("esri.rest.knowledgeGraph.ObjectValue")],jt);const on=jt;let ht=class extends re.wq{constructor(e){super(e),this.path=null}};(0,d._)([(0,u.Cb)({type:[It],json:{write:!0}})],ht.prototype,"path",void 0),ht=(0,d._)([(0,I.j)("esri.rest.knowledgeGraph.Path")],ht);const an=ht;var Ie,Ze,Er;function wr(e){const t={},o=kt(e,t),i=e.lengths,a=e.coords;let s="";if(e.geometry_type.value===Ie.ESRI_GEOMETRY_POLYGON)s="rings";else{if(e.geometry_type.value!==Ie.ESRI_GEOMETRY_POLYLINE)throw new M.Z("KnowledgeGraph:illegal-geometry-type","Illegal Geometry type for multipath conversion");s="paths"}t[s]=[];let l=0;return i.forEach(v=>{const E=[];for(let b=0;b<v;b++){const w=[];for(let G=0;G<o;G++)w[G]=a[l],l++;E.push(w)}t[s].push(E)}),t}function kt(e,t){let o=2;return e.has_z?(t.hasZ=e.has_z,o++):t.hasZ=!1,e.has_m?(t.hasM=e.has_m,o++):t.hasM=!1,o}!function(e){e[e.ESRI_GEOMETRY_NULL=0]="ESRI_GEOMETRY_NULL",e[e.ESRI_GEOMETRY_POINT=1]="ESRI_GEOMETRY_POINT",e[e.ESRI_GEOMETRY_MULTIPOINT=2]="ESRI_GEOMETRY_MULTIPOINT",e[e.ESRI_GEOMETRY_POLYLINE=3]="ESRI_GEOMETRY_POLYLINE",e[e.ESRI_GEOMETRY_POLYGON=4]="ESRI_GEOMETRY_POLYGON",e[e.ESRI_GEOMETRY_ENVELOPE=5]="ESRI_GEOMETRY_ENVELOPE",e[e.ESRI_GEOMETRY_ANY=6]="ESRI_GEOMETRY_ANY",e[e.ESRI_GEOMETRY_MULTI_PATCH=7]="ESRI_GEOMETRY_MULTI_PATCH"}(Ie||(Ie={})),function(e){e[e.OBJECT=0]="OBJECT",e[e.ENTITY=1]="ENTITY",e[e.RELATIONSHIP=2]="RELATIONSHIP",e[e.PATH=3]="PATH",e[e.ARRAY=4]="ARRAY"}(Ze||(Ze={})),function(e){e[e.view=0]="view",e[e.edit=1]="edit"}(Er||(Er={}));const ft=ue.Z.getLogger("esri.rest.knowledgeGraph.WasmToQueryResponseObjConstructors"),un={decodedWasmObjToQueryResponseObj:(e,t)=>{if(null==e)return null;if("object"!=typeof e||"getDate"in e)return e;if("geometry_type"in e)switch(e.geometry_type.value){case null:return null;case Ie.ESRI_GEOMETRY_POINT:return function ln(e){const t={};let o=2;kt(e,t);const i=e.coords;return t.x=i[0],t.y=i[1],e.has_z&&(t.z=i[o],o++),e.has_m&&(t.m=i[o]),new tt.Z(t)}(e);case Ie.ESRI_GEOMETRY_MULTIPOINT:return function sn(e){const t={},o=kt(e,t),a=e.coords,s=e.lengths[0];t.points=[];let l=0;for(let v=0;v<s;v++){const E=[];for(let b=0;b<o;b++)E[b]=a[l],l++;t.points.push(E)}return new fr.Z(t)}(e);case Ie.ESRI_GEOMETRY_POLYLINE:return function pn(e){return new Ne.Z(wr(e))}(e);case Ie.ESRI_GEOMETRY_POLYGON:return function dn(e){return new c.Z(wr(e))}(e);case Ie.ESRI_GEOMETRY_ENVELOPE:case Ie.ESRI_GEOMETRY_MULTI_PATCH:return ft.warnOnce("Envelope and Multipatch are not supported on knowledge entities, but one of those geometry types was detected. Result interpreted as null"),null;default:return ft.warnOnce("Unknown or blank geometry type returned - Result interpreted as null"),null}else{if(!("object_value_type"in e))return ft.warnOnce("A decoded value came back of a type that is not supported. Result interpreted as null"),null;switch(e.object_value_type.value){case Ze.OBJECT:return function yn(e,t){return new on(mt(e,t))}(e,t);case Ze.ENTITY:return Tr(e,t);case Ze.RELATIONSHIP:return xr(e,t);case Ze.PATH:return function hn(e,t){const o=e.entity_count(),i=e.relationship_count(),a=[];for(let s=0;s<o;s++)a.push(Tr(e.get_entity_at(s),t)),s<i&&a.push(xr(e.get_relationship_at(s),t));return new an({path:a})}(e,t);case Ze.ARRAY:return function cn(e,t){const o=[],i=e.count();for(let a=0;a<i;a++){const s=e.get_value_at(a);o.push(Pt(s,t))}return o}(e,t);default:return ft.warnOnce("Unknown graph object type detected!  Result interpreted as null"),null}}}};function Pt(e,t){return un.decodedWasmObjToQueryResponseObj(e,t)}function Tr(e,t){const o=e.type_name,i=mt(e,t),a=e.get_id();return new vr(Object.assign({typeName:o,id:a},i))}function mt(e,t){const o={},i=e.key_count();for(let a=0;a<i;a++)o[e.get_key_at(a)]=Pt(e.get_value_at(a),t);return{properties:o}}function xr(e,t){const o=e.type_name,i=mt(e,t);return new Cr(Object.assign({typeName:o,id:e.get_id(),originId:e.get_origin_entity_id(),destinationId:e.get_destination_entity_id()},i))}let He=class extends g.Z{constructor(e){super(e),this.hasError=null,this.error=null,this.editResults=[]}};(0,d._)([(0,u.Cb)()],He.prototype,"hasError",void 0),(0,d._)([(0,u.Cb)()],He.prototype,"error",void 0),(0,d._)([(0,u.Cb)()],He.prototype,"editResults",void 0),He=(0,d._)([(0,I.j)("esri.rest.knowledgeGraph.GraphApplyEdits")],He);const fn=He,je={fetchKnowledgeGraph:function(){var e=(0,h.Z)(function*(t){const o=new ve({url:t}),i=[];return i.push(bt(o)),i.push(function bn(e){return Bt.apply(this,arguments)}(o)),yield Promise.all(i),o});return function(o){return e.apply(this,arguments)}}(),refreshDataModel:function(){var e=(0,h.Z)(function*(t){t.dataModel=yield Ir(t)});return function(o){return e.apply(this,arguments)}}(),refreshServiceDefinition:function(){var e=(0,h.Z)(function*(t){const o=(yield(0,Ce.Z)(t.url,{query:{f:"json"}})).data;return o.capabilities=o?.capabilities?.split(","),o.supportedQueryFormats=o?.supportedQueryFormats?.split(","),t.serviceDefinition=new X(o),t.serviceDefinition});return function(o){return e.apply(this,arguments)}}(),executeQueryStreaming:function(){var e=(0,h.Z)(function*(t,o,i){const a=`${t.url}/graph/query`;yield Ht(t);const s=yield Jt(a,i);s.data.body=yield function _n(e,t){return Vt.apply(this,arguments)}(o,t);const l=yield Qt(s.data.url,s.data);if(t.dataModel)return new ae({resultRowsStream:yield Mr(l,t.dataModel)});throw new M.Z("knowledge-graph:undefined-data-model","The KnowledgeGraph supplied did not have a data model")});return function(o,i,a){return e.apply(this,arguments)}}(),executeApplyEdits:function(){var e=(0,h.Z)(function*(t,o,i){if(t.serviceDefinition?.dataEditingNotSupported)throw new M.Z("knowledge-graph:data-editing-not-supported","The Knowledge Graph Service definition indicated that data editing is not supported");const a=`${t.url}/graph/applyEdits`;yield Ht(t);const s=yield Jt(a,i);return s.data.body=yield function Cn(e,t){return Kt.apply(this,arguments)}(o,t),function wn(e){return qt.apply(this,arguments)}(yield Qt(s.data.url,s.data))});return function(o,i,a){return e.apply(this,arguments)}}(),executeQuery:function(){var e=(0,h.Z)(function*(t,o,i){const a=`${t.url}/graph/query`,s=yield(0,Ce.Z)(a,{responseType:"array-buffer",query:{f:"pbf",openCypherQuery:o.openCypherQuery,...i?.query},signal:i?.signal,timeout:i?.timeout}),l=s.getHeader?.("content-type"),v=s.data;if(l?.includes("application/x-protobuf")){const E=new((yield Fe()).GraphQueryDecoder);if(E.deleteLater(),t.dataModel)return new U({resultRows:er(E,v,t.dataModel)});throw new M.Z("knowledge-graph:undefined-data-model","The KnowledgeGraph supplied did not have a data model")}throw new M.Z("knowledge-graph:unexpected-server-response","server returned an unexpected response",{responseType:l,data:s.data})});return function(o,i,a){return e.apply(this,arguments)}}(),executeSearch:function(){var e=(0,h.Z)(function*(t,o,i){const a=o.typeCategoryFilter,s=`${t.url}/graph/search`,l=yield(0,Ce.Z)(s,{responseType:"array-buffer",query:{f:"pbf",searchQuery:`"${o.searchQuery}"`,typeCategoryFilter:a,...i?.query},signal:i?.signal,timeout:i?.timeout}),v=l.getHeader?.("content-type"),E=l.data;if(v?.includes("application/x-protobuf")){const b=new((yield Fe()).GraphQueryDecoder);if(b.deleteLater(),t.dataModel)return new U({resultRows:er(b,E,t.dataModel)});throw new M.Z("knowledge-graph:undefined-data-model","The KnowledgeGraph supplied did not have a data model")}throw new M.Z("knowledge-graph:unexpected-server-response","server returned an unexpected response",{responseType:v,data:l.data})});return function(o,i,a){return e.apply(this,arguments)}}(),executeSearchStreaming:function(){var e=(0,h.Z)(function*(t,o,i){const a=`${t.url}/graph/search`;yield Ht(t);const s=yield Jt(a,i);s.data.body=yield function En(e){return Yt.apply(this,arguments)}(o);const l=yield Qt(s.data.url,s.data);if(t.dataModel)return new ae({resultRowsStream:yield Mr(l,t.dataModel)});throw new M.Z("knowledge-graph:undefined-data-model","The KnowledgeGraph supplied did not have a data model")});return function(o,i,a){return e.apply(this,arguments)}}(),_fetchWrapper:function(){var e=(0,h.Z)(function*(t,o){return fetch(t,o)});return function(o,i){return e.apply(this,arguments)}}()};function gt(e,t,o){return Nt.apply(this,arguments)}function Nt(){return Nt=(0,h.Z)(function*(e,t,o){return je.executeQueryStreaming(e,t,o)}),Nt.apply(this,arguments)}function Ut(){return Ut=(0,h.Z)(function*(e){return je.fetchKnowledgeGraph(e)}),Ut.apply(this,arguments)}function bt(e){return zt.apply(this,arguments)}function zt(){return zt=(0,h.Z)(function*(e){return je.refreshDataModel(e)}),zt.apply(this,arguments)}function Bt(){return Bt=(0,h.Z)(function*(e){return je.refreshServiceDefinition(e)}),Bt.apply(this,arguments)}function Qt(e,t){return Wt.apply(this,arguments)}function Wt(){return Wt=(0,h.Z)(function*(e,t){return je._fetchWrapper(e,t)}),Wt.apply(this,arguments)}function Ht(e){return $t.apply(this,arguments)}function $t(){return $t=(0,h.Z)(function*(e){Re.id?.findCredential(e.url)||(e.dataModel?yield Ir(e):yield bt(e))}),$t.apply(this,arguments)}function nt(e,t,o){if(0!==e.error_code)throw new M.Z(t,o,{errorCode:e.error_code,errorMessage:e.error_message})}function vn(e,t,o,i){null==t?o.set_param_key_value(e,""):"object"!=typeof t||t instanceof Date?o.set_param_key_value(e,t):o.set_param_key_value(e,t instanceof Tt.Z?xt(t,i):t instanceof Array?mr(t,i):gr(t,i))}function Kt(){return Kt=(0,h.Z)(function*(e,t){if(t.dataModel||(yield bt(t)),!t.dataModel)throw new M.Z("knowledge-graph:data-model-undefined","Encoding could not proceed because a data model was not provided and it could not be determined from the service");const o=yield Fe(),i=!!e.options?.cascadeDelete,a=new o.GraphApplyEditsEncoder(o.SpatialReferenceUtil.WGS84(),e.options?.inputQuantizationParameters?function Wr(e){return{xy_resolution:e.xyResolution,x_false_origin:e.xFalseOrigin,y_false_origin:e.yFalseOrigin,z_resolution:e.zResolution,z_false_origin:e.zFalseOrigin,m_resolution:e.mResolution,m_false_origin:e.mFalseOrigin}}(e.options?.inputQuantizationParameters):o.InputQuantizationUtil.WGS84_lossless());a.deleteLater(),a.cascade_delete=i;try{let l;e.entityAdds?.forEach(v=>{l=a.add_entity(dt(v,o)),nt(l,"knowledge-graph:applyEdits-encoding-failed","Attempting to encode the applyEdits - an entity failed to be added to the encoder")}),e.relationshipAdds?.forEach(v=>{if(!v.originId||!v.destinationId)throw new M.Z("knowledge-graph:relationship-origin-destination-missing","When adding a new relationship, you must provide both an origin and destination id on the appropriate class property");l=a.add_relationship(dt(v,o)),nt(l,"knowledge-graph:applyEdits-encoding-failed","Attempting to encode the applyEdits - a relationship failed to be added to the encoder")}),e.entityUpdates?.forEach(v=>{if(!v.id)throw new M.Z("knowledge-graph:entity-id-missing","When updating an entity or relationship, you must specify the id on the class level property");l=a.update_entity(dt(v,o)),nt(l,"knowledge-graph:applyEdits-encoding-failed","Attempting to encode the applyEdits - an entity failed to be added to the encoder")}),e.relationshipUpdates?.forEach(v=>{if(!v.id)throw new M.Z("knowledge-graph:relationship-id-missing","When updating an entity or relationship, you must specify the id on the class level property");l=a.update_relationship(dt(v,o)),nt(l,"knowledge-graph:applyEdits-encoding-failed","Attempting to encode the applyEdits - a relationship failed to be added to the encoder")}),e.entityDeletes?.forEach(v=>{if(!v.typeName)throw new M.Z("knowledge-graph:no-type-name","You must indicate the entity/relationship named object type to apply edits - delete");const E=a.make_delete_helper(v.typeName,!0);E.deleteLater(),v.ids?.forEach(b=>{E.delete_by_id(b)})}),e.relationshipDeletes?.forEach(v=>{if(!v.typeName)throw new M.Z("knowledge-graph:no-type-name","You must indicate the entity/relationship named object type to apply edits - delete");const E=a.make_delete_helper(v.typeName,!1);v.ids?.forEach(b=>{E.delete_by_id(b)})}),a.encode()}catch(l){throw new M.Z("knowledge-graph:applyEdits-encoding-failed","Attempting to encode the applyEdits failed",{error:l})}const s=a.get_encoding_result();return nt(s.error,"knowledge-graph:applyEdits-encoding-failed","Attempting to encode the applyEdits failed"),s.get_byte_buffer()}),Kt.apply(this,arguments)}function Vt(){return Vt=(0,h.Z)(function*(e,t){const o=yield Fe(),i=new o.GraphQueryRequestEncoder;if(i.deleteLater(),i.output_spatial_reference=o.SpatialReferenceUtil.WGS84(),i.open_cypher_query=e.openCypherQuery,e.bindParameters)for(const[s,l]of Object.entries(e.bindParameters))vn(s,l,i,o);if(e.bindGeometryQuantizationParameters)!function Zr(e,t){t.input_quantization_parameters={xy_resolution:e.xyResolution,x_false_origin:e.xFalseOrigin,y_false_origin:e.yFalseOrigin,z_resolution:e.zResolution,z_false_origin:e.zFalseOrigin,m_resolution:e.mResolution,m_false_origin:e.mFalseOrigin}}(e.bindGeometryQuantizationParameters,i);else{if(t.dataModel||(yield bt(t)),4326!==t.dataModel?.spatialReference?.wkid)throw new M.Z("knowledge-graph:SR-quantization-mismatch","If the DataModel indicates a coordinate system other than WGS84, inputQuantizationParameters must be provided to the query encoder");i.input_quantization_parameters=o.InputQuantizationUtil.WGS84_lossless()}e.outputQuantizationParameters&&function Ur(e,t,o){if(!e.extent)throw new M.Z("knowledge-graph:illegal-output-quantization","The Output quantization provided to the encoder had an illegal value as part of its extent",e.extent);if(!e.quantizeMode)throw new M.Z("knowledge-graph:illegal-output-quantization","The Output quantization contained an illegal mode setting",e.quantizeMode);if(!e.tolerance)throw new M.Z("knowledge-graph:illegal-output-quantization","The Output quantization contained an illegal tolerance setting",e.quantizeMode);t.output_quantization_parameters={extent:{xmax:e.extent.xmax,ymax:e.extent.ymax,xmin:e.extent.xmin,ymin:e.extent.ymin},quantize_mode:o.esriQuantizeMode[e.quantizeMode],tolerance:e.tolerance}}(e.outputQuantizationParameters,i,o);try{i.encode()}catch(s){throw new M.Z("knowledge-graph:query-encoding-failed","Attempting to encode the query failed",{error:s})}const a=i.get_encoding_result();if(0!==a.error.error_code)throw new M.Z("knowledge-graph:query-encoding-failed","Attempting to encode the query failed",{errorCode:a.error.error_code,errorMessage:a.error.error_message});return a.get_byte_buffer()}),Vt.apply(this,arguments)}function Yt(){return Yt=(0,h.Z)(function*(e){const t=yield Fe(),o=new t.GraphSearchRequestEncoder;if(o.deleteLater(),o.search_query=e.searchQuery,o.type_category_filter=t.esriNamedTypeCategory[e.typeCategoryFilter],!0===e.returnSearchContext&&(o.return_search_context=e.returnSearchContext),null!=e.start&&e.start>0&&(o.start_index=e.start),null!=e.num&&(o.max_num_results=e.num),null!=e.idsFilter&&Array.isArray(e.idsFilter)&&e.idsFilter.length>0)try{o.set_ids_filter(mr(e.idsFilter,t))}catch(a){throw new M.Z("knowledge-graph:ids-format-error","Attempting to set ids filter failed.  This is usually caused by an incorrectly formatted UUID string",{error:a})}e.namedTypesFilter?.forEach(a=>{o.add_named_type_filter(a)});try{o.encode()}catch(a){throw new M.Z("knowledge-graph:search-encoding-failed","Attempting to encode the search failed",{error:a})}const i=o.get_encoding_result();if(0!==i.error.error_code)throw new M.Z("knowledge-graph:search-encoding-failed","Attempting to get encoding result from the query failed",{errorCode:i.error.error_code,errorMessage:i.error.error_message});return i.get_byte_buffer()}),Yt.apply(this,arguments)}function Jt(e,t){return Xt.apply(this,arguments)}function Xt(){return Xt=(0,h.Z)(function*(e,t){return(0,Ce.Z)(e,{responseType:"native-request-init",method:"post",query:{f:"pbf",...t?.query},body:"x",headers:{"Content-Type":"application/octet-stream"},signal:t?.signal,timeout:t?.timeout})}),Xt.apply(this,arguments)}function qt(){return qt=(0,h.Z)(function*(e){const t=e.headers.get("content-type");if(t?.includes("application/x-protobuf")){const o=yield e.arrayBuffer(),i=new((yield Fe()).GraphApplyEditsDecoder);return i.deleteLater(),i.decode(new Uint8Array(o)),function mn(e){const t=new fn;t.hasError=e.has_error(),t.hasError&&(t.error={errorCode:e.error.error_code,errorMessage:e.error.error_message});const o=e.get_edit_results_count();for(let i=0;i<o;i++){const a=e.get_edit_results_at(i),s=e.get_edit_results_type_name_at(i),l=[],v=[],E=[],b=a.get_add_results_count(),w=a.get_update_results_count(),G=a.get_delete_results_count();for(let Q=0;Q<b;Q++){const L=a.get_add_result_at(Q);l.push({id:L.id,error:{errorCode:L.error.error_code,errorMessage:L.error.error_message}})}for(let Q=0;Q<w;Q++){const L=a.get_update_result_at(Q);v.push({id:L.id,error:{errorCode:L.error.error_code,errorMessage:L.error.error_message}})}for(let Q=0;Q<G;Q++){const L=a.get_delete_result_at(Q);E.push({id:L.id,error:{errorCode:L.error.error_code,errorMessage:L.error.error_message}})}t.editResults.push({typeName:s,adds:l,updates:v,deletes:E})}return t}(i)}throw new M.Z("knowledge-graph:unexpected-server-response","server returned an unexpected response",{responseType:t,data:e.text()})}),qt.apply(this,arguments)}function er(e,t,o){e.push_buffer(new Uint8Array(t));const i=[];let a=0;for(;e.next_row();){a||(a=e.get_header_keys().size());const s=new Array(a);for(let l=0;l<a;l++){const v=e.get_value(l);s[l]=Pt(v,o)}i.push(s)}if(e.has_error())throw new M.Z("knowledge-graph:stream-decoding-error","One or more result rows were not successfully decoded",{errorCode:e.error.error_code,errorMessage:e.error.error_message});return i}function Mr(e,t){return tr.apply(this,arguments)}function tr(){return tr=(0,h.Z)(function*(e,t){const o=e.headers.get("content-type");if(e.headers.get("content-length")&&ue.Z.getLogger("esri.rest.knowledgeGraph.knowledgeGraphService").warnOnce("Found `Content-Length` header when expecting a streaming HTTP response! Please investigate whether all intermediate HTTP proxies and/or load balancers are configured such that they don't forcefully buffer the entire response before returning it to the client. A valid HTTP streaming response should use Chunked Transfer Encoding and not have a Content Length defined."),o?.includes("application/x-protobuf")){const i=e.body?.getReader(),a=new((yield Fe()).GraphQueryDecoder);return a.deleteLater(),new ReadableStream({start:s=>(0,h.Z)(function*(){try{return function l(){return i?.read().then(({done:v,value:E})=>{if(v){let w;if(a.has_error()&&(w=new M.Z("knowledge-graph:stream-decoding-error","One or more result rows were not successfully decoded",{errorCode:a.error.error_code,errorMessage:a.error.error_message})),i.releaseLock(),w)throw s.error(w),w;return void s.close()}const b=er(a,E,t);return b.length>0&&s.enqueue(b),l()})}()}catch(v){i?.releaseLock(),s.error(new M.Z("knowledge-graph:stream-decoding-error","The server returned a valid response, but there was an error decoding the response stream",{error:v})),s.close()}})()})}throw new M.Z("knowledge-graph:unexpected-server-response","server returned an unexpected response",{responseType:o,data:e.text()})}),tr.apply(this,arguments)}function Ir(e){return rr.apply(this,arguments)}function rr(){return rr=(0,h.Z)(function*(e){const t=`${e.url}/dataModel/queryDataModel`,o=yield(0,Ce.Z)(t,{responseType:"array-buffer",query:{f:"pbf"}}),i=o.getHeader?.("content-type"),a=o.data;if(i?.includes("application/x-protobuf")){const s=(yield Fe()).decode_data_model_from_protocol_buffer(new Uint8Array(a));if(!s)throw new M.Z("knowledge-graph:data-model-decode-failure","The server responded to the data model query, but the response failed to be decoded.  This typically occurs when the Knowledge JS API (4.26 or later) is used with an unsupported backend (11.0 or earlier)");return function $r(e){return e.deleteLater(),new ie({timestamp:e.timestamp,spatialReference:new S.Z(e.spatial_reference),strict:e.strict,objectIdField:e.objectid_property,globalIdField:e.globalid_property,arcgisManaged:e.arcgis_managed,identifierInfo:{identifierMappingInfo:{identifierInfoType:Rt[e.identifier_info?.identifier_mapping_info?.identifier_info_type?.value],databaseNativeIdentifier:e.identifier_info?.identifier_mapping_info?.database_native_identifier,uniformPropertyIdentifier:{identifierPropertyName:e.identifier_info?.identifier_mapping_info?.uniform_property_identifier?.identifier_property_name}},identifierGenerationInfo:{uuidMethodHint:Lt[e.identifier_info?.identifier_generation_info?.uuid_method_hint?.value]}},searchIndexes:nn(e.search_indexes),entityTypes:Xr(e.entity_types),relationshipTypes:rn(e.relationship_types)})}(s)}throw new M.Z("knowledge-graph:unexpected-server-response","server returned an unexpected response",{responseType:i,data:o.data})}),rr.apply(this,arguments)}let vt=class extends g.Z{constructor(e){super(e),this.openCypherQuery=""}};(0,d._)([(0,u.Cb)()],vt.prototype,"openCypherQuery",void 0),vt=(0,d._)([(0,I.j)("esri.rest.knowledgeGraph.GraphQuery")],vt);const Tn=vt;let $e=class extends Tn{constructor(e){super(e),this.bindParameters=null,this.bindGeometryQuantizationParameters=null,this.outputQuantizationParameters=null}};(0,d._)([(0,u.Cb)()],$e.prototype,"bindParameters",void 0),(0,d._)([(0,u.Cb)()],$e.prototype,"bindGeometryQuantizationParameters",void 0),(0,d._)([(0,u.Cb)()],$e.prototype,"outputQuantizationParameters",void 0),$e=(0,d._)([(0,I.j)("esri.rest.knowledgeGraph.GraphQueryStreaming")],$e);const ot=$e;function xn(e){if(!e.spatialReference.isWGS84)throw new M.Z("knowledge-graph:layer-support-utils","The extentToInBoundsRings function only supports WGS84 spatial references.");let t;return t=e.xmax>180&&e.xmin<180?[[[e.xmin,e.ymin],[e.xmin,e.ymax],[180,e.ymax],[180,e.ymin],[e.xmin,e.ymin]],[[-180,e.ymin],[-180,e.ymax],[e.xmax-360,e.ymax],[e.xmax-360,e.ymin],[-180,e.ymin]]]:e.xmax>180&&e.xmin>180?[[[e.xmin-360,e.ymin],[e.xmin-360,e.ymax],[e.xmax-360,e.ymax],[e.xmax-360,e.ymin],[e.xmin-360,e.ymin]]]:e.xmax>-180&&e.xmin<-180?[[[e.xmin+360,e.ymin],[e.xmin+360,e.ymax],[180,e.ymax],[180,e.ymin],[e.xmin+360,e.ymin]],[[-180,e.ymin],[-180,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[-180,e.ymin]]]:e.xmax<-180&&e.xmin<-180?[[[e.xmin+360,e.ymin],[e.xmin+360,e.ymax],[e.xmax+360,e.ymax],[e.xmax+360,e.ymin],[e.xmin+360,e.ymin]]]:[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]],t}function nr(){return nr=(0,h.Z)(function*(e,t){const o=[],i=new Map,a=[];if(t.dataModel?.relationshipTypes)for(const s of t.dataModel.relationshipTypes)s.name&&i.set(s.name,[]);for(const s of e)i.has(s.typeName)&&i.get(s.typeName)?.push(s.id);for(const[s,l]of i){if(l.length<1)continue;const v=new ot({openCypherQuery:`MATCH (n)-[r:${s}]->(m) WHERE id(r) in $ids RETURN id(n), labels(n)[0], id(m), labels(m)[0]`,bindParameters:{ids:l}});a.push(gt(t,v).then(function(){var E=(0,h.Z)(function*(b){const w=b.resultRowsStream.getReader();for(;;){const{done:G,value:Q}=yield w.read();if(G)break;for(const L of Q)o.push({id:L[0],typeName:L[1]}),o.push({id:L[2],typeName:L[3]})}});return function(b){return E.apply(this,arguments)}}()))}return yield Promise.all(a),o}),nr.apply(this,arguments)}var Ke=p(96854),it=p(2004);const ne="ESRI__ID",at="ESRI__ORIGIN_ID",or="ESRI__DESTINATION_ID",ce="ESRI__LAYOUT_GEOMETRY",Lr=ue.Z.getLogger("esri.rest.knowledgeGraph.knowledgeGraphLayer.KnowledgeGraphLayerDataManager");let Le=class extends g.Z{constructor(e){super(e),this.inclusionModeDefinition={generateAllSublayers:!0,namedTypeDefinitions:new Map},this.entityTypeNames=new Set,this.relationshipTypeNames=new Set,this.geographicLookup=new Map,this.sublayerCaches=new Map,this.nodeConnectionsLookup=new Map,this.memberIdTypeLookup=new Map,this._processingCacheUpdatesLookup=new Map;const t=new Map;e.knowledgeGraph.dataModel.entityTypes?.forEach(o=>{o.name&&(t.set(o.name,"entity"),this._processingCacheUpdatesLookup.set(o.name,[]),e.inclusionModeDefinition&&!e.inclusionModeDefinition?.generateAllSublayers||this.entityTypeNames.add(o.name),o.properties?.forEach(i=>{i.geometryType&&"esriGeometryNull"!==i.geometryType&&this.geographicLookup.set(o.name,{name:i.name??"",geometryType:i.geometryType})}))}),e.knowledgeGraph.dataModel.relationshipTypes?.forEach(o=>{o.name&&(t.set(o.name,"relationship"),this._processingCacheUpdatesLookup.set(o.name,[]),e.inclusionModeDefinition&&!e.inclusionModeDefinition?.generateAllSublayers||this.relationshipTypeNames.add(o.name),o.properties?.forEach(i=>{i.geometryType&&"esriGeometryNull"!==i.geometryType&&this.geographicLookup.set(o.name,{name:i.name??"",geometryType:i.geometryType})}))}),e.inclusionModeDefinition?.namedTypeDefinitions.forEach((o,i)=>{if("entity"===t.get(i))this.entityTypeNames.add(i);else{if("relationship"!==t.get(i))return Lr.warn(`A named type, ${i}, was in the inclusion list that wasn't in the data model and will be removed`),void e.inclusionModeDefinition?.namedTypeDefinitions.delete(i);this.relationshipTypeNames.add(i)}const a=new Map;o.members?.forEach(s=>{this.memberIdTypeLookup.set(s.id,i);const l=this.getById(s.id);l&&a.set(s.id,l)}),this.sublayerCaches.set(i,a)})}addToLayer(e){e.forEach(({typeName:t,id:o})=>{if(!this.inclusionModeDefinition)throw new M.Z("knowledge-graph:layer-data-manager","You cannot add to a layer's exclusion list if it was not created with an exclusion list originally");if(this.inclusionModeDefinition.namedTypeDefinitions.has(t)){if(this.inclusionModeDefinition.namedTypeDefinitions.has(t)){const i=this.inclusionModeDefinition.namedTypeDefinitions.get(t);i.members||(i.members=new Map),i.members.set(o,{id:o}),this.memberIdTypeLookup.set(o,t)}}else{const i=new Map;i.set(o,{id:o}),this.inclusionModeDefinition.namedTypeDefinitions.set(t,{useAllData:!1,members:i}),this.memberIdTypeLookup.set(o,t)}})}getById(e){return he.getInstance().readFromStoreById(e)}getData(e,t,o){var i=this;return(0,h.Z)(function*(){if(t.objectType.name&&i.inclusionModeDefinition?.namedTypeDefinitions&&i.inclusionModeDefinition.namedTypeDefinitions.size>0&&!i.inclusionModeDefinition.namedTypeDefinitions.has(t.objectType.name))return[];let a;if(a=e||new Ke.Z({where:"1=1",outFields:["*"]}),"link-chart"===t.parentCompositeLayer.type){const s=t.parentCompositeLayer,l=i._processingCacheUpdatesLookup.get(t.objectType.name??""),v=a.outFields,E=a.geometry;let b="",w="";E&&E.extent&&(b=(0,Y.fC)(E.extent.ymin,E.extent.xmin,12),w=(0,Y.fC)(E.extent.ymax,E.extent.xmax,12)),v&&1===v.length&&v[0]===ne&&"1=1"===a.where||(yield Promise.all(l??[]));const G=i.sublayerCaches.has(t.objectType.name??"")?Array.from(i.sublayerCaches.get(t.objectType.name)?.values()):[],Q=[];return G.forEach(L=>{if(L.geometry=s.linkChartDiagramLookup.get(L.attributes[t.objectIdField]),L.attributes[ce]=L.geometry,b&&w){const R=s.linkChartGeohashLookup.get(L.attributes[t.objectIdField]);R?R>=b&&R<=w&&Q.push(L):Q.push(L)}else Q.push(L)}),Q}return i.retrieveDataFromService(a,t,o)})()}getConnectedRecordIds(e){var t=this;return(0,h.Z)(function*(){const o=[],i=[],a=new Map;return e.forEach(s=>{if(t.memberIdTypeLookup.has(s)){const l=t.memberIdTypeLookup.get(s);if(!t.entityTypeNames.has(l))return;a.has(l)?a.get(l)?.push(s):a.set(l,[s])}}),a.forEach((s,l)=>{const v=`MATCH (n:${l})-[r]-(m) WHERE id(n) IN $ids RETURN id(r), type(r), id(m), labels(m)[0]`,E=new Promise(b=>{(0,h.Z)(function*(){const w=(yield gt(t.knowledgeGraph,new ot({openCypherQuery:v,bindParameters:{ids:s}}))).resultRowsStream.getReader();try{for(;;){const{done:G,value:Q}=yield w.read();if(G)break;for(let L=0;L<Q.length;L++){const R=Q[L];o.push({id:R[0],typeName:R[1]}),o.push({id:R[2],typeName:R[3]})}}}catch(G){if("AbortError"!==G.name)throw G;Lr.info("Request aborted as expected")}})().then(()=>{b()})});i.push(E)}),yield Promise.all(i),o})()}refreshCacheContent(e,t,o,i=!0){var a=this;return(0,h.Z)(function*(){const s=he.getInstance(),l=[],v=new Map,E=new Map;a.knowledgeGraph.dataModel.entityTypes?.forEach(b=>{b.name&&E.set(b.name,b)}),a.knowledgeGraph.dataModel.relationshipTypes?.forEach(b=>{b.name&&E.set(b.name,b)}),e||a.inclusionModeDefinition?e?e.forEach(b=>{if(a.memberIdTypeLookup.has(b)){const w=a.memberIdTypeLookup.get(b);v.has(w)?v.get(w)?.push(b):v.set(w,[b])}}):a.inclusionModeDefinition?.namedTypeDefinitions?.forEach((b,w)=>{b.useAllData?v.set(w,null):b.members&&b.members.forEach(G=>{v.has(w)&&null!==v.get(w)?v.get(w)?.push(G.id):v.set(w,[G.id])})}):(a.knowledgeGraph.dataModel.entityTypes?.forEach(b=>{b.name&&v.set(b.name,null)}),a.knowledgeGraph.dataModel.entityTypes?.forEach(b=>{b.name&&v.set(b.name,null)}));for(const[b,w]of v){const G=new Promise(Q=>{(function(){var R=(0,h.Z)(function*(){const Z=new Set,D=[];let se,B="",oe=!1;if(t||E.get(b)?.properties?.forEach(T=>{T.name&&Z.add(T.name)}),o&&a.geographicLookup.has(b)){const T=a.geographicLookup.get(b)?.name;T&&Z.add(T)}if(a.entityTypeNames.has(b))B=`MATCH (n:${b}) ${w?"WHERE id(n) IN $ids ":""}return ID(n)`,Z.forEach(T=>{B+=`, n.${T}`,D.push(T)});else{if(!a.relationshipTypeNames.has(b))throw new M.Z("knowledge-graph:layer-data-manager",`The graph type of ${b} could not be determined. Was this type set in the KG data model and inclusion definition?`);oe=!0,B=`MATCH ()-[n:${b}]->() ${w?"WHERE id(n) IN $ids ":""}return ID(n), id(startNode(n)), id(endNode(n))`,Z.forEach(T=>{B+=`, n.${T}`,D.push(T)})}se=new ot(w?{openCypherQuery:B,bindParameters:{ids:w}}:{openCypherQuery:B});const te=(yield gt(a.knowledgeGraph,se)).resultRowsStream.getReader();for(;;){const{done:T,value:ee}=yield te.read();if(T)break;const O=[];for(let P=0;P<ee.length;P++){const fe=ee[P];let ye=0,Te=0;const Ee={properties:{}};for(Ee.id=fe[ye],ye++,Te++,oe&&(Ee.originId=fe[ye],ye++,Te++,Ee.destinationId=fe[ye],ye++,Te++,(0,j.s1)(a.nodeConnectionsLookup,Ee.originId,()=>new Set).add(Ee.id),(0,j.s1)(a.nodeConnectionsLookup,Ee.destinationId,()=>new Set).add(Ee.id));ye<fe.length;ye++)Ee.properties[D[ye-Te]]=fe[ye];O.push(Ee)}const C=s.writeToStore(O,ne,a.geographicLookup.get(b)?.name);a.sublayerCaches.has(b)||a.sublayerCaches.set(b,new Map),i&&!a.inclusionModeDefinition?.namedTypeDefinitions.has(b)&&a.inclusionModeDefinition?.namedTypeDefinitions.set(b,{useAllData:!1,members:new Map}),i&&!a.inclusionModeDefinition?.namedTypeDefinitions.get(b).members&&(a.inclusionModeDefinition.namedTypeDefinitions.get(b).members=new Map);const H=a.sublayerCaches.get(b);C.forEach(P=>{H?.set(P.attributes[ne],P),i&&!a.inclusionModeDefinition?.namedTypeDefinitions.get(b).members.has(P.attributes[ne])&&(a.inclusionModeDefinition?.namedTypeDefinitions.get(b).members.set(P.attributes[ne],{id:P.attributes[ne]}),a.memberIdTypeLookup.set(P.attributes[ne],b))})}});return function(){return R.apply(this,arguments)}})()().then(()=>{Q(null)})});l.push(G),a._processingCacheUpdatesLookup.get(b)?.push(G)}yield Promise.all(l)})()}removeFromLayer(e){const t=new Set,o=new Set(e.map(i=>i.id));for(const i of e)t.add(i.typeName),this.memberIdTypeLookup.delete(i.id),this.inclusionModeDefinition?.namedTypeDefinitions.forEach(a=>{a.members?.has(i.id)&&a.members.delete(i.id)});t.forEach(i=>{this.sublayerCaches.get(i)?.forEach((a,s)=>{o.has(s)&&this.sublayerCaches.get(i)?.delete(s)})})}retrieveDataFromService(e,t,o){var i=this;return(0,h.Z)(function*(){const a=he.getInstance(),s=new Set,l=[];let v,E="",b=[];const w="relationship"===t.graphType,G=i.inclusionModeDefinition?.namedTypeDefinitions?.get(t.objectType.name)?.useAllData,Q=t.parentCompositeLayer.sublayerIdsCache.get(t.objectType.name);let L=!G&&Q?Array.from(Q).sort():null;if(i.inclusionModeDefinition?.namedTypeDefinitions?.get(t.objectType.name)?.useAllData)i.inclusionModeDefinition?.namedTypeDefinitions?.get(t.objectType.name)?.useAllData&&null!=e.objectIds&&(L=e.objectIds);else if(null!=e.objectIds&&L&&L.length>0){const Z=e.objectIds;e.objectIds=L.filter(D=>Z.includes(D))}else if(null!=e.objectIds)L=e.objectIds;else{if(i.inclusionModeDefinition?.namedTypeDefinitions.has(t.objectType.name)&&(!i.inclusionModeDefinition.namedTypeDefinitions.get(t.objectType.name)?.members||i.inclusionModeDefinition.namedTypeDefinitions.get(t.objectType.name)?.members?.size<1))return e.objectIds=[],[];e.objectIds=L}if(null!=e.outFields){const Z=e.outFields;Z.includes("*")?t.fields.forEach(D=>{s.add(D.name)}):Z.forEach(D=>{D!==ne&&D!==t.geometryFieldName&&s.add(D)})}if(null!=e.geometry){const Z=e.geometry;let D;const se=t.parentCompositeLayer.dataManager.knowledgeGraph.serviceDefinition,B=se?.spatialReference,oe=se?.serviceCapabilities?.geometryCapabilities;let te=oe?.geometryMaxBoundingRectangleSizeX,T=oe?.geometryMaxBoundingRectangleSizeY;if(Z?.extent?.spatialReference&&!Z.spatialReference?.isWGS84?(yield(0,f.initializeProjection)(Z.extent.spatialReference,m.Zn),D=(0,f.project)(Z.extent,m.Zn)):D=Z.extent,te&&T&&B){if(4326!==B.wkid){const ee=new it.Z({spatialReference:B,xmax:te,ymax:T}),O=(0,f.project)(ee,m.Zn);te=O.xmax,T=O.ymax}if(D.xmax-D.xmin>te)throw new M.Z("knowledge-graph:layer-data-manager",`Extent x bounds should be within ${te}\xb0 latitude, limit exceeded`);if(D.ymax-D.ymin>T)throw new M.Z("knowledge-graph:layer-data-manager",`Extent y bounds should be within ${T}\xb0 longitude, limit exceeded`)}if(null!=e.where&&"1=1"!==e.where){const ee=yield(0,y.E)(e.where.toUpperCase(),t.fieldsIndex);t.fields.forEach(O=>{ee.fieldNames.includes(O.name)&&s.add(O.name)})}E=w?`Match ()-[n:${t.objectType.name}]->() WHERE esri.graph.ST_Intersects($param_filter_geom, n.${t.geometryFieldName}) return ID(n), id(startNode(r)), id(endNode(r))`:`Match (n:${t.objectType.name}) WHERE esri.graph.ST_Intersects($param_filter_geom, n.${t.geometryFieldName}) return ID(n)`,t.geometryFieldName&&s.add(t.geometryFieldName),s.forEach(ee=>{E+=`, n.${ee}`,l.push(ee)}),v=new ot({openCypherQuery:E,bindParameters:{param_filter_geom:new c.Z({rings:xn(D)})}})}else{let Z="";if(null!=e.where&&"1=1"!==e.where){const B=yield(0,y.E)(e.where,t.fieldsIndex);t.fields.forEach(O=>{B.fieldNames.includes(O.name)&&s.add(O.name)});const oe=new Set(["column-reference","string","number","binary-expression"]),te=new Set(["=","<","<=","<>",">",">=","AND","OR","LIKE"]);let T=!1;const ee=O=>{if("column-reference"===O.type)return`n.${O.column}`;if("string"===O.type)return`'${O.value}'`;if("number"===O.type)return`${O.value}`;if("binary-expression"===O.type&&oe.has(O.left.type)&&oe.has(O.right.type)&&te.has(O.operator))return`${ee(O.left)} ${O.operator} ${ee(O.right)}`;if("binary-expression"===O.type&&"LIKE"===O.operator){let C="";if("function"===O.left.type&&"column-reference"===O.left.args.value[0].type)C+=`lower(n.${O.left.args.value[0].column})`;else{if("column-reference"!==O.left.type)return T=!0,"";C+=`lower(n.${O.left.column})`}if(C+=" CONTAINS (","string"!==O.right.type)return T=!0,"";{let H=O.right.value;"%"===H.charAt(0)&&(H=H.slice(1)),"%"===H.charAt(H.length-1)&&(H=H.slice(0,-1)),C+=`'${H.toLowerCase()}')`}return C}return T=!0,""};Z=ee(B.parseTree),T&&(Z="")}let D="";D=w?`Match ()-[n:${t.objectType.name}]->()`:`Match (n:${t.objectType.name})`;let se=!1;L&&(se=!0,D+=" WHERE ID(n) IN $ids"),Z&&(D+=se?" AND":" WHERE",D+=` ${Z}`),D+=" return ID(n)",w&&(D+=", id(startNode(n)), id(endNode(n))"),e.returnGeometry&&t.geometryFieldName&&s.add(t.geometryFieldName),s.forEach(B=>{D+=`, n.${B}`,l.push(B)}),v=new ot(L?{openCypherQuery:D,bindParameters:{ids:L}}:{openCypherQuery:D})}const R=(yield gt(t.parentCompositeLayer.dataManager.knowledgeGraph,v,o)).resultRowsStream.getReader();for(;;){const{done:Z,value:D}=yield R.read();if(Z)break;const se=[];for(let B=0;B<D.length;B++){const oe=D[B];let te=0,T=0;const ee={properties:{}};for(ee.id=oe[te],te++,T++,w&&(ee.originId=oe[te],te++,T++,ee.destinationId=oe[te],te++,T++);te<oe.length;te++)ee.properties[l[te-T]]=oe[te];se.push(ee)}b=b.concat(a.writeToStore(se,ne,t.parentCompositeLayer.dataManager.geographicLookup.get(t.objectType.name)?.name))}return b})()}};(0,d._)([(0,u.Cb)()],Le.prototype,"knowledgeGraph",void 0),(0,d._)([(0,u.Cb)()],Le.prototype,"inclusionModeDefinition",void 0),(0,d._)([(0,u.Cb)()],Le.prototype,"entityTypeNames",void 0),(0,d._)([(0,u.Cb)()],Le.prototype,"relationshipTypeNames",void 0),(0,d._)([(0,u.Cb)()],Le.prototype,"geographicLookup",void 0),(0,d._)([(0,u.Cb)()],Le.prototype,"sublayerCaches",void 0),(0,d._)([(0,u.Cb)()],Le.prototype,"nodeConnectionsLookup",void 0),(0,d._)([(0,u.Cb)()],Le.prototype,"memberIdTypeLookup",void 0),Le=(0,d._)([(0,I.j)("esri.rest.knowledgeGraph.knowledgeGraphLayer.KnowledgeGraphLayerDataManager")],Le);var In=p(73281),ir=(p(4832),p(49067),p(96794),p(69747),p(40425),p(69357),p(40342),p(73640),p(33474)),Ln=p(32088),Dn=(p(97347),p(81975)),Sn=p(60331),Ct=p(56554);const Dr=(0,p(55911).v)(),Gn=e=>{let t=class extends e{constructor(){super(...arguments),this.fields=[],this.fieldsIndex=null}};return(0,d._)([(0,u.Cb)(Dr.fields)],t.prototype,"fields",void 0),(0,d._)([(0,u.Cb)(Dr.fieldsIndex)],t.prototype,"fieldsIndex",void 0),t=(0,d._)([(0,I.j)("esri.layers.knowledgeGraphLayer.KnowledgeGraphSublayerBase")],t),t};var Sr=p(552),jn=p(15008),kn=p(30346),Rr=p(99555),Gr=p(36255),Pn=p(90194),On=p(17253),Fn=p(49430),Nn=p(97856),Ve=p(71774);let de=class extends((0,jn.M)(Gn((0,Sr.h)((0,Rr.M)((0,kn.Q)(le.Z)))))){constructor(e){if(super(e),this.capabilities=(0,Ct.MS)(!1,!1),this.definitionExpression="",this.displayField="",this.elevationInfo=null,this.geometryType=null,this.geometryFieldName=null,this.graphType=null,this.hasM=!1,this.hasZ=!1,this.labelsVisible=null,this.labelingInfo=null,this.objectIdField=ne,this.objectType=null,this.parentCompositeLayer=null,this.popupTemplate=null,this.source={openPorts:()=>this.load().then(()=>{const t=new MessageChannel;return new Nn.Z(t.port1,{channel:t,client:{queryFeatures:(o,i={})=>{const a=Ke.Z.fromJSON(o);return this.queryFeaturesJSON(a,i)}}}),[t.port2]})},this.type="knowledge-graph-sublayer","link-chart"===e.parentCompositeLayer.type)this.geometryType="relationship"===e.graphType?"polyline":"point",this.geometryFieldName=ce;else if(e.parentCompositeLayer.dataManager.geographicLookup.get(e.objectType.name)?.geometryType&&"esriGeometryNull"!==e.parentCompositeLayer.dataManager.geographicLookup.get(e.objectType.name)?.geometryType){const t=e.parentCompositeLayer.dataManager.geographicLookup.get(e.objectType.name);this.geometryFieldName=t?.name??null,this.geometryType=t?.geometryType?Ve.M.fromJSON(t.geometryType):null;const o=t?.name,i=o?e.objectType.properties?.[o]:null;i?(this.hasM=i.hasM??!1,this.hasZ=i.hasZ??!1):(this.hasM=!1,this.hasZ=!1)}else this.geometryType=null;e.objectType.properties?.forEach(t=>{let i=t.fieldType;"esriFieldTypeOID"===i&&(i="esriFieldTypeInteger"),this.fields.push(Gr.Z.fromJSON({name:t.name,type:i,alias:t.alias,defaultValue:null,editable:t.editable,nullable:t.nullable}))}),this.fields.push(Gr.Z.fromJSON({name:this.objectIdField,type:"esriFieldTypeString",alias:this.objectIdField,editable:!1})),this._set("fields",[...this.fields]),e.parentCompositeLayer.dataManager.knowledgeGraph.dataModel?.spatialReference&&(this.spatialReference=e.parentCompositeLayer.dataManager.knowledgeGraph.dataModel.spatialReference),this.renderer=(0,ir.i)("link-chart"===e.parentCompositeLayer.type?"relationship"===e.graphType?(0,Ct.bU)(Ve.M.toJSON("polyline")).renderer:(0,Ct.bU)(Ve.M.toJSON("point")).renderer:(0,Ct.bU)(Ve.M.toJSON(this.geometryType)).renderer)}get defaultPopupTemplate(){return this.createPopupTemplate()}set renderer(e){(0,Pn.YN)(e,this.fieldsIndex),this._set("renderer",e)}createPopupTemplate(e){return(0,Fn.eZ)(this,e)}createQuery(){return new Ke.Z({where:"1=1",outFields:["*"]})}getField(e){for(let t=0;t<this.fields.length;t++)if(this.fields[t].name===e)return this.fields[t];throw new Error("Field not found")}getFieldDomain(e,t){return null}queryFeatures(e,t){var o=this;return(0,h.Z)(function*(){const{resolvedQuery:i,queryEngine:a}=yield o._setupQueryObjects(e),s=On.Z.fromJSON(yield a.executeQuery(i.toJSON(),t?.signal));return s.features.forEach(l=>{l.sourceLayer=o}),s})()}queryFeaturesJSON(e,t){var o=this;return(0,h.Z)(function*(){const{resolvedQuery:i,queryEngine:a}=yield o._setupQueryObjects(e);return yield a.executeQuery(i.toJSON(),t?.signal)})()}queryFeatureCount(e,t){var o=this;return(0,h.Z)(function*(){const{resolvedQuery:i,queryEngine:a}=yield o._setupQueryObjects(e);return a.executeQueryForCount(i.toJSON(),t?.signal)})()}queryExtent(e={},t){var o=this;return(0,h.Z)(function*(){const i={...e,returnGeometry:!0},{resolvedQuery:a,queryEngine:s}=yield o._setupQueryObjects(i),l=yield s.executeQueryForExtent(a.toJSON(),t?.signal);let v;return v=null!=l.extent?.xmin&&null!=l.extent?.xmax&&null!=l.extent?.ymin&&null!=l.extent?.ymax?new it.Z(l.extent):new it.Z,{count:l.count,extent:v}})()}queryObjectIds(e,t){var o=this;return(0,h.Z)(function*(){const i=Ke.Z.from(e);let a;if("link-chart"===o.parentCompositeLayer.type&&o._cachedQueryEngine)a=o._cachedQueryEngine;else{const s=yield o.parentCompositeLayer.dataManager.getData(i,o,t);a=o.loadQueryEngine(s)}return a.executeQueryForIds(i.toJSON(),t?.signal)})()}loadQueryEngine(e){const t=new Dn.Z({geometryType:Ve.M.toJSON(this.geometryType),hasM:this.hasM,hasZ:this.hasZ}),o=new Sn.q({fieldsIndex:this.fieldsIndex.toJSON(),geometryType:Ve.M.toJSON(this.geometryType),hasM:this.hasM,hasZ:this.hasZ,objectIdField:this.objectIdField,spatialReference:this.spatialReference.toJSON(),timeInfo:null,featureStore:t});return o.featureStore.addMany(e),o}refreshCachedQueryEngine(){var e=this;return(0,h.Z)(function*(){const t=yield e.parentCompositeLayer.dataManager.getData(new Ke.Z({where:"1=1",outFields:[ne]}),e);e._cachedQueryEngine=e.loadQueryEngine(t)})()}_setupQueryObjects(e,t){var o=this;return(0,h.Z)(function*(){const i=Ke.Z.from(e),a=i.geometry;let s;if(a&&!a.spatialReference?.isWGS84&&(yield(0,f.initializeProjection)(a.spatialReference,m.Zn),i.geometry=(0,f.project)(a instanceof c.Z||a instanceof Ne.Z?a:a.extent,m.Zn)),"link-chart"===o.parentCompositeLayer.type&&o._cachedQueryEngine)s=o._cachedQueryEngine;else{const l=yield o.parentCompositeLayer.dataManager.getData(i,o,t);s=o.loadQueryEngine(l)}return{resolvedQuery:i,queryEngine:s}})()}};(0,d._)([(0,u.Cb)()],de.prototype,"capabilities",void 0),(0,d._)([(0,u.Cb)({readOnly:!0})],de.prototype,"defaultPopupTemplate",null),(0,d._)([(0,u.Cb)()],de.prototype,"definitionExpression",void 0),(0,d._)([(0,u.Cb)()],de.prototype,"displayField",void 0),(0,d._)([(0,u.Cb)()],de.prototype,"elevationInfo",void 0),(0,d._)([(0,u.Cb)()],de.prototype,"geometryType",void 0),(0,d._)([(0,u.Cb)()],de.prototype,"geometryFieldName",void 0),(0,d._)([(0,u.Cb)()],de.prototype,"graphType",void 0),(0,d._)([(0,u.Cb)()],de.prototype,"hasM",void 0),(0,d._)([(0,u.Cb)()],de.prototype,"hasZ",void 0),(0,d._)([(0,u.Cb)()],de.prototype,"labelsVisible",void 0),(0,d._)([(0,u.Cb)()],de.prototype,"labelingInfo",void 0),(0,d._)([(0,u.Cb)()],de.prototype,"objectIdField",void 0),(0,d._)([(0,u.Cb)()],de.prototype,"objectType",void 0),(0,d._)([(0,u.Cb)()],de.prototype,"parentCompositeLayer",void 0),(0,d._)([(0,u.Cb)({type:In.Z,json:{name:"popupInfo",write:!0}})],de.prototype,"popupTemplate",void 0),(0,d._)([(0,u.Cb)({types:Ln.A,json:{write:{target:"layerDefinition.drawingInfo.renderer"}}})],de.prototype,"renderer",null),(0,d._)([(0,u.Cb)()],de.prototype,"source",void 0),(0,d._)([(0,u.Cb)({json:{read:!1}})],de.prototype,"type",void 0),de=(0,d._)([(0,I.j)("esri.layers.knowledgeGraph.KnowledgeGraphSublayer")],de);const ar=de;let sr,q=null;var De;function Ye(e,t,o,i,a,s){const l=o.length,v=a.length,E=Float64Array.BYTES_PER_ELEMENT,b=Uint32Array.BYTES_PER_ELEMENT,w=Uint8Array.BYTES_PER_ELEMENT,L=q._malloc(15+l*(w+2*E)+v*(2*b));try{const R=L+16-L%16,Z=R+l*E,D=Z+l*E,se=D+v*b,B=se+v*b,oe=()=>[q.HEAPF64.subarray(R>>3,(R>>3)+l),q.HEAPF64.subarray(Z>>3,(Z>>3)+l),q.HEAPU32.subarray(D>>2,(D>>2)+v),q.HEAPU32.subarray(se>>2,(se>>2)+v),q.HEAPU8.subarray(B,B+l)],[te,T,ee,O,C]=oe();te.set(o),T.set(i),ee.set(a),O.set(s),C.set(t);const H=e(l,B,R,Z,v,D,se),[P,fe,ye,Te,Ee]=oe();return o.set(P),i.set(fe),a.set(ye),s.set(Te),t.set(Ee),H}finally{q._free(L)}}!function(e){e[e.None=0]="None",e[e.IsMovable=1]="IsMovable",e[e.IsGeographic=2]="IsGeographic",e[e.IsRoot=4]="IsRoot"}(De||(De={}));var lr,pr,dr,ur,cr,yr,Or,Fr;(function(e){e.getMinIdealEdgeLength=function t(){return q.getMinIdealEdgeLength()},e.apply=function o(i,a,s,l,v,E=2,b=1,w=-1){return Ye((G,Q,L,R,Z,D,se)=>q.applyForceDirectedLayout(G,Q,L,R,Z,D,se,E,b,w),i,a,s,l,v)}})(lr||(lr={})),function(e){e.apply=function t(o,i,a,s,l,v=2,E=1,b=-1){return Ye((w,G,Q,L,R,Z,D)=>q.applyCommunityLayout(w,G,Q,L,R,Z,D,v,E,b),o,i,a,s,l)}}(pr||(pr={})),function(e){e.apply=function t(o,i,a,s,l){return Ye(q.applySimpleLayout,o,i,a,s,l)}}(dr||(dr={})),function(e){e.apply=function t(o,i,a,s,l){return Ye(q.applyHierarchicalLayout,o,i,a,s,l)}}(ur||(ur={})),function(e){e.apply=function t(o,i,a,s,l){return Ye(q.applyRadialTreeLayout,o,i,a,s,l)}}(cr||(cr={})),function(e){e.apply=function t(o,i,a,s,l){return Ye(q.applySmartTreeLayout,o,i,a,s,l)}}(yr||(yr={})),function(e){e[e.Undirected=0]="Undirected",e[e.Directed=1]="Directed",e[e.Reversed=2]="Reversed"}(Or||(Or={})),function(e){e[e.ByCC_Raw=0]="ByCC_Raw",e[e.ByCC_NormalizeGlobally=1]="ByCC_NormalizeGlobally",e[e.ByCC_NormalizeByCC=2]="ByCC_NormalizeByCC"}(Fr||(Fr={}));let _e=class extends((0,Sr.h)((0,Rr.M)(le.Z))){constructor(e){if(super(e),this.dataPreloadedInLocalCache=!1,this.defaultLinkChartConfig=null,this._currentLinkChartConfig={layoutMode:"RADIAL_TREE",xScaleFactor:1,yScaleFactor:1},this._graphTypeLookup=new Map,this.knowledgeGraph=null,this.layers=new V.Z,this.linkChartDiagramLookup=new Map,this.linkChartExtent=new it.Z({xmin:-1e-7,ymin:-1e-7,xmax:1e-7,ymax:1e-7}),this.linkChartGeohashLookup=new Map,this.memberEntityTypes=null,this.memberRelationshipTypes=null,this.sublayerIdsCache=new Map,this.tables=new V.Z,this.type="link-chart",this._originalInclusionList=e.inclusionModeDefinition,e.dataPreloadedInLocalCache&&!e.inclusionModeDefinition)throw new M.Z("knowledge-graph:linkchart-layer-constructor","If creating a link chart composite layer and configured that data is already loaded in the cache, you must specify an inclusion list so the Composite Layer knows what records belong to it")}normalizeCtorArgs(e){return{url:e.url,title:e.title,dataPreloadedInLocalCache:e.dataPreloadedInLocalCache,defaultLinkChartConfig:e.defaultLinkChartConfig}}_initializeLayerProperties(e){if(!this.title&&this.url){const s=this.url.split("/");this.title=s[s.length-2]}const t=new Set;let o=[],i=[];if(e.inclusionModeDefinition&&(!e.inclusionModeDefinition.namedTypeDefinitions||e.inclusionModeDefinition.namedTypeDefinitions.size<1))throw new M.Z("knowledge-graph:composite-layer-constructor","If an explicit inclusion definition is defined, at least one namedTypeDefinition must also be defined");e.knowledgeGraph.dataModel.entityTypes?.forEach(s=>{s.name&&this._graphTypeLookup.set(s.name,s)}),e.knowledgeGraph.dataModel.relationshipTypes?.forEach(s=>{s.name&&this._graphTypeLookup.set(s.name,s)}),e.inclusionModeDefinition?.generateAllSublayers?(o=e.knowledgeGraph.dataModel.entityTypes??[],i=e.knowledgeGraph.dataModel.relationshipTypes??[]):e.inclusionModeDefinition?.namedTypeDefinitions&&e.inclusionModeDefinition?.namedTypeDefinitions.size>0?e.inclusionModeDefinition?.namedTypeDefinitions.forEach((s,l)=>{if(!this._graphTypeLookup.get(l))return ue.Z.getLogger(this).warn(`A named type, ${l}, was in the inclusion list that wasn't in the data model and will be removed`),void e.inclusionModeDefinition?.namedTypeDefinitions.delete(l);this._graphTypeLookup.get(l)instanceof qe||"strictOrigin"in this._graphTypeLookup.get(l)?t.has(l)||(t.add(l),i.push(this._graphTypeLookup.get(l))):this._graphTypeLookup.get(l)instanceof Be||"properties"in this._graphTypeLookup.get(l)?t.has(l)||(t.add(l),o.push(this._graphTypeLookup.get(l))):(ue.Z.getLogger(this).warn(`A named type, ${l}, was in the inclusion list that wasn't properly modeled and will be removed`),e.inclusionModeDefinition?.namedTypeDefinitions.delete(l))}):(o=e.knowledgeGraph.dataModel.entityTypes??[],i=e.knowledgeGraph.dataModel.relationshipTypes??[]);const a=new Le({knowledgeGraph:e.knowledgeGraph,inclusionModeDefinition:e.inclusionModeDefinition});this.knowledgeGraph=e.knowledgeGraph,this.memberEntityTypes=o,this.memberRelationshipTypes=i,this.dataManager=a}load(e){var t=this;return this.addResolvingPromise(new Promise(o=>{(function gn(e){return Ut.apply(this,arguments)})(this.url).then(i=>{this._initializeLayerProperties({knowledgeGraph:i,inclusionModeDefinition:this._originalInclusionList}),this.dataManager.inclusionModeDefinition?.namedTypeDefinitions?.size||(this.dataManager.inclusionModeDefinition={generateAllSublayers:!1,namedTypeDefinitions:new Map},this.dataManager.knowledgeGraph.dataModel.entityTypes?.forEach(a=>{a.name&&this.dataManager.inclusionModeDefinition?.namedTypeDefinitions.set(a.name,{useAllData:!0})}),this.dataManager.knowledgeGraph.dataModel.relationshipTypes?.forEach(a=>{a.name&&this.dataManager.inclusionModeDefinition?.namedTypeDefinitions.set(a.name,{useAllData:!0})})),this.dataPreloadedInLocalCache?(this.loadLayerAssumingLocalCache(),this.dataManager.inclusionModeDefinition&&(this.dataManager.inclusionModeDefinition.generateAllSublayers=!1),this.dataManager.inclusionModeDefinition?.namedTypeDefinitions.forEach(a=>{a.useAllData=!1,a.members?.forEach(s=>{let l;l=s.linkChartLocation instanceof Pe.Z?s.linkChartLocation:s.linkChartLocation?(0,be.GH)(s.linkChartLocation):null,this.linkChartDiagramLookup.set(s.id,l),this.linkChartGeohashLookup.set(s.id,l&&2===l.coords.length&&0===l.lengths.length?(0,Y.fC)(l.coords[1],l.coords[0],12):"")}),this.addResolvingPromise(this._initializeDiagram().then((0,h.Z)(function*(){t.layers.forEach(function(){var s=(0,h.Z)(function*(l){yield l.refreshCachedQueryEngine()});return function(l){return s.apply(this,arguments)}}()),t.tables.forEach(function(){var s=(0,h.Z)(function*(l){yield l.refreshCachedQueryEngine()});return function(l){return s.apply(this,arguments)}}())})))})):this.addResolvingPromise(this.dataManager.refreshCacheContent(void 0,!1,"GEOGRAPHIC"===this.defaultLinkChartConfig?.layoutMode,!0).then((0,h.Z)(function*(){(0,ge.k_)(e);const s=[],l=[];t.loadLayerAssumingLocalCache(),t.dataManager.inclusionModeDefinition&&(t.dataManager.inclusionModeDefinition.generateAllSublayers=!1,t.dataManager.inclusionModeDefinition.namedTypeDefinitions.forEach(v=>{v.useAllData=!1})),yield t._initializeDiagram(),t.layers.forEach(v=>{l.push(v.refreshCachedQueryEngine()),s.push(new Promise(E=>{v.on("layerview-create",()=>{E(null)})}))}),t.tables.forEach(v=>{l.push(v.refreshCachedQueryEngine())}),yield Promise.all(l)}))),o(null)})})),Promise.resolve(this)}addRecords(e,t){var o=this;return(0,h.Z)(function*(){let i=[];t?.cascadeAddRelationshipEndNodes&&o.dataManager.knowledgeGraph.dataModel&&(i=yield function Mn(e,t){return nr.apply(this,arguments)}(e,o.dataManager.knowledgeGraph));const a=e.concat(i).filter(s=>!o.sublayerIdsCache.get(s.typeName)?.has(s.id));yield o._handleNewRecords(a)})()}removeRecords(e,{cascadeRemoveRelationships:t=!0,recalculateLayout:o=!1}={cascadeRemoveRelationships:!0,recalculateLayout:!1}){var i=this;return(0,h.Z)(function*(){let a=[];for(const l of e)!1===i.dataManager.inclusionModeDefinition?.namedTypeDefinitions?.get(l.typeName)?.useAllData&&i.dataManager.inclusionModeDefinition?.namedTypeDefinitions?.get(l.typeName)?.members?.has(l.id)&&a.push(l);if(t){const l=new Set,v=[];for(const E of a)if(i.dataManager.nodeConnectionsLookup.has(E.id))for(const b of i.dataManager.nodeConnectionsLookup.get(E.id))l.add(b);for(const E of l)i.dataManager.memberIdTypeLookup.has(E)&&v.push({id:E,typeName:i.dataManager.memberIdTypeLookup.get(E)});a=a.concat(v)}i.dataManager.removeFromLayer(a);for(const l of a)i.sublayerIdsCache.get(l.typeName)?.delete(l.id),i.linkChartDiagramLookup.delete(l.id);o&&(yield i.calculateLinkChartLayout(i._currentLinkChartConfig.layoutMode,{xScaleFactor:i._currentLinkChartConfig.xScaleFactor,yScaleFactor:i._currentLinkChartConfig.xScaleFactor}));const s=[];return i.layers.forEach(l=>{s.push(l.refreshCachedQueryEngine())}),yield Promise.all(s),i._refreshNamedTypes(),a})()}expand(e){var t=this;return(0,h.Z)(function*(){const o=yield t.dataManager.getConnectedRecordIds(e),i=o.filter(a=>!t.sublayerIdsCache.get(a.typeName)?.has(a.id));return yield t._handleNewRecords(o),{records:i}})()}loadLayerAssumingLocalCache(){this.memberRelationshipTypes.forEach(e=>{const t=new ar({objectType:e,parentCompositeLayer:this,graphType:"relationship",title:e.name});t.geometryType?this.layers.push(t):this.tables.push(t),this.dataManager.sublayerCaches.has(e.name)||this.dataManager.sublayerCaches.set(e.name,new Map)}),this.memberEntityTypes.forEach(e=>{const t=new ar({objectType:e,parentCompositeLayer:this,graphType:"entity",title:e.name});t.geometryType?this.layers.push(t):this.tables.push(t),this.dataManager.sublayerCaches.has(e.name)||this.dataManager.sublayerCaches.set(e.name,new Map)}),this.dataManager.inclusionModeDefinition?.namedTypeDefinitions&&this.dataManager.inclusionModeDefinition?.namedTypeDefinitions.forEach((e,t)=>{const o=((e,t,o)=>(e.has(t)||e.set(t,new Set),e.get(t)))(this.sublayerIdsCache,t);e.members?.forEach(i=>{if(o.add(i.id),i.linkChartLocation)if(i.linkChartLocation instanceof Pe.Z)this.linkChartDiagramLookup.set(i.id,i.linkChartLocation),this.linkChartGeohashLookup.set(i.id,2===i.linkChartLocation.coords.length&&0===i.linkChartLocation.lengths.length?(0,Y.fC)(i.linkChartLocation.coords[1],i.linkChartLocation.coords[0],12):"");else{const a=(0,be.GH)(i.linkChartLocation);this.linkChartDiagramLookup.set(i.id,i.linkChartLocation?a:null),this.linkChartGeohashLookup.set(i.id,"x"in i.linkChartLocation&&"y"in i.linkChartLocation?(0,Y.fC)(i.linkChartLocation.x,i.linkChartLocation.y,12):"")}})})}calculateLinkChartLayout(e="RADIAL_TREE",t){var o=this;return(0,h.Z)(function*(){const i=[],a=[];o.dataManager.sublayerCaches.forEach((C,H)=>{o.dataManager.entityTypeNames.has(H)?C.forEach(P=>{i.push({typeName:H,feature:P})}):o.dataManager.relationshipTypeNames.has(H)&&C.forEach(P=>{a.push({typeName:H,feature:P})})}),o.linkChartDiagramLookup=new Map;const s=new Map,l=new Map,v=new Map,E=new Map,b=new Uint8Array(i.length),w=new Float64Array(i.length),G=new Float64Array(i.length),Q=new Uint32Array(a.length),L=new Uint32Array(a.length),R=[],D=t?.xScaleFactor??1,se=t?.yScaleFactor??1,B=new it.Z({xmin:-1e-7,ymin:-1e-7,xmax:1e-7,ymax:1e-7});let oe,te="FORCE_DIRECTED",T=0,ee=0;switch(te="GEOGRAPHIC"===e?"FORCE_DIRECTED":e,te){case"FORCE_DIRECTED":oe=lr.apply;break;case"COMMUNITY":oe=pr.apply;break;case"HIERARCHICAL":oe=ur.apply;break;case"RADIAL_TREE":oe=cr.apply;break;case"SMART_TREE":oe=yr.apply;break;default:oe=dr.apply}i.forEach(({typeName:C,feature:H})=>{if(t?.lockedNodeLocations?.has(H.attributes[ne])){b[T]="GEOGRAPHIC"===e&&o.dataManager.geographicLookup.has(C)?De.IsGeographic:De.None;const P=t.lockedNodeLocations.get(H.attributes[ne]);w[T]=P.x,G[T]=P.y}else if("GEOGRAPHIC"===e&&o.dataManager.geographicLookup.has(C)){b[T]=De.IsGeographic;let P=null;const fe=H.attributes[o.dataManager.geographicLookup.get(C).name];switch(o.dataManager.geographicLookup.get(C)?.geometryType){case"esriGeometryPoint":w[T]=fe?.x,G[T]=fe?.y;break;case"esriGeometryPolygon":P=fe?.centroid,null!=P?.x&&null!=P?.y?(w[T]=P.x,G[T]=P.y):b[T]=De.IsMovable;break;case"esriGeometryPolyline":case"esriGeometryMultipoint":P=fe?.extent?.center,null!=P?.x&&null!=P?.y?(w[T]=P.x,G[T]=P.y):b[T]=De.IsMovable;break;default:b[T]=De.IsMovable}(null==w[T]||null==G[T]||Number.isNaN(w[T])||Number.isNaN(G[T]))&&(b[T]=De.IsMovable,w[T]=0,G[T]=0)}else b[T]=De.IsMovable,w[T]=0,G[T]=0;E.set(H.attributes[ne],T),R[T]={feature:H,typeName:C},T++});let O=!1;if(a.forEach(C=>{const H=E.get(C.feature.attributes[at]),P=E.get(C.feature.attributes[or]);void 0!==H&&void 0!==P?(Q[ee]=H,L[ee]=P,ee++):(O=!0,o.linkChartDiagramLookup.set(C.feature.attributes[at],null),o.linkChartGeohashLookup.set(C.feature.attributes[at],null))}),O&&ue.Z.getLogger(o).warn("A relationship is a member of this layer that has either origin or destination entity nodes that are not members. The diagram geometry will be set to null"),yield function An(){return sr||(sr=p.e(1466).then(p.bind(p,31466)).then(e=>e.l).then(({default:e})=>e({locateFile:t=>(0,Ge.V)(`esri/libs/linkchartlayout/${t}`)})).then(e=>{!function Zn(e){q=e}(e)}),sr)}(),!oe(b,w,G,Q,L))throw new M.Z("knowledge-graph:layout-failed","Attempting to arrange the records in the specified layout failed");for(let C=0;C<R.length;C++){if(b[C]===De.IsMovable&&(w[C]=w[C]*D,G[C]=G[C]*se),G[C]>84.9999&&(G[C]=84.9999),G[C]<-84.9999&&(G[C]=-84.9999),w[C]>179.9999&&(w[C]=179.9999),w[C]<-179.9999&&(w[C]=-179.9999),R[C].feature.attributes[ce]=new tt.Z(w[C],G[C]),s.has(R[C].typeName))s.get(R[C].typeName)?.set(R[C].feature.attributes[ne],R[C].feature);else{const P=new Map;P.set(R[C].feature.attributes[ne],R[C].feature),s.set(R[C].typeName,P)}v.set(R[C].feature.attributes[ne],R[C].feature);const H=(0,be.GH)(R[C].feature.attributes[ce]);o.linkChartDiagramLookup.set(R[C].feature.attributes[ne],R[C].feature.attributes[ce]?H:null),o.linkChartGeohashLookup.set(R[C].feature.attributes[ne],(0,Y.fC)(R[C].feature.attributes[ce].y,R[C].feature.attributes[ce].x,12)),R[C].feature.attributes[ce].x<B.xmin&&(B.xmin=R[C].feature.attributes[ce].x),R[C].feature.attributes[ce].x>B.xmax&&(B.xmax=R[C].feature.attributes[ce].x),R[C].feature.attributes[ce].y<B.ymin&&(B.ymin=R[C].feature.attributes[ce].y),R[C].feature.attributes[ce].y>B.ymax&&(B.ymax=R[C].feature.attributes[ce].y)}return o.linkChartExtent.xmin=B.xmin,o.linkChartExtent.xmax=B.xmax,o.linkChartExtent.ymin=B.ymin,o.linkChartExtent.ymax=B.ymax,a.forEach(C=>{const H=R[E.get(C.feature.attributes[at])]?.feature.attributes[ce],P=R[E.get(C.feature.attributes[or])]?.feature.attributes[ce];if(!H||!P)return;const fe=new Ne.Z({paths:[[H.x,H.y],[P.x,P.y]]});if(C.feature.attributes[ce]=fe,l.has(C.typeName))l.get(C.typeName)?.set(C.feature.attributes[ne],C.feature);else{const Te=new Map;Te.set(C.feature.attributes[ne],C.feature),l.set(C.typeName,Te)}v.set(C.feature.attributes[ne],C.feature);const ye=(0,be.GH)(C.feature.attributes[ce]);o.linkChartDiagramLookup.set(C.feature.attributes[ne],C.feature.attributes[ce]?ye:null),o.linkChartGeohashLookup.set(C.feature.attributes[ne],"")}),o._currentLinkChartConfig={layoutMode:e,xScaleFactor:D,yScaleFactor:se},{nodes:s,links:l,idMap:v}})()}applyNewLinkChartLayout(e="RADIAL_TREE",t){var o=this;return(0,h.Z)(function*(){const i=[];yield o.calculateLinkChartLayout(e,t),o.layers.forEach(a=>{i.push(a.refreshCachedQueryEngine())}),yield Promise.all(i),o._refreshNamedTypes()})()}getCurrentNodeLocations(){const e=new Map;return this.dataManager.inclusionModeDefinition?.namedTypeDefinitions?.forEach(t=>{t?.members?.forEach(o=>{const i=o.linkChartLocation;let a;i&&(a="x"in i?{x:i.x,y:i.y}:{x:i.coords[0],y:i.coords[1]},e.set(o.id,new tt.Z({x:a.x,y:a.y})))})}),e}synchronizeInclusionListWithCache(){var e=this;return(0,h.Z)(function*(){return new Promise(t=>{e.dataManager.inclusionModeDefinition?.namedTypeDefinitions.forEach((o,i)=>{if(o.useAllData=!1,o.members&&o.members.size>0){if(!e.dataManager.sublayerCaches.get(i))return;const a=new Set(Array.from(e.dataManager.sublayerCaches.get(i).keys()));Array.from(o.members.keys()).filter(s=>!a.has(s)).forEach(s=>{o.members?.delete(s)})}}),t()})})()}refreshLinkChartCache(e){var t=this;return(0,h.Z)(function*(){yield t.dataManager.refreshCacheContent(e);const o=[];t.layers.forEach(i=>{o.push(i.refreshCachedQueryEngine())}),yield Promise.all(o),t._refreshNamedTypes()})()}_handleNewRecords(e){var t=this;return(0,h.Z)(function*(){const o=[];t.dataManager.addToLayer(e);for(const i of e)t.sublayerIdsCache.has(i.typeName)||(t.sublayerIdsCache.set(i.typeName,new Set),o.push(i.typeName)),t.sublayerIdsCache.get(i.typeName).add(i.id);for(const i of o)if(t._graphTypeLookup.has(i)){const a=t._graphTypeLookup.get(i),s="endPoints"in a?"relationship":"entity",l=new ar({objectType:a,parentCompositeLayer:t,graphType:s,title:i});"entity"===s?t.dataManager.entityTypeNames.add(i):t.dataManager.relationshipTypeNames.add(i),l.geometryType?t.layers.push(l):t.tables.push(l),t.dataManager.sublayerCaches.set(i,new Map)}yield t.dataManager.refreshCacheContent(e.map(i=>i.id)),yield t.applyNewLinkChartLayout(t._currentLinkChartConfig.layoutMode,{xScaleFactor:t._currentLinkChartConfig.xScaleFactor,yScaleFactor:t._currentLinkChartConfig.xScaleFactor})})()}_initializeDiagram(){var e=this;return(0,h.Z)(function*(){e.defaultLinkChartConfig?e.defaultLinkChartConfig.doNotRecalculateLayout?(e.dataManager.inclusionModeDefinition?.namedTypeDefinitions?.forEach(t=>{t?.members?.forEach(o=>{const i=o.linkChartLocation;let a;const s=o.id;if(!i)return;a="x"in i?{x:i.x,y:i.y}:{x:i.coords[0],y:i.coords[1]};const l=(0,be.GH)(a);e.linkChartDiagramLookup.set(s,l),e.linkChartGeohashLookup.set(s,(0,Y.fC)(a.x,a.y,12)),e.linkChartExtent.xmin>a.x&&(e.linkChartExtent.xmin=a.x),e.linkChartExtent.xmax<a.x&&(e.linkChartExtent.xmax=a.x),e.linkChartExtent.ymin>a.y&&(e.linkChartExtent.ymin=a.y),e.linkChartExtent.ymax<a.y&&(e.linkChartExtent.ymax=a.y)})}),e.memberRelationshipTypes.forEach(t=>{t.name&&e.dataManager.sublayerCaches.get(t.name)?.forEach(o=>{const i=e.linkChartDiagramLookup.get(o.attributes[at]),a=e.linkChartDiagramLookup.get(o.attributes[or]);if(i&&a){const s=(0,be.GH)(new Ne.Z({paths:[[i.coords[0],i.coords[1]],[a.coords[0],a.coords[1]]]}));e.linkChartDiagramLookup.set(o.attributes[ne],s)}else e.linkChartDiagramLookup.set(o.attributes[ne],null);e.linkChartGeohashLookup.set(o.attributes[ne],"")})})):yield e.calculateLinkChartLayout(e.defaultLinkChartConfig.layoutMode,{xScaleFactor:e.defaultLinkChartConfig.xScaleFactor,yScaleFactor:e.defaultLinkChartConfig.yScaleFactor,lockedNodeLocations:e.getCurrentNodeLocations()}):yield e.calculateLinkChartLayout("RADIAL_TREE",{lockedNodeLocations:e.getCurrentNodeLocations()})})()}_refreshNamedTypes(){for(const e of this.layers)e.emit("refresh",{dataChanged:!0});for(const e of this.tables)e.emit("refresh",{dataChanged:!0})}};(0,d._)([(0,u.Cb)()],_e.prototype,"dataPreloadedInLocalCache",void 0),(0,d._)([(0,u.Cb)()],_e.prototype,"defaultLinkChartConfig",void 0),(0,d._)([(0,u.Cb)()],_e.prototype,"dataManager",void 0),(0,d._)([(0,u.Cb)()],_e.prototype,"knowledgeGraph",void 0),(0,d._)([(0,u.Cb)()],_e.prototype,"layers",void 0),(0,d._)([(0,u.Cb)()],_e.prototype,"linkChartDiagramLookup",void 0),(0,d._)([(0,u.Cb)()],_e.prototype,"linkChartExtent",void 0),(0,d._)([(0,u.Cb)()],_e.prototype,"linkChartGeohashLookup",void 0),(0,d._)([(0,u.Cb)()],_e.prototype,"memberEntityTypes",void 0),(0,d._)([(0,u.Cb)()],_e.prototype,"memberRelationshipTypes",void 0),(0,d._)([(0,u.Cb)()],_e.prototype,"sublayerIdsCache",void 0),(0,d._)([(0,u.Cb)()],_e.prototype,"tables",void 0),(0,d._)([(0,u.Cb)({json:{read:!1}})],_e.prototype,"type",void 0),_e=(0,d._)([(0,I.j)("esri.layers.LinkChartLayer")],_e);const zn=_e},56554:(ke,me,p)=>{p.d(me,{Dm:()=>u,Hq:()=>K,MS:()=>pe,bU:()=>M});var h=p(8314),d=p(58817),$=p(87757),V=p(24837);function M(A){return{renderer:{type:"simple",symbol:"esriGeometryPoint"===A||"esriGeometryMultipoint"===A?V.I4:"esriGeometryPolyline"===A?V.ET:V.lF}}}const ue=/^[_$a-zA-Z][_$a-zA-Z0-9]*$/;let ge=1;function u(A,I){if((0,h.Z)("esri-csp-restrictions"))return()=>({[I]:null,...A});try{let Y=`this.${I} = null;`;for(const be in A)Y+=`this${ue.test(be)?`.${be}`:`["${be}"]`} = ${JSON.stringify(A[be])};`;const le=new Function(`\n      return class AttributesClass$${ge++} {\n        constructor() {\n          ${Y};\n        }\n      }\n    `)();return()=>new le}catch{return()=>({[I]:null,...A})}}function K(A={}){return[{name:"New Feature",description:"",prototype:{attributes:(0,d.d9)(A)}}]}function pe(A,I){return{analytics:{supportsCacheHint:!1},attachment:null,data:{isVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:A},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:I,supportsDelete:I,supportsEditing:I,supportsChangeTracking:!1,supportsQuery:!0,supportsQueryAnalytics:!1,supportsQueryAttachments:!1,supportsQueryTopFeatures:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:I,supportsExceedsLimitStatistics:!0,supportsAsyncConvert3D:!1},query:$.g,queryRelated:{supportsCount:!0,supportsOrderBy:!0,supportsPagination:!0,supportsCacheHint:!1},queryTopFeatures:{supportsCacheHint:!1},editing:{supportsGeometryUpdate:I,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1,supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1,supportsAsyncApplyEdits:!1,zDefault:void 0}}}},15008:(ke,me,p)=>{p.d(me,{M:()=>we});var x,h=p(17626),d=p(32917),$=p(77712),ge=(p(90912),p(85931),p(8314),p(76898)),u=p(43149),K=p(9256),pe=p(83989),A=p(73281),j=(p(4832),p(49067),p(96794),p(69747),p(40425),p(69357),p(40342)),c=(p(73640),p(33474)),f=p(32088),m=p(58817),_=p(94113),xe=p(55342),Me=p(68653),Se=p(99433),he=p(13812),Re=p(56347),Ce=p(170);let k=x=class extends pe.B{constructor(ie){super(ie),this.type="binning",this.binType="geohash",this.fixedBinLevel=3,this.labelingInfo=null,this.labelsVisible=!0,this.maxScale=0,this.popupEnabled=!0,this.popupTemplate=null,this.fields=[],this.renderer=null}writeFields(ie,F,X){const N=ie.filter(ve=>"avg_angle"!==ve.statisticType).map(ve=>ve.toJSON());(0,_.RB)(X,N,F)}readRenderer(ie,F,X){const N=F.drawingInfo?.renderer;return N?(0,c.a)(N,F,X)??void 0:(0,Re.Ob)(F,X)}clone(){return new x({fields:(0,m.d9)(this.fields),fixedBinLevel:this.fixedBinLevel,labelingInfo:(0,m.d9)(this.labelingInfo),labelsVisible:this.labelsVisible,maxScale:this.maxScale,popupEnabled:this.popupEnabled,popupTemplate:(0,m.d9)(this.popupTemplate),renderer:(0,m.d9)(this.renderer)})}};(0,h._)([(0,xe.J)({binning:"binning"})],k.prototype,"type",void 0),(0,h._)([(0,xe.J)({geohash:"geohash"})],k.prototype,"binType",void 0),(0,h._)([(0,$.Cb)({type:Number,range:{min:1,max:9},json:{write:!0}})],k.prototype,"fixedBinLevel",void 0),(0,h._)([(0,$.Cb)({type:[Ce.Z],json:{read:{source:"drawingInfo.labelingInfo"},write:{target:"drawingInfo.labelingInfo"}}})],k.prototype,"labelingInfo",void 0),(0,h._)([(0,$.Cb)(he.iR)],k.prototype,"labelsVisible",void 0),(0,h._)([(0,$.Cb)({type:Number,json:{default:0,name:"visibilityInfo.maxScale"}})],k.prototype,"maxScale",void 0),(0,h._)([(0,$.Cb)(he.C_)],k.prototype,"popupEnabled",void 0),(0,h._)([(0,$.Cb)({type:A.Z,json:{name:"popupInfo",write:!0}})],k.prototype,"popupTemplate",void 0),(0,h._)([(0,$.Cb)({type:[u.Z],json:{write:!0}})],k.prototype,"fields",void 0),(0,h._)([(0,Se.c)("fields")],k.prototype,"writeFields",null),(0,h._)([(0,$.Cb)({types:f.A,json:{write:{target:"drawingInfo.renderer"}}})],k.prototype,"renderer",void 0),(0,h._)([(0,Me.r)("renderer",["drawingInfo.renderer"])],k.prototype,"readRenderer",null),k=x=(0,h._)([(0,ge.j)("esri.layers.support.FeatureReductionBinning")],k);const ae=k;var Oe,re=p(20383),S=p(86810),W=p(23841);function Je(ie){return"simple"===ie.type&&!ie.visualVariables?.length}let J=Oe=class extends S.wq{constructor(ie){super(ie),this.type="cluster",this.clusterRadius=(0,W.t_)("80px"),this.clusterMinSize=(0,W.t_)("12px"),this.clusterMaxSize=(0,W.t_)("50px"),this.maxScale=0,this.popupEnabled=!0,this.popupTemplate=null,this.renderer=null,this.symbol=null,this.labelingInfo=null,this.labelsVisible=!0,this.fields=null}readRenderer(ie,F,X){const N=F.drawingInfo?.renderer;return N?.authoringInfo?.isAutoGenerated?null:N?Je(N)?null:(0,c.a)(N,F,X)??void 0:(0,Re.Ob)(F,X)}readSymbol(ie,F,X){const N=F.drawingInfo?.renderer;return N?.authoringInfo?.isAutoGenerated?null:N&&Je(N)?(0,c.a)(N,F,X)?.symbol:null}writeSymbol(ie,F,X,N){const ve=this.renderer?.authoringInfo?.isAutoGenerated;if(!this.renderer||ve){const Ge=new j.Z({symbol:ie});F.drawingInfo={renderer:Ge.write({},N)}}}writeFields(ie,F,X){const N=ie.filter(ve=>"avg_angle"!==ve.statisticType).map(ve=>ve.toJSON());(0,_.RB)(X,N,F)}readFields(ie,F,X){return ie.filter(N=>!N.isAutoGenerated).map(N=>u.Z.fromJSON(N))}clone(){return new Oe({clusterRadius:this.clusterRadius,clusterMinSize:this.clusterMinSize,clusterMaxSize:this.clusterMaxSize,labelingInfo:(0,m.d9)(this.labelingInfo),labelsVisible:this.labelsVisible,fields:(0,m.d9)(this.fields),maxScale:this.maxScale,renderer:(0,m.d9)(this.renderer),symbol:(0,m.d9)(this.symbol),popupEnabled:this.popupEnabled,popupTemplate:(0,m.d9)(this.popupTemplate)})}};(0,h._)([(0,$.Cb)({type:["cluster"],readOnly:!0,json:{write:!0}})],J.prototype,"type",void 0),(0,h._)([(0,$.Cb)({type:Number,cast:ie=>"auto"===ie?ie:(0,W.t_)(ie),json:{write:!0}})],J.prototype,"clusterRadius",void 0),(0,h._)([(0,$.Cb)({type:Number,cast:W.t_,json:{write:!0}})],J.prototype,"clusterMinSize",void 0),(0,h._)([(0,$.Cb)({type:Number,cast:W.t_,json:{write:!0}})],J.prototype,"clusterMaxSize",void 0),(0,h._)([(0,$.Cb)({type:Number,json:{default:0,name:"visibilityInfo.maxScale"}})],J.prototype,"maxScale",void 0),(0,h._)([(0,$.Cb)(he.C_)],J.prototype,"popupEnabled",void 0),(0,h._)([(0,$.Cb)({type:A.Z,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],J.prototype,"popupTemplate",void 0),(0,h._)([(0,$.Cb)({types:f.A,json:{write:{target:"drawingInfo.renderer"}}})],J.prototype,"renderer",void 0),(0,h._)([(0,Me.r)("renderer",["drawingInfo.renderer"])],J.prototype,"readRenderer",null),(0,h._)([(0,$.Cb)({types:re.AH})],J.prototype,"symbol",void 0),(0,h._)([(0,Me.r)("symbol",["drawingInfo.renderer"])],J.prototype,"readSymbol",null),(0,h._)([(0,Se.c)("symbol")],J.prototype,"writeSymbol",null),(0,h._)([(0,$.Cb)({type:[Ce.Z],json:{read:{source:"drawingInfo.labelingInfo"},write:{target:"drawingInfo.labelingInfo"}}})],J.prototype,"labelingInfo",void 0),(0,h._)([(0,$.Cb)(he.iR)],J.prototype,"labelsVisible",void 0),(0,h._)([(0,$.Cb)({type:[u.Z],json:{write:!0}})],J.prototype,"fields",void 0),(0,h._)([(0,Se.c)("fields")],J.prototype,"writeFields",null),(0,h._)([(0,Me.r)("fields")],J.prototype,"readFields",null),J=Oe=(0,h._)([(0,ge.j)("esri.layers.support.FeatureReductionCluster")],J);const Xe=J;var ze=p(47058);const Be={key:"type",base:pe.B,typeMap:{cluster:Xe,binning:ae}},Qe={types:{key:"type",base:pe.B,typeMap:{selection:ze.Z,cluster:Xe,binning:ae}},json:{name:"layerDefinition.featureReduction",write:{allowNull:!0},origins:{"web-map":{types:Be},"portal-item":{types:Be},"web-scene":{types:{key:"type",base:pe.B,typeMap:{selection:ze.Z}},name:"layerDefinition.featureReduction",write:{layerContainerTypes:K.C}}}}};var qe=p(62192);const we=ie=>{let F=class extends ie{constructor(...X){super(...X),this.addHandles((0,d.YP)(()=>this.renderer,()=>{if(this.featureReduction){const N=this._normalizeFeatureReduction(this.featureReduction);this._set("featureReduction",N)}},d.Z_))}set featureReduction(X){const N=this._normalizeFeatureReduction(X);this._set("featureReduction",N)}set renderer(X){}_normalizeFeatureReduction(X){if("cluster"!==X?.type)return X;const N=X.clone(),ve=[new u.Z({name:"cluster_count",isAutoGenerated:!0,statisticType:"count"})],Ge=(N.fields??[]).filter(et=>!et.isAutoGenerated);if(X.renderer&&!X.renderer.authoringInfo?.isAutoGenerated)return N.fields=[...ve,...Ge],N;if(X.symbol)return N.fields=[...ve,...Ge],N.renderer=null,N;if(!this.renderer)return X;const st=(0,qe.S1)(ve,this.renderer,X,null,!1);return N.fields=[...ve,...Ge],N.renderer=st,N}};return(0,h._)([(0,$.Cb)(Qe)],F.prototype,"featureReduction",null),F=(0,h._)([(0,ge.j)("esri.layers.mixins.FeatureReductionLayer")],F),F}},43149:(ke,me,p)=>{p.d(me,{Z:()=>pe});var u,h=p(17626),d=p(86810),$=p(58817),V=p(77712),ue=(p(90912),p(76898)),ge=p(95778);let K=u=class extends d.wq{constructor(A){super(A),this.isAutoGenerated=!1,this.name=null,this.alias=null,this.onStatisticField=null,this.onStatisticExpression=null,this.statisticType=null}clone(){return new u({name:this.name,alias:this.alias,isAutoGenerated:this.isAutoGenerated,onStatisticExpression:(0,$.d9)(this.onStatisticExpression),onStatisticField:this.onStatisticField,statisticType:this.statisticType})}};(0,h._)([(0,V.Cb)({type:Boolean,json:{write:!0}})],K.prototype,"isAutoGenerated",void 0),(0,h._)([(0,V.Cb)({type:String,json:{write:!0}})],K.prototype,"name",void 0),(0,h._)([(0,V.Cb)({type:String,json:{write:!0}})],K.prototype,"alias",void 0),(0,h._)([(0,V.Cb)({type:String,json:{write:!0}})],K.prototype,"onStatisticField",void 0),(0,h._)([(0,V.Cb)({type:ge.Z,json:{write:!0}})],K.prototype,"onStatisticExpression",void 0),(0,h._)([(0,V.Cb)({type:String,json:{write:!0}})],K.prototype,"statisticType",void 0),K=u=(0,h._)([(0,ue.j)("esri.layers.support.AggregateField")],K);const pe=K},95778:(ke,me,p)=>{p.d(me,{Z:()=>pe});var h=p(17626),d=p(79608),$=p(86810),V=p(77712),u=(p(90912),p(85931),p(8314),p(76898));let K=class extends((0,d.J)($.wq)){constructor(A){super(A),this.expression=null,this.title=null,this.returnType=null}};(0,h._)([(0,V.Cb)({type:String,json:{write:!0}})],K.prototype,"expression",void 0),(0,h._)([(0,V.Cb)({type:String,json:{write:!0}})],K.prototype,"title",void 0),(0,h._)([(0,V.Cb)({type:String,json:{write:!0}})],K.prototype,"returnType",void 0),K=(0,h._)([(0,u.j)("esri.layers.support.ExpressionInfo")],K);const pe=K},83989:(ke,me,p)=>{p.d(me,{B:()=>u});var h=p(17626),d=p(86810),$=p(77712),ge=(p(90912),p(85931),p(8314),p(76898));let u=class extends d.wq{constructor(){super(...arguments),this.type=null}};(0,h._)([(0,$.Cb)({type:["selection","cluster","binning"],readOnly:!0,json:{read:!1,write:!0}})],u.prototype,"type",void 0),u=(0,h._)([(0,ge.j)("esri.layers.support.FeatureReduction")],u)},47058:(ke,me,p)=>{p.d(me,{Z:()=>pe});var u,h=p(17626),d=p(77712),ue=(p(90912),p(85931),p(8314),p(76898)),ge=p(83989);let K=u=class extends ge.B{constructor(A){super(A),this.type="selection"}clone(){return new u}};(0,h._)([(0,d.Cb)({type:["selection"]})],K.prototype,"type",void 0),K=u=(0,h._)([(0,ue.j)("esri.layers.support.FeatureReductionSelection")],K);const pe=K},62192:(ke,me,p)=>{p.d(me,{aV:()=>Me,S1:()=>f,os:()=>m,st:()=>_,yR:()=>Se});var g,h=p(26584),d=p(8314),$=p(63290),V=p(50011),M=p(43149),ue=p(95778),ge=p(15312),u=p(68598),K=p(64902),pe=p(17626),A=p(58817),I=p(77712),le=(p(90912),p(76898)),be=p(99433),Pe=p(86971);let j=g=class extends u.Z{writeLevels(x,U,k){for(const ae in x)return void(U.stops=this.levels[ae])}clone(){return new g({axis:this.axis,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,maxDataValue:this.maxDataValue,maxSize:(0,Pe.iY)(this.maxSize)?this.maxSize.clone():this.maxSize,minDataValue:this.minDataValue,minSize:(0,Pe.iY)(this.minSize)?this.minSize.clone():this.minSize,normalizationField:this.normalizationField,stops:this.stops?.map(x=>x.clone()),target:this.target,useSymbolValue:this.useSymbolValue,valueRepresentation:this.valueRepresentation,valueUnit:this.valueUnit,legendOptions:this.legendOptions?.clone(),levels:(0,A.d9)(this.levels)})}};(0,pe._)([(0,I.Cb)()],j.prototype,"levels",void 0),(0,pe._)([(0,be.c)("levels")],j.prototype,"writeLevels",null),j=g=(0,pe._)([(0,le.j)("esri.views.2d.engine.LevelDependentSizeVariable")],j);const y=$.Z.getLogger("esri.views.2d.layers.support.clusterUtils");d.Z.add("esri-cluster-arcade-enabled",!0);const c=(0,d.Z)("esri-cluster-arcade-enabled"),f=(x,U,k,ae,re)=>{const S=U.clone();if(!Se(S))return S;if(S.authoringInfo||(S.authoringInfo=new ge.Z),S.authoringInfo.isAutoGenerated=!0,"visualVariables"in S){const W=(S.visualVariables||[]).filter(z=>"$view.scale"!==z.valueExpression),Oe=m(W);W.forEach(z=>{"rotation"===z.type?z.field?z.field=Ce(x,z.field,"avg_angle","number"):z.valueExpression&&(z.field=Re(x,z.valueExpression,"avg_angle","number"),z.valueExpression=null):z.normalizationField?(z.field=Ce(x,z.field,"avg_norm","number",z.normalizationField),z.normalizationField=null):z.field?z.field=Ce(x,z.field,"avg","number"):z.valueExpression&&(z.field=Re(x,z.valueExpression,"avg","number"),z.valueExpression=null)}),null==Oe&&!xe(W)&&re&&(W.push(Me(k,ae)),S.dynamicClusterSize=!0),S.visualVariables=W}switch(S.type){case"simple":break;case"pie-chart":for(const W of S.attributes)W.field?W.field=Ce(x,W.field,"sum","number"):W.valueExpression&&(W.field=Re(x,W.valueExpression,"sum","number"),W.valueExpression=null);break;case"unique-value":S.field?S.field=Ce(x,S.field,"mode","string"):S.valueExpression&&(S.field=Re(x,S.valueExpression,"mode","string"),S.valueExpression=null);break;case"class-breaks":S.normalizationField?(S.field=Ce(x,S.field,"avg_norm","number",S.normalizationField),S.normalizationField=null):S.field?S.field=Ce(x,S.field,"avg","number"):S.valueExpression&&(S.field=Re(x,S.valueExpression,"avg","number"),S.valueExpression=null)}return S},m=x=>{for(const U of x)if("size"===U.type)return U;return null};function _(x,U,k){const ae=x.clone();let re=!1;if("visualVariables"in ae){const S=(ae.visualVariables||[]).filter(W=>"$view.scale"!==W.valueExpression);null==m(S)&&(ae.visualVariables||(ae.visualVariables=[]),ae.visualVariables.push(Me(U,k)),ae.dynamicClusterSize=!0,re=!0)}return{renderer:ae,didInject:re}}const xe=x=>{for(const U of x)if("cluster_count"===U.field)return!0;return!1},Me=(x,U)=>{const k=[new K.Z({value:0,size:0}),new K.Z({value:1})];if(null==U)return new u.Z({field:"cluster_count",stops:[...k,new K.Z({value:2,size:0})]});const ae=Object.keys(U).reduce((re,S)=>({...re,[S]:[...k,new K.Z({value:Math.max(2,U[S].minValue),size:x.clusterMinSize}),new K.Z({value:Math.max(3,U[S].maxValue),size:x.clusterMaxSize})]}),{});return new j({field:"cluster_count",levels:ae})},Se=x=>{const U=k=>y.error(new h.Z("Unsupported-renderer",k,{renderer:x}));if(!x)return!1;switch(x.type){case"unique-value":if(x.field2||x.field3)return U("FeatureReductionCluster does not support multi-field UniqueValueRenderers"),!1;break;case"class-breaks":if(x.normalizationField){const k=x.normalizationType;if("field"!==k)return U(`FeatureReductionCluster does not support a normalizationType of ${k}`),!1}break;case"simple":case"pie-chart":break;default:return U(`FeatureReductionCluster does not support renderers of type ${x.type}`),!1}if(!c){if("valueExpression"in x&&x.valueExpression)return U("FeatureReductionCluster does not currently support renderer.valueExpression. Support will be added in a future release"),!1;if(("visualVariables"in x&&x.visualVariables||[]).some(k=>!(!("valueExpression"in k)||!k.valueExpression)))return U("FeatureReductionCluster does not currently support visualVariables with a valueExpression. Support will be added in a future release"),!1}return!0};function Re(x,U,k,ae){const re=(0,V.F)(U),S="mode"===k?`cluster_type_${re}`:"sum"===k?`cluster_sum_${re}`:`cluster_avg_${re}`;return x.some(W=>W.name===S)||x.push(new M.Z({name:S,isAutoGenerated:!0,onStatisticExpression:new ue.Z({expression:U,returnType:ae}),statisticType:k})),S}function Ce(x,U,k,ae,re){if("cluster_count"===U||x.some(W=>W.name===U))return U;const S=function he(x,U,k){switch(x){case"sum":return`cluster_sum_${U}`;case"avg":case"avg_angle":return`cluster_avg_${U}`;case"mode":return`cluster_type_${U}`;case"avg_norm":{const ae=k,re="field",S=U.toLowerCase()+",norm:"+re+","+ae.toLowerCase();return"cluster_avg_"+(0,V.F)(S)}}}(k,U,re);return x.some(W=>W.name===S)||x.push(new M.Z("avg_norm"===k?{name:S,isAutoGenerated:!0,onStatisticExpression:new ue.Z({expression:`$feature.${U} / $feature.${re}`,returnType:ae}),statisticType:"avg"}:{name:S,isAutoGenerated:!0,onStatisticField:U,statisticType:k})),S}}}]);