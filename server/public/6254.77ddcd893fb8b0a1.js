"use strict";(self.webpackChunkCRIS=self.webpackChunkCRIS||[]).push([[6254],{90301:(A,y,t)=>{t.d(y,{JZ:()=>E,RL:()=>P,eY:()=>W});var v=t(15861),n=t(10699),i=t(30217),p=t(49966),o=t(9545),R=t(57477),d=t(14403),L=t(80738),B=t(67969),T=t(18952),D=t(31548);function E(l){return l&&"render"in l}function P(l){const e=document.createElement("canvas");return e.width=l.width,e.height=l.height,l.render(e.getContext("2d")),e}class W extends R.s{constructor(e=null,r=!1){super(),this.blendFunction="standard",this._sourceWidth=0,this._sourceHeight=0,this._textureInvalidated=!1,this._texture=null,this.stencilRef=0,this.coordScale=[1,1],this._height=void 0,this.pixelRatio=1,this.resolution=0,this.rotation=0,this._source=null,this._width=void 0,this.x=0,this.y=0,this.immutable=r,this.source=e,this.requestRender=this.requestRender.bind(this)}destroy(){this._texture&&(this._texture.dispose(),this._texture=null),null!=this._uploadStatus&&(this._uploadStatus.controller.abort(),this._uploadStatus=null)}get isSourceScaled(){return this.width!==this._sourceWidth||this.height!==this._sourceHeight}get height(){return void 0!==this._height?this._height:this._sourceHeight}set height(e){this._height=e}get source(){return this._source}set source(e){null==e&&null==this._source||(this._source=e,this.invalidateTexture(),this.requestRender())}get width(){return void 0!==this._width?this._width:this._sourceWidth}set width(e){this._width=e}beforeRender(e){super.beforeRender(e),this.updateTexture(e)}setSourceAsync(e,r){var s=this;return(0,v.Z)(function*(){null!=s._uploadStatus&&s._uploadStatus.controller.abort();const _=new AbortController,c=(0,n.hh)();return(0,n.$F)(r,()=>_.abort()),(0,n.$F)(_,u=>c.reject(u)),s._uploadStatus={controller:_,resolver:c},s.source=e,c.promise})()}invalidateTexture(){this._textureInvalidated||(this._textureInvalidated=!0,this._source instanceof HTMLImageElement?(this._sourceHeight=this._source.naturalHeight,this._sourceWidth=this._source.naturalWidth):this._source&&(this._sourceHeight=this._source.height,this._sourceWidth=this._source.width))}updateTransitionProperties(e,r){e>=64&&(this.fadeTransitionEnabled=!1,this.inFadeTransition=!1),super.updateTransitionProperties(e,r)}setTransform(e){const r=(0,i.g)(this.transforms.dvs),[s,_]=e.toScreenNoRotation([0,0],[this.x,this.y]),c=this.resolution/this.pixelRatio/e.resolution,u=c*this.width,f=c*this.height,h=Math.PI*this.rotation/180;(0,i.h)(r,r,(0,o.f)(s,_)),(0,i.h)(r,r,(0,o.f)(u/2,f/2)),(0,i.r)(r,r,-h),(0,i.h)(r,r,(0,o.f)(-u/2,-f/2)),(0,i.l)(r,r,(0,o.f)(u,f)),(0,i.m)(this.transforms.dvs,e.displayViewMat3,r)}setSamplingProfile(e){this._texture&&(e.mips&&!this._texture.descriptor.hasMipmap&&this._texture.generateMipmap(),this._texture.setSamplingMode(e.samplingMode))}bind(e,r){this._texture&&e.bindTexture(this._texture,r)}updateTexture({context:e,painter:r}){var s=this;return(0,v.Z)(function*(){if(!s._textureInvalidated)return;if(s._textureInvalidated=!1,s._texture||(s._texture=s._createTexture(e)),!s.source)return void s._texture.setData(null);s._texture.resize(s._sourceWidth,s._sourceHeight);const _=function I(l){return E(l)?l instanceof d.Z?l.getRenderedRasterPixels()?.renderedRasterPixels:P(l):l}(s.source);try{if(null!=s._uploadStatus){const{controller:c,resolver:u}=s._uploadStatus,f={signal:c.signal},{width:h,height:a}=s,x=s._texture;yield r.textureUploadManager.enqueueTextureUpdate({data:_,texture:x,width:h,height:a},f),u.resolve(),s._uploadStatus=null}else s._texture.setData(_);s.ready()}catch(c){(0,n.H9)(c)}})()}onDetach(){this.destroy()}_createTransforms(){return{dvs:(0,p.c)()}}_createTexture(e){const r=this.immutable&&e.type===L.zO.WEBGL2,s=new D.X;return s.internalFormat=r?B.lP.RGBA8:B.VI.RGBA,s.wrapMode=B.e8.CLAMP_TO_EDGE,s.isImmutable=r,s.width=this._sourceWidth,s.height=this._sourceHeight,new T.x(e,s)}}},14403:(A,y,t)=>{t.d(y,{Z:()=>v});class v{constructor(i,p,o){this.pixelBlock=i,this.extent=p,this.originalPixelBlock=o}get width(){return null!=this.pixelBlock?this.pixelBlock.width:0}get height(){return null!=this.pixelBlock?this.pixelBlock.height:0}render(i){const p=this.pixelBlock;if(null==p)return;const o=this.filter({extent:this.extent,pixelBlock:this.originalPixelBlock??p});if(null==o.pixelBlock)return;o.pixelBlock.maskIsAlpha&&(o.pixelBlock.premultiplyAlpha=!0);const R=o.pixelBlock.getAsRGBA(),d=i.createImageData(o.pixelBlock.width,o.pixelBlock.height);d.data.set(R),i.putImageData(d,0,0)}getRenderedRasterPixels(){const i=this.filter({extent:this.extent,pixelBlock:this.pixelBlock});return null==i.pixelBlock?null:(i.pixelBlock.maskIsAlpha&&(i.pixelBlock.premultiplyAlpha=!0),{width:i.pixelBlock.width,height:i.pixelBlock.height,renderedRasterPixels:new Uint8Array(i.pixelBlock.getAsRGBA().buffer)})}}},6053:(A,y,t)=>{t.r(y),t.d(y,{default:()=>f});var v=t(15861),n=t(17626),i=t(63290),p=t(62208),o=t(10699),R=t(32917),d=t(77712),D=(t(90912),t(85931),t(8314),t(76898)),E=t(2004),P=t(91757),I=t(37384),W=t(67802),l=t(45611),e=t(94421),r=t(26584),s=t(13812),_=t(51920);const c=h=>{let a=class extends h{initialize(){this.exportImageParameters=new _.j({layer:this.layer})}destroy(){this.exportImageParameters=(0,p.SC)(this.exportImageParameters)}get exportImageVersion(){return this.exportImageParameters?.commitProperty("version"),this.commitProperty("timeExtent"),(this._get("exportImageVersion")||0)+1}fetchPopupFeatures(x){const{layer:m}=this;if(!x)return Promise.reject(new r.Z("wmslayerview:fetchPopupFeatures","Nothing to fetch without area",{layer:m}));const{popupEnabled:C}=m;if(!C)return Promise.reject(new r.Z("wmslayerview:fetchPopupFeatures","popupEnabled should be true",{popupEnabled:C}));const S=this.createFetchPopupFeaturesQuery(x);if(!S)return Promise.resolve([]);const{extent:g,width:M,height:O,x:U,y:w}=S;if(!(g&&M&&O))throw new r.Z("wmslayerview:fetchPopupFeatures","WMSLayer does not support fetching features.",{extent:g,width:M,height:O});return m.fetchFeatureInfo(g,M,O,U,w)}};return(0,n._)([(0,d.Cb)()],a.prototype,"exportImageParameters",void 0),(0,n._)([(0,d.Cb)({readOnly:!0})],a.prototype,"exportImageVersion",null),(0,n._)([(0,d.Cb)()],a.prototype,"layer",void 0),(0,n._)([(0,d.Cb)(s.qG)],a.prototype,"timeExtent",void 0),a=(0,n._)([(0,D.j)("esri.layers.mixins.WMSLayerView")],a),a};let u=class extends(c((0,e.Z)((0,I.y)(l.Z)))){constructor(){super(...arguments),this.bitmapContainer=new P.c}supportsSpatialReference(h){return this.layer.serviceSupportsSpatialReference(h)}update(h){this.strategy.update(h).catch(a=>{(0,o.D_)(a)||i.Z.getLogger(this).error(a)})}attach(){const{layer:h}=this,{imageMaxHeight:a,imageMaxWidth:x}=h;this.bitmapContainer=new P.c,this.container.addChild(this.bitmapContainer),this.strategy=new W.Z({container:this.bitmapContainer,fetchSource:this.fetchImage.bind(this),requestUpdate:this.requestUpdate.bind(this),imageMaxHeight:a,imageMaxWidth:x,imageRotationSupported:!1,imageNormalizationSupported:!1,hidpi:!1}),this.addAttachHandles((0,R.YP)(()=>this.exportImageVersion,()=>this.requestUpdate()))}detach(){this.strategy=(0,p.SC)(this.strategy),this.container.removeAllChildren()}moveStart(){}viewChange(){}moveEnd(){this.requestUpdate()}createFetchPopupFeaturesQuery(h){const{view:a,bitmapContainer:x}=this,{x:m,y:C}=h,{spatialReference:S}=a;let g,M=0,O=0;if(x.children.some(z=>{const{width:b,height:Z,resolution:F,x:j,y:K}=z,H=j+F*b,V=K-F*Z;return m>=j&&m<=H&&C<=K&&C>=V&&(g=new E.Z({xmin:j,ymin:V,xmax:H,ymax:K,spatialReference:S}),M=b,O=Z,!0)}),!g)return null;const U=g.width/M,w=Math.round((m-g.xmin)/U),G=Math.round((g.ymax-C)/U);return{extent:g,width:M,height:O,x:w,y:G}}doRefresh(){var h=this;return(0,v.Z)(function*(){h.requestUpdate()})()}isUpdating(){return this.strategy.updating||this.updateRequested}fetchImage(h,a,x,m){return this.layer.fetchImageBitmap(h,a,x,{timeExtent:this.timeExtent,...m})}};(0,n._)([(0,d.Cb)()],u.prototype,"strategy",void 0),(0,n._)([(0,d.Cb)()],u.prototype,"updating",void 0),u=(0,n._)([(0,D.j)("esri.views.2d.layers.WMSLayerView2D")],u);const f=u},94421:(A,y,t)=>{t.d(y,{Z:()=>T});var v=t(17626),n=t(63290),i=t(10699),p=t(32917),o=t(77712),B=(t(90912),t(85931),t(8314),t(76898));const T=D=>{let E=class extends D{initialize(){this.addHandles((0,p.on)(()=>this.layer,"refresh",P=>{this.doRefresh(P.dataChanged).catch(I=>{(0,i.D_)(I)||n.Z.getLogger(this).error(I)})}),"RefreshableLayerView")}};return(0,v._)([(0,o.Cb)()],E.prototype,"layer",void 0),E=(0,v._)([(0,B.j)("esri.layers.mixins.RefreshableLayerView")],E),E}}}]);