"use strict";(self.webpackChunkCRIS=self.webpackChunkCRIS||[]).push([[5881],{90301:(A,D,i)=>{i.d(D,{JZ:()=>O,RL:()=>v,eY:()=>T});var R=i(15861),g=i(10699),l=i(30217),x=i(49966),p=i(9545),I=i(57477),u=i(14403),f=i(80738),n=i(67969),E=i(18952),_=i(31548);function O(o){return o&&"render"in o}function v(o){const e=document.createElement("canvas");return e.width=o.width,e.height=o.height,o.render(e.getContext("2d")),e}class T extends I.s{constructor(e=null,s=!1){super(),this.blendFunction="standard",this._sourceWidth=0,this._sourceHeight=0,this._textureInvalidated=!1,this._texture=null,this.stencilRef=0,this.coordScale=[1,1],this._height=void 0,this.pixelRatio=1,this.resolution=0,this.rotation=0,this._source=null,this._width=void 0,this.x=0,this.y=0,this.immutable=s,this.source=e,this.requestRender=this.requestRender.bind(this)}destroy(){this._texture&&(this._texture.dispose(),this._texture=null),null!=this._uploadStatus&&(this._uploadStatus.controller.abort(),this._uploadStatus=null)}get isSourceScaled(){return this.width!==this._sourceWidth||this.height!==this._sourceHeight}get height(){return void 0!==this._height?this._height:this._sourceHeight}set height(e){this._height=e}get source(){return this._source}set source(e){null==e&&null==this._source||(this._source=e,this.invalidateTexture(),this.requestRender())}get width(){return void 0!==this._width?this._width:this._sourceWidth}set width(e){this._width=e}beforeRender(e){super.beforeRender(e),this.updateTexture(e)}setSourceAsync(e,s){var t=this;return(0,R.Z)(function*(){null!=t._uploadStatus&&t._uploadStatus.controller.abort();const r=new AbortController,h=(0,g.hh)();return(0,g.$F)(s,()=>r.abort()),(0,g.$F)(r,c=>h.reject(c)),t._uploadStatus={controller:r,resolver:h},t.source=e,h.promise})()}invalidateTexture(){this._textureInvalidated||(this._textureInvalidated=!0,this._source instanceof HTMLImageElement?(this._sourceHeight=this._source.naturalHeight,this._sourceWidth=this._source.naturalWidth):this._source&&(this._sourceHeight=this._source.height,this._sourceWidth=this._source.width))}updateTransitionProperties(e,s){e>=64&&(this.fadeTransitionEnabled=!1,this.inFadeTransition=!1),super.updateTransitionProperties(e,s)}setTransform(e){const s=(0,l.g)(this.transforms.dvs),[t,r]=e.toScreenNoRotation([0,0],[this.x,this.y]),h=this.resolution/this.pixelRatio/e.resolution,c=h*this.width,M=h*this.height,a=Math.PI*this.rotation/180;(0,l.h)(s,s,(0,p.f)(t,r)),(0,l.h)(s,s,(0,p.f)(c/2,M/2)),(0,l.r)(s,s,-a),(0,l.h)(s,s,(0,p.f)(-c/2,-M/2)),(0,l.l)(s,s,(0,p.f)(c,M)),(0,l.m)(this.transforms.dvs,e.displayViewMat3,s)}setSamplingProfile(e){this._texture&&(e.mips&&!this._texture.descriptor.hasMipmap&&this._texture.generateMipmap(),this._texture.setSamplingMode(e.samplingMode))}bind(e,s){this._texture&&e.bindTexture(this._texture,s)}updateTexture({context:e,painter:s}){var t=this;return(0,R.Z)(function*(){if(!t._textureInvalidated)return;if(t._textureInvalidated=!1,t._texture||(t._texture=t._createTexture(e)),!t.source)return void t._texture.setData(null);t._texture.resize(t._sourceWidth,t._sourceHeight);const r=function y(o){return O(o)?o instanceof u.Z?o.getRenderedRasterPixels()?.renderedRasterPixels:v(o):o}(t.source);try{if(null!=t._uploadStatus){const{controller:h,resolver:c}=t._uploadStatus,M={signal:h.signal},{width:a,height:m}=t,d=t._texture;yield s.textureUploadManager.enqueueTextureUpdate({data:r,texture:d,width:a,height:m},M),c.resolve(),t._uploadStatus=null}else t._texture.setData(r);t.ready()}catch(h){(0,g.H9)(h)}})()}onDetach(){this.destroy()}_createTransforms(){return{dvs:(0,x.c)()}}_createTexture(e){const s=this.immutable&&e.type===f.zO.WEBGL2,t=new _.X;return t.internalFormat=s?n.lP.RGBA8:n.VI.RGBA,t.wrapMode=n.e8.CLAMP_TO_EDGE,t.isImmutable=s,t.width=this._sourceWidth,t.height=this._sourceHeight,new E.x(e,t)}}},47123:(A,D,i)=>{i.d(D,{T:()=>T});var R=i(15861),g=i(10699),l=i(35133),x=i(28082),p=i(26268),I=i(23841),u=i(16730),f=i(21254),n=i(87526),E=i(17807),_=i(25575),O=i(31637);function v(o,e){const s=e.length;if(o<e[0].value||1===s)return e[0].size;for(let t=1;t<s;t++)if(o<e[t].value)return e[t-1].size+(o-e[t-1].value)/(e[t].value-e[t-1].value)*(e[t].size-e[t-1].size);return e[s-1].size}class y{constructor(){this.symbolLevels=[],this.vvColorValues=new Float32Array(8),this.vvColors=new Float32Array(32),this.vvOpacityValues=new Float32Array(8),this.vvOpacities=new Float32Array(8),this.vvSizeMinMaxValue=new Float32Array(4),this.outsideLabelsVisible=!1,this._vvMaterialParameters={vvSizeEnabled:!1,vvColorEnabled:!1,vvRotationEnabled:!1,vvRotationType:"geographic",vvOpacityEnabled:!1},this._technique=E.v}getSizeVVFieldStops(e){const s=this._vvSizeFieldStops;if(s)switch(s.type){case"static":return s;case"level-dependent":return s.levels[e]??(()=>{let t=1/0,r=0;for(const a in s.levels){const m=parseFloat(a),d=Math.abs(e-m);d<t&&(t=d,r=m)}if(t===1/0)return{sizes:new Float32Array([0,0,0,0,0,0]),values:new Float32Array([0,0,0,0,0,0])};const h=2**((e-r)/2),c=s.levels[r],M=new Float32Array(c.values);return M[2]*=h,M[3]*=h,{sizes:c.sizes,values:M}})();default:return}}get vvMaterialParameters(){return this._vvMaterialParameters}update(e){null!=this._vvInfo&&this._updateVisualVariables(this._vvInfo.vvRanges,e)}setInfo(e,s,t){this._updateEffects(t),this._vvInfo=s,this._technique=(0,_.EJ)(e),this.rendererSchema=this._technique.createOrUpdateRendererSchema(this.rendererSchema,e)}getVariation(){return{...this._technique.getVariation(this.rendererSchema),outsideLabelsVisible:this.outsideLabelsVisible,supportsTextureFloat:(0,O.hc)("2d").supportsTextureFloat}}getVariationHash(){return this._technique.getVariationHash(this.rendererSchema)<<1|(this.outsideLabelsVisible?1:0)}_updateEffects(e){this.outsideLabelsVisible=null!=e&&e.excludedLabelsVisible}_updateVisualVariables(e,s){const t=this._vvMaterialParameters;if(t.vvOpacityEnabled=!1,t.vvSizeEnabled=!1,t.vvColorEnabled=!1,t.vvRotationEnabled=!1,!e)return;const r=e.size;if(r){if(t.vvSizeEnabled=!0,r.minMaxValue){const a=r.minMaxValue;let m,d;if((0,n.$K)(a.minSize)&&(0,n.$K)(a.maxSize))if((0,n.hj)(a.minSize)&&(0,n.hj)(a.maxSize))m=(0,I.F2)(a.minSize),d=(0,I.F2)(a.maxSize);else{const P=s.scale;m=(0,I.F2)(v(P,a.minSize.stops)),d=(0,I.F2)(v(P,a.maxSize.stops))}this.vvSizeMinMaxValue.set([a.minDataValue,a.maxDataValue,m,d])}if(r.scaleStops&&(this.vvSizeScaleStopsValue=(0,I.F2)(v(s.scale,r.scaleStops.stops))),r.unitValue){const a=(0,u.c9)(s.spatialReference)/f.a[r.unitValue.unit];this.vvSizeUnitValueToPixelsRatio=a/s.resolution}r.fieldStops&&(this._vvSizeFieldStops=r.fieldStops)}const h=e.color;h&&(t.vvColorEnabled=!0,this.vvColorValues.set(h.values),this.vvColors.set(h.colors));const c=e.opacity;c&&(t.vvOpacityEnabled=!0,this.vvOpacityValues.set(c.values),this.vvOpacities.set(c.opacities));const M=e.rotation;M&&(t.vvRotationEnabled=!0,t.vvRotationType=M.type)}}class T extends p.Z{constructor(e){super(e),this._rendererInfo=new y,this._materialItemsRequestQueue=new l.Z,this.attributeView=new x.H(()=>this.onAttributeStoreUpdate())}destroy(){this.children.forEach(e=>e.destroy()),this.removeAllChildren(),this.attributeView.destroy(),this._materialItemsRequestQueue.clear()}setRendererInfo(e,s,t){this._rendererInfo.setInfo(e,s,t),this.requestRender()}getMaterialItems(e,s){var t=this;return(0,R.Z)(function*(){if(!e||0===e.length)return[];const r=(0,g.hh)();return t._materialItemsRequestQueue.push({items:e,abortOptions:s,resolver:r}),t.requestRender(),r.promise})()}doRender(e){if(e.context.capabilities.enable("textureFloat"),e.context.capabilities.enable("vao"),this._materialItemsRequestQueue.length>0){let s=this._materialItemsRequestQueue.pop();for(;s;)this._processMaterialItemRequest(e,s),s=this._materialItemsRequestQueue.pop()}super.doRender(e)}renderChildren(e){for(const s of this.children)s.commit(e);this._rendererInfo.update(e.state),super.renderChildren(e)}createRenderParams(e){const s=super.createRenderParams(e);return s.rendererInfo=this._rendererInfo,s.attributeView=this.attributeView,s}onAttributeStoreUpdate(){}_processMaterialItemRequest(e,{items:s,abortOptions:t,resolver:r}){const{painter:h,pixelRatio:c}=e,M=s.map(a=>h.textureManager.rasterizeItem(a.symbol,c,a.glyphIds,t));Promise.all(M).then(a=>{if(!this.stage)return void r.reject();const m=a.map((d,P)=>({id:s[P].id,mosaicItem:d}));r.resolve(m)},r.reject)}}},14403:(A,D,i)=>{i.d(D,{Z:()=>R});class R{constructor(l,x,p){this.pixelBlock=l,this.extent=x,this.originalPixelBlock=p}get width(){return null!=this.pixelBlock?this.pixelBlock.width:0}get height(){return null!=this.pixelBlock?this.pixelBlock.height:0}render(l){const x=this.pixelBlock;if(null==x)return;const p=this.filter({extent:this.extent,pixelBlock:this.originalPixelBlock??x});if(null==p.pixelBlock)return;p.pixelBlock.maskIsAlpha&&(p.pixelBlock.premultiplyAlpha=!0);const I=p.pixelBlock.getAsRGBA(),u=l.createImageData(p.pixelBlock.width,p.pixelBlock.height);u.data.set(I),l.putImageData(u,0,0)}getRenderedRasterPixels(){const l=this.filter({extent:this.extent,pixelBlock:this.pixelBlock});return null==l.pixelBlock?null:(l.pixelBlock.maskIsAlpha&&(l.pixelBlock.premultiplyAlpha=!0),{width:l.pixelBlock.width,height:l.pixelBlock.height,renderedRasterPixels:new Uint8Array(l.pixelBlock.getAsRGBA().buffer)})}}},26268:(A,D,i)=>{i.d(D,{Z:()=>u});var R=i(8314),g=i(39406),l=i(44589),x=i(8650),p=i(13382);const I=(f,n)=>f.key.level-n.key.level!=0?f.key.level-n.key.level:f.key.row-n.key.row!=0?f.key.row-n.key.row:f.key.col-n.key.col;class u extends l.Z{constructor(n){super(),this._tileInfoView=n}renderChildren(n){this.sortChildren(I),this.setStencilReference(n),super.renderChildren(n)}createRenderParams(n){const{state:E}=n,_=super.createRenderParams(n);return _.requiredLevel=this._tileInfoView.getClosestInfoForScale(E.scale).level,_.displayLevel=this._tileInfoView.tileInfo.scaleToZoom(E.scale),_}prepareRenderPasses(n){const E=super.prepareRenderPasses(n);return E.push(n.registerRenderPass({name:"stencil",brushes:[p.Z],drawPhase:g.jx.DEBUG|g.jx.MAP|g.jx.HIGHLIGHT,target:()=>this.getStencilTarget()})),(0,R.Z)("esri-tiles-debug")&&E.push(n.registerRenderPass({name:"tileInfo",brushes:[x.Z],drawPhase:g.jx.DEBUG,target:()=>this.children})),E}getStencilTarget(){return this.children}setStencilReference(n){let E=1;for(const _ of this.children)_.stencilRef=E++}}},55051:(A,D,i)=>{i.d(D,{Z:()=>e});var R=i(62208),g=i(47123),l=i(30217),x=i(49966),p=i(9545),I=i(14658),u=i(93555),f=i(57477),n=i(87526),E=i(83994),_=i(67969),O=i(49353);const v=Math.PI/180;class T extends f.s{constructor(t){super(),this._program=null,this._vao=null,this._vertexBuffer=null,this._indexBuffer=null,this._dvsMat3=(0,x.c)(),this._localOrigin={x:0,y:0},this._getBounds=t}destroy(){this._vao&&(this._vao.dispose(),this._vao=null,this._vertexBuffer=null,this._indexBuffer=null),this._program=(0,R.M2)(this._program)}doRender(t){const{context:r}=t,h=this._getBounds();if(h.length<1)return;this._createShaderProgram(r),this._updateMatricesAndLocalOrigin(t),this._updateBufferData(r,h),r.setBlendingEnabled(!0),r.setDepthTestEnabled(!1),r.setStencilWriteMask(0),r.setStencilTestEnabled(!1),r.setBlendFunction(_.zi.ONE,_.zi.ONE_MINUS_SRC_ALPHA),r.setColorMask(!0,!0,!0,!0);const c=this._program;r.bindVAO(this._vao),r.useProgram(c),c.setUniformMatrix3fv("u_dvsMat3",this._dvsMat3),r.gl.lineWidth(1),r.drawElements(_.MX.LINES,8*h.length,_.g.UNSIGNED_INT,0),r.bindVAO()}_createTransforms(){return{dvs:(0,x.c)()}}_createShaderProgram(t){this._program||(this._program=t.programCache.acquire("precision highp float;\n        uniform mat3 u_dvsMat3;\n\n        attribute vec2 a_position;\n\n        void main() {\n          mediump vec3 pos = u_dvsMat3 * vec3(a_position, 1.0);\n          gl_Position = vec4(pos.xy, 0.0, 1.0);\n        }","precision mediump float;\n      void main() {\n        gl_FragColor = vec4(0.75, 0.0, 0.0, 0.75);\n      }",o().attributes))}_updateMatricesAndLocalOrigin(t){const{state:r}=t,{displayMat3:h,size:c,resolution:M,pixelRatio:a,rotation:m,viewpoint:d}=r,P=v*m,{x:B,y:L}=d.targetGeometry,U=(0,u.or)(B,r.spatialReference);this._localOrigin.x=U,this._localOrigin.y=L;const b=a*c[0],S=a*c[1],j=M*b,W=M*S,C=(0,l.g)(this._dvsMat3);(0,l.m)(C,C,h),(0,l.h)(C,C,(0,p.f)(b/2,S/2)),(0,l.c)(C,C,(0,I.f)(c[0]/j,-S/W,1)),(0,l.r)(C,C,-P)}_updateBufferData(t,r){const{x:h,y:c}=this._localOrigin,a=new Float32Array(8*r.length),m=new Uint32Array(8*r.length);let d=0,P=0;for(const B of r)B&&(a[2*d]=B[0]-h,a[2*d+1]=B[1]-c,a[2*d+2]=B[0]-h,a[2*d+3]=B[3]-c,a[2*d+4]=B[2]-h,a[2*d+5]=B[3]-c,a[2*d+6]=B[2]-h,a[2*d+7]=B[1]-c,m[P]=d+0,m[P+1]=d+3,m[P+2]=d+3,m[P+3]=d+2,m[P+4]=d+2,m[P+5]=d+1,m[P+6]=d+1,m[P+7]=d+0,d+=4,P+=8);if(this._vertexBuffer?this._vertexBuffer.setData(a.buffer):this._vertexBuffer=E.f.createVertex(t,_.l1.DYNAMIC_DRAW,a.buffer),this._indexBuffer?this._indexBuffer.setData(m):this._indexBuffer=E.f.createIndex(t,_.l1.DYNAMIC_DRAW,m),!this._vao){const B=o();this._vao=new O.U(t,B.attributes,B.bufferLayouts,{geometry:this._vertexBuffer},this._indexBuffer)}}}const o=()=>(0,n.cM)("bounds",{geometry:[{location:0,name:"a_position",count:2,type:_.g.FLOAT}]});let e=class extends g.T{constructor(s){super(s),this.checkHighlight=()=>!0}destroy(){super.destroy(),this._boundsRenderer=(0,R.SC)(this._boundsRenderer)}enableRenderingBounds(s){this._boundsRenderer=new T(s),this.requestRender()}get hasHighlight(){return this.checkHighlight()}onTileData(s,t){s.patch(t),this.contains(s)||this.addChild(s),this.requestRender()}onTileError(s){s.clear(),this.contains(s)||this.addChild(s)}_renderChildren(s,t){for(const r of this.children)r.isReady&&r.hasData&&(r.commit(s),s.context.setStencilFunction(_.wb.EQUAL,r.stencilRef,255),r.getDisplayList().replay(s,r,t))}}},13305:(A,D,i)=>{i.d(D,{Z:()=>O});var R=i(17626),u=(i(63290),i(90912),i(85931),i(8314),i(26584),i(76898)),f=i(39406),n=i(55051),E=i(67969);let _=class extends n.Z{get hasHighlight(){return this.children.some(v=>v.hasData)}renderChildren(v){if(v.drawPhase!==f.jx.HIGHLIGHT||(this.attributeView.update(),!this.children.some(o=>o.hasData)))return;this.attributeView.bindTextures(v.context),super.renderChildren(v);const{painter:y}=v,T=y.effects.highlight;T.bind(v),v.context.setColorMask(!0,!0,!0,!0),v.context.clear(E.lk.COLOR_BUFFER_BIT),this._renderChildren(v,T.defines.concat(["highlightAll"])),T.draw(v),T.unbind()}};_=(0,R._)([(0,u.j)("esri.views.2d.layers.support.HighlightGraphicContainer")],_);const O=_},94421:(A,D,i)=>{i.d(D,{Z:()=>E});var R=i(17626),g=i(63290),l=i(10699),x=i(32917),p=i(77712),n=(i(90912),i(85931),i(8314),i(76898));const E=_=>{let O=class extends _{initialize(){this.addHandles((0,x.on)(()=>this.layer,"refresh",v=>{this.doRefresh(v.dataChanged).catch(y=>{(0,l.D_)(y)||g.Z.getLogger(this).error(y)})}),"RefreshableLayerView")}};return(0,R._)([(0,p.Cb)()],O.prototype,"layer",void 0),O=(0,R._)([(0,n.j)("esri.layers.mixins.RefreshableLayerView")],O),O}},10023:(A,D,i)=>{i.d(D,{V5:()=>p,e7:()=>l});var R=i(15861),g=i(90194);function l(u){return x.apply(this,arguments)}function x(){return(x=(0,R.Z)(function*(u,f=u.popupTemplate){if(null==f)return[];const n=yield f.getRequiredFields(u.fieldsIndex),{lastEditInfoEnabled:E}=f,{objectIdField:_,typeIdField:O,globalIdField:v,relationships:y}=u;if(n.includes("*"))return["*"];const T=E?(0,g.CH)(u):[],o=(0,g.Q0)(u.fieldsIndex,[...n,...T]);return O&&o.push(O),o&&_&&u.fieldsIndex?.has(_)&&!o.includes(_)&&o.push(_),o&&v&&u.fieldsIndex?.has(v)&&!o.includes(v)&&o.push(v),y&&y.forEach(e=>{const{keyField:s}=e;o&&s&&u.fieldsIndex?.has(s)&&!o.includes(s)&&o.push(s)}),o})).apply(this,arguments)}function p(u,f){return u.popupTemplate?u.popupTemplate:null!=f&&f.defaultPopupTemplateEnabled&&null!=u.defaultPopupTemplate?u.defaultPopupTemplate:null}}}]);