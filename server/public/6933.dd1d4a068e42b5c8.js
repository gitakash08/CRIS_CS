"use strict";(self.webpackChunkCRIS=self.webpackChunkCRIS||[]).push([[6933,9683],{50011:(_,P,s)=>{s.d(P,{F:()=>W,M:()=>h});const h={Base64:0,Hex:1,String:2,Raw:3},p=8,C=(1<<p)-1;function S(n,y){const t=(65535&n)+(65535&y);return(n>>16)+(y>>16)+(t>>16)<<16|65535&t}function F(n,y,t,i,l,o){return S(function R(n,y){return n<<y|n>>>32-y}(S(S(y,n),S(i,o)),l),t)}function v(n,y,t,i,l,o,d){return F(y&t|~y&i,n,y,l,o,d)}function m(n,y,t,i,l,o,d){return F(y&i|t&~i,n,y,l,o,d)}function I(n,y,t,i,l,o,d){return F(y^t^i,n,y,l,o,d)}function E(n,y,t,i,l,o,d){return F(t^(y|~i),n,y,l,o,d)}function W(n,y=h.Hex){const t=y||h.Base64,i=function B(n,y){n[y>>5]|=128<<y%32,n[14+(y+64>>>9<<4)]=y;let t=1732584193,i=-271733879,l=-1732584194,o=271733878;for(let d=0;d<n.length;d+=16){const u=t,M=i,Z=l,A=o;t=v(t,i,l,o,n[d],7,-680876936),o=v(o,t,i,l,n[d+1],12,-389564586),l=v(l,o,t,i,n[d+2],17,606105819),i=v(i,l,o,t,n[d+3],22,-1044525330),t=v(t,i,l,o,n[d+4],7,-176418897),o=v(o,t,i,l,n[d+5],12,1200080426),l=v(l,o,t,i,n[d+6],17,-1473231341),i=v(i,l,o,t,n[d+7],22,-45705983),t=v(t,i,l,o,n[d+8],7,1770035416),o=v(o,t,i,l,n[d+9],12,-1958414417),l=v(l,o,t,i,n[d+10],17,-42063),i=v(i,l,o,t,n[d+11],22,-1990404162),t=v(t,i,l,o,n[d+12],7,1804603682),o=v(o,t,i,l,n[d+13],12,-40341101),l=v(l,o,t,i,n[d+14],17,-1502002290),i=v(i,l,o,t,n[d+15],22,1236535329),t=m(t,i,l,o,n[d+1],5,-165796510),o=m(o,t,i,l,n[d+6],9,-1069501632),l=m(l,o,t,i,n[d+11],14,643717713),i=m(i,l,o,t,n[d],20,-373897302),t=m(t,i,l,o,n[d+5],5,-701558691),o=m(o,t,i,l,n[d+10],9,38016083),l=m(l,o,t,i,n[d+15],14,-660478335),i=m(i,l,o,t,n[d+4],20,-405537848),t=m(t,i,l,o,n[d+9],5,568446438),o=m(o,t,i,l,n[d+14],9,-1019803690),l=m(l,o,t,i,n[d+3],14,-187363961),i=m(i,l,o,t,n[d+8],20,1163531501),t=m(t,i,l,o,n[d+13],5,-1444681467),o=m(o,t,i,l,n[d+2],9,-51403784),l=m(l,o,t,i,n[d+7],14,1735328473),i=m(i,l,o,t,n[d+12],20,-1926607734),t=I(t,i,l,o,n[d+5],4,-378558),o=I(o,t,i,l,n[d+8],11,-2022574463),l=I(l,o,t,i,n[d+11],16,1839030562),i=I(i,l,o,t,n[d+14],23,-35309556),t=I(t,i,l,o,n[d+1],4,-1530992060),o=I(o,t,i,l,n[d+4],11,1272893353),l=I(l,o,t,i,n[d+7],16,-155497632),i=I(i,l,o,t,n[d+10],23,-1094730640),t=I(t,i,l,o,n[d+13],4,681279174),o=I(o,t,i,l,n[d],11,-358537222),l=I(l,o,t,i,n[d+3],16,-722521979),i=I(i,l,o,t,n[d+6],23,76029189),t=I(t,i,l,o,n[d+9],4,-640364487),o=I(o,t,i,l,n[d+12],11,-421815835),l=I(l,o,t,i,n[d+15],16,530742520),i=I(i,l,o,t,n[d+2],23,-995338651),t=E(t,i,l,o,n[d],6,-198630844),o=E(o,t,i,l,n[d+7],10,1126891415),l=E(l,o,t,i,n[d+14],15,-1416354905),i=E(i,l,o,t,n[d+5],21,-57434055),t=E(t,i,l,o,n[d+12],6,1700485571),o=E(o,t,i,l,n[d+3],10,-1894986606),l=E(l,o,t,i,n[d+10],15,-1051523),i=E(i,l,o,t,n[d+1],21,-2054922799),t=E(t,i,l,o,n[d+8],6,1873313359),o=E(o,t,i,l,n[d+15],10,-30611744),l=E(l,o,t,i,n[d+6],15,-1560198380),i=E(i,l,o,t,n[d+13],21,1309151649),t=E(t,i,l,o,n[d+4],6,-145523070),o=E(o,t,i,l,n[d+11],10,-1120210379),l=E(l,o,t,i,n[d+2],15,718787259),i=E(i,l,o,t,n[d+9],21,-343485551),t=S(t,u),i=S(i,M),l=S(l,Z),o=S(o,A)}return[t,i,l,o]}(function w(n){const y=[];for(let t=0,i=n.length*p;t<i;t+=p)y[t>>5]|=(n.charCodeAt(t/p)&C)<<t%32;return y}(n),n.length*p);switch(t){case h.Raw:return i;case h.Hex:return function j(n){const y="0123456789abcdef",t=[];for(let i=0,l=4*n.length;i<l;i++)t.push(y.charAt(n[i>>2]>>i%4*8+4&15)+y.charAt(n[i>>2]>>i%4*8&15));return t.join("")}(i);case h.String:return function x(n){const y=[];for(let t=0,i=32*n.length;t<i;t+=p)y.push(String.fromCharCode(n[t>>5]>>>t%32&C));return y.join("")}(i);case h.Base64:return function L(n){const i=[];for(let l=0,o=4*n.length;l<o;l+=3){const d=(n[l>>2]>>l%4*8&255)<<16|(n[l+1>>2]>>(l+1)%4*8&255)<<8|n[l+2>>2]>>(l+2)%4*8&255;for(let u=0;u<4;u++)i.push(8*l+6*u>32*n.length?"=":"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(d>>6*(3-u)&63))}return i.join("")}(i)}}},27559:(_,P,s)=>{s.r(P),s.d(P,{default:()=>Ne});var h=s(15861),p=s(17626),C=s(88879),S=s(73281),E=(s(4832),s(49067),s(96794),s(69747),s(40425),s(69357),s(40342),s(73640),s(33474),s(32088)),B=s(84792),W=s(79608),n=s(74333),y=s(26584),t=s(63290),i=s(99959),l=s(10699),o=s(32917),d=s(21726),u=s(77712),K=(s(90912),s(85931),s(8314),s(52323)),T=s(68653),N=s(76898),Q=s(31283),z=s(44917),J=s(50085),ae=s(65088),ne=s(6733),le=s(49286),O=s(6647),k=s(99555),V=s(42432),Y=s(38305),ee=s(39593),te=s(59787),D=s(13812),fe=s(56347),Fe=s(83989),Oe=s(47058),Ce=s(55911),Se=s(60466),de=s(90194),X=s(35031),je=s(170),ge=s(62667),Pe=s(2430),Re=s(30164),pe=s(86810);let G=class extends pe.wq{constructor(){super(...arguments),this.name=null,this.field=null,this.currentRangeExtent=null,this.fullRangeExtent=null,this.type="rangeInfo"}};(0,p._)([(0,u.Cb)({type:String,json:{read:!0,write:!0}})],G.prototype,"name",void 0),(0,p._)([(0,u.Cb)({type:String,json:{read:!0,write:!0}})],G.prototype,"field",void 0),(0,p._)([(0,u.Cb)({type:[Number],json:{read:!0,write:!0}})],G.prototype,"currentRangeExtent",void 0),(0,p._)([(0,u.Cb)({type:[Number],json:{read:!0,write:!0}})],G.prototype,"fullRangeExtent",void 0),(0,p._)([(0,u.Cb)({type:["rangeInfo"],readOnly:!0,json:{read:!1,write:!0}})],G.prototype,"type",void 0),G=(0,p._)([(0,N.j)("esri.layers.support.RangeInfo")],G);var re,De=s(58817),Ae=s(128),ve=s(14889),ue=s(37118),me=s(5464);let ye=re=class extends((0,pe.eC)(n.Z.ofType(ue.Z))){constructor(e){super(e)}clone(){return new re(this.items.map(e=>e.clone()))}write(e,a){return this.toJSON(a)}toJSON(e){const a=e?.layer?.spatialReference;return a?this.toArray().map(r=>{if(!a.equals(r.spatialReference)){if(!(0,me.canProjectWithoutEngine)(r.spatialReference,a))return e?.messages&&e.messages.push(new ve.Z("scenefilter:unsupported","Scene filters with incompatible spatial references are not supported",{modification:this,spatialReference:e.layer.spatialReference,context:e})),null;const g=new ue.Z;(0,me.projectPolygon)(r,g,a),r=g}const f=r.toJSON(e);return delete f.spatialReference,f}).filter(r=>null!=r):(e?.messages&&e.messages.push(new ve.Z("scenefilter:unsupported","Writing Scene filters without context layer is not supported",{modification:this,spatialReference:e.layer.spatialReference,context:e})),this.toArray().map(r=>r.toJSON(e)))}static fromJSON(e,a){const r=new re;return e.forEach(f=>r.add(ue.Z.fromJSON(f,a))),r}};ye=re=(0,p._)([(0,N.j)("esri.layers.support.PolygonCollection")],ye);const se=ye;var ce,Me=s(29840);let $=ce=class extends pe.wq{constructor(e){super(e),this.spatialRelationship="disjoint",this.geometries=new se,this._geometriesSource=null}initialize(){this.addHandles((0,o.on)(()=>this.geometries,"after-changes",()=>this.geometries=this.geometries,o.Z_))}readGeometries(e,a,r){Array.isArray(e)?this.geometries=se.fromJSON(e,r):this._geometriesSource={url:(0,Me.f)(e,r),context:r}}loadGeometries(e,a){var r=this;return(0,h.Z)(function*(){if(null==r._geometriesSource)return;const{url:f,context:g}=r._geometriesSource,b=yield(0,B.Z)(f,{responseType:"json",signal:a?.signal}),U=e.toJSON(),H=b.data.map(q=>({...q,spatialReference:U}));r.geometries=se.fromJSON(H,g),r._geometriesSource=null})()}clone(){const e=new ce({geometries:(0,De.d9)(this.geometries),spatialRelationship:this.spatialRelationship});return e._geometriesSource=this._geometriesSource,e}};(0,p._)([(0,u.Cb)({type:["disjoint","contains"],nonNullable:!0,json:{write:!0}})],$.prototype,"spatialRelationship",void 0),(0,p._)([(0,u.Cb)({type:se,nonNullable:!0,json:{write:!0}}),(0,Ae.B)({origins:["web-scene","portal-item"],type:"resource",prefix:"geometries",contentAddressed:!0})],$.prototype,"geometries",void 0),(0,p._)([(0,T.r)(["web-scene","portal-item"],"geometries")],$.prototype,"readGeometries",null),$=ce=(0,p._)([(0,N.j)("esri.layers.support.SceneFilter")],$);const Te=$;var Ue=s(39683),xe=s(96854),ie=s(60507),Ie=s(35560),Ze=s(49430),we=s(95178),be=s(10023),Be=s(92236);const We=new Set(["3DObject","Point"]),Ee=(0,Ce.v)();let c=class extends((0,ne.o1)((0,V.Vt)((0,ae.Y)((0,le.q)((0,O.I)((0,k.M)((0,i.R)((0,J.V)((0,W.J)(z.Z)))))))))){constructor(...e){super(...e),this.featureReduction=null,this.rangeInfos=null,this.operationalLayerType="ArcGISSceneServiceLayer",this.type="scene",this.fields=null,this.floorInfo=null,this.outFields=null,this.nodePages=null,this.materialDefinitions=null,this.textureSetDefinitions=null,this.geometryDefinitions=null,this.serviceUpdateTimeStamp=null,this.excludeObjectIds=new n.Z,this.definitionExpression=null,this.filter=null,this.path=null,this.labelsVisible=!0,this.labelingInfo=null,this.legendEnabled=!0,this.priority=null,this.semantic=null,this.cachedDrawingInfo={color:!1},this.popupEnabled=!0,this.popupTemplate=null,this.objectIdField=null,this.globalIdField=null,this._fieldUsageInfo={},this.screenSizePerspectiveEnabled=!0,this.serviceItemId=void 0}normalizeCtorArgs(e,a){return"string"==typeof e?{url:e,...a}:e}destroy(){this._set("renderer",null)}getField(e){return this.fieldsIndex.get(e)}getFieldDomain(e,a){const r=this.getFeatureType(a?.feature)?.domains?.[e];return r&&"inherited"!==r.type?r:this.getField(e)?.domain??null}getFeatureType(e){return e&&this.associatedLayer?this.associatedLayer.getFeatureType(e):null}get types(){return this.associatedLayer?.types??[]}get typeIdField(){return this.associatedLayer?.typeIdField??null}get templates(){return this.associatedLayer?.templates??null}get formTemplate(){return this.associatedLayer?.formTemplate??null}get fieldsIndex(){return new Se.Z(this.fields)}readNodePages(e,a,r){return"Point"===a.layerType&&(e=a.pointNodePages),null==e||"object"!=typeof e?null:X.U4.fromJSON(e,r)}set elevationInfo(e){this._set("elevationInfo",e),this.loaded&&this._validateElevationInfo()}get effectiveCapabilities(){return this._capabilitiesFromAssociatedFeatureLayer(this.associatedLayer?.effectiveCapabilities)}get effectiveEditingEnabled(){return null!=this.associatedLayer&&(0,fe.sX)(this.associatedLayer)}get geometryType(){return Ke[this.profile]||"mesh"}set renderer(e){(0,de.YN)(e,this.fieldsIndex),this._set("renderer",e)}readCachedDrawingInfo(e){return null!=e&&"object"==typeof e||(e={}),null==e.color&&(e.color=!1),e}get capabilities(){return this._capabilitiesFromAssociatedFeatureLayer(this.associatedLayer?.capabilities)}_capabilitiesFromAssociatedFeatureLayer(e){e=e??te.C;const{query:a,queryRelated:r,editing:{supportsGlobalId:f,supportsRollbackOnFailure:g,supportsUploadWithItemId:b,supportsGeometryUpdate:U,supportsReturnServiceEditsInSourceSpatialReference:H},data:{supportsZ:q,supportsM:Ve,isVersioned:Ge,supportsAttachment:Qe},operations:{supportsEditing:He,supportsAdd:_e,supportsUpdate:Je,supportsDelete:$e,supportsQuery:ze,supportsQueryAttachments:Ye,supportsAsyncConvert3D:Xe}}=e,oe=e.operations.supportsChangeTracking,he=!!this.associatedLayer?.infoFor3D&&(0,Ie.Rx)();return{query:a,queryRelated:r,editing:{supportsGlobalId:f,supportsReturnServiceEditsInSourceSpatialReference:H,supportsRollbackOnFailure:g,supportsGeometryUpdate:he&&U,supportsUploadWithItemId:b},data:{supportsAttachment:Qe,supportsZ:q,supportsM:Ve,isVersioned:Ge},operations:{supportsQuery:ze,supportsQueryAttachments:Ye,supportsEditing:He&&oe,supportsAdd:he&&_e&&oe,supportsDelete:he&&$e&&oe,supportsUpdate:Je&&oe,supportsAsyncConvert3D:Xe}}}get editingEnabled(){return this._isOverridden("editingEnabled")?this._get("editingEnabled"):this.associatedLayer?.editingEnabled??!1}set editingEnabled(e){this._overrideIfSome("editingEnabled",e)}get infoFor3D(){return this.associatedLayer?.infoFor3D??null}get relationships(){return this.associatedLayer?.relationships}get defaultPopupTemplate(){return this.associatedLayer||this.attributeStorageInfo?this.createPopupTemplate():null}readObjectIdField(e,a){return!e&&a.fields&&a.fields.some(r=>("esriFieldTypeOID"===r.type&&(e=r.name),!!e)),e||void 0}readGlobalIdField(e,a){return!e&&a.fields&&a.fields.some(r=>("esriFieldTypeGlobalID"===r.type&&(e=r.name),!!e)),e||void 0}get displayField(){return this.associatedLayer?.displayField??null}readProfile(e,a){const r=a.store.profile;return null!=r&&Le[r]?Le[r]:(t.Z.getLogger(this).error("Unknown or missing profile",{profile:r,layer:this}),"mesh-pyramids")}load(e){return this.addResolvingPromise(this._load(e)),Promise.resolve(this)}_load(e){var a=this;return(0,h.Z)(function*(){const r=null!=e?e.signal:null;yield a.loadFromPortal({supportedTypes:["Scene Service"]},e).catch(l.r9),yield a._fetchService(r),yield Promise.all([a._fetchIndexAndUpdateExtent(a.nodePages,r),a._setAssociatedFeatureLayer(r),a._loadFilterGeometries()]),a._validateElevationInfo(),a._applyAssociatedLayerOverrides(),a._populateFieldUsageInfo(),yield(0,Ue.y)(a,{origin:"service"},r),(0,de.YN)(a.renderer,a.fieldsIndex),yield a.finishLoadEditablePortalLayer(e)})()}beforeSave(){var e=this;return(0,h.Z)(function*(){null!=e.filter&&(e.filter=e.filter.clone(),yield e.load())})()}_loadFilterGeometries(){var e=this;return(0,h.Z)(function*(){if(e.filter)try{yield e.filter.loadGeometries(e.spatialReference)}catch(a){t.Z.getLogger(e).error("#_loadFilterGeometries()",e,"Failed to load filter geometries. Geometry filter will not be applied for this layer.",{error:a}),e.filter=null}})()}createQuery(){const e=new xe.Z;return"mesh"!==this.geometryType&&(e.returnGeometry=!0,e.returnZ=!0),e.where=this.definitionExpression||"1=1",e.sqlFormat="standard",e.outFields=["*"],e}queryExtent(e,a){return this._getAssociatedLayerForQuery().then(r=>r.queryExtent(e||this.createQuery(),a))}queryFeatureCount(e,a){return this._getAssociatedLayerForQuery().then(r=>r.queryFeatureCount(e||this.createQuery(),a))}queryFeatures(e,a){return this._getAssociatedLayerForQuery().then(r=>r.queryFeatures(e||this.createQuery(),a)).then(r=>{if(r?.features)for(const f of r.features)f.layer=this,f.sourceLayer=this;return r})}queryRelatedFeatures(e,a){var r=this;return(0,h.Z)(function*(){if(yield r.load(),!r.associatedLayer)throw new y.Z("scenelayer:query-not-available","SceneLayer queries are not available without an associated feature layer",{layer:r});return r.associatedLayer.queryRelatedFeatures(e,a)})()}queryRelatedFeaturesCount(e,a){var r=this;return(0,h.Z)(function*(){if(yield r.load(),!r.associatedLayer)throw new y.Z("scenelayer:query-not-available","SceneLayer queries are not available without an associated feature layer",{layer:r});return r.associatedLayer.queryRelatedFeaturesCount(e,a)})()}queryCachedAttributes(e,a){var r=this;return(0,h.Z)(function*(){const f=(0,de.Lk)(r.fieldsIndex,yield(0,be.e7)(r,(0,be.V5)(r)));return(0,we.xe)(r.parsedUrl.path,r.attributeStorageInfo??[],e,a,f)})()}queryCachedFeature(e,a){var r=this;return(0,h.Z)(function*(){const f=yield r.queryCachedAttributes(e,[a]);if(!f||0===f.length)throw new y.Z("scenelayer:feature-not-in-cached-data","Feature not found in cached data");const g=new C.Z;return g.attributes=f[0],g.layer=r,g.sourceLayer=r,g})()}queryObjectIds(e,a){return this._getAssociatedLayerForQuery().then(r=>r.queryObjectIds(e||this.createQuery(),a))}queryAttachments(e,a){return this._getAssociatedLayerForQuery().then(r=>r.queryAttachments(e,a))}getFieldUsageInfo(e){const a={supportsLabelingInfo:!1,supportsRenderer:!1,supportsPopupTemplate:!1,supportsLayerQuery:!1};return this.loaded?this._fieldUsageInfo[e]||a:(t.Z.getLogger(this).error("#getFieldUsageInfo()","Unavailable until layer is loaded"),a)}createPopupTemplate(e){return(0,Ze.eZ)(this,e)}_getAssociatedLayerForQuery(){const e=this.associatedLayer;return e?.loaded?Promise.resolve(e):this._loadAssociatedLayerForQuery()}_loadAssociatedLayerForQuery(){var e=this;return(0,h.Z)(function*(){if(yield e.load(),!e.associatedLayer)throw new y.Z("scenelayer:query-not-available","SceneLayer queries are not available without an associated feature layer",{layer:e});try{yield e.associatedLayer.load()}catch(a){throw new y.Z("scenelayer:query-not-available","SceneLayer associated feature layer could not be loaded",{layer:e,error:a})}return e.associatedLayer})()}hasCachedStatistics(e){return null!=this.statisticsInfo&&this.statisticsInfo.some(a=>a.name===e)}queryCachedStatistics(e,a){var r=this;return(0,h.Z)(function*(){if(yield r.load(a),!r.statisticsInfo)throw new y.Z("scenelayer:no-cached-statistics","Cached statistics are not available for this layer");const f=r.fieldsIndex.get(e);if(!f)throw new y.Z("scenelayer:field-unexisting",`Field '${e}' does not exist on the layer`);for(const g of r.statisticsInfo)if(g.name===f.name){const b=(0,d.v_)(r.parsedUrl.path,g.href);return(0,B.Z)(b,{query:{f:"json",token:r.apiKey},responseType:"json",signal:a?a.signal:null}).then(U=>U.data)}throw new y.Z("scenelayer:no-cached-statistics","Cached statistics for this attribute are not available")})()}saveAs(e,a){var r=this;return(0,h.Z)(function*(){return r._debouncedSaveOperations(V.xp.SAVE_AS,{...a,getTypeKeywords:()=>r._getTypeKeywords(),portalItemLayerType:"scene"},e)})()}save(){var e=this;return(0,h.Z)(function*(){const a={getTypeKeywords:()=>e._getTypeKeywords(),portalItemLayerType:"scene"};return e._debouncedSaveOperations(V.xp.SAVE,a)})()}applyEdits(e,a){var r=this;return(0,h.Z)(function*(){const{applyEdits:f}=yield s.e(1e3).then(s.bind(s,81913));let g=a;yield r.load();const b=r.associatedLayer;if(!b)throw new y.Z(`${r.type}-layer:not-editable`,"Service is not editable");yield b.load();const{globalIdField:U}=b,H=!!b.infoFor3D,q=g?.globalIdUsed??!0;if(H&&null==U)throw new y.Z(`${r.type}-layer:not-editable`,"Valid globalIdField expected on editable SceneLayer");if(H&&!q)throw new y.Z(`${r.type}-layer:globalid-required`,"globalIdUsed must not be false for SceneLayer editing as globalIds are required.");return(0,Y.M8)(b.url)&&H&&null!=e.deleteFeatures&&null!=U&&(g={...g,globalIdToObjectId:yield(0,fe.HW)(b,e.deleteFeatures,U)}),f(r,b.source,e,g)})()}uploadAssets(e,a){var r=this;return(0,h.Z)(function*(){if(yield r.load(),null==r.associatedLayer)throw new y.Z(`${r.type}-layer:not-editable`,"Service is not editable");return yield r.associatedLayer.load(),r.associatedLayer.uploadAssets(e,a)})()}on(e,a){return super.on(e,a)}validateLayer(e){if(e.layerType&&!We.has(e.layerType))throw new y.Z("scenelayer:layer-type-not-supported","SceneLayer does not support this layer type",{layerType:e.layerType});if(isNaN(this.version.major)||isNaN(this.version.minor))throw new y.Z("layer:service-version-not-supported","Service version is not supported.",{serviceVersion:this.version.versionString,supportedVersions:"1.x, 2.x"});if(this.version.major>2)throw new y.Z("layer:service-version-too-new","Service version is too new.",{serviceVersion:this.version.versionString,supportedVersions:"1.x, 2.x"});!function a(r,f){let g=!1,b=!1;if(null==r)g=!0,b=!0;else{const U=f&&f.isGeographic;switch(r){case"east-north-up":case"earth-centered":g=!0,b=U;break;case"vertex-reference-frame":g=!0,b=!U;break;default:g=!1}}if(!g)throw new y.Z("scenelayer:unsupported-normal-reference-frame","Normal reference frame is invalid.");if(!b)throw new y.Z("scenelayer:incompatible-normal-reference-frame","Normal reference frame is incompatible with layer spatial reference.")}(this.normalReferenceFrame,this.spatialReference)}_getTypeKeywords(){const e=[];if("points"===this.profile)e.push("Point");else{if("mesh-pyramids"!==this.profile)throw new y.Z("scenelayer:unknown-profile","SceneLayer:save() encountered an unknown SceneLayer profile: "+this.profile);e.push("3DObject")}return e}_populateFieldUsageInfo(){if(this._fieldUsageInfo={},this.fields)for(const e of this.fields){const a=!(!this.attributeStorageInfo||!this.attributeStorageInfo.some(g=>g.name===e.name)),r=!!this.associatedLayer?.fields?.some(g=>g&&e.name===g.name);this._fieldUsageInfo[e.name]={supportsLabelingInfo:a,supportsRenderer:a,supportsPopupTemplate:a||r,supportsLayerQuery:r}}}_applyAssociatedLayerOverrides(){this._applyAssociatedLayerFieldsOverrides(),this._applyAssociatedLayerPopupOverrides(),this._applyAssociatedLayerExtentOverride(),this._applyAssociatedLayerPrivileges()}_applyAssociatedLayerFieldsOverrides(){if(!this.associatedLayer?.fields)return;let e=null;for(const a of this.associatedLayer.fields){const r=this.getField(a.name);r?(!r.domain&&a.domain&&(r.domain=a.domain.clone()),r.editable=a.editable,r.nullable=a.nullable,r.length=a.length):(e||(e=this.fields?this.fields.slice():[]),e.push(a.clone()))}e&&this._set("fields",e)}_applyAssociatedLayerPopupOverrides(){if(!this.associatedLayer)return;const e=["popupTemplate","popupEnabled"],a=(0,K.vw)(this);for(let r=0;r<e.length;r++){const f=e[r],g=this.originIdOf(f),b=this.associatedLayer.originIdOf(f);g<b&&(b===Q.s3.SERVICE||b===Q.s3.PORTAL_ITEM)&&a.setAtOrigin(f,this.associatedLayer[f],b)}}_applyAssociatedLayerExtentOverride(){const e=this.associatedLayer?.editingInfo?.lastEditDate,a=this.associatedLayer?.serverGens,r=this.associatedLayer?.getAtOrigin("fullExtent","service");!(0,Ie.Rx)()||null==this.associatedLayer?.infoFor3D||!r||!(0,Y.M8)(this.associatedLayer?.url)||!e||this.serviceUpdateTimeStamp?.lastUpdate===e.getTime()||!this.serviceUpdateTimeStamp&&a?.minServerGen===a?.serverGen||(0,K.vw)(this).setAtOrigin("fullExtent",r.clone(),Q.s3.SERVICE)}_applyAssociatedLayerPrivileges(){const e=this.associatedLayer;e&&(this._set("userHasEditingPrivileges",e.userHasEditingPrivileges),this._set("userHasFullEditingPrivileges",e.userHasFullEditingPrivileges),this._set("userHasUpdateItemPrivileges",e.userHasUpdateItemPrivileges))}_setAssociatedFeatureLayer(e){var a=this;return(0,h.Z)(function*(){if(["mesh-pyramids","points"].includes(a.profile))try{const{serverUrl:r,layerId:f,portalItem:g}=yield(0,ee.w)(`${a.url}/layers/${a.layerId}`,{sceneLayerItem:a.portalItem,apiKey:a.apiKey,signal:e}),b=yield Re.T.FeatureLayer();a.associatedLayer=new b({url:r,layerId:f,portalItem:g}),yield a.associatedLayer.load()}catch(r){(0,l.D_)(r)||a._logWarningOnPopupEnabled()}})()}_logWarningOnPopupEnabled(){var e=this;return(0,h.Z)(function*(){yield(0,o.N1)(()=>e.popupEnabled&&null!=e.popupTemplate);const a=`this SceneLayer: ${e.title}`;null==e.attributeStorageInfo?t.Z.getLogger(e).warn(`Associated FeatureLayer could not be loaded and no binary attributes found. Popups will not work on ${a}`):t.Z.getLogger(e).info(`Associated FeatureLayer could not be loaded. Falling back to binary attributes for Popups on ${a}`)})()}_validateElevationInfo(){const e=this.elevationInfo;"mesh-pyramids"===this.profile&&(0,ie.LR)(t.Z.getLogger(this),(0,ie.Wb)("Mesh scene layers","relative-to-scene",e)),(0,ie.LR)(t.Z.getLogger(this),(0,ie.kf)("Scene layers",e))}};(0,p._)([(0,u.Cb)({types:{key:"type",base:Fe.B,typeMap:{selection:Oe.Z}},json:{origins:{"web-scene":{name:"layerDefinition.featureReduction",write:!0},"portal-item":{name:"layerDefinition.featureReduction",write:!0}}}})],c.prototype,"featureReduction",void 0),(0,p._)([(0,u.Cb)({type:[G],json:{read:!1,origins:{"web-scene":{name:"layerDefinition.rangeInfos",write:!0},"portal-item":{name:"layerDefinition.rangeInfos",write:!0}}}})],c.prototype,"rangeInfos",void 0),(0,p._)([(0,u.Cb)({json:{read:!1}})],c.prototype,"associatedLayer",void 0),(0,p._)([(0,u.Cb)({type:["show","hide"]})],c.prototype,"listMode",void 0),(0,p._)([(0,u.Cb)({type:["ArcGISSceneServiceLayer"]})],c.prototype,"operationalLayerType",void 0),(0,p._)([(0,u.Cb)({json:{read:!1},readOnly:!0})],c.prototype,"type",void 0),(0,p._)([(0,u.Cb)({...Ee.fields,readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],c.prototype,"fields",void 0),(0,p._)([(0,u.Cb)()],c.prototype,"types",null),(0,p._)([(0,u.Cb)()],c.prototype,"typeIdField",null),(0,p._)([(0,u.Cb)()],c.prototype,"templates",null),(0,p._)([(0,u.Cb)()],c.prototype,"formTemplate",null),(0,p._)([(0,u.Cb)({readOnly:!0,clonable:!1})],c.prototype,"fieldsIndex",null),(0,p._)([(0,u.Cb)({type:Pe.Z,json:{read:{source:"layerDefinition.floorInfo"},write:{target:"layerDefinition.floorInfo"}}})],c.prototype,"floorInfo",void 0),(0,p._)([(0,u.Cb)(Ee.outFields)],c.prototype,"outFields",void 0),(0,p._)([(0,u.Cb)({type:X.U4,readOnly:!0,json:{read:!1}})],c.prototype,"nodePages",void 0),(0,p._)([(0,T.r)("service","nodePages",["nodePages","pointNodePages"])],c.prototype,"readNodePages",null),(0,p._)([(0,u.Cb)({type:[X.QI],readOnly:!0})],c.prototype,"materialDefinitions",void 0),(0,p._)([(0,u.Cb)({type:[X.Yh],readOnly:!0})],c.prototype,"textureSetDefinitions",void 0),(0,p._)([(0,u.Cb)({type:[X.H3],readOnly:!0})],c.prototype,"geometryDefinitions",void 0),(0,p._)([(0,u.Cb)({readOnly:!0})],c.prototype,"serviceUpdateTimeStamp",void 0),(0,p._)([(0,u.Cb)({readOnly:!0})],c.prototype,"attributeStorageInfo",void 0),(0,p._)([(0,u.Cb)({readOnly:!0})],c.prototype,"statisticsInfo",void 0),(0,p._)([(0,u.Cb)({type:n.Z.ofType(Number),nonNullable:!0,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.excludeObjectIds",write:{enabled:!0}}})],c.prototype,"excludeObjectIds",void 0),(0,p._)([(0,u.Cb)({type:String,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],c.prototype,"definitionExpression",void 0),(0,p._)([(0,u.Cb)({type:Te,json:{name:"layerDefinition.polygonFilter",write:{enabled:!0,allowNull:!0},origins:{service:{read:!1,write:!1}}}})],c.prototype,"filter",void 0),(0,p._)([(0,u.Cb)({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],c.prototype,"path",void 0),(0,p._)([(0,u.Cb)(D.PV)],c.prototype,"elevationInfo",null),(0,p._)([(0,u.Cb)({readOnly:!0,json:{read:!1}})],c.prototype,"effectiveCapabilities",null),(0,p._)([(0,u.Cb)({readOnly:!0})],c.prototype,"effectiveEditingEnabled",null),(0,p._)([(0,u.Cb)({type:String})],c.prototype,"geometryType",null),(0,p._)([(0,u.Cb)(D.iR)],c.prototype,"labelsVisible",void 0),(0,p._)([(0,u.Cb)({type:[je.Z],json:{origins:{service:{name:"drawingInfo.labelingInfo",read:{reader:ge.r},write:!1}},name:"layerDefinition.drawingInfo.labelingInfo",read:{reader:ge.r},write:!0}})],c.prototype,"labelingInfo",void 0),(0,p._)([(0,u.Cb)(D.rn)],c.prototype,"legendEnabled",void 0),(0,p._)([(0,u.Cb)({type:Number,json:{origins:{"web-document":{default:1,write:{enabled:!0,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}},read:{source:["opacity","layerDefinition.drawingInfo.transparency"],reader(e,a){if("number"==typeof e&&e>=0&&e<=1)return e;const r=a.layerDefinition?.drawingInfo?.transparency;return void 0!==r?(0,Be.b)(r):void 0}}},"portal-item":{write:!0},service:{read:!1}}}})],c.prototype,"opacity",void 0),(0,p._)([(0,u.Cb)({type:["Low","High"],readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],c.prototype,"priority",void 0),(0,p._)([(0,u.Cb)({type:["Labels"],readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],c.prototype,"semantic",void 0),(0,p._)([(0,u.Cb)({types:E.o,json:{origins:{service:{read:{source:"drawingInfo.renderer"}}},name:"layerDefinition.drawingInfo.renderer",write:!0},value:null})],c.prototype,"renderer",null),(0,p._)([(0,u.Cb)({json:{read:!1}})],c.prototype,"cachedDrawingInfo",void 0),(0,p._)([(0,T.r)("service","cachedDrawingInfo")],c.prototype,"readCachedDrawingInfo",null),(0,p._)([(0,u.Cb)({readOnly:!0,json:{read:!1}})],c.prototype,"capabilities",null),(0,p._)([(0,u.Cb)({type:Boolean,json:{read:!1}})],c.prototype,"editingEnabled",null),(0,p._)([(0,u.Cb)({readOnly:!0,json:{write:!1,read:!1}})],c.prototype,"infoFor3D",null),(0,p._)([(0,u.Cb)({readOnly:!0,json:{write:!1,read:!1}})],c.prototype,"relationships",null),(0,p._)([(0,u.Cb)(D.C_)],c.prototype,"popupEnabled",void 0),(0,p._)([(0,u.Cb)({type:S.Z,json:{name:"popupInfo",write:!0}})],c.prototype,"popupTemplate",void 0),(0,p._)([(0,u.Cb)({readOnly:!0,json:{read:!1}})],c.prototype,"defaultPopupTemplate",null),(0,p._)([(0,u.Cb)({type:String,json:{read:!1}})],c.prototype,"objectIdField",void 0),(0,p._)([(0,T.r)("service","objectIdField",["objectIdField","fields"])],c.prototype,"readObjectIdField",null),(0,p._)([(0,u.Cb)({type:String,json:{read:!1}})],c.prototype,"globalIdField",void 0),(0,p._)([(0,T.r)("service","globalIdField",["globalIdField","fields"])],c.prototype,"readGlobalIdField",null),(0,p._)([(0,u.Cb)({readOnly:!0,type:String,json:{read:!1}})],c.prototype,"displayField",null),(0,p._)([(0,u.Cb)({type:String,json:{read:!1}})],c.prototype,"profile",void 0),(0,p._)([(0,T.r)("service","profile",["store.profile"])],c.prototype,"readProfile",null),(0,p._)([(0,u.Cb)({readOnly:!0,type:String,json:{origins:{service:{read:{source:"store.normalReferenceFrame"}}},read:!1}})],c.prototype,"normalReferenceFrame",void 0),(0,p._)([(0,u.Cb)(D.YI)],c.prototype,"screenSizePerspectiveEnabled",void 0),(0,p._)([(0,u.Cb)({json:{read:!1,origins:{service:{read:!0}}}})],c.prototype,"serviceItemId",void 0),c=(0,p._)([(0,N.j)("esri.layers.SceneLayer")],c);const Le={"mesh-pyramids":"mesh-pyramids",meshpyramids:"mesh-pyramids","features-meshes":"mesh-pyramids",points:"points","features-points":"points",lines:"lines","features-lines":"lines",polygons:"polygons","features-polygons":"polygons"},Ke={"mesh-pyramids":"mesh",points:"point",lines:"polyline",polygons:"polygon"},Ne=c},6733:(_,P,s)=>{s.d(P,{jF:()=>E,lQ:()=>y,o1:()=>l});var h=s(17626),p=s(61885),C=s(58817),S=s(10699),R=(s(63290),s(90912),s(26584),s(8314),s(76898)),F=s(67385);const v=new p.Z.EventEmitter;function E(o,d,u=null,M=!1){const Z=(0,S.hh)();return v.emit("apply-edits",{serviceUrl:o,layerId:d,gdbVersion:u,mayReceiveServiceEdits:M=null==d||M,result:Z.promise}),Z}const W="esri.layers.mixins.EditBusLayer",n=Symbol(W);function y(o){return null!=o&&"object"==typeof o&&n in o}function t(o){return null!=o&&"object"==typeof o&&"gdbVersion"in o}function i(o,d,u){const M=new URL(o).host,Z=F.Jp.get(M),A=K=>!K||K===Z;return A(d)&&A(u)||d===u}const l=o=>{var d;let u=class extends o{constructor(...M){super(...M),this[d]=!0,this._applyEditsHandler=Z=>{const{serviceUrl:A,layerId:K,gdbVersion:T,mayReceiveServiceEdits:N,result:Q}=Z,z=A===this.url,J=null!=K&&null!=this.layerId&&K===this.layerId,ae=t(this),ne=t(this)&&i(A,T,this.gdbVersion);if(!z||ae&&!ne||!J&&!N)return;const le=Q.then(O=>{if(J&&(O.addedFeatures.length||O.updatedFeatures.length||O.deletedFeatures.length||O.addedAttachments.length||O.updatedAttachments.length||O.deletedAttachments.length))return this.emit("edits",(0,C.d9)(O)),O;const k=O.editedFeatures?.find(({layerId:V})=>V===this.layerId);if(k){const{adds:V,updates:Y,deletes:ee}=k.editedFeatures,te={edits:null,addedAttachments:[],deletedAttachments:[],updatedAttachments:[],addedFeatures:V?V.map(({attributes:D})=>({objectId:this.objectIdField&&D[this.objectIdField],globalId:this.globalIdField&&D[this.globalIdField]})):[],deletedFeatures:ee?ee.map(({attributes:D})=>({objectId:this.objectIdField&&D[this.objectIdField],globalId:this.globalIdField&&D[this.globalIdField]})):[],updatedFeatures:Y?Y.map(({current:{attributes:D}})=>({objectId:this.objectIdField&&D[this.objectIdField],globalId:this.globalIdField&&D[this.globalIdField]})):[],editedFeatures:(0,C.d9)(O.editedFeatures),exceededTransferLimit:!1,historicMoment:(0,C.d9)(O.historicMoment)};return this.emit("edits",te),te}return{edits:null,addedAttachments:[],deletedAttachments:[],updatedAttachments:[],addedFeatures:[],deletedFeatures:[],updatedFeatures:[],editedFeatures:(0,C.d9)(O.editedFeatures),exceededTransferLimit:!1,historicMoment:(0,C.d9)(O.historicMoment)}}).then(O=>("historicMoment"in this&&this.historicMoment!==O.historicMoment&&(0,F.JV)(A,T)&&(this.historicMoment=O.historicMoment),O));this.emit("apply-edits",{result:le})},this._updateMomentHandler=Z=>{const{serviceUrl:A,gdbVersion:K,moment:T}=Z,N=A===this.url,Q=t(this),z=t(this)&&i(A,K,this.gdbVersion),J=t(this)&&!i(A,this.gdbVersion,null);N&&Q&&z&&J&&"historicMoment"in this&&this.historicMoment!==T&&(this.historicMoment=T)},this.when().then(()=>{this.addHandles(function m(o){return v.on("apply-edits",new WeakRef(o))}(this._applyEditsHandler)),"historicMoment"in this&&this.addHandles(function I(o){return v.on("update-moment",new WeakRef(o))}(this._updateMomentHandler))},()=>{})}};return d=n,u=(0,h._)([(0,R.j)(W)],u),u}},83989:(_,P,s)=>{s.d(P,{B:()=>L});var h=s(17626),p=s(86810),C=s(77712),j=(s(90912),s(85931),s(8314),s(76898));let L=class extends p.wq{constructor(){super(...arguments),this.type=null}};(0,h._)([(0,C.Cb)({type:["selection","cluster","binning"],readOnly:!0,json:{read:!1,write:!0}})],L.prototype,"type",void 0),L=(0,h._)([(0,j.j)("esri.layers.support.FeatureReduction")],L)},47058:(_,P,s)=>{s.d(P,{Z:()=>F});var L,h=s(17626),p=s(77712),x=(s(90912),s(85931),s(8314),s(76898)),j=s(83989);let R=L=class extends j.B{constructor(v){super(v),this.type="selection"}clone(){return new L}};(0,h._)([(0,p.Cb)({type:["selection"]})],R.prototype,"type",void 0),R=L=(0,h._)([(0,x.j)("esri.layers.support.FeatureReductionSelection")],R);const F=R},39683:(_,P,s)=>{s.d(P,{y:()=>w});var h=s(15861),p=s(59213),C=s(10699),S=s(14889);function w(j,L,R){return x.apply(this,arguments)}function x(){return(x=(0,h.Z)(function*(j,L,R){const F=j&&j.getAtOrigin&&j.getAtOrigin("renderer",L.origin);if(F&&"unique-value"===F.type&&F.styleOrigin){const v=yield(0,p.q6)(F.populateFromStyle());if((0,C.k_)(R),!1===v.ok){const m=v.error;L?.messages&&L.messages.push(new S.Z("renderer:style-reference",`Failed to create unique value renderer from style reference: ${m.message}`,{error:m,context:L})),j.clear("renderer",L?.origin)}}})).apply(this,arguments)}},67385:(_,P,s)=>{s.d(P,{JV:()=>R,Jp:()=>S,Px:()=>j,U8:()=>C});var h=s(15861);const C=(0,s(35948).dG)(),S=new Map,w=new Map;function j(F,v){return L.apply(this,arguments)}function L(){return(L=(0,h.Z)(function*(F,v,m=!1){if(!F||!v)return!0;const I=F.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,""),E=w.get(I)?.entries();if(E)for(const[B,W]of E)if(W.name===v){const n=!W.stack?.hasForwardEdits();if(!n&&m){const[{deleteForwardEdits:y},{default:t}]=yield Promise.all([s.e(7993).then(s.bind(s,87993)),s.e(3084).then(s.bind(s,73084))]);return y(I,B,new t({sessionId:C,moment:W.moment}))}return n}return!0})).apply(this,arguments)}function R(F,v){if(!F)return!1;const m=F.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,""),I=w.get(m)?.entries();if(I)for(const[E,B]of I)if(B.name===v)return"edit"===B.lockType;return!1}}}]);