"use strict";(self.webpackChunkCRIS=self.webpackChunkCRIS||[]).push([[7348],{65389:(rt,X,o)=>{o.d(X,{Z:()=>I});class I{constructor(D){this.size=0,this._start=0,this.maxSize=D,this._buffer=new Array(D)}get entries(){return this._buffer}enqueue(D){if(this.size===this.maxSize){const g=this._buffer[this._start];return this._buffer[this._start]=D,this._start=(this._start+1)%this.maxSize,g}return this._buffer[(this._start+this.size++)%this.maxSize]=D,null}dequeue(){if(0===this.size)return null;const D=this._buffer[this._start];return this._buffer[this._start]=null,this.size--,this._start=(this._start+1)%this.maxSize,D}peek(){return 0===this.size?null:this._buffer[this._start]}find(D){if(0===this.size)return null;for(const g of this._buffer)if(null!=g&&D(g))return g;return null}clear(D){let g=this.dequeue();for(;null!=g;)D&&D(g),g=this.dequeue()}}},7074:(rt,X,o)=>{function I(m,D,g,A){let x=null,y=1e3;"number"==typeof D?(y=D,A=g):(x=D??null,y=g);let L,T=0;const s=()=>{T=0,m.apply(A,L)},b=(...C)=>{x&&x.apply(A,C),L=C,y?T||(T=setTimeout(s,y)):s()};return b.remove=()=>{T&&(clearTimeout(T),T=0)},b.forceUpdate=()=>{T&&(clearTimeout(T),s())},b.hasPendingUpdates=()=>!!T,b}o.d(X,{P:()=>I})},57932:(rt,X,o)=>{o.d(X,{$7:()=>C,$e:()=>A,E0:()=>s,N5:()=>b,lW:()=>x});var I=o(15861),D=(o(8314),o(26584)),g=o(21726);function A(f){const S=s(f);return null!=S?S.toDataURL():""}function x(f){return y.apply(this,arguments)}function y(){return y=(0,I.Z)(function*(f){const S=s(f);if(null==S)throw new D.Z("imageToArrayBuffer","Unsupported image type");const V=yield function L(f){return T.apply(this,arguments)}(f),M=yield new Promise(K=>S.toBlob(K,V));if(!M)throw new D.Z("imageToArrayBuffer","Failed to encode image");return{data:yield M.arrayBuffer(),type:V}}),y.apply(this,arguments)}function T(){return(T=(0,I.Z)(function*(f){if(!(f instanceof HTMLImageElement))return"image/png";const S=f.src;if((0,g.HK)(S)){const V=(0,g.sJ)(S);return"image/jpeg"===V?.mediaType?V.mediaType:"image/png"}return/\.png$/i.test(S)?"image/png":/\.(jpg|jpeg)$/i.test(S)?"image/jpeg":"image/png"})).apply(this,arguments)}function s(f){if(f instanceof HTMLCanvasElement)return f;if(f instanceof HTMLVideoElement)return null;const S=document.createElement("canvas");S.width=f.width,S.height=f.height;const V=S.getContext("2d");return f instanceof HTMLImageElement?V.drawImage(f,0,0,f.width,f.height):f instanceof ImageData&&V.putImageData(f,0,0),S}function b(f){const S=[],V=new Uint8Array(f);for(let M=0;M<V.length;M++)S.push(String.fromCharCode(V[M]));return"data:application/octet-stream;base64,"+btoa(S.join(""))}function C(f){if(f.byteLength<8)return!1;const S=new Uint8Array(f);return 137===S[0]&&80===S[1]&&78===S[2]&&71===S[3]&&13===S[4]&&10===S[5]&&26===S[6]&&10===S[7]}},32837:(rt,X,o)=>{o.d(X,{Z:()=>L});var I=o(21286),m=o(35909),D=o(26996),g=o(31375),A=o(47139),x=o(80991);class L{constructor(s){this._resourceManager=s,this._lazyRasterizationCanvas=null}dispose(){this._lazyRasterizationCanvas=null}get _rasterizationCanvas(){return null==this._lazyRasterizationCanvas&&(this._lazyRasterizationCanvas=document.createElement("canvas"),this._lazyRasterizationCanvas.getContext("2d",{willReadFrequently:!0})),this._lazyRasterizationCanvas}rasterizeJSONResource(s,b,C){if("simple-fill"===s.type||"esriSFS"===s.type){const[R,z,H]=(0,D.Y)(this._rasterizationCanvas,s.style,b);return{size:[z,H],image:new Uint32Array(R.buffer),sdf:!1,simplePattern:!0,anchorX:0,anchorY:0,rasterizationScale:(0,I.fp)(Math.ceil(b))}}if("simple-line"===s.type||"esriSLS"===s.type||"line"===s.type&&s.dashTemplate){let R,z;if("simple-line"===s.type||"esriSLS"===s.type)switch(R=(0,m.U1)(s.style,s.cap),s.cap){case"butt":z="Butt";break;case"square":z="Square";break;default:z="Round"}else R=s.dashTemplate,z=s.cim.capStyle;const[H,J,Q]=(0,D.m)(R,z);return{size:[J,Q],image:new Uint32Array(H.buffer),sdf:!0,simplePattern:!0,anchorX:0,anchorY:0}}let f,S=null,V=null,M=1;if("simple-marker"===s.type||"esriSMS"===s.type||"line-marker"===s.type?(f=m.B$.fromSimpleMarker(s),V=(0,A.Fp)(f)):s.cim&&"CIMHatchFill"===s.cim.type?(f=m.B$.fromCIMHatchFill(s.cim,b),S=new g.Z(f.frame.xmin,-f.frame.ymax,f.frame.xmax-f.frame.xmin,f.frame.ymax-f.frame.ymin),M=b):s.cim.markerPlacement&&"CIMMarkerPlacementInsidePolygon"===s.cim.markerPlacement.type?(f=m.B$.fromCIMInsidePolygon(s.cim),S=new g.Z(f.frame.xmin,-f.frame.ymax,f.frame.xmax-f.frame.xmin,f.frame.ymax-f.frame.ymin)):(f=s.cim,s.avoidSDFRasterization||(V=(0,A.Fp)(f))),V&&!C){const[R,z,H]=(0,A.RL)(V);return R?{size:[z,H],image:new Uint32Array(R.buffer),sdf:!0,simplePattern:!0,anchorX:0,anchorY:0,rasterizationScale:M}:null}const[K,v,E,B,N]=m.B$.rasterize(this._rasterizationCanvas,f,S,this._resourceManager,!C);return K?{size:[v,E],image:new Uint32Array(K.buffer),sdf:!1,simplePattern:!1,anchorX:B,anchorY:N}:null}rasterizeImageResource(s,b,C,f){this._rasterizationCanvas.width=s,this._rasterizationCanvas.height=b;const S=this._rasterizationCanvas.getContext("2d");C instanceof ImageData?S.putImageData(C,0,0):(C.setAttribute("width",`${s}px`),C.setAttribute("height",`${b}px`),S.drawImage(C,0,0,s,b));const V=S.getImageData(0,0,s,b),M=new Uint8Array(V.data);if(f)for(const R of f)if(R&&R.oldColor&&4===R.oldColor.length&&R.newColor&&4===R.newColor.length){const[z,H,J,Q]=R.oldColor,[ot,P,j,k]=R.newColor;if(z===ot&&H===P&&J===j&&Q===k)continue;for(let Z=0;Z<M.length;Z+=4)z===M[Z]&&H===M[Z+1]&&J===M[Z+2]&&Q===M[Z+3]&&(M[Z]=ot,M[Z+1]=P,M[Z+2]=j,M[Z+3]=k)}let K;for(let R=0;R<M.length;R+=4)K=M[R+3]/255,M[R]=M[R]*K,M[R+1]=M[R+1]*K,M[R+2]=M[R+2]*K;let v=M,E=s,B=b;const N=512;if(E>=N||B>=N){const R=E/B;R>1?(E=N,B=Math.round(N/R)):(B=N,E=Math.round(N*R)),v=new Uint8Array(4*E*B);const z=new Uint8ClampedArray(v.buffer);(0,x.TT)(M,s,b,z,E,B,!1)}return{size:[E,B],image:new Uint32Array(v.buffer),sdf:!1,simplePattern:!1,anchorX:0,anchorY:0}}}},26996:(rt,X,o)=>{o.d(X,{Y:()=>g,m:()=>A});var I=o(36161),m=o(21286);const D=x=>"vertical"===x||"horizontal"===x||"cross"===x||"esriSFSCross"===x||"esriSFSVertical"===x||"esriSFSHorizontal"===x;function g(x,y,L){const T=(0,m.fp)(Math.ceil(L)),s=D(y)?8*T:16*T,b=2*T;x.width=s,x.height=s;const C=x.getContext("2d");C.strokeStyle="#FFFFFF",C.lineWidth=T,C.beginPath(),"vertical"!==y&&"cross"!==y&&"esriSFSCross"!==y&&"esriSFSVertical"!==y||(C.moveTo(s/2,-b),C.lineTo(s/2,s+b)),"horizontal"!==y&&"cross"!==y&&"esriSFSCross"!==y&&"esriSFSHorizontal"!==y||(C.moveTo(-b,s/2),C.lineTo(s+b,s/2)),"forward-diagonal"!==y&&"diagonal-cross"!==y&&"esriSFSDiagonalCross"!==y&&"esriSFSForwardDiagonal"!==y||(C.moveTo(-b,-b),C.lineTo(s+b,s+b),C.moveTo(s-b,-b),C.lineTo(s+b,b),C.moveTo(-b,s-b),C.lineTo(b,s+b)),"backward-diagonal"!==y&&"diagonal-cross"!==y&&"esriSFSBackwardDiagonal"!==y&&"esriSFSDiagonalCross"!==y||(C.moveTo(s+b,-b),C.lineTo(-b,s+b),C.moveTo(b,-b),C.lineTo(-b,b),C.moveTo(s+b,s-b),C.lineTo(s-b,s+b)),C.stroke();const f=C.getImageData(0,0,x.width,x.height),S=new Uint8Array(f.data);let V;for(let M=0;M<S.length;M+=4)V=S[M+3]/255,S[M]=S[M]*V,S[M+1]=S[M+1]*V,S[M+2]=S[M+2]*V;return[S,x.width,x.height]}function A(x,y){const L="Butt"===y,T="Square"===y,s=!L&&!T;x.length%2==1&&(x=[...x,...x]);const b=15.5;let f=0;for(const z of x)f+=z;const S=Math.round(f*b),V=new Float32Array(31*S),M=7.75;let K=0,v=0,E=.5,B=!0;for(const z of x){for(K=v,v+=z*b;E<=v;){let H=.5;for(;H<31;){const J=(H-.5)*S+E-.5,Q=s?(H-b)*(H-b):Math.abs(H-b);V[J]=B?L?Math.max(Math.max(K+M-E,Q),Math.max(E-v+M,Q)):Q:s?Math.min((E-K)*(E-K)+Q,(E-v)*(E-v)+Q):T?Math.min(Math.max(E-K,Q),Math.max(v-E,Q)):Math.min(Math.max(E-K+M,Q),Math.max(v+M-E,Q)),H++}E++}B=!B}const N=V.length,R=new Uint8Array(4*N);for(let z=0;z<N;++z){const H=(s?Math.sqrt(V[z]):V[z])/b;(0,I.I)(H,R,4*z)}return[R,S,31]}},80576:(rt,X,o)=>{o.d(X,{Q:()=>Q});var I=o(17626),m=o(83761),g=(o(26584),o(8314)),x=(o(63290),o(7074)),y=o(77712),s=(o(90912),o(85931),o(76898)),b=o(39351),C=o(21286),f=o(42797);class E{constructor(P,j,k){this._debugMap=new Map,this._width=P*k,this._height=j*k,this._pixelRatio=k;const Z=Math.ceil(this._width/1),Y=Math.ceil(this._height/1);this._cols=Z,this._rows=Y,this._cells=f.p.create(Z*Y)}insertMetrics(P){const j=this._hasCollision(P);return 0===j&&this._markMetrics(P),j}getCellId(P,j){return P+j*this._cols}has(P){return this._cells.has(P)}hasRange(P,j){return this._cells.hasRange(P,j)}set(P){this._cells.set(P)}setRange(P,j){this._cells.setRange(P,j)}_collide(P,j,k,Z){const Y=P-k/2,$=j-Z/2,q=Y+k,it=$+Z;if(q<0||it<0||Y>this._width||$>this._height)return 1;const pt=(0,C.uZ)(Math.floor(Y/1),0,this._cols),at=(0,C.uZ)(Math.floor($/1),0,this._rows),ft=(0,C.uZ)(Math.ceil(q/1),0,this._cols),lt=(0,C.uZ)(Math.ceil(it/1),0,this._rows);for(let gt=at;gt<=lt;gt++)for(let tt=pt;tt<=ft;tt++){const yt=this.getCellId(tt,gt);if(this.has(yt))return 2}return 0}_mark(P,j,k,Z,Y){const $=P-k/2,q=j-Z/2,it=$+k,pt=q+Z,at=(0,C.uZ)(Math.floor($/1),0,this._cols),ft=(0,C.uZ)(Math.floor(q/1),0,this._rows),lt=(0,C.uZ)(Math.ceil(it/1),0,this._cols),gt=(0,C.uZ)(Math.ceil(pt/1),0,this._rows);for(let tt=ft;tt<=gt;tt++)for(let yt=at;yt<=lt;yt++){const _=this.getCellId(yt,tt);this._debugMap.set(_,Y),this.set(_)}return!1}_hasCollision(P){const j=P.id;let k=0,Z=0;P.save();do{const Y=P.boundsCount;k+=Y;for(let $=0;$<Y;$++){const q=P.boundsComputedAnchorX($),it=P.boundsComputedAnchorY($),pt=(P.boundsWidth($)+2)*this._pixelRatio,at=(P.boundsHeight($)+2)*this._pixelRatio;switch(this._collide(q,it,pt,at)){case 2:return 2;case 1:Z++}}}while(P.peekId()===j&&P.next());return P.restore(),k===Z?1:0}_markMetrics(P){const j=P.id;P.save();do{const k=P.boundsCount;for(let Z=0;Z<k;Z++){const Y=P.boundsComputedAnchorX(Z),$=P.boundsComputedAnchorY(Z),q=(P.boundsWidth(Z)+2)*this._pixelRatio,it=(P.boundsHeight(Z)+2)*this._pixelRatio;this._mark(Y,$,q,it,P.id)}}while(P.peekId()===j&&P.next());P.restore()}}const N=255;function z(ot,P){const j=[];ot.forEachTile(k=>j.push(k)),j.sort((k,Z)=>k.instanceId-Z.instanceId),j.forEach(k=>{null!=k.labelMetrics&&k.isReady&&P(k,k.labelMetrics.getCursor())})}class H{run(P,j,k){const Z=[];for(let Y=P.length-1;Y>=0;Y--){const $=P[Y];$.labelingCollisionInfos&&Z.push(...$.labelingCollisionInfos)}this._transformMetrics(Z),this._runCollision(Z,j,k)}_runCollision(P,j,k){const[Z,Y]=j.state.size,$=new E(Z,Y,j.pixelRatio);for(const{tileRenderer:q,deconflictionEnabled:it,visible:pt}of P){const at=q.featuresView.attributeView;it?pt?(this._prepare(q),this._collideVisible($,q,k),this._collideInvisible($,q)):z(q,(ft,lt)=>{for(;lt.nextId();)at.setLabelMinZoom(lt.id,N)}):z(q,(ft,lt)=>{for(;lt.nextId();)at.setLabelMinZoom(lt.id,0),pt&&$.insertMetrics(lt)})}}_isFiltered(P,j,k){const Z=j.getFilterFlags(P);return!((!k.hasFilter||Z&b.g3)&&(null==k.featureEffect||k.featureEffect.excludedLabelsVisible||Z&b.kU))}_prepare(P){const j=P.featuresView.attributeView,k=new Set;z(P,(Z,Y)=>{for(;Y.nextId();)if(!k.has(Y.id)){if(k.add(Y.id),this._isFiltered(Y.id,j,P.layerView)){j.setLabelMinZoom(Y.id,254);continue}0!==j.getLabelMinZoom(Y.id)?j.setLabelMinZoom(Y.id,N):j.setLabelMinZoom(Y.id,0)}})}_collideVisible(P,j,k){const Z=j.featuresView.attributeView,Y=new Set;z(j,($,q)=>{for(;q.nextId();)if(!Y.has(q.id))if($.key.level===k){if(0===Z.getLabelMinZoom(q.id))switch(P.insertMetrics(q)){case 1:break;case 2:Z.setLabelMinZoom(q.id,254),Y.add(q.id);break;case 0:Z.setLabelMinZoom(q.id,0),Y.add(q.id)}}else Z.setLabelMinZoom(q.id,254)})}_collideInvisible(P,j){const k=j.featuresView.attributeView,Z=new Set;z(j,(Y,$)=>{for(;$.nextId();)if(!Z.has($.id)&&k.getLabelMinZoom($.id)===N)switch(P.insertMetrics($)){case 1:break;case 2:k.setLabelMinZoom($.id,N),Z.add($.id);break;case 0:k.setLabelMinZoom($.id,0),Z.add($.id)}})}_transformMetrics(P){for(const{tileRenderer:j,geometryType:k,vvEvaluators:Z}of P)z(j,(Y,$)=>{const q=j.featuresView.attributeView,it=Y.transforms.labelMat2d;it[4]=Math.round(it[4]),it[5]=Math.round(it[5]);const pt="polyline"===k;for(;$.next();){const at=$.boundsCount,ft=$.anchorX,lt=$.anchorY;let gt=$.size;const tt=Z[0];if(null!=tt){const G=tt(q.getVVSize($.id));gt=isNaN(G)||null==G||G===1/0?gt:G}const yt=$.directionX*(gt/2),_=$.directionY*(gt/2);for(let G=0;G<at;G++){let ht=ft,ut=$.anchorY;if(pt){let vt=ht+$.boundsX(G)+yt,dt=ut+$.boundsY(G)+_;vt=it[0]*vt+it[2]*dt+it[4],dt=it[1]*vt+it[3]*dt+it[5],$.setBoundsComputedAnchorX(G,Math.floor(vt)),$.setBoundsComputedAnchorY(G,Math.floor(dt))}else{ht=it[0]*ft+it[2]*lt+it[4],ut=it[1]*ft+it[3]*lt+it[5];const vt=ht+$.boundsX(G)+yt,dt=ut+$.boundsY(G)+_;$.setBoundsComputedAnchorX(G,vt),$.setBoundsComputedAnchorY(G,dt)}}}})}}let Q=class extends m.Z{constructor(ot){super(ot),this.collisionEngine=new H,this.lastUpdateId=-1,this.updateRequested=!1,this.view=null,this._applyVisibilityPass=(0,x.P)(P=>{const j=this.view;if(j)try{const k=j.featuresTilingScheme.getClosestInfoForScale(P.state.scale).level;this.collisionEngine.run(j.allLayerViews.items,P,k)}catch{}},32,this),this.addHandles(this._applyVisibilityPass)}get updating(){return(0,g.Z)("esri-2d-log-updating")&&console.log(`Updating LabelManager ${this.updateRequested}:\n-> updateRequested: ${this.updateRequested}`),this.updateRequested}update(ot){this._applyVisibilityPass(ot)}viewChange(){this.requestUpdate()}requestUpdate(){this.updateRequested||(this.updateRequested=!0,this.view?.requestUpdate())}processUpdate(ot){this.updateRequested&&(this.updateRequested=!1,this.update(ot))}};(0,I._)([(0,y.Cb)()],Q.prototype,"updateRequested",void 0),(0,I._)([(0,y.Cb)()],Q.prototype,"updating",null),(0,I._)([(0,y.Cb)()],Q.prototype,"view",void 0),Q=(0,I._)([(0,s.j)("esri.views.2d.LabelManager")],Q)},919:(rt,X,o)=>{var I,m,D,g;o.d(X,{Fr:()=>D,_K:()=>m,al:()=>I}),(g=I||(I={}))[g.FILL=1]="FILL",g[g.LINE=2]="LINE",g[g.SYMBOL=3]="SYMBOL",g[g.CIRCLE=4]="CIRCLE",function(g){g[g.BACKGROUND=0]="BACKGROUND",g[g.FILL=1]="FILL",g[g.OUTLINE=2]="OUTLINE",g[g.LINE=3]="LINE",g[g.ICON=4]="ICON",g[g.CIRCLE=5]="CIRCLE",g[g.TEXT=6]="TEXT",g[g.TILEINFO=7]="TILEINFO"}(m||(m={})),function(g){g[g.PAINTER_CHANGED=0]="PAINTER_CHANGED",g[g.LAYOUT_CHANGED=1]="LAYOUT_CHANGED",g[g.LAYER_CHANGED=2]="LAYER_CHANGED",g[g.LAYER_REMOVED=3]="LAYER_REMOVED",g[g.SPRITES_CHANGED=4]="SPRITES_CHANGED"}(D||(D={}))},31656:(rt,X,o)=>{o.d(X,{w:()=>A});const I={background:{"background.frag":"#ifdef PATTERN\nuniform lowp float u_opacity;\nuniform lowp sampler2D u_texture;\nvarying mediump vec4 v_tlbr;\nvarying mediump vec2 v_tileTextureCoord;\n#else\nuniform lowp vec4 u_color;\n#endif\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main() {\n#ifdef PATTERN\nmediump vec2 normalizedTextureCoord = mod(v_tileTextureCoord, 1.0);\nmediump vec2 samplePos = mix(v_tlbr.xy, v_tlbr.zw, normalizedTextureCoord);\nlowp vec4 color = texture2D(u_texture, samplePos);\ngl_FragColor = u_opacity * color;\n#else\ngl_FragColor = u_color;\n#endif\n#ifdef ID\nif (gl_FragColor.a < 1.0 / 255.0) {\ndiscard;\n}\ngl_FragColor = v_id;\n#endif\n}","background.vert":"precision mediump float;\nattribute vec2 a_pos;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nuniform highp mat3 u_dvsMat3;\nuniform mediump float u_coord_range;\nuniform mediump float u_depth;\n#ifdef PATTERN\nuniform mediump mat3 u_pattern_matrix;\nvarying mediump vec2 v_tileTextureCoord;\nuniform mediump vec4 u_tlbr;\nuniform mediump vec2 u_mosaicSize;\nvarying mediump vec4 v_tlbr;\n#endif\nvoid main() {\ngl_Position = vec4((u_dvsMat3 * vec3(u_coord_range * a_pos, 1.0)).xy, u_depth, 1.0);\n#ifdef PATTERN\nv_tileTextureCoord = (u_pattern_matrix * vec3(a_pos, 1.0)).xy;\nv_tlbr             = u_tlbr / u_mosaicSize.xyxy;\n#endif\n#ifdef ID\nv_id = u_id / 255.0;\n#endif\n}"},circle:{"circle.frag":"precision lowp float;\nvarying lowp vec4 v_color;\nvarying lowp vec4 v_stroke_color;\nvarying mediump float v_blur;\nvarying mediump float v_stroke_width;\nvarying mediump float v_radius;\nvarying mediump vec2 v_offset;\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main()\n{\nmediump float dist = length(v_offset);\nmediump float alpha = smoothstep(0.0, -v_blur, dist - 1.0);\nlowp float color_mix_ratio = v_stroke_width < 0.01 ? 0.0 : smoothstep(-v_blur, 0.0, dist - v_radius / (v_radius + v_stroke_width));\ngl_FragColor = alpha * mix(v_color, v_stroke_color, color_mix_ratio);\n#ifdef ID\nif (gl_FragColor.a < 1.0 / 255.0) {\ndiscard;\n}\ngl_FragColor = v_id;\n#endif\n}","circle.vert":"precision mediump float;\nattribute vec2 a_pos;\n#pragma header\nvarying lowp vec4 v_color;\nvarying lowp vec4 v_stroke_color;\nvarying mediump float v_blur;\nvarying mediump float v_stroke_width;\nvarying mediump float v_radius;\nvarying mediump vec2 v_offset;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform mediump vec2 u_circleTranslation;\nuniform mediump float u_depth;\nuniform mediump float u_antialiasingWidth;\nvoid main()\n{\n#pragma main\nv_color = color * opacity;\nv_stroke_color = stroke_color * stroke_opacity;\nv_stroke_width = stroke_width;\nv_radius = radius;\nv_blur = max(blur, u_antialiasingWidth / (radius + stroke_width));\nmediump vec2 offset = vec2(mod(a_pos, 2.0) * 2.0 - 1.0);\nv_offset = offset;\n#ifdef ID\nv_id = u_id / 255.0;\n#endif\nmediump vec3 pos = u_dvsMat3 * vec3(a_pos * 0.5, 1.0) + u_displayMat3 * vec3((v_radius + v_stroke_width) * offset + u_circleTranslation, 0.0);\ngl_Position = vec4(pos.xy, u_depth, 1.0);\n}"},fill:{"fill.frag":"precision lowp float;\n#ifdef PATTERN\nuniform lowp sampler2D u_texture;\nvarying mediump vec2 v_tileTextureCoord;\nvarying mediump vec4 v_tlbr;\n#endif\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvarying lowp vec4 v_color;\nvec4 mixColors(vec4 color1, vec4 color2) {\nfloat compositeAlpha = color2.a + color1.a * (1.0 - color2.a);\nvec3 compositeColor = color2.rgb + color1.rgb * (1.0 - color2.a);\nreturn vec4(compositeColor, compositeAlpha);\n}\nvoid main()\n{\n#ifdef PATTERN\nmediump vec2 normalizedTextureCoord = fract(v_tileTextureCoord);\nmediump vec2 samplePos = mix(v_tlbr.xy, v_tlbr.zw, normalizedTextureCoord);\nlowp vec4 color = texture2D(u_texture, samplePos);\ngl_FragColor = v_color[3] * color;\n#else\ngl_FragColor = v_color;\n#endif\n#ifdef ID\nif (gl_FragColor.a < 1.0 / 255.0) {\ndiscard;\n}\ngl_FragColor = v_id;\n#endif\n}","fill.vert":"precision mediump float;\nattribute vec2 a_pos;\n#pragma header\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform mediump float u_depth;\nuniform mediump vec2 u_fillTranslation;\n#ifdef PATTERN\n#include <util/util.glsl>\nuniform mediump vec2 u_mosaicSize;\nuniform mediump float u_patternFactor;\nvarying mediump vec2 v_tileTextureCoord;\nvarying mediump vec4 v_tlbr;\n#endif\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nvarying lowp vec4 v_color;\nvoid main()\n{\n#pragma main\nv_color = color * opacity;\n#ifdef ID\nv_id = u_id / 255.0;\n#endif\n#ifdef PATTERN\nfloat patternWidth = nextPOT(tlbr.z - tlbr.x);\nfloat patternHeight = nextPOT(tlbr.w - tlbr.y);\nfloat scaleX = 1.0 / (patternWidth * u_patternFactor);\nfloat scaleY = 1.0 / (patternHeight * u_patternFactor);\nmat3 patterMat = mat3(scaleX, 0.0,    0.0,\n0.0,    -scaleY, 0.0,\n0.0,    0.0,    1.0);\nv_tileTextureCoord = (patterMat * vec3(a_pos, 1.0)).xy;\nv_tlbr             = tlbr / u_mosaicSize.xyxy;\n#endif\nvec3 pos = u_dvsMat3 * vec3(a_pos, 1.0) + u_displayMat3 * vec3(u_fillTranslation, 0.0);\ngl_Position = vec4(pos.xy, u_depth, 1.0);\n}"},icon:{"icon.frag":"precision mediump float;\nuniform lowp sampler2D u_texture;\n#ifdef SDF\nuniform lowp vec4 u_color;\nuniform lowp vec4 u_outlineColor;\n#endif\nvarying mediump vec2 v_tex;\nvarying lowp float v_opacity;\nvarying mediump vec2 v_size;\nvarying lowp vec4 v_color;\n#ifdef SDF\nvarying mediump flaot v_halo_width;\n#endif\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\n#include <util/encoding.glsl>\nvec4 mixColors(vec4 color1, vec4 color2) {\nfloat compositeAlpha = color2.a + color1.a * (1.0 - color2.a);\nvec3 compositeColor = color2.rgb + color1.rgb * (1.0 - color2.a);\nreturn vec4(compositeColor, compositeAlpha);\n}\nvoid main()\n{\n#ifdef SDF\nlowp vec4 fillPixelColor = v_color;\nfloat d = rgba2float(texture2D(u_texture, v_tex)) - 0.5;\nconst float softEdgeRatio = 0.248062016;\nfloat size = max(v_size.x, v_size.y);\nfloat dist = d * softEdgeRatio * size;\nfillPixelColor *= clamp(0.5 - dist, 0.0, 1.0);\nif (v_halo_width > 0.25) {\nlowp vec4 outlinePixelColor = u_outlineColor;\nconst float outlineLimitRatio = (16.0 / 86.0);\nfloat clampedOutlineSize = softEdgeRatio * min(v_halo_width, outlineLimitRatio * max(v_size.x, v_size.y));\noutlinePixelColor *= clamp(0.5 - (abs(dist) - clampedOutlineSize), 0.0, 1.0);\ngl_FragColor = v_opacity * mixColors(fillPixelColor, outlinePixelColor);\n}\nelse {\ngl_FragColor = v_opacity * fillPixelColor;\n}\n#else\nlowp vec4 texColor = texture2D(u_texture, v_tex);\ngl_FragColor = v_opacity * texColor;\n#endif\n#ifdef ID\nif (gl_FragColor.a < 1.0 / 255.0) {\ndiscard;\n}\ngl_FragColor = v_id;\n#endif\n}","icon.vert":"attribute vec2 a_pos;\nattribute vec2 a_vertexOffset;\nattribute vec4 a_texAngleRange;\nattribute vec4 a_levelInfo;\nattribute float a_opacityInfo;\n#pragma header\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nvarying lowp vec4 v_color;\n#ifdef SDF\nvarying mediump float v_halo_width;\n#endif\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform highp mat3 u_displayViewMat3;\nuniform mediump vec2 u_iconTranslation;\nuniform vec2 u_mosaicSize;\nuniform mediump float u_depth;\nuniform mediump float u_mapRotation;\nuniform mediump float u_level;\nuniform lowp float u_keepUpright;\nuniform mediump float u_fadeDuration;\nvarying mediump vec2 v_tex;\nvarying lowp float v_opacity;\nvarying mediump vec2 v_size;\nconst float C_OFFSET_PRECISION = 1.0 / 8.0;\nconst float C_256_TO_RAD = 3.14159265359 / 128.0;\nconst float C_DEG_TO_RAD = 3.14159265359 / 180.0;\nconst float tileCoordRatio = 1.0 / 8.0;\nuniform highp float u_time;\nvoid main()\n{\n#pragma main\nv_color = color;\nv_opacity = opacity;\n#ifdef SDF\nv_halo_width = halo_width;\n#endif\nfloat modded = mod(a_opacityInfo, 128.0);\nfloat targetOpacity = (a_opacityInfo - modded) / 128.0;\nfloat startOpacity = modded / 127.0;\nfloat interpolatedOpacity = clamp(startOpacity + 2.0 * (targetOpacity - 0.5) * u_time / u_fadeDuration, 0.0, 1.0);\nv_opacity *= interpolatedOpacity;\nmediump float a_angle         = a_levelInfo[1];\nmediump float a_minLevel      = a_levelInfo[2];\nmediump float a_maxLevel      = a_levelInfo[3];\nmediump vec2 a_tex            = a_texAngleRange.xy;\nmediump float delta_z = 0.0;\nmediump float rotated = mod(a_angle + u_mapRotation, 256.0);\ndelta_z += (1.0 - step(u_keepUpright, 0.0)) * step(64.0, rotated) * (1.0 - step(192.0, rotated));\ndelta_z += 1.0 - step(a_minLevel, u_level);\ndelta_z += step(a_maxLevel, u_level);\ndelta_z += step(v_opacity, 0.0);\nvec2 offset = C_OFFSET_PRECISION * a_vertexOffset;\nv_size = abs(offset);\n#ifdef SDF\noffset = (120.0 / 86.0) * offset;\n#endif\nmediump vec3 pos = u_dvsMat3 * vec3(a_pos, 1.0) + u_displayViewMat3 * vec3(size * offset, 0.0) + u_displayMat3 * vec3(u_iconTranslation, 0.0);\ngl_Position = vec4(pos.xy, u_depth + delta_z, 1.0);\n#ifdef ID\nv_id = u_id / 255.0;\n#endif\nv_tex = a_tex.xy / u_mosaicSize;\n}"},line:{"line.frag":"precision lowp float;\nvarying mediump vec2 v_normal;\nvarying highp float v_accumulatedDistance;\nvarying mediump float v_lineHalfWidth;\nvarying lowp vec4 v_color;\nvarying mediump float v_blur;\n#if defined (PATTERN) || defined(SDF)\nvarying mediump vec4 v_tlbr;\nvarying mediump vec2 v_patternSize;\nvarying mediump float v_widthRatio;\nuniform sampler2D u_texture;\nuniform mediump float u_antialiasing;\n#endif\n#ifdef SDF\n#include <util/encoding.glsl>\n#endif\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main()\n{\nmediump float fragDist = length(v_normal) * v_lineHalfWidth;\nlowp float alpha = clamp((v_lineHalfWidth - fragDist) / v_blur, 0.0, 1.0);\n#ifdef PATTERN\nmediump float relativeTexX = fract(v_accumulatedDistance / (v_patternSize.x * v_widthRatio));\nmediump float relativeTexY = 0.5 + v_normal.y * v_lineHalfWidth / (v_patternSize.y * v_widthRatio);\nmediump vec2 texCoord = mix(v_tlbr.xy, v_tlbr.zw, vec2(relativeTexX, relativeTexY));\nlowp vec4 color = texture2D(u_texture, texCoord);\ngl_FragColor = alpha * v_color[3] * color;\n#elif defined(SDF)\nmediump float relativeTexX = fract((v_accumulatedDistance * 0.5) / (v_patternSize.x * v_widthRatio));\nmediump float relativeTexY =  0.5 + 0.25 * v_normal.y;\nmediump vec2 texCoord = mix(v_tlbr.xy, v_tlbr.zw, vec2(relativeTexX, relativeTexY));\nmediump float d = rgba2float(texture2D(u_texture, texCoord)) - 0.5;\nfloat dist = d * (v_lineHalfWidth + u_antialiasing / 2.0);\ngl_FragColor = alpha * clamp(0.5 - dist, 0.0, 1.0) * v_color;\n#else\ngl_FragColor = alpha * v_color;\n#endif\n#ifdef ID\nif (gl_FragColor.a < 1.0 / 255.0) {\ndiscard;\n}\ngl_FragColor = v_id;\n#endif\n}","line.vert":"precision mediump float;\nattribute vec2 a_pos;\nattribute vec4 a_extrude_offset;\nattribute vec4 a_dir_normal;\nattribute vec2 a_accumulatedDistance;\n#pragma header\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform highp mat3 u_displayViewMat3;\nuniform mediump float u_zoomFactor;\nuniform mediump vec2 u_lineTranslation;\nuniform mediump float u_antialiasing;\nuniform mediump float u_depth;\nvarying mediump vec2 v_normal;\nvarying highp float v_accumulatedDistance;\nconst float scale = 1.0 / 31.0;\nconst mediump float tileCoordRatio = 8.0;\n#if defined (SDF)\nconst mediump float sdfPatternHalfWidth = 15.5;\n#endif\n#if defined (PATTERN) || defined(SDF)\nuniform mediump vec2 u_mosaicSize;\nvarying mediump vec4 v_tlbr;\nvarying mediump vec2 v_patternSize;\nvarying mediump float v_widthRatio;\n#endif\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nvarying lowp vec4 v_color;\nvarying mediump float v_lineHalfWidth;\nvarying mediump float v_blur;\nvoid main()\n{\n#pragma main\nv_color = color * opacity;\nv_blur = blur + u_antialiasing;\nv_normal = a_dir_normal.zw * scale;\n#if defined (PATTERN) || defined(SDF)\nv_tlbr          = tlbr / u_mosaicSize.xyxy;\nv_patternSize   = vec2(tlbr.z - tlbr.x, tlbr.y - tlbr.w);\n#if defined (PATTERN)\nv_widthRatio = width / v_patternSize.y;\n#else\nv_widthRatio = width / sdfPatternHalfWidth / 2.0;\n#endif\n#endif\nv_lineHalfWidth = (width + u_antialiasing) * 0.5;\nmediump vec2 dir = a_dir_normal.xy * scale;\nmediump vec2 offset_ = a_extrude_offset.zw * scale * offset;\nmediump vec2 dist = v_lineHalfWidth * scale * a_extrude_offset.xy;\nmediump vec3 pos = u_dvsMat3 * vec3(a_pos + offset_ * tileCoordRatio / u_zoomFactor, 1.0) + u_displayViewMat3 * vec3(dist, 0.0) + u_displayMat3 * vec3(u_lineTranslation, 0.0);\ngl_Position = vec4(pos.xy, u_depth, 1.0);\n#if defined (PATTERN) || defined(SDF)\nv_accumulatedDistance = a_accumulatedDistance.x * u_zoomFactor / tileCoordRatio + dot(dir, dist + offset_);\n#endif\n#ifdef ID\nv_id = u_id / 255.0;\n#endif\n}"},outline:{"outline.frag":"varying lowp vec4 v_color;\nvarying mediump vec2 v_normal;\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main()\n{\nlowp float dist = abs(v_normal.y);\nlowp float alpha = smoothstep(1.0, 0.0, dist);\ngl_FragColor = alpha * v_color;\n#ifdef ID\nif (gl_FragColor.a < 1.0 / 255.0) {\ndiscard;\n}\ngl_FragColor = v_id;\n#endif\n}","outline.vert":"attribute vec2 a_pos;\nattribute vec2 a_offset;\nattribute vec2 a_xnormal;\n#pragma header\nvarying lowp vec4 v_color;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform mediump vec2 u_fillTranslation;\nuniform mediump float u_depth;\nuniform mediump float u_outline_width;\nvarying lowp vec2 v_normal;\nconst float scale = 1.0 / 15.0;\nvoid main()\n{\n#pragma main\nv_color = color * opacity;\n#ifdef ID\nv_id = u_id / 255.0;\n#endif\nv_normal = a_xnormal;\nmediump vec2 dist = u_outline_width * scale * a_offset;\nmediump vec3 pos = u_dvsMat3 * vec3(a_pos, 1.0) + u_displayMat3 * vec3(dist + u_fillTranslation, 0.0);\ngl_Position = vec4(pos.xy, u_depth, 1.0);\n}"},text:{"text.frag":"uniform lowp sampler2D u_texture;\nvarying lowp vec2 v_tex;\nvarying lowp vec4 v_color;\nvarying mediump float v_edgeWidth;\nvarying mediump float v_edgeDistance;\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main()\n{\nlowp float dist = texture2D(u_texture, v_tex).a;\nmediump float alpha = smoothstep(v_edgeDistance - v_edgeWidth, v_edgeDistance + v_edgeWidth, dist);\ngl_FragColor = alpha * v_color;\n#ifdef ID\nif (gl_FragColor.a < 1.0 / 255.0) {\ndiscard;\n}\ngl_FragColor = v_id;\n#endif\n}","text.vert":"attribute vec2 a_pos;\nattribute vec2 a_vertexOffset;\nattribute vec4 a_texAngleRange;\nattribute vec4 a_levelInfo;\nattribute float a_opacityInfo;\n#pragma header\nvarying lowp vec4 v_color;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform highp mat3 u_displayViewMat3;\nuniform mediump vec2 u_textTranslation;\nuniform vec2 u_mosaicSize;\nuniform mediump float u_depth;\nuniform mediump float u_mapRotation;\nuniform mediump float u_level;\nuniform lowp float u_keepUpright;\nuniform mediump float u_fadeDuration;\nvarying lowp vec2 v_tex;\nconst float offsetPrecision = 1.0 / 8.0;\nconst mediump float edgePos = 0.75;\nuniform mediump float u_antialiasingWidth;\nvarying mediump float v_edgeDistance;\nvarying mediump float v_edgeWidth;\nuniform lowp float u_halo;\nconst float sdfFontScale = 1.0 / 24.0;\nconst float sdfPixel = 3.0;\nuniform highp float u_time;\nvoid main()\n{\n#pragma main\nif (u_halo > 0.5)\n{\nv_color = halo_color * opacity;\nhalo_width *= sdfPixel;\nhalo_blur *= sdfPixel;\n}\nelse\n{\nv_color = color * opacity;\nhalo_width = 0.0;\nhalo_blur = 0.0;\n}\nfloat modded = mod(a_opacityInfo, 128.0);\nfloat targetOpacity = (a_opacityInfo - modded) / 128.0;\nfloat startOpacity = modded / 127.0;\nfloat interpolatedOpacity = clamp(startOpacity + 2.0 * (targetOpacity - 0.5) * u_time / u_fadeDuration, 0.0, 1.0);\nv_color *= interpolatedOpacity;\nmediump float a_angle       = a_levelInfo[1];\nmediump float a_minLevel    = a_levelInfo[2];\nmediump float a_maxLevel    = a_levelInfo[3];\nmediump vec2 a_tex          = a_texAngleRange.xy;\nmediump float a_visMinAngle    = a_texAngleRange.z;\nmediump float a_visMaxAngle    = a_texAngleRange.w;\nmediump float delta_z = 0.0;\nmediump float angle = mod(a_angle + u_mapRotation, 256.0);\nif (a_visMinAngle < a_visMaxAngle)\n{\ndelta_z += (1.0 - step(u_keepUpright, 0.0)) * (step(a_visMaxAngle, angle) + (1.0 - step(a_visMinAngle, angle)));\n}\nelse\n{\ndelta_z += (1.0 - step(u_keepUpright, 0.0)) * (step(a_visMaxAngle, angle) * (1.0 - step(a_visMinAngle, angle)));\n}\ndelta_z += 1.0 - step(a_minLevel, u_level);\ndelta_z += step(a_maxLevel, u_level);\ndelta_z += step(v_color[3], 0.0);\nv_tex = a_tex.xy / u_mosaicSize;\n#ifdef ID\nv_id = u_id / 255.0;\n#endif\nv_edgeDistance = edgePos - halo_width / size;\nv_edgeWidth = (u_antialiasingWidth + halo_blur) / size;\nmediump vec3 pos = u_dvsMat3 * vec3(a_pos, 1.0) + sdfFontScale * u_displayViewMat3 * vec3(offsetPrecision * size * a_vertexOffset, 0.0) + u_displayMat3 * vec3(u_textTranslation, 0.0);\ngl_Position = vec4(pos.xy, u_depth + delta_z, 1.0);\n}"},util:{"encoding.glsl":"const vec4 rgba2float_factors = vec4(\n255.0 / (256.0),\n255.0 / (256.0 * 256.0),\n255.0 / (256.0 * 256.0 * 256.0),\n255.0 / (256.0 * 256.0 * 256.0 * 256.0)\n);\nfloat rgba2float(vec4 rgba) {\nreturn dot(rgba, rgba2float_factors);\n}","util.glsl":"float nextPOT(in float x) {\nreturn pow(2.0, ceil(log2(abs(x))));\n}"}},g=new(o(7423).B)(function D(x){let y=I;return x.split("/").forEach(L=>{y&&(y=y[L])}),y});function A(x){return g.resolveIncludes(x)}},2172:(rt,X,o)=>{o.d(X,{Q:()=>y,g:()=>A});var I=o(8314),m=o(62208),D=o(31823);const g=(0,I.Z)("esri-2d-log-allocations");class A{constructor(T,s){this._array=T,this._pool=s}get array(){return this._array}get length(){return this._array.length}static create(T,s){const b=s.acquire(T);return new A(b,s)}expand(T){const s=this._pool.acquire(T);s.set(this._array),this._pool.release(this._array),this._array=s}destroy(){this._pool.release(this._array)}set(T,s){this._array.set(T._array,s)}slice(){const T=this._pool.acquire(this._array.byteLength);return T.set(this._array),new A(T,this._pool)}}class x{constructor(){this._data=new ArrayBuffer(x.BYTE_LENGTH),this._freeList=new D.m({start:0,end:this._data.byteLength})}static get BYTE_LENGTH(){return 64e6}get buffer(){return this._data}allocate(T){const s=this._freeList.firstFit(T);return null==s?null:new Uint32Array(this._data,s,T/Uint32Array.BYTES_PER_ELEMENT)}free(T){this._freeList.free(T.byteOffset,T.byteLength)}}class y{constructor(){this._bytesAllocated=0,this._pages=[],this._pagesByBuffer=new Map,this._addPage()}destroy(){this._pages=[],this._pagesByBuffer=null}get _bytesTotal(){return this._pages.length*x.BYTE_LENGTH}acquire(T){if(this._bytesAllocated+=T,g&&console.log(`Allocating ${T}, (${this._bytesAllocated} / ${this._bytesTotal})`),T>x.BYTE_LENGTH)return new Uint32Array(T/Uint32Array.BYTES_PER_ELEMENT);for(const b of this._pages){const C=b.allocate(T);if(null!=C)return C}const s=this._addPage().allocate(T);return(0,m.O3)(s,"Expected to allocate page"),s}release(T){this._bytesAllocated-=T.byteLength,g&&console.log(`Freeing ${T.byteLength}, (${this._bytesAllocated} / ${this._bytesTotal})`);const s=this._pagesByBuffer.get(T.buffer);s&&s.free(T)}_addPage(){const T=new x;return this._pages.push(T),this._pagesByBuffer.set(T.buffer,T),T}}},22796:(rt,X,o)=>{o.d(X,{Q:()=>x});var I=o(65389),m=o(61885),D=o(8314),g=o(46593);const A=(0,D.Z)("esri-2d-profiler");class x{constructor(L,T){if(this._events=new m.Z,this._entries=new Map,this._timings=new I.Z(10),this._currentContainer=null,this._currentPass=null,this._currentBrush=null,this._currentSummary=null,!A)return;this._ext=(0,g.mO)(L.gl,{}),this._debugOutput=T;const s=L.gl;if(!this.enableCommandLogging)return;let b;for(b in s)if("function"==typeof s[b]){const C=s[b],f=b.includes("draw");s[b]=(...S)=>(this._events.emit("command",{container:this._currentContainer,pass:this._currentPass,brush:this._currentBrush,method:b,args:S,isDrawCommand:f}),this._currentSummary&&(this._currentSummary.commands++,f&&this._currentSummary.drawCommands++),C.apply(s,S))}}get enableCommandLogging(){return!("object"==typeof A&&A.disableCommands)}recordContainerStart(L){A&&(this._currentContainer=L)}recordContainerEnd(){A&&(this._currentContainer=null)}recordPassStart(L){A&&(this._currentPass=L,this._initSummary())}recordPassEnd(){A&&(this._currentPass=null,this._emitSummary())}recordBrushStart(L){A&&(this._currentBrush=L)}recordBrushEnd(){A&&(this._currentBrush=null)}recordStart(L){if(A&&null!=this._ext){if(this._entries.has(L)){const s=this._entries.get(L),b=this._ext.resultAvailable(s.query),C=this._ext.disjoint();if(b&&!C){const f=this._ext.getResult(s.query)/1e6;let S=0;if(null!=this._timings.enqueue(f)){const K=this._timings.entries,v=K.length;let E=0;for(const B of K)E+=B;S=E/v}const V=f.toFixed(2),M=S?S.toFixed(2):"--";this.enableCommandLogging?(console.groupCollapsed(`Frame report for ${L}, ${V} ms (${M} last 10 avg)\n${s.commandsLen} Commands (${s.drawCommands} draw)`),console.log("RenderPass breakdown: "),console.table(s.summaries),console.log("Commands: ",s.commands),console.groupEnd()):console.log(`Frame report for ${L}, ${V} ms (${M} last 10 avg)`),this._debugOutput.innerHTML=`${V} (${M})`}for(const f of s.handles)f.remove();this._ext.deleteQuery(s.query),this._entries.delete(L)}const T={name:L,query:this._ext.createQuery(),commands:[],commandsLen:0,drawCommands:0,summaries:[],handles:[]};this.enableCommandLogging&&(T.handles.push(this._events.on("command",s=>{T.commandsLen++,T.commands.push(s),s.isDrawCommand&&T.drawCommands++})),T.handles.push(this._events.on("summary",s=>{T.summaries.push(s)}))),this._ext.beginTimeElapsed(T.query),this._entries.set(L,T)}}recordEnd(L){A&&null!=this._ext&&this._entries.has(L)&&this._ext.endTimeElapsed()}_initSummary(){this.enableCommandLogging&&(this._currentSummary={container:this._currentContainer,pass:this._currentPass,drawCommands:0,commands:0})}_emitSummary(){this.enableCommandLogging&&this._currentSummary&&this._events.emit("summary",this._currentSummary)}}},67910:(rt,X,o)=>{o.d(X,{Z:()=>et});var I=o(15861),m=o(59318),D=o(84792),g=o(986),A=o(26584),x=o(17002),y=o(8314),L=o(63290),T=o(21286),s=o(10699),b=o(23841),C=o(21726),f=o(67831),S=o(9545),V=o(32837),M=o(39351),K=o(39406),v=o(84439);class E{constructor(t,i){this._width=0,this._height=0,this._free=[],this._width=t,this._height=i,this._free.push(new v.Z(0,0,t,i))}get width(){return this._width}get height(){return this._height}allocate(t,i){if(t>this._width||i>this._height)return new v.Z;let e=null,l=-1;for(let h=0;h<this._free.length;++h){const r=this._free[h];t<=r.width&&i<=r.height&&(null===e||r.y<=e.y&&r.x<=e.x)&&(e=r,l=h)}return null===e?new v.Z:(this._free.splice(l,1),e.width<e.height?(e.width>t&&this._free.push(new v.Z(e.x+t,e.y,e.width-t,i)),e.height>i&&this._free.push(new v.Z(e.x,e.y+i,e.width,e.height-i))):(e.width>t&&this._free.push(new v.Z(e.x+t,e.y,e.width-t,e.height)),e.height>i&&this._free.push(new v.Z(e.x,e.y+i,t,e.height-i))),new v.Z(e.x,e.y,t,i))}release(t){for(let i=0;i<this._free.length;++i){const e=this._free[i];if(e.y===t.y&&e.height===t.height&&e.x+e.width===t.x)e.width+=t.width;else if(e.x===t.x&&e.width===t.width&&e.y+e.height===t.y)e.height+=t.height;else if(t.y===e.y&&t.height===e.height&&t.x+t.width===e.x)e.x=t.x,e.width+=t.width;else{if(t.x!==e.x||t.width!==e.width||t.y+t.height!==e.y)continue;e.y=t.y,e.height+=t.height}this._free.splice(i,1),this.release(t)}this._free.push(t)}}var B=o(67969),N=o(18952),R=o(31548);const H=F=>Math.floor(F/256);class P{constructor(t,i,e){this.width=0,this.height=0,this._dirties=[],this._glyphData=[],this._currentPage=0,this._glyphCache={},this._textures=[],this._rangePromises=new Map,this._preloadCache={},this.width=t,this.height=i,this._glyphSource=e,this._binPack=new E(t-4,i-4),this._glyphData.push(new Uint8Array(t*i)),this._dirties.push(!0),this._textures.push(null),this._initDecorationGlyphs()}dispose(){this._binPack=null;for(const t of this._textures)t&&t.dispose();this._textures.length=0,this._glyphData.length=0}_initDecorationGlyphs(){const t=[117,149,181,207,207,181,149,117],i=[],e=[];for(let r=0;r<t.length;r++){const p=t[r];for(let W=0;W<11;W++){const U=r>=3&&r<5&&W>=3&&W<8?255:0;i.push(p),e.push(U)}}const l={metrics:{width:5,height:2,left:0,top:0,advance:0},bitmap:new Uint8Array(i)},h={metrics:{width:5,height:2,left:0,top:0,advance:0},bitmap:new Uint8Array(e)};this._recordGlyph(l),this._recordGlyph(h)}getGlyphItems(t,i,e){var l=this;return(0,I.Z)(function*(){const h=l._getGlyphCache(t);return yield l._fetchRanges(t,i,e),i.map(r=>l._getMosaicItem(h,t,r))})()}bind(t,i,e,l){const h=this._getTexture(t,e);h.setSamplingMode(i),this._dirties[e]&&(h.setData(this._glyphData[e]),this._dirties[e]=!1),t.bindTexture(h,l)}preloadASCIIGlyphCache(t){const i=this._preloadCache[t];if(null!=i)return i;const e=this._glyphSource.preloadASCIIRange(t).then(()=>{const l=this._getGlyphCache(t);for(let h=0;h<256;h++)this._getMosaicItem(l,t,h)});return this._preloadCache[t]=e,e}_getGlyphCache(t){return this._glyphCache[t]||(this._glyphCache[t]={}),this._glyphCache[t]}_getTexture(t,i){if(!this._textures[i]){const e=new R.X;e.pixelFormat=B.VI.ALPHA,e.wrapMode=B.e8.CLAMP_TO_EDGE,e.width=this.width,e.height=this.height,this._textures[i]=new N.x(t,e,new Uint8Array(this.width*this.height))}return this._textures[i]}_invalidate(){this._dirties[this._currentPage]=!0}_fetchRanges(t,i,e){var l=this;return(0,I.Z)(function*(){const h=function J(F){const t=new Set;for(const i of F)t.add(H(i));return t}(i),r=[];h.forEach(p=>{r.push(l._fetchRange(t,p,e))}),yield Promise.all(r)})()}_fetchRange(t,i,e){var l=this;return(0,I.Z)(function*(){if(!(i>256))return function Q(F,t,i){return F.has(t)||F.set(t,i().then(()=>{F.delete(t)}).catch(e=>{F.delete(t),(0,s.H9)(e)})),F.get(t)}(l._rangePromises,t+i,()=>l._glyphSource.getRange(t,i,e))})()}_getMosaicItem(t,i,e){if(!t[e]){const l=this._glyphSource.getGlyph(i,e);if(!l?.metrics)return F=e,{rect:new v.Z(0,0,0,0),page:0,metrics:{left:0,width:0,height:0,advance:0,top:0},code:F,sdf:!0};const h=this._recordGlyph(l);t[e]={rect:h,page:this._currentPage,metrics:l.metrics,code:e,sdf:!0},this._invalidate()}var F;return t[e]}_recordGlyph(t){const i=t.metrics;let e;if(0===i.width)e=new v.Z(0,0,0,0);else{const h=i.width+6,r=i.height+6;e=this._binPack.allocate(h,r),e.isEmpty&&(this._dirties[this._currentPage]||(this._glyphData[this._currentPage]=null),this._currentPage=this._glyphData.length,this._glyphData.push(new Uint8Array(this.width*this.height)),this._dirties.push(!0),this._textures.push(null),this._initDecorationGlyphs(),this._binPack=new E(this.width-4,this.height-4),e=this._binPack.allocate(h,r));const p=this._glyphData[this._currentPage],W=t.bitmap;let U,st;if(W)for(let ct=0;ct<r;ct++){U=h*ct,st=this.width*(e.y+ct)+e.x;for(let nt=0;nt<h;nt++)p[st+nt]=W[U+nt]}(0,y.Z)("esri-glyph-debug")&&this._showDebugPage(p)}return e}_showDebugPage(t){const i=document.createElement("canvas"),e=i.getContext("2d"),l=new ImageData(this.width,this.height),h=l.data;i.width=this.width,i.height=this.height,i.style.border="1px solid black";for(let r=0;r<t.length;++r)h[4*r]=t[r],h[4*r+1]=0,h[4*r+2]=0,h[4*r+3]=255;e.putImageData(l,0,0),document.body.appendChild(i)}}var j=o(24192);class k{constructor(t){for(this._metrics=[],this._bitmaps=[];t.next();)switch(t.tag()){case 1:{const i=t.getMessage();for(;i.next();)switch(i.tag()){case 3:{const e=i.getMessage();let l,h,r,p,W,U,st;for(;e.next();)switch(e.tag()){case 1:l=e.getUInt32();break;case 2:h=e.getBytes();break;case 3:r=e.getUInt32();break;case 4:p=e.getUInt32();break;case 5:W=e.getSInt32();break;case 6:U=e.getSInt32();break;case 7:st=e.getUInt32();break;default:e.skip()}e.release(),l&&(this._metrics[l]={width:r,height:p,left:W,top:U,advance:st},this._bitmaps[l]=h);break}default:i.skip()}i.release();break}default:t.skip()}}getMetrics(t){return this._metrics[t]}getBitmap(t){return this._bitmaps[t]}}class Z{constructor(){this._ranges=[]}getRange(t){return this._ranges[t]}addRange(t,i){this._ranges[t]=i}}class Y{constructor(t){this._glyphInfo={},this._baseURL=t}getRange(t,i,e){const l=this._getFontStack(t);if(l.getRange(i))return Promise.resolve();const h=256*i,r=h+255,p=this._baseURL.replace("{fontstack}",t).replace("{range}",h+"-"+r);return(0,D.Z)(p,{responseType:"array-buffer",...e}).then(W=>{l.addRange(i,new k(new j.Z(new Uint8Array(W.data),new DataView(W.data))))})}preloadASCIIRange(t){var i=this;return(0,I.Z)(function*(){const e=i._getFontStack(t),r=i._baseURL.replace("{fontstack}",t).replace("{range}","0-255"),p=yield(0,D.Z)(r,{responseType:"array-buffer"}),W=new k(new j.Z(new Uint8Array(p.data),new DataView(p.data)));for(let U=0;U<=255;U++)e.getRange(U)||e.addRange(U,W)})()}getGlyph(t,i){const e=this._getFontStack(t);if(!e)return;const l=Math.floor(i/256),h=e.getRange(l);return h?{metrics:h.getMetrics(i),bitmap:h.getBitmap(i)}:void 0}_getFontStack(t){let i=this._glyphInfo[t];return i||(i=this._glyphInfo[t]=new Z),i}}var $=o(36161);const q=1e20;class it{constructor(t){this._svg=null,this.size=t;const i=document.createElement("canvas");i.width=i.height=t,this._context=i.getContext("2d",{willReadFrequently:!1}),this._gridOuter=new Float64Array(t*t),this._gridInner=new Float64Array(t*t),this._f=new Float64Array(t),this._d=new Float64Array(t),this._z=new Float64Array(t+1),this._v=new Int16Array(t)}dispose(){this._context=this._gridOuter=this._gridInner=this._f=this._d=this._z=this._v=null,this._svg&&(document.body.removeChild(this._svg),this._svg=null)}draw(t,i,e,l=31){this._initSVG();const h=this.createSVGString(t,i);return new Promise((r,p)=>{const W=new Image;W.src="data:image/svg+xml; charset=utf8, "+encodeURIComponent(h),W.onload=()=>{W.onload=null,this._context.clearRect(0,0,this.size,this.size),this._context.drawImage(W,0,0,this.size,this.size);const st=this._context.getImageData(0,0,this.size,this.size),ct=new Uint8Array(this.size*this.size*4);for(let nt=0;nt<this.size*this.size;nt++){const _t=st.data[4*nt+3]/255;this._gridOuter[nt]=1===_t?0:0===_t?q:Math.max(0,.5-_t)**2,this._gridInner[nt]=1===_t?q:0===_t?0:Math.max(0,_t-.5)**2}this._edt(this._gridOuter,this.size,this.size),this._edt(this._gridInner,this.size,this.size);for(let nt=0;nt<this.size*this.size;nt++)(0,$.I)(.5-(this._gridOuter[nt]-this._gridInner[nt])/(2*l),ct,4*nt);r(ct)};const U=e?.signal;U&&(0,s.fu)(U,()=>p((0,s.zE)()))})}_initSVG(){if(!this._svg){const t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.setAttribute("style","position: absolute;"),t.setAttribute("width","0"),t.setAttribute("height","0"),t.setAttribute("aria-hidden","true"),t.setAttribute("role","presentation"),document.body.appendChild(t),this._svg=t}return this._svg}createSVGString(t,i){const e=this._initSVG(),l=document.createElementNS("http://www.w3.org/2000/svg","path");l.setAttribute("d",t),e.appendChild(l);const h=l.getBBox(),r=h.width/h.height,p=this.size/2;let W,U,st;r>1?(W=p/h.width,U=this.size/4,st=p-p*(1/r)/2):(W=p/h.height,U=p-p*r/2,st=this.size/4),l.setAttribute("style",`transform: matrix(${W}, 0, 0, ${W}, ${-h.x*W+U}, ${-h.y*W+st})`),l.setAttribute("stroke-width",""+.5/W);const _t=`<svg style="fill:${i?"red":"none"}; stroke:${i?"none":"red"}" height="${this.size}" width="${this.size}" xmlns="http://www.w3.org/2000/svg">${e.innerHTML}</svg>`;return e.removeChild(l),_t}_edt(t,i,e){const l=this._f,h=this._d,r=this._v,p=this._z;for(let W=0;W<i;W++){for(let U=0;U<e;U++)l[U]=t[U*i+W];this._edt1d(l,h,r,p,e);for(let U=0;U<e;U++)t[U*i+W]=h[U]}for(let W=0;W<e;W++){for(let U=0;U<i;U++)l[U]=t[W*i+U];this._edt1d(l,h,r,p,i);for(let U=0;U<i;U++)t[W*i+U]=Math.sqrt(h[U])}}_edt1d(t,i,e,l,h){e[0]=0,l[0]=-q,l[1]=+q;for(let r=1,p=0;r<h;r++){let W=(t[r]+r*r-(t[e[p]]+e[p]*e[p]))/(2*r-2*e[p]);for(;W<=l[p];)p--,W=(t[r]+r*r-(t[e[p]]+e[p]*e[p]))/(2*r-2*e[p]);p++,e[p]=r,l[p]=W,l[p+1]=+q}for(let r=0,p=0;r<h;r++){for(;l[p+1]<r;)p++;i[r]=(r-e[p])*(r-e[p])+t[e[p]]}}}var pt=o(43289);function at(F){return F&&"static"===F.type}class ft{constructor(t,i,e=0){this._mosaicPages=[],this._maxItemSize=0,this._currentPage=0,this._pageWidth=0,this._pageHeight=0,this._mosaicRects=new Map,this._spriteCopyQueue=[],this.pixelRatio=1,(t<=0||i<=0)&&console.error("Sprites mosaic defaultWidth and defaultHeight must be greater than zero!"),this._pageWidth=t,this._pageHeight=i,e>0&&(this._maxItemSize=e),this.pixelRatio=window.devicePixelRatio||1,this._binPack=new E(this._pageWidth,this._pageHeight);const l=Math.floor(this._pageWidth),h=Math.floor(this._pageHeight);this._mosaicPages.push({mosaicsData:{type:"static",data:new Uint32Array(l*h)},size:[this._pageWidth,this._pageHeight],dirty:!0,texture:void 0})}getWidth(t){return t>=this._mosaicPages.length?-1:this._mosaicPages[t].size[0]}getHeight(t){return t>=this._mosaicPages.length?-1:this._mosaicPages[t].size[1]}getPageTexture(t){return t<this._mosaicPages.length?this._mosaicPages[t].texture:null}has(t){return this._mosaicRects.has(t)}get itemCount(){return this._mosaicRects.size}getSpriteItem(t){return this._mosaicRects.get(t)}addSpriteItem(t,i,e,l,h,r,p=1){if(this._mosaicRects.has(t))return this._mosaicRects.get(t);let W,U,st;if(at(e)?[W,U,st]=this._allocateImage(i[0],i[1]):(W=new v.Z(0,0,i[0],i[1]),U=this._mosaicPages.length,this._mosaicPages.push({mosaicsData:e,size:[i[0]+2*M.s4,i[1]+2*M.s4],dirty:!0,texture:void 0})),W.width<=0||W.height<=0)return null;const ct={rect:W,width:i[0],height:i[1],sdf:h,simplePattern:r,pixelRatio:p,page:U};return this._mosaicRects.set(t,ct),at(e)&&((0,y.Z)("esri-mosaic-debug")&&this._showDebugSprite(i,e.data),this._copy({rect:W,spriteSize:i,spriteData:e.data,page:U,pageSize:st,repeat:l,sdf:h})),ct}hasItemsToProcess(){return 0!==this._spriteCopyQueue.length}processNextItem(){const t=this._spriteCopyQueue.pop();t&&this._copy(t)}getSpriteItems(t){const i={};for(const e of t)i[e]=this.getSpriteItem(e);return i}getMosaicItemPosition(t){const i=this.getSpriteItem(t),e=i?.rect;if(!e)return null;e.width=i.width,e.height=i.height;const r=M.s4,p=this._mosaicPages[i.page].size;return{size:[i.width,i.height],tl:[(e.x+r)/p[0],(e.y+r)/p[1]],br:[(e.x+r+i.width)/p[0],(e.y+r+i.height)/p[1]],page:i.page}}bind(t,i,e=0,l=0){const h=this._mosaicPages[e],r=h.mosaicsData;let p=h.texture;p||(p=function gt(F,t){const i=new R.X;return i.width=t[0],i.height=t[1],i.wrapMode=B.e8.CLAMP_TO_EDGE,new N.x(F,i,null)}(t,h.size),h.texture=p),p.setSamplingMode(i),at(r)?(t.bindTexture(p,l),h.dirty&&(p.setData(new Uint8Array(r.data.buffer)),p.generateMipmap(),(0,y.Z)("esri-mosaic-debug")&&this._showDebugPage(e))):(r.data.bindFrame(t,p,l),p.generateMipmap()),h.dirty=!1}dispose(){this._binPack=null;for(const t of this._mosaicPages){const i=t.texture;i&&i.dispose();const e=t.mosaicsData;at(e)||e.data.destroy()}this._mosaicPages=null,this._mosaicRects.clear()}static _copyBits(t,i,e,l,h,r,p,W,U,st,ct){let nt=l*i+e,_t=W*r+p;if(ct){_t-=r;for(let mt=-1;mt<=st;mt++,nt=((mt+st)%st+l)*i+e,_t+=r)for(let wt=-1;wt<=U;wt++)h[_t+wt]=t[nt+(wt+U)%U]}else for(let mt=0;mt<st;mt++){for(let wt=0;wt<U;wt++)h[_t+wt]=t[nt+wt];nt+=i,_t+=r}}_copy(t){if(t.page>=this._mosaicPages.length)return;const i=this._mosaicPages[t.page],e=i.mosaicsData;if(!at(i.mosaicsData))throw new A.Z("mapview-invalid-resource","unsuitable data type!");const l=t.spriteData,h=e.data;h&&l||console.error("Source or target images are uninitialized!"),ft._copyBits(l,t.spriteSize[0],0,0,h,t.pageSize[0],t.rect.x+M.s4,t.rect.y+M.s4,t.spriteSize[0],t.spriteSize[1],t.repeat),i.dirty=!0}_allocateImage(t,i){t+=2*M.s4,i+=2*M.s4;const e=Math.max(t,i);if(this._maxItemSize&&this._maxItemSize<e){const h=2**Math.ceil((0,pt.k3)(t)),r=2**Math.ceil((0,pt.k3)(i)),p=new v.Z(0,0,t,i);return this._mosaicPages.push({mosaicsData:{type:"static",data:new Uint32Array(h*r)},size:[h,r],dirty:!0,texture:void 0}),[p,this._mosaicPages.length-1,[h,r]]}const l=this._binPack.allocate(t,i);if(l.width<=0){const h=this._mosaicPages[this._currentPage];return!h.dirty&&at(h.mosaicsData)&&(h.mosaicsData.data=null),this._currentPage=this._mosaicPages.length,this._mosaicPages.push({mosaicsData:{type:"static",data:new Uint32Array(this._pageWidth*this._pageHeight)},size:[this._pageWidth,this._pageHeight],dirty:!0,texture:void 0}),this._binPack=new E(this._pageWidth,this._pageHeight),this._allocateImage(t,i)}return[l,this._currentPage,[this._pageWidth,this._pageHeight]]}_showDebugSprite([t,i],e){const l=document.createElement("canvas");l.width=t,l.height=i,l.setAttribute("style",`position: absolute; top: ${4+204*lt++}px; right: 208px; width: 200px; height: 200px; border: 1px solid black;`);const h=l.getContext("2d"),r=new ImageData(t,i);r.data.set(new Uint8Array(e.buffer)),h.putImageData(r,0,0),document.body.appendChild(l)}_showDebugPage(t){const i=this._mosaicPages[t],{size:[e,l],mosaicsData:h}=i;if(!at(h))return void console.error("Could not show sprite mosaic debug for non-static resource");const r=`mosaicDebugPage${t}`,p=document.getElementById(r)??document.createElement("canvas");p.id=r,p.width=e,p.height=l,p.setAttribute("style",`position: absolute; top: ${4+204*t}px; right: 4px; width: 200px; height: 200px; border: 1px solid black;`);const W=p.getContext("2d"),U=new ImageData(e,l);U.data.set(new Uint8Array(h.data.buffer)),W.putImageData(U,0,0),document.body.appendChild(p)}}let lt=0;var tt=o(87526),yt=o(34106);class _{constructor(t,i,e,l){this._animation=t,this._frameData=null,this.frameCount=this._animation.frameDurations.length,this.width=this._animation.width,this.height=this._animation.height,this._playHandle=(0,yt.hY)(this._animation,e,l,r=>{this._frameData=r,i.requestRender()})}destroy(){this._playHandle.remove()}bindFrame(t,i,e){t.bindTexture(i,e);const l=this._frameData;null!=l&&(i.updateData(0,M.s4,M.s4,"width"in l?l.width:l.codedWidth,"height"in l?l.height:l.codedHeight,l),this._frameData=null)}}var G=o(84450),ut=o(7875);const vt=(0,S.c)(),dt="arial-unicode-ms-regular",Mt=L.Z.getLogger("esri.views.2d.engine.webgl.TextureManager");function d(F){const t=Math.round((0,b.F2)(F)*window.devicePixelRatio);return t*(t>=128?2:4)}function a(F,t){return Math.min(F,d(t))}function c(F,t){if(!F||!t)return{width:0,height:0};const i=F/t;if(i>1){const l=d(F);return{width:l,height:l/i}}const e=d(t);return{width:e*i,height:e}}const w=(F,t,i)=>Mt.error(new A.Z(F,t,i));class O{static fromMosaic(t,i){return new O(t,i.page,i.sdf)}constructor(t,i,e){this.mosaicType=t,this.page=i,this.sdf=e}}class et{constructor(t,i,e){var l;this._requestRender=t,this.resourceManager=i,this._allowNonPowerOfTwo=e,this._invalidFontsMap=new Map,this._sdfConverter=new it(M.qu),this._bindingInfos=new Array,this._hashToBindingIndex=new Map,this._ongoingRasterizations=new Map,this._imageRequestQueue=new ut.e({concurrency:10,process:(l=(0,I.Z)(function*(h,r){(0,s.k_)(r);try{return yield(0,D.Z)(h,{responseType:"image",signal:r})}catch(p){throw(0,s.D_)(p)?p:new A.Z("mapview-invalid-resource",`Could not fetch requested resource at ${h}`,p)}}),function(r,p){return l.apply(this,arguments)})}),this._spriteMosaic=new ft(2048,2048,500),this._glyphSource=new Y(`${m.Z.fontsUrl}/{fontstack}/{range}.pbf`),this._glyphMosaic=new P(1024,1024,this._glyphSource),this._rasterizer=new V.Z(i)}dispose(){this._spriteMosaic.dispose(),this._glyphMosaic.dispose(),this._rasterizer.dispose(),this._sdfConverter.dispose(),this._spriteMosaic=null,this._glyphMosaic=null,this._sdfConverter=null,this._hashToBindingIndex.clear(),this._hashToBindingIndex=null,this._bindingInfos=null,this._ongoingRasterizations.clear(),this._ongoingRasterizations=null,this._imageRequestQueue.clear(),this._imageRequestQueue=null}get sprites(){return this._spriteMosaic}get glyphs(){return this._glyphMosaic}rasterizeItem(t,i,e,l){var h=this;return(0,I.Z)(function*(){if(null==t)return w("mapview-null-resource","Unable to rasterize null resource"),null;switch(t.type){case"text":case"esriTS":{const r=yield h._rasterizeText(t,e,l);return r.forEach(p=>h._setTextureBinding(K.Un.GLYPH,p)),{glyphMosaicItems:r}}default:{if((0,tt.Ll)(t))return w("mapview-invalid-type",`MapView does not support symbol type: ${t.type}`,t),null;const r=yield h._rasterizeSpriteSymbol(t,i,l);return(0,G.ok)(r)&&r&&h._setTextureBinding(K.Un.SPRITE,r),{spriteMosaicItem:r}}}})()}bindTextures(t,i,e,l=!1){if(0===e.textureBinding)return;const h=this._bindingInfos[e.textureBinding-1],r=h.page,p=l?B.cw.LINEAR_MIPMAP_LINEAR:B.cw.LINEAR;switch(h.mosaicType){case K.Un.SPRITE:{const W=this.sprites.getWidth(r),U=this.sprites.getHeight(r),st=(0,f.s)(vt,W,U);return this._spriteMosaic.bind(t,p,r,M.Kt),i.setUniform1i("u_texture",M.Kt),void i.setUniform2fv("u_mosaicSize",st)}case K.Un.GLYPH:{const st=(0,f.s)(vt,this.glyphs.width,this.glyphs.height);return this._glyphMosaic.bind(t,p,r,M.wJ),i.setUniform1i("u_texture",M.wJ),void i.setUniform2fv("u_mosaicSize",st)}default:Mt.error("mapview-texture-manager",`Cannot handle unknown type ${h.mosaicType}`)}}_hashMosaic(t,i){return 1|t<<1|(i.sdf?1:0)<<2|i.page<<3}_setTextureBinding(t,i){const e=this._hashMosaic(t,i);if(!this._hashToBindingIndex.has(e)){const l=O.fromMosaic(t,i);this._hashToBindingIndex.set(e,this._bindingInfos.length+1),this._bindingInfos.push(l)}i.textureBinding=this._hashToBindingIndex.get(e)}_rasterizeText(t,i,e){var l=this;return(0,I.Z)(function*(){let h,r;if("cim"in t)h=t.fontName,r=t.text;else{const U=t;h=(0,x.Yc)(U.font),r=U.text}const p=l._invalidFontsMap.has(h),W=i||(0,tt.Jq)((0,g.E)(r)[0]);try{const U=p?dt:h;return(0,y.Z)("esri-2d-stabilize-glyphs")&&(yield l._glyphMosaic.preloadASCIIGlyphCache(U)),yield l._glyphMosaic.getGlyphItems(U,W,e)}catch{return w("mapview-invalid-resource",`Couldn't find font ${h}. Falling back to Arial Unicode MS Regular`),l._invalidFontsMap.set(h,!0),l._glyphMosaic.getGlyphItems(dt,W,e)}})()}_rasterizeSpriteSymbol(t,i,e){var l=this;return(0,I.Z)(function*(){if((0,tt.Gg)(t))return;const h=function ht(F){switch(F.type){case"esriSMS":return`${F.style}.${F.path}`;case"esriSLS":return`${F.style}.${F.cap}`;case"esriSFS":return`${F.style}`;case"esriPFS":case"esriPMS":return F.imageData?`${F.imageData}${F.width}${F.height}`:`${F.url}${F.width}${F.height}`;default:return"mosaicHash"in F?F.mosaicHash:JSON.stringify(F)}}(t);if(l._spriteMosaic.has(h))return l._spriteMosaic.getSpriteItem(h);if((0,tt.sG)(t)||(0,tt.HX)(t)&&!(0,tt.yP)(t))return l._handleAsyncResource(h,t,e);const p=l._rasterizer.rasterizeJSONResource(t,M.FM);if(p){const{size:W,image:U,sdf:st,simplePattern:ct,rasterizationScale:nt}=p;return l._addItemToMosaic(h,W,{type:"static",data:U},(0,tt.js)(t),st,ct,nt)}return new A.Z("TextureManager","unrecognized or null rasterized image")})()}_handleAsyncResource(t,i,e){var l=this;return(0,I.Z)(function*(){if(l._ongoingRasterizations.has(t))return l._ongoingRasterizations.get(t);let h;h=(0,tt.sG)(i)?l._handleSVG(i,t,e):l._handleImage(i,t,e),l._ongoingRasterizations.set(t,h);try{yield h,l._ongoingRasterizations.delete(t)}catch{l._ongoingRasterizations.delete(t)}return h})()}_handleSVG(t,i,e){var l=this;return(0,I.Z)(function*(){const h=[M.qu,M.qu],r=!("cim"in t)||t.cim.asFill,p=yield l._sdfConverter.draw(t.path,r,e);return l._addItemToMosaic(i,h,{type:"static",data:new Uint32Array(p.buffer)},!1,!0,!0)})()}_handleGIFOrPNG(t,i,e){var l=this;return(0,I.Z)(function*(){const h=(0,tt.Gr)(t);yield l.resourceManager.fetchResource(h,e);let r=l.resourceManager.getResource(h);if(null==r)return new A.Z("mapview-invalid-resource",`Could not fetch requested resource at ${h}.`);let p=r.width,W=r.height;if(r instanceof HTMLImageElement){"esriPMS"===t.type&&(p=Math.round(a(r.width,(0,tt.Ub)(t))),W=Math.round(r.height*(p/r.width)));const nt="cim"in t?t.cim.colorSubstitutions:void 0,{size:_t,sdf:mt,image:wt}=l._rasterizer.rasterizeImageResource(p,W,r,nt);return l._addItemToMosaic(i,_t,{type:"static",data:wt},(0,tt.js)(t),mt,!1)}l._allowNonPowerOfTwo||(p=(0,T.fp)(r.width+2*M.s4)-2*M.s4,W=(0,T.fp)(r.height+2*M.s4)-2*M.s4),p===r.width&&W===r.height||(r=(0,yt.SI)(r,p,W));const ct=new _(r,l._requestRender,t.animatedSymbolProperties||{},t.objectId);return l._addItemToMosaic(i,[ct.width,ct.height],{type:"animated",data:ct},(0,tt.js)(t),!1,!1)})()}_handleImage(t,i,e){var l=this;return(0,I.Z)(function*(){if((0,tt.DQ)(t)||(0,tt.iw)(t))return l._handleGIFOrPNG(t,i,e);const h=(0,tt.Gr)(t);try{let r;const p=l.resourceManager.getResource(h);if(null!=p&&p instanceof HTMLImageElement)r=p;else{const{data:mt}=yield l._imageRequestQueue.push(h,{...e});r=mt}if((0,C.zd)(h))if("width"in t&&"height"in t){const{width:mt,height:wt}=c(t.width,t.height);r.width=mt,r.height=wt}else if("cim"in t){const mt=t.cim,{width:wt,height:xt}=c(mt.width??mt.scaleX*mt.size,mt.size);r.width=wt,r.height=xt}if(!r.width||!r.height)return null;let W=r.width,U=r.height;"esriPMS"===t.type&&(W=Math.round(a(r.width,(0,tt.Ub)(t))),U=Math.round(r.height*(W/r.width)));const st="cim"in t?t.cim.colorSubstitutions:void 0,{size:ct,sdf:nt,image:_t}=l._rasterizer.rasterizeImageResource(W,U,r,st);return l._addItemToMosaic(i,ct,{type:"static",data:_t},(0,tt.js)(t),nt,!1)}catch(r){if(!(0,s.D_)(r))return new A.Z("mapview-invalid-resource",`Could not fetch requested resource at ${h}. ${r.message}`)}})()}_addItemToMosaic(t,i,e,l,h,r,p){return this._spriteMosaic.addSpriteItem(t,i,e,l,h,r,p)}}},34106:(rt,X,o)=>{o.d(X,{SI:()=>K,hY:()=>f});var I=o(54024),m=o(27422),D=o(57932),g=o(7547),A=o(3959);function s(v,E){const{width:B,height:N,getFrame:R}=v,z=v.frameDurations.slice(),H=z.pop();return z.push((0,m.HA)(H+E)),{frameCount:v.frameCount,duration:v.duration+E,frameDurations:z,getFrame:R,width:B,height:N}}class b{constructor(E,B,N,R){this._animation=E,this._repeatType=N,this._onFrameData=R,this._direction=1,this._currentFrame=0,this.timeToFrame=this._animation.frameDurations[this._currentFrame];let z=0;for(;B>z;)z+=this.timeToFrame,this.nextFrame();const H=this._animation.getFrame(this._currentFrame);this._onFrameData(H)}nextFrame(){if(this._currentFrame+=this._direction,this._direction>0){if(this._currentFrame===this._animation.frameDurations.length)switch(this._repeatType){case g.of.None:this._currentFrame-=this._direction;break;case g.of.Loop:this._currentFrame=0;break;case g.of.Oscillate:this._currentFrame-=this._direction,this._direction=-1}}else if(-1===this._currentFrame)switch(this._repeatType){case g.of.None:this._currentFrame-=this._direction;break;case g.of.Loop:this._currentFrame=this._animation.frameDurations.length-1;break;case g.of.Oscillate:this._currentFrame-=this._direction,this._direction=1}this.timeToFrame=this._animation.frameDurations[this._currentFrame];const E=this._animation.getFrame(this._currentFrame);this._onFrameData(E)}}function f(v,E,B,N){const R=null==E.playAnimation||E.playAnimation,z=function C(v,E,B,N){let R,{repeatType:z}=E;if(null==z&&(z=g.of.Loop),!0===E.reverseAnimation&&(v=function y(v){const{width:E,height:B}=v,N=v.frameDurations.reverse();return{frameCount:v.frameCount,duration:v.duration,frameDurations:N,getFrame:z=>v.getFrame(v.frameDurations.length-1-z),width:E,height:B}}(v)),null!=E.duration&&(v=function L(v,E){const{width:B,height:N,getFrame:R}=v,z=E/v.duration,H=v.frameDurations.map(J=>(0,m.HA)(J*z));return{frameCount:v.frameCount,duration:v.duration,frameDurations:H,getFrame:R,width:B,height:N}}(v,(0,m.HA)(1e3*E.duration))),null!=E.repeatDelay){const H=1e3*E.repeatDelay;z===g.of.Loop?v=s(v,(0,m.HA)(H)):z===g.of.Oscillate&&(v=function T(v,E){const{width:B,height:N,getFrame:R}=v,z=v.frameDurations.slice(),H=z.shift();return z.unshift((0,m.HA)(H+E)),{frameCount:v.frameCount,duration:v.duration+E,frameDurations:z,getFrame:R,width:B,height:N}}(s(v,(0,m.HA)(H/2)),(0,m.HA)(H/2)))}if(null!=E.startTimeOffset)R=(0,m.HA)(1e3*E.startTimeOffset);else if(null!=E.randomizeStartTime){const H=(0,A.$)(B),ot=(0,A.f)(H,null!=E.randomizeStartSeed?E.randomizeStartSeed:82749913);R=(0,m.HA)(ot*function x(v){return(0,m.HA)(v.frameDurations.reduce((E,B)=>E+B,0))}(v))}else R=(0,m.HA)(0);return new b(v,R,z,N)}(v,E,B,N);let H,J=z.timeToFrame;return function Q(){H=R?setTimeout(()=>{z.nextFrame(),J=z.timeToFrame,Q()},J):void 0}(),(0,I.kB)(()=>R&&clearTimeout(H))}let S,V;function K(v,E,B){const{canvas:N,ctx:R}=function M(){return S??=document.createElement("canvas"),V??=S.getContext("2d"),{canvas:S,ctx:V}}();N.width=E,N.height=B;const z=[],H=v.frameDurations.length;for(let J=0;J<H;J++){const Q=v.getFrame(J);R.clearRect(0,0,E,B),Q instanceof ImageData?R.drawImage((0,D.E0)(Q),0,0,E,B):R.drawImage(Q,0,0,E,B),z.push(R.getImageData(0,0,E,B))}return{width:E,height:B,frameDurations:v.frameDurations,getFrame:J=>z[J],frameCount:v.frameCount,duration:v.duration}}},23282:(rt,X,o)=>{o.d(X,{k:()=>S});var I=o(26584),m=o(63290),D=o(62208),g=o(39406),A=o(50392),x=o(37977);const L=V=>`#define ${(V=>V.replace("-","_").toUpperCase())(V)}\n`;function T(V){return{attributes:new Map([["a_pos",0],["a_tex",1]]),shaders:{vertexShader:L(V)+(0,x.w)("blend/blend.vert"),fragmentShader:L(V)+(0,x.w)("blend/blend.frag")}}}var s=o(67969),b=o(18952),C=o(31548);const f=m.Z.getLogger("esri.views.2d.engine.webgl.effects.blendEffects.BlendEffect");class S{constructor(){this._size=[0,0]}dispose(M){this._backBufferTexture=(0,D.M2)(this._backBufferTexture),this._quad=(0,D.M2)(this._quad)}draw(M,K,v,E,B){const{context:N,drawPhase:R}=M;if(this._setupShader(N),E&&"normal"!==E&&R!==g.jx.LABEL)return void this._drawBlended(M,K,v,E,B);const z=T("normal"),H=N.programCache.acquire(z.shaders.vertexShader,z.shaders.fragmentShader,z.attributes);if(!H)return void f.error(new I.Z("mapview-BlendEffect",'Error creating shader program for blend mode "normal"'));N.useProgram(H),K.setSamplingMode(v),N.bindTexture(K,0),H.setUniform1i("u_layerTexture",0),H.setUniform1f("u_opacity",B),N.setBlendingEnabled(!0),N.setBlendFunction(s.zi.ONE,s.zi.ONE_MINUS_SRC_ALPHA);const J=this._quad;J.draw(),J.unbind(),H.dispose()}_drawBlended(M,K,v,E,B){const{context:N,state:R,pixelRatio:z,inFadeTransition:H}=M,{size:J}=R,Q=N.getBoundFramebufferObject();let ot,P;null!=Q?(ot=Q.width,P=Q.height):(ot=Math.round(z*J[0]),P=Math.round(z*J[1])),this._createOrResizeTexture(M,ot,P);const j=this._backBufferTexture;Q.copyToTexture(0,0,ot,P,0,0,j),N.setStencilTestEnabled(!1),N.setStencilWriteMask(0),N.setBlendingEnabled(!0),N.setDepthTestEnabled(!1),N.setDepthWriteEnabled(!1);const k=T(E),Z=N.programCache.acquire(k.shaders.vertexShader,k.shaders.fragmentShader,k.attributes);if(!Z)return void f.error(new I.Z("mapview-BlendEffect",`Error creating shader program for blend mode ${E}`));N.useProgram(Z),j.setSamplingMode(v),N.bindTexture(j,0),Z.setUniform1i("u_backbufferTexture",0),K.setSamplingMode(v),N.bindTexture(K,1),Z.setUniform1i("u_layerTexture",1),Z.setUniform1f("u_opacity",B),Z.setUniform1f("u_inFadeOpacity",H?1:0),N.setBlendFunction(s.zi.ONE,s.zi.ZERO);const Y=this._quad;Y.draw(),Y.unbind(),Z.dispose(),N.setBlendFunction(s.zi.ONE,s.zi.ONE_MINUS_SRC_ALPHA)}_setupShader(M){this._quad||(this._quad=new A.Z(M,[-1,-1,1,-1,-1,1,1,1]))}_createOrResizeTexture(M,K,v){const{context:E}=M;if(null===this._backBufferTexture||K!==this._size[0]||v!==this._size[1]){if(this._backBufferTexture)this._backBufferTexture.resize(K,v);else{const B=new C.X;B.internalFormat=s.VI.RGBA,B.wrapMode=s.e8.CLAMP_TO_EDGE,B.width=K,B.height=v,this._backBufferTexture=new b.x(E,B)}this._size[0]=K,this._size[1]=v}}}},35903:(rt,X,o)=>{o.d(X,{Q:()=>m});var I=o(37977);const m={shaders:{vertexShader:(0,I.w)("bitBlit/bitBlit.vert"),fragmentShader:(0,I.w)("bitBlit/bitBlit.frag")},attributes:new Map([["a_pos",0],["a_tex",1]])}},8017:(rt,X,o)=>{o.d(X,{C:()=>m,y:()=>D});var I=o(37977);const m={shaders:{vertexShader:(0,I.w)("highlight/textured.vert"),fragmentShader:(0,I.w)("highlight/highlight.frag")},attributes:new Map([["a_position",0],["a_texcoord",1]])},D={shaders:{vertexShader:(0,I.w)("highlight/textured.vert"),fragmentShader:(0,I.w)("highlight/blur.frag")},attributes:new Map([["a_position",0],["a_texcoord",1]])}},18142:(rt,X,o)=>{o.d(X,{F:()=>g,c:()=>D});var I=o(37977),m=o(94299);const D={shaders:{vertexShader:(0,I.w)("magnifier/magnifier.vert"),fragmentShader:(0,I.w)("magnifier/magnifier.frag")},attributes:new Map([["a_pos",0]])};function g(A){return(0,m.H)(A,D)}},60233:(rt,X,o)=>{o.d(X,{H:()=>m});var I=o(37977);const m={shaders:{vertexShader:(0,I.w)("stencil/stencil.vert"),fragmentShader:(0,I.w)("stencil/stencil.frag")},attributes:new Map([["a_pos",0]])}},29289:(rt,X,o)=>{o.d(X,{Z:()=>Mt});var I=o(15861),m=o(17626),D=o(85807),g=o(83761),A=o(62208),x=o(77712),s=(o(90912),o(85931),o(8314),o(76898)),b=o(72642),C=o(24926),f=o(23841),S=o(61477);const V="esri-zoom-box",M={container:`${V}__container`,overlay:`${V}__overlay`,background:`${V}__overlay-background`,box:`${V}__outline`};let v=class extends g.Z{constructor(d){super(d),this._container=null,this._overlay=null,this._backgroundShape=null,this._boxShape=null,this._box={x:0,y:0,width:0,height:0},this._rafId=null,this._redraw=this._redraw.bind(this)}destroy(){this.view=null}set view(d){this.removeAllHandles(),this._destroyOverlay(),this._set("view",d),d&&this.addHandles([d.on("drag",["Shift"],a=>this._handleDrag(a,1),S.f.INTERNAL),d.on("drag",["Shift","Ctrl"],a=>this._handleDrag(a,-1),S.f.INTERNAL)])}_start(){this._createContainer(),this._createOverlay(),this.navigation.begin()}_update(d,a,c,w){this._box.x=d,this._box.y=a,this._box.width=c,this._box.height=w,this._rafId||(this._rafId=requestAnimationFrame(this._redraw))}_end(d,a,c,w,O){const et=this.view,F=et.toMap((0,f.vW)(d+.5*c,a+.5*w));let t=Math.max(c/et.width,w/et.height);-1===O&&(t=1/t),this._destroyOverlay(),this.navigation.end(),et.goTo({center:F,scale:et.scale*t})}_updateBox(d,a,c,w){const O=this._boxShape;O.setAttributeNS(null,"x",""+d),O.setAttributeNS(null,"y",""+a),O.setAttributeNS(null,"width",""+c),O.setAttributeNS(null,"height",""+w),O.setAttributeNS(null,"class",M.box)}_updateBackground(d,a,c,w){this._backgroundShape.setAttributeNS(null,"d",this._toSVGPath(d,a,c,w,this.view.width,this.view.height))}_createContainer(){const d=document.createElement("div");d.className=M.container,this.view.root.appendChild(d),this._container=d}_createOverlay(){const d=this.view.width,a=this.view.height,c=document.createElementNS("http://www.w3.org/2000/svg","path");c.setAttributeNS(null,"d","M 0 0 L "+d+" 0 L "+d+" "+a+" L 0 "+a+" Z"),c.setAttributeNS(null,"class",M.background);const w=document.createElementNS("http://www.w3.org/2000/svg","rect"),O=document.createElementNS("http://www.w3.org/2000/svg","svg");O.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),O.setAttributeNS(null,"class",M.overlay),O.appendChild(c),O.appendChild(w),this._container.appendChild(O),this._backgroundShape=c,this._boxShape=w,this._overlay=O}_destroyOverlay(){this._container&&this._container.parentNode&&this._container.parentNode.removeChild(this._container),this._container=this._backgroundShape=this._boxShape=this._overlay=null}_toSVGPath(d,a,c,w,O,et){const F=d+c,t=a+w;return"M 0 0 L "+O+" 0 L "+O+" "+et+" L 0 "+et+" ZM "+d+" "+a+" L "+d+" "+t+" L "+F+" "+t+" L "+F+" "+a+" Z"}_handleDrag(d,a){const c=d.x,w=d.y,O=d.origin.x,et=d.origin.y;let F,t,i,e;switch(c>O?(F=O,i=c-O):(F=c,i=O-c),w>et?(t=et,e=w-et):(t=w,e=et-w),d.action){case"start":this._start();break;case"update":this._update(F,t,i,e);break;case"end":this._end(F,t,i,e,a)}d.stopPropagation()}_redraw(){if(!this._rafId||(this._rafId=null,!this._overlay))return;const{x:d,y:a,width:c,height:w}=this._box;this._updateBox(d,a,c,w),this._updateBackground(d,a,c,w),this._rafId=requestAnimationFrame(this._redraw)}};(0,m._)([(0,x.Cb)()],v.prototype,"navigation",void 0),(0,m._)([(0,x.Cb)()],v.prototype,"view",null),v=(0,m._)([(0,s.j)("esri.views.2d.navigation.ZoomBox")],v);const E=v;o(29132);var N=o(32917),R=o(84161),z=o(28093);class H{constructor(a){this._gain=a,this.lastValue=void 0,this.filteredDelta=void 0}update(a){if(this.hasLastValue()){const c=this.computeDelta(a);this._updateDelta(c)}this.lastValue=a}reset(){this.lastValue=void 0,this.filteredDelta=void 0}hasLastValue(){return void 0!==this.lastValue}hasFilteredDelta(){return void 0!==this.filteredDelta}computeDelta(a){return void 0===this.lastValue?NaN:a-this.lastValue}_updateDelta(a){this.filteredDelta=void 0!==this.filteredDelta?(1-this._gain)*this.filteredDelta+this._gain*a:a}}class J{constructor(a,c,w){this._initialVelocity=a,this._stopVelocity=c,this._friction=w,this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/this._stopVelocity)/Math.log(1-this._friction))}get duration(){return this._duration}isFinished(a){return a>this.duration}get friction(){return this._friction}value(a){return this.valueFromInitialVelocity(this._initialVelocity,a)}valueDelta(a,c){const w=this.value(a);return this.value(a+c)-w}valueFromInitialVelocity(a,c){c=Math.min(c,this.duration);const w=1-this.friction;return a*(w**c-1)/Math.log(w)}}class Q extends J{constructor(a,c,w,O,et){super(a,c,w),this._sceneVelocity=O,this.direction=et}value(a){return super.valueFromInitialVelocity(this._sceneVelocity,a)}}class ot{constructor(a=300,c=12,w=.84){this._minimumInitialVelocity=a,this._stopVelocity=c,this._friction=w,this.enabled=!0,this._time=new H(.6),this._screen=[new H(.4),new H(.4)],this._scene=[new H(.6),new H(.6),new H(.6)],this._tmpDirection=(0,z.c)()}add(a,c,w){if(this.enabled){if(this._time.hasLastValue()&&this._time.computeDelta(w)<.015)return;this._screen[0].update(a[0]),this._screen[1].update(a[1]),this._scene[0].update(c[0]),this._scene[1].update(c[1]),this._scene[2].update(c[2]),this._time.update(w)}}reset(){this._screen[0].reset(),this._screen[1].reset(),this._scene[0].reset(),this._scene[1].reset(),this._scene[2].reset(),this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta()||!this._time.hasFilteredDelta())return null;const a=this._screen[0].filteredDelta,c=this._screen[1].filteredDelta,w=null==a||null==c?0:Math.sqrt(a*a+c*c),O=this._time.filteredDelta,et=null==O||null==w?0:w/O;return Math.abs(et)<this._minimumInitialVelocity?null:this.createMomentum(et,this._stopVelocity,this._friction)}createMomentum(a,c,w){(0,R.s)(this._tmpDirection,this._scene[0].filteredDelta??0,this._scene[1].filteredDelta??0,this._scene[2].filteredDelta??0);const O=(0,R.l)(this._tmpDirection);O>0&&(0,R.i)(this._tmpDirection,this._tmpDirection,1/O);const et=this._time.filteredDelta;return new Q(a,c,w,null==et?0:O/et,this._tmpDirection)}}let P=class extends g.Z{constructor(d){super(d),this.animationTime=0,this.momentumEstimator=new ot(500,6,.92),this.momentum=null,this.tmpMomentum=(0,z.c)(),this.momentumFinished=!1,this.viewpoint=new D.Z({targetGeometry:new b.Z,scale:0,rotation:0}),this._previousDrag=null,(0,N.gx)(()=>this.momentumFinished,()=>this.navigation.stop())}begin(d,a){this.navigation.begin(),this.momentumEstimator.reset(),this.addToEstimator(a),this._previousDrag=a}update(d,a){this.addToEstimator(a);let c=a.center.x,w=a.center.y;const O=this._previousDrag;c=O?O.center.x-c:-c,w=O?w-O.center.y:w,d.viewpoint=(0,C.Rx)(this.viewpoint,d.viewpoint,[c||0,w||0]),this._previousDrag=a}end(d,a){this.addToEstimator(a),this.momentum=d.navigation.momentumEnabled?this.momentumEstimator.evaluateMomentum():null,this.animationTime=0,this.momentum&&this.onAnimationUpdate(d),this._previousDrag=null,this.navigation.end()}addToEstimator(d){const a=d.center.x,c=d.center.y,w=(0,f.s1)(-a,c),O=(0,z.f)(-a,c,0);this.momentumEstimator.add(w,O,.001*d.timestamp)}onAnimationUpdate(d){this.navigation.animationManager?.animateContinous(d.viewpoint,(a,c)=>{const{momentum:w,animationTime:O,tmpMomentum:et}=this,F=.001*c;if(!(this.momentumFinished=!w||w.isFinished(O))){const t=w.valueDelta(O,F);(0,R.i)(et,w.direction,t),(0,C.Rx)(a,a,et),d.constraints.constrainByGeometry(a)}this.animationTime+=F})}stopMomentumNavigation(){this.momentum&&(this.momentumEstimator.reset(),this.momentum=null,this.navigation.stop())}};(0,m._)([(0,x.Cb)()],P.prototype,"momentumFinished",void 0),(0,m._)([(0,x.Cb)()],P.prototype,"viewpoint",void 0),(0,m._)([(0,x.Cb)()],P.prototype,"navigation",void 0),P=(0,m._)([(0,s.j)("esri.views.2d.navigation.actions.Pan")],P);const j=P;var k=o(67831),Z=o(99770),Y=o(21286);class ${constructor(a=2.5,c=.01,w=.95,O=12){this._minimumInitialVelocity=a,this._stopVelocity=c,this._friction=w,this._maxVelocity=O,this.enabled=!0,this.value=new H(.8),this.time=new H(.3)}add(a,c){if(this.enabled&&null!=c){if(this.time.hasLastValue()){if(this.time.computeDelta(c)<.01)return;if(this.value.hasFilteredDelta()){const w=this.value.computeDelta(a);this.value.filteredDelta*w<0&&this.value.reset()}}this.time.update(c),this.value.update(a)}}reset(){this.value.reset(),this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.value.hasFilteredDelta()||!this.time.hasFilteredDelta())return null;let a=this.value.filteredDelta/this.time.filteredDelta;return a=(0,Y.uZ)(a,-this._maxVelocity,this._maxVelocity),Math.abs(a)<this._minimumInitialVelocity?null:this.createMomentum(a,this._stopVelocity,this._friction)}createMomentum(a,c,w){return new J(a,c,w)}}class q extends ${constructor(a=3,c=.01,w=.95,O=12){super(a,c,w,O)}add(a,c){const w=this.value.lastValue;if(null!=w){let O=a-w;for(;O>Math.PI;)O-=2*Math.PI;for(;O<-Math.PI;)O+=2*Math.PI;a=w+O}super.add(a,c)}}class it extends J{constructor(a,c,w){super(a,c,w)}value(a){const c=super.value(a);return Math.exp(c)}valueDelta(a,c){const w=super.value(a),O=super.value(a+c)-w;return Math.exp(O)}}class pt extends ${constructor(a=2.5,c=.01,w=.95,O=12){super(a,c,w,O)}add(a,c){super.add(Math.log(a),c)}createMomentum(a,c,w){return new it(a,c,w)}}let at=class extends g.Z{constructor(d){super(d),this._animationTime=0,this._momentumFinished=!1,this._previousAngle=0,this._previousRadius=0,this._previousCenter=null,this._rotationMomentumEstimator=new q(.6,.15,.95),this._rotationDirection=1,this._startAngle=0,this._startRadius=0,this._updateTimestamp=null,this._zoomDirection=1,this._zoomMomentumEstimator=new pt,this._zoomOnly=null,this.zoomMomentum=null,this.rotateMomentum=null,this.viewpoint=new D.Z({targetGeometry:new b.Z,scale:0,rotation:0}),this.addHandles((0,N.gx)(()=>this._momentumFinished,()=>this.navigation.stop()))}begin(d,a){this.navigation.begin(),this._rotationMomentumEstimator.reset(),this._zoomMomentumEstimator.reset(),this._zoomOnly=null,this._previousAngle=this._startAngle=a.angle,this._previousRadius=this._startRadius=a.radius,this._previousCenter=a.center,this._updateTimestamp=null,d.constraints.rotationEnabled&&this.addToRotateEstimator(0,a.timestamp),this.addToZoomEstimator(a,1)}update(d,a){null===this._updateTimestamp&&(this._updateTimestamp=a.timestamp);const c=a.angle,w=a.radius,O=a.center,et=Math.abs(180*(c-this._startAngle)/Math.PI),F=Math.abs(w-this._startRadius),t=this._startRadius/w;if(this._previousRadius&&this._previousCenter){const i=w/this._previousRadius;let e=180*(c-this._previousAngle)/Math.PI;this._rotationDirection=e>=0?1:-1,this._zoomDirection=i>=1?1:-1,d.constraints.rotationEnabled?(null===this._zoomOnly&&a.timestamp-this._updateTimestamp>200&&(this._zoomOnly=F-et>0),null===this._zoomOnly||this._zoomOnly?e=0:this.addToRotateEstimator(c-this._startAngle,a.timestamp)):e=0,this.addToZoomEstimator(a,t),this.navigation.setViewpoint([O.x,O.y],1/i,e,[this._previousCenter.x-O.x,O.y-this._previousCenter.y])}this._previousAngle=c,this._previousRadius=w,this._previousCenter=O}end(d){this.rotateMomentum=this._rotationMomentumEstimator.evaluateMomentum(),this.zoomMomentum=this._zoomMomentumEstimator.evaluateMomentum(),this._animationTime=0,(this.rotateMomentum||this.zoomMomentum)&&this.onAnimationUpdate(d),this.navigation.end()}addToRotateEstimator(d,a){this._rotationMomentumEstimator.add(d,.001*a)}addToZoomEstimator(d,a){this._zoomMomentumEstimator.add(a,.001*d.timestamp)}canZoomIn(d){const c=d.constraints.effectiveMaxScale;return 0===c||d.scale>c}canZoomOut(d){const c=d.constraints.effectiveMinScale;return 0===c||d.scale<c}onAnimationUpdate(d){this.navigation.animationManager?.animateContinous(d.viewpoint,(a,c)=>{const w=!this.canZoomIn(d)&&this._zoomDirection>1||!this.canZoomOut(d)&&this._zoomDirection<1,O=!this.rotateMomentum||this.rotateMomentum.isFinished(this._animationTime),et=w||!this.zoomMomentum||this.zoomMomentum.isFinished(this._animationTime),F=.001*c;if(this._momentumFinished=O&&et,!this._momentumFinished){const t=this.rotateMomentum?Math.abs(this.rotateMomentum.valueDelta(this._animationTime,F))*this._rotationDirection*180/Math.PI:0;let i=this.zoomMomentum?Math.abs(this.zoomMomentum.valueDelta(this._animationTime,F)):1;const e=(0,Z.a)(),l=(0,Z.a)();if(this._previousCenter){(0,k.s)(e,this._previousCenter.x,this._previousCenter.y),(0,C.Dq)(l,d.size,d.padding),(0,k.i)(e,e,l);const{constraints:h,scale:r}=d,p=r*i;i<1&&!h.canZoomInTo(p)?(i=r/h.effectiveMaxScale,this.zoomMomentum=null,this.rotateMomentum=null):i>1&&!h.canZoomOutTo(p)&&(i=r/h.effectiveMinScale,this.zoomMomentum=null,this.rotateMomentum=null),(0,C.UZ)(a,d.viewpoint,i,t,e,d.size),d.constraints.constrainByGeometry(a)}}this._animationTime+=F})}stopMomentumNavigation(){(this.rotateMomentum||this.zoomMomentum)&&(this.rotateMomentum&&(this._rotationMomentumEstimator.reset(),this.rotateMomentum=null),this.zoomMomentum&&(this._zoomMomentumEstimator.reset(),this.zoomMomentum=null),this.navigation.stop())}};(0,m._)([(0,x.Cb)()],at.prototype,"_momentumFinished",void 0),(0,m._)([(0,x.Cb)()],at.prototype,"viewpoint",void 0),(0,m._)([(0,x.Cb)()],at.prototype,"navigation",void 0),at=(0,m._)([(0,s.j)("esri.views.2d.navigation.actions.Pinch")],at);const ft=at,lt=(0,Z.a)(),gt=(0,Z.a)();let tt=class extends g.Z{constructor(d){super(d),this._previousCenter=(0,Z.a)(),this.viewpoint=new D.Z({targetGeometry:new b.Z,scale:0,rotation:0})}begin(d,a){this.navigation.begin(),(0,k.s)(this._previousCenter,a.center.x,a.center.y)}update(d,a){const{state:{size:c,padding:w}}=d;(0,k.s)(lt,a.center.x,a.center.y),(0,C.ni)(gt,c,w),d.viewpoint=(0,C.$H)(this.viewpoint,d.state.paddedViewState.viewpoint,(0,C.dI)(gt,this._previousCenter,lt)),(0,k.j)(this._previousCenter,lt)}end(){this.navigation.end()}};(0,m._)([(0,x.Cb)()],tt.prototype,"viewpoint",void 0),(0,m._)([(0,x.Cb)()],tt.prototype,"navigation",void 0),tt=(0,m._)([(0,s.j)("esri.views.2d.actions.Rotate")],tt);const yt=tt,_=10,ht=new D.Z({targetGeometry:new b.Z}),ut=[0,0];let dt=class extends g.Z{constructor(d){super(d),this._endTimer=null,this._lastEventTimestamp=null,this.animationManager=null,this.interacting=!1}initialize(){this.pan=new j({navigation:this}),this.rotate=new yt({navigation:this}),this.pinch=new ft({navigation:this}),this.zoomBox=new E({view:this.view,navigation:this})}destroy(){this.pan=(0,A.SC)(this.pan),this.rotate=(0,A.SC)(this.rotate),this.pinch=(0,A.SC)(this.pinch),this.zoomBox=(0,A.SC)(this.zoomBox),this.animationManager=null}begin(){this._set("interacting",!0)}end(){this._lastEventTimestamp=performance.now(),this._startTimer(250)}zoom(d,a=this._getDefaultAnchor()){var c=this;return(0,I.Z)(function*(){if(c.stop(),c.begin(),c.view.constraints.snapToZoom&&c.view.constraints.effectiveLODs)return d<1?c.zoomIn(a):c.zoomOut(a);c.setViewpoint(a,d,0,[0,0])})()}zoomIn(d){var a=this;return(0,I.Z)(function*(){const c=a.view,w=c.constraints.snapToNextScale(c.scale);return a._zoomToScale(w,d)})()}zoomOut(d){var a=this;return(0,I.Z)(function*(){const c=a.view,w=c.constraints.snapToPreviousScale(c.scale);return a._zoomToScale(w,d)})()}setViewpoint(d,a,c,w){this.begin(),this.view.stateManager.state.viewpoint=this._scaleRotateTranslateViewpoint(this.view.viewpoint,d,a,c,w),this.end()}setViewpointImmediate(d,a=0,c=[0,0],w=this._getDefaultAnchor()){this.view.stateManager.state.viewpoint=this._scaleRotateTranslateViewpoint(this.view.viewpoint,w,d,a,c)}continousRotateClockwise(){this.animationManager?.animateContinous(this.view.viewpoint,a=>{(0,C.$H)(a,a,-1)})}continousRotateCounterclockwise(){this.animationManager?.animateContinous(this.view.viewpoint,a=>{(0,C.$H)(a,a,1)})}resetRotation(){this.view.constraints.rotationEnabled&&(this.view.rotation=0)}continousPanLeft(){this._continuousPan([-_,0])}continousPanRight(){this._continuousPan([_,0])}continousPanUp(){this._continuousPan([0,_])}continousPanDown(){this._continuousPan([0,-_])}continuousPanVector({x:d,y:a}){this._continuousPan([d*_,a*_])}stop(){this.pan.stopMomentumNavigation(),this.animationManager?.stop(),this.end(),null!==this._endTimer&&(clearTimeout(this._endTimer),this._endTimer=null,this._set("interacting",!1))}_continuousPan(d){this.animationManager?.animateContinous(this.view.viewpoint,c=>{(0,C.Rx)(c,c,d),this.view.constraints.constrainByGeometry(c)})}_startTimer(d){return null!==this._endTimer||(this._endTimer=setTimeout(()=>{this._endTimer=null;const a=performance.now()-(this._lastEventTimestamp??0);a<250?this._endTimer=this._startTimer(a):this._set("interacting",!1)},d)),this._endTimer}_getDefaultAnchor(){const{size:d,padding:{left:a,right:c,top:w,bottom:O}}=this.view;return ut[0]=.5*(d[0]-c+a),ut[1]=.5*(d[1]-O+w),ut}_zoomToScale(d,a=this._getDefaultAnchor()){var c=this;return(0,I.Z)(function*(){const{view:w}=c,{constraints:O,scale:et,viewpoint:F,size:t,padding:i}=w,e=O.canZoomInTo(d),l=O.canZoomOutTo(d);if(!(d<et&&!e||d>et&&!l))return(0,C.gG)(ht,F,d/et,0,a,t,i),O.constrainByGeometry(ht),w.goTo(ht,{animate:!0,pickClosestTarget:!1})})()}_scaleRotateTranslateViewpoint(d,a,c,w,O){const{view:et}=this,{size:F,padding:t,constraints:i,scale:e,viewpoint:l}=et,h=e*c,r=i.canZoomInTo(h),p=i.canZoomOutTo(h);return(c<1&&!r||c>1&&!p)&&(c=1),(0,C.Rx)(l,l,O),(0,C.gG)(d,l,c,w,a,F,t),i.constrainByGeometry(d)}};(0,m._)([(0,x.Cb)()],dt.prototype,"animationManager",void 0),(0,m._)([(0,x.Cb)({type:Boolean,readOnly:!0})],dt.prototype,"interacting",void 0),(0,m._)([(0,x.Cb)()],dt.prototype,"pan",void 0),(0,m._)([(0,x.Cb)()],dt.prototype,"pinch",void 0),(0,m._)([(0,x.Cb)()],dt.prototype,"rotate",void 0),(0,m._)([(0,x.Cb)()],dt.prototype,"view",void 0),(0,m._)([(0,x.Cb)()],dt.prototype,"zoomBox",void 0),dt=(0,m._)([(0,s.j)("esri.views.2d.navigation.MapViewNavigation")],dt);const Mt=dt},17625:(rt,X,o)=>{o.d(X,{H:()=>D,K:()=>m});const m=class I{};function D(g,...A){let x="";for(let y=0;y<A.length;y++)x+=g[y]+A[y];return x+=g[g.length-1],x}var g;(g=D||(D={})).int=function A(y){return Math.round(y).toString()},g.float=function x(y){return y.toPrecision(8)}},88569:(rt,X,o)=>{o.d(X,{Bh:()=>C,IB:()=>x,j7:()=>y,je:()=>b,ve:()=>T,wu:()=>g});var I=o(44835),m=o(67969),D=o(2078);const g=(0,D.wK)(m.zi.SRC_ALPHA,m.zi.ONE,m.zi.ONE_MINUS_SRC_ALPHA,m.zi.ONE_MINUS_SRC_ALPHA),A=(0,D.if)(m.zi.ONE,m.zi.ONE),x=(0,D.if)(m.zi.ZERO,m.zi.ONE_MINUS_SRC_ALPHA);function y(f){return f===I.A.FrontFace?null:f===I.A.Alpha?x:A}const T=5e5,s={factor:-1,units:-2};function b(f){return f?s:null}function C(f,S=m.wb.LESS){return f===I.A.NONE||f===I.A.FrontFace?S:m.wb.LEQUAL}},44835:(rt,X,o)=>{var I,m;o.d(X,{A:()=>I}),(m=I||(I={}))[m.Color=0]="Color",m[m.Alpha=1]="Alpha",m[m.FrontFace=2]="FrontFace",m[m.NONE=3]="NONE",m[m.COUNT=4]="COUNT"},42743:(rt,X,o)=>{var I,m,D,g,A,x,y,L,T,s;o.d(X,{Gv:()=>m,Iq:()=>L,JJ:()=>y,Rw:()=>g,Ti:()=>T,V_:()=>x,Vr:()=>I,hU:()=>A}),(s=I||(I={}))[s.None=0]="None",s[s.Front=1]="Front",s[s.Back=2]="Back",s[s.COUNT=3]="COUNT",function(s){s[s.Less=0]="Less",s[s.Lequal=1]="Lequal",s[s.COUNT=2]="COUNT"}(m||(m={})),function(s){s[s.BACKGROUND=0]="BACKGROUND",s[s.UPDATE=1]="UPDATE"}(D||(D={})),function(s){s[s.NOT_LOADED=0]="NOT_LOADED",s[s.LOADING=1]="LOADING",s[s.LOADED=2]="LOADED"}(g||(g={})),function(s){s[s.IntegratedMeshMaskExcluded=1]="IntegratedMeshMaskExcluded",s[s.OutlineVisualElementMask=2]="OutlineVisualElementMask"}(A||(A={})),function(s){s[s.Highlight=0]="Highlight",s[s.MaskOccludee=1]="MaskOccludee",s[s.COUNT=2]="COUNT"}(x||(x={})),function(s){s[s.Blend=0]="Blend",s[s.Opaque=1]="Opaque",s[s.Mask=2]="Mask",s[s.MaskBlend=3]="MaskBlend",s[s.COUNT=4]="COUNT"}(y||(y={})),function(s){s[s.OFF=0]="OFF",s[s.ON=1]="ON"}(L||(L={})),function(s){s.DDS_ENCODING="image/vnd-ms.dds",s.KTX2_ENCODING="image/ktx2",s.BASIS_ENCODING="image/x.basis"}(T||(T={}))},69839:(rt,X,o)=>{o.d(X,{G:()=>m});var I=o(62208);class m{constructor(){this._result=!1}dispose(){this._program=(0,I.M2)(this._program)}get result(){return null!=this._program&&(this._result=this._test(this._program),this.dispose()),this._result}}},46593:(rt,X,o)=>{o.d(X,{mO:()=>g});var I=o(38210);class m{constructor(x,y,L,T,s,b,C,f,S){this.createQuery=x,this.deleteQuery=y,this.resultAvailable=L,this.getResult=T,this.disjoint=s,this.beginTimeElapsed=b,this.endTimeElapsed=C,this.createTimestamp=f,this.timestampBits=S}}let D=!1;function g(A,x){if(x.disjointTimerQuery)return null;let y=A.getExtension("EXT_disjoint_timer_query_webgl2");return y&&(0,I.Z)(A)?new m(()=>A.createQuery(),L=>{A.deleteQuery(L),D=!1},L=>A.getQueryParameter(L,A.QUERY_RESULT_AVAILABLE),L=>A.getQueryParameter(L,A.QUERY_RESULT),()=>A.getParameter(y.GPU_DISJOINT_EXT),L=>{D||(D=!0,A.beginQuery(y.TIME_ELAPSED_EXT,L))},()=>{A.endQuery(y.TIME_ELAPSED_EXT),D=!1},L=>y.queryCounterEXT(L,y.TIMESTAMP_EXT),()=>A.getQuery(y.TIMESTAMP_EXT,y.QUERY_COUNTER_BITS_EXT)):(y=A.getExtension("EXT_disjoint_timer_query"),y?new m(()=>y.createQueryEXT(),L=>{y.deleteQueryEXT(L),D=!1},L=>y.getQueryObjectEXT(L,y.QUERY_RESULT_AVAILABLE_EXT),L=>y.getQueryObjectEXT(L,y.QUERY_RESULT_EXT),()=>A.getParameter(y.GPU_DISJOINT_EXT),L=>{D||(D=!0,y.beginQueryEXT(y.TIME_ELAPSED_EXT,L))},()=>{y.endQueryEXT(y.TIME_ELAPSED_EXT),D=!1},L=>y.queryCounterEXT(L,y.TIMESTAMP_EXT),()=>y.getQueryEXT(y.TIMESTAMP_EXT,y.QUERY_COUNTER_BITS_EXT)):null)}},2078:(rt,X,o)=>{o.d(X,{BK:()=>T,LZ:()=>L,if:()=>D,jp:()=>yt,sm:()=>E,wK:()=>g,zp:()=>y});var I=o(42743),m=o(67969);function D(_,G,ht=m.db.ADD,ut=[0,0,0,0]){return{srcRgb:_,srcAlpha:_,dstRgb:G,dstAlpha:G,opRgb:ht,opAlpha:ht,color:{r:ut[0],g:ut[1],b:ut[2],a:ut[3]}}}function g(_,G,ht,ut,vt=m.db.ADD,dt=m.db.ADD,Mt=[0,0,0,0]){return{srcRgb:_,srcAlpha:G,dstRgb:ht,dstAlpha:ut,opRgb:vt,opAlpha:dt,color:{r:Mt[0],g:Mt[1],b:Mt[2],a:Mt[3]}}}const A={face:m.LR.BACK,mode:m.Wf.CCW},x={face:m.LR.FRONT,mode:m.Wf.CCW},y=_=>_===I.Vr.Back?A:_===I.Vr.Front?x:null,L={zNear:0,zFar:1},T={r:!0,g:!0,b:!0,a:!0};function s(_){return R.intern(_)}function b(_){return H.intern(_)}function C(_){return Q.intern(_)}function f(_){return P.intern(_)}function S(_){return k.intern(_)}function V(_){return Y.intern(_)}function M(_){return q.intern(_)}function K(_){return pt.intern(_)}function v(_){return ft.intern(_)}function E(_){return gt.intern(_)}class B{constructor(G,ht){this._makeKey=G,this._makeRef=ht,this._interns=new Map}intern(G){if(!G)return null;const ht=this._makeKey(G),ut=this._interns;return ut.has(ht)||ut.set(ht,this._makeRef(G)),ut.get(ht)??null}}function N(_){return"["+_.join(",")+"]"}const R=new B(z,_=>({__tag:"Blending",..._}));function z(_){return _?N([_.srcRgb,_.srcAlpha,_.dstRgb,_.dstAlpha,_.opRgb,_.opAlpha,_.color.r,_.color.g,_.color.b,_.color.a]):null}const H=new B(J,_=>({__tag:"Culling",..._}));function J(_){return _?N([_.face,_.mode]):null}const Q=new B(ot,_=>({__tag:"PolygonOffset",..._}));function ot(_){return _?N([_.factor,_.units]):null}const P=new B(j,_=>({__tag:"DepthTest",..._}));function j(_){return _?N([_.func]):null}const k=new B(Z,_=>({__tag:"StencilTest",..._}));function Z(_){return _?N([_.function.func,_.function.ref,_.function.mask,_.operation.fail,_.operation.zFail,_.operation.zPass]):null}const Y=new B($,_=>({__tag:"DepthWrite",..._}));function $(_){return _?N([_.zNear,_.zFar]):null}const q=new B(it,_=>({__tag:"ColorWrite",..._}));function it(_){return _?N([_.r,_.g,_.b,_.a]):null}const pt=new B(at,_=>({__tag:"StencilWrite",..._}));function at(_){return _?N([_.mask]):null}const ft=new B(lt,_=>({__tag:"DrawBuffers",..._}));function lt(_){return _?N(_.buffers):null}const gt=new B(function tt(_){return _?N([z(_.blending),J(_.culling),ot(_.polygonOffset),j(_.depthTest),Z(_.stencilTest),$(_.depthWrite),it(_.colorWrite),at(_.stencilWrite),lt(_.drawBuffers)]):null},_=>({blending:s(_.blending),culling:b(_.culling),polygonOffset:C(_.polygonOffset),depthTest:f(_.depthTest),stencilTest:S(_.stencilTest),depthWrite:V(_.depthWrite),colorWrite:M(_.colorWrite),stencilWrite:K(_.stencilWrite),drawBuffers:v(_.drawBuffers)}));class yt{constructor(G){this._pipelineInvalid=!0,this._blendingInvalid=!0,this._cullingInvalid=!0,this._polygonOffsetInvalid=!0,this._depthTestInvalid=!0,this._stencilTestInvalid=!0,this._depthWriteInvalid=!0,this._colorWriteInvalid=!0,this._stencilWriteInvalid=!0,this._drawBuffersInvalid=!0,this._stateSetters=G}setPipeline(G){(this._pipelineInvalid||G!==this._pipeline)&&(this._setBlending(G.blending),this._setCulling(G.culling),this._setPolygonOffset(G.polygonOffset),this._setDepthTest(G.depthTest),this._setStencilTest(G.stencilTest),this._setDepthWrite(G.depthWrite),this._setColorWrite(G.colorWrite),this._setStencilWrite(G.stencilWrite),this._setDrawBuffers(G.drawBuffers),this._pipeline=G),this._pipelineInvalid=!1}invalidateBlending(){this._blendingInvalid=!0,this._pipelineInvalid=!0}invalidateCulling(){this._cullingInvalid=!0,this._pipelineInvalid=!0}invalidatePolygonOffset(){this._polygonOffsetInvalid=!0,this._pipelineInvalid=!0}invalidateDepthTest(){this._depthTestInvalid=!0,this._pipelineInvalid=!0}invalidateStencilTest(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDepthWrite(){this._depthWriteInvalid=!0,this._pipelineInvalid=!0}invalidateColorWrite(){this._colorWriteInvalid=!0,this._pipelineInvalid=!0}invalidateStencilWrite(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDrawBuffers(){this._drawBuffersInvalid=!0,this._pipelineInvalid=!0}_setBlending(G){this._blending=this._setSubState(G,this._blending,this._blendingInvalid,this._stateSetters.setBlending),this._blendingInvalid=!1}_setCulling(G){this._culling=this._setSubState(G,this._culling,this._cullingInvalid,this._stateSetters.setCulling),this._cullingInvalid=!1}_setPolygonOffset(G){this._polygonOffset=this._setSubState(G,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset),this._polygonOffsetInvalid=!1}_setDepthTest(G){this._depthTest=this._setSubState(G,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest),this._depthTestInvalid=!1}_setStencilTest(G){this._stencilTest=this._setSubState(G,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest),this._stencilTestInvalid=!1}_setDepthWrite(G){this._depthWrite=this._setSubState(G,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite),this._depthWriteInvalid=!1}_setColorWrite(G){this._colorWrite=this._setSubState(G,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite),this._colorWriteInvalid=!1}_setStencilWrite(G){this._stencilWrite=this._setSubState(G,this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite),this._stencilTestInvalid=!1}_setDrawBuffers(G){this._drawBuffers=this._setSubState(G,this._drawBuffers,this._drawBuffersInvalid,this._stateSetters.setDrawBuffers),this._drawBuffersInvalid=!1}_setSubState(G,ht,ut,vt){return(ut||G!==ht)&&(vt(G),this._pipelineInvalid=!0),G}}},7160:(rt,X,o)=>{o.d(X,{d:()=>T});var I=o(93292),m=o(83994),D=o(67969),g=o(85775),A=o(18952),x=o(31548),y=o(49353),L=o(69839);class T extends L.G{constructor(C){super(),this._rctx=C,this._program=C.programCache.acquire("\n    precision highp float;\n\n    attribute vec2 a_pos;\n    varying vec2 v_uv;\n\n    void main() {\n      v_uv = a_pos;\n      gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n    }\n    ","\n    precision highp float;\n\n    varying vec2 v_uv;\n\n    uniform sampler2D u_texture;\n\n    void main() {\n      gl_FragColor = texture2D(u_texture, v_uv);\n    }\n    ",new Map([["a_pos",0]]))}dispose(){super.dispose()}_test(C){const f=this._rctx;if(!f.gl)return C.dispose(),!0;const S=new x.X(1);S.wrapMode=D.e8.CLAMP_TO_EDGE,S.samplingMode=D.cw.NEAREST;const V=new g.X(f,S),M=m.f.createVertex(f,D.l1.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),K=new y.U(f,new Map([["a_pos",0]]),I.cD,{geometry:M}),v=new x.X;v.samplingMode=D.cw.LINEAR,v.wrapMode=D.e8.CLAMP_TO_EDGE;const E=new A.x(f,v,s);f.useProgram(C),f.bindTexture(E,0),C.setUniform1i("u_texture",0);const B=f.getBoundFramebufferObject(),{x:N,y:R,width:z,height:H}=f.getViewport();f.bindFramebuffer(V),f.setViewport(0,0,1,1),f.setClearColor(0,0,0,0),f.setBlendingEnabled(!1),f.clearSafe(D.lk.COLOR_BUFFER_BIT),f.bindVAO(K),f.drawArrays(D.MX.TRIANGLE_STRIP,0,4);const J=new Uint8Array(4);return V.readPixels(0,0,1,1,D.VI.RGBA,D.Br.UNSIGNED_BYTE,J),K.dispose(),V.dispose(),E.dispose(),f.setViewport(N,R,z,H),f.bindFramebuffer(B),255!==J[0]}}const s=new Image;s.src="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='5' height='5' version='1.1' viewBox='0 0 5 5' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='5' height='5' fill='%23f00' fill-opacity='.5'/%3E%3C/svg%3E%0A",s.width=5,s.height=5,s.decode()}}]);