"use strict";(self.webpackChunkCRIS=self.webpackChunkCRIS||[]).push([[392,3250],{80991:(ne,Z,x)=>{function k(h){return"function"==typeof h}function A(h,B,W,U){return k(h)?h(B,W,U):h}function z(h){return[h.r,h.g,h.b,h.a]}x.d(Z,{$Z:()=>q,BX:()=>X,Cc:()=>i,E_:()=>u,F:()=>$,FG:()=>te,H1:()=>y,JW:()=>ce,NA:()=>R,NO:()=>j,On:()=>w,QI:()=>b,Qf:()=>de,Qs:()=>p,RI:()=>g,TB:()=>ie,TT:()=>P,W7:()=>G,X_:()=>ee,be:()=>E,cO:()=>D,gJ:()=>M,hf:()=>A,nn:()=>z,pJ:()=>v,wO:()=>k,wi:()=>V,yL:()=>L,zL:()=>O});const S=" /-,\n";function _(h){let B=h.length;for(;B--;)if(!S.includes(h.charAt(B)))return!1;return!0}function y(h,B){const W=[];let U=0,H=-1;do{if(H=h.indexOf("[",U),H>=U){if(H>U){const se=h.substr(U,H-U);W.push([se,null,_(se)])}if(U=H+1,H=h.indexOf("]",U),H>=U){if(H>U){const se=B[h.substr(U,H-U)];se&&W.push([null,se,!1])}U=H+1}}}while(-1!==H);if(U<h.length-1){const se=h.substr(U);W.push([se,null,_(se)])}return W}function u(h,B,W){let U="",H=null;for(const se of B){const[me,re,Q]=se;if(me)Q?H=me:(H&&(U+=H,H=null),U+=me);else{const Re=h.attributes[re];Re&&(H&&(U+=H,H=null),U+=Re)}}return b(U,W)}function p(h,B,W){const U=y(B,h);return H=>u(H,U,W)}function b(h,B){switch("string"!=typeof h&&(h=String(h)),B){case"LowerCase":return h.toLowerCase();case"Allcaps":return h.toUpperCase();default:return h}}function P(h,B,W,U,H,se,me=!0){const re=B/H,Q=W/se,Re=Math.ceil(re/2),be=Math.ceil(Q/2);for(let fe=0;fe<se;fe++)for(let _e=0;_e<H;_e++){const Ee=4*(_e+(me?se-fe-1:fe)*H);let ae=0,ge=0,Me=0,ve=0,Ce=0,Le=0,we=0;const oe=(fe+.5)*Q;for(let le=Math.floor(fe*Q);le<(fe+1)*Q;le++){const Fe=Math.abs(oe-(le+.5))/be,Oe=(_e+.5)*re,Ve=Fe*Fe;for(let Te=Math.floor(_e*re);Te<(_e+1)*re;Te++){let he=Math.abs(Oe-(Te+.5))/Re;const pe=Math.sqrt(Ve+he*he);pe>=-1&&pe<=1&&(ae=2*pe*pe*pe-3*pe*pe+1,ae>0&&(he=4*(Te+le*B),we+=ae*h[he+3],Me+=ae,h[he+3]<255&&(ae=ae*h[he+3]/250),ve+=ae*h[he],Ce+=ae*h[he+1],Le+=ae*h[he+2],ge+=ae))}}U[Ee]=ve/ge,U[Ee+1]=Ce/ge,U[Ee+2]=Le/ge,U[Ee+3]=we/Me}}function j(h){return h?{r:h[0],g:h[1],b:h[2],a:h[3]/255}:{r:0,g:0,b:0,a:0}}function E(h){return h.data?.symbol??null}function O(h){return"CIMVectorMarker"===h.type||"CIMPictureMarker"===h.type||"CIMBarChartMarker"===h.type||"CIMCharacterMarker"===h.type||"CIMPieChartMarker"===h.type||"CIMStackedBarChartMarker"===h.type}function L(h){return"CIMGradientStroke"===h.type||"CIMPictureStroke"===h.type||"CIMSolidStroke"===h.type}function M(h){return null!=h&&("CIMMarkerPlacementAlongLineRandomSize"===h.type||"CIMMarkerPlacementAlongLineSameSize"===h.type||"CIMMarkerPlacementAlongLineVariableSize"===h.type||"CIMMarkerPlacementAtExtremities"===h.type||"CIMMarkerPlacementAtMeasuredUnits"===h.type||"CIMMarkerPlacementAtRatioPositions"===h.type||"CIMMarkerPlacementOnLine"===h.type||"CIMMarkerPlacementOnVertices"===h.type)}const R=(h,B=0)=>null==h||isNaN(h)?B:h,D=h=>h.tintColor?j(h.tintColor):{r:255,g:255,b:255,a:1},i=h=>{if(!h)return!1;for(const B of h)switch(B.type){case"CIMGeometricEffectBuffer":case"CIMGeometricEffectOffset":case"CIMGeometricEffectDonut":return!0}return!1};function g(){return Promise.all([x.e(4918),x.e(8592),x.e(5994)]).then(x.bind(x,32825))}function v(h){if(!h)return"normal";switch(h.toLowerCase()){case"italic":return"italic";case"oblique":return"oblique";default:return"normal"}}function w(h){if(!h)return"normal";switch(h.toLowerCase()){case"bold":return"bold";case"bolder":return"bolder";case"lighter":return"lighter";default:return"normal"}}function V(h){let B="normal",W="normal";if(h){const U=h.toLowerCase();U.includes("italic")?B="italic":U.includes("oblique")&&(B="oblique"),U.includes("bold")?W="bold":U.includes("light")&&(W="lighter")}return{style:B,weight:W}}function X(h){return h.underline?"underline":h.strikethrough?"line-through":"none"}function G(h){if(!h)return null;switch(h.type){case"CIMPolygonSymbol":if(h.symbolLayers)for(const B of h.symbolLayers){const W=G(B);if(null!=W)return W}break;case"CIMTextSymbol":return G(h.symbol);case"CIMSolidFill":return h.color}}function q(h){if(h)switch(h.type){case"CIMPolygonSymbol":case"CIMLineSymbol":{const B=h.symbolLayers;if(B)for(const W of B){const U=q(W);if(null!=U)return U}break}case"CIMTextSymbol":return q(h.symbol);case"CIMSolidStroke":return h.color}}function $(h){if(h)switch(h.type){case"CIMPolygonSymbol":case"CIMLineSymbol":if(h.symbolLayers)for(const B of h.symbolLayers){const W=$(B);if(void 0!==W)return W}break;case"CIMTextSymbol":return $(h.symbol);case"CIMSolidStroke":case"CIMGradientStroke":case"CIMPictureStroke":return h.width}}function ee(h){switch(h){case"Left":default:return"left";case"Right":return"right";case"Center":case"Justify":return"center"}}function te(h){switch(h){case"Top":default:return"top";case"Center":return"middle";case"Baseline":return"baseline";case"Bottom":return"bottom"}}function de(h){return(h?Object.keys(h):[]).map(B=>({name:B,alias:B,type:"string"==typeof h[B]?"esriFieldTypeString":"esriFieldTypeDouble"}))}const ie=h=>h.includes("data:image/svg+xml");function ce(h){if(!h)return null;switch(h.type){case"CIMPointSymbol":case"CIMTextSymbol":return"esriGeometryPoint";case"CIMLineSymbol":return"esriGeometryPolyline";case"CIMPolygonSymbol":return"esriGeometryPolygon";default:return null}}},28082:(ne,Z,x)=>{x.d(Z,{H:()=>R});var k=x(15861),A=x(26584),z=x(8314),S=x(63290),_=x(10699),y=x(39351),u=x(99666),p=x(87526),b=x(31982),P=x(67969),j=x(85775),E=x(18952),O=x(31548);const L=S.Z.getLogger("esri.views.2d.engine.webgl.AttributeStoreView"),T=(0,b.g)(b.P,L);class M{constructor(i,g,v){this._texture=null,this._lastTexture=null,this._fbos={},this.texelSize=4;const{buffer:w,pixelType:V,textureOnly:X}=i,G=(0,p.UK)(V);this.shared=v,this.pixelType=V,this.size=g,this.textureOnly=X,X||(this.data=new G(w)),this._resetRange()}destroy(){this._texture?.dispose();for(const i in this._fbos){const g=this._fbos[i];g&&("0"===i&&g.detachColorTexture(),g.dispose()),this._fbos[i]=null}this._texture=null}get _textureDesc(){const i=new O.X;return i.wrapMode=P.e8.CLAMP_TO_EDGE,i.samplingMode=P.cw.NEAREST,i.dataType=this.pixelType,i.width=this.size,i.height=this.size,i}setData(i,g,v){const w=(0,u.jL)(i),V=this.data,X=w*this.texelSize+g;!V||X>=V.length||(V[X]=v,this.dirtyStart=Math.min(this.dirtyStart,w),this.dirtyEnd=Math.max(this.dirtyEnd,w))}getData(i,g){if(null==this.data)return null;const v=(0,u.jL)(i)*this.texelSize+g;return!this.data||v>=this.data.length?null:this.data[v]}getTexture(i){return this._texture??this._initTexture(i)}getFBO(i,g=0){if(!this._fbos[g]){const v=0===g?this.getTexture(i):this._textureDesc;this._fbos[g]=new j.X(i,v)}return this._fbos[g]}get locked(){return!(this.pixelType!==P.Br.UNSIGNED_BYTE||!this.shared||this.textureOnly||!(0,z.Z)("esri-atomics")||!this.data)&&1===Atomics.load(this.data,0)}get hasDirty(){return this.dirtyEnd>=this.dirtyStart}updateTexture(i,g){if(!this.locked){try{const v=this.dirtyStart,w=this.dirtyEnd;if(!this.hasDirty)return;this._resetRange();const V=this.data.buffer,X=this.getTexture(i),G=4,q=(v-v%this.size)/this.size,ee=q,de=(w-w%this.size)/this.size,ie=q*this.size*G,ce=(this.size+de*this.size)*G-ie,h=(0,p.UK)(this.pixelType),B=new h(V,ie*h.BYTES_PER_ELEMENT,ce),W=this.size,U=de-ee+1;if(U>this.size)return void L.error(new A.Z("mapview-webgl","Out-of-bounds index when updating AttributeData"));X.updateData(0,0,ee,W,U,B)}catch{}g()}}update(i){const{data:g,start:v,end:w}=i;if(null!=g&&null!=this.data){const V=this.data,X=v*this.texelSize;for(let G=0;G<g.length;G++)i.layout&1<<G%this.texelSize&&(V[X+G]=g[G])}this.dirtyStart=Math.min(this.dirtyStart,v),this.dirtyEnd=Math.max(this.dirtyEnd,w)}resize(i,g){const v=this.size;if(this.size=g,this.textureOnly)return void(v!==this.size&&(this._lastTexture=this._texture,this._texture=null));const w=(0,p.UK)(this.pixelType);this.destroy(),this.data=new w(i.buffer)}_resetRange(){this.dirtyStart=2147483647,this.dirtyEnd=0}_initTexture(i){const g=new E.x(i,this._textureDesc,this.data??void 0);if(null!=this._lastTexture&&this._fbos[0]){const v=this._lastTexture.descriptor.width,w=this._lastTexture.descriptor.height,V=this._lastTexture.descriptor.dataType,X=this._lastTexture.descriptor.pixelFormat,G=this.getFBO(i),q=(0,p.Yw)(V),$=new((0,p.UK)(V))(new ArrayBuffer(v*w*q*this.texelSize)),ee=i.getBoundFramebufferObject(),{x:te,y:de,width:ie,height:ce}=i.getViewport();i.bindFramebuffer(G),G.readPixels(0,0,v,w,X,V,$),g.updateData(0,0,0,2*v,w/2,$),i.setViewport(te,de,ie,ce),i.bindFramebuffer(ee)}return this.destroy(),this._texture=g,this._texture}}class R{constructor(i){this._onUpdate=i,this._initialized=!1,this._forceNextUpload=!1,this._locked=!1}initialize(i){const{blocks:g,shared:v,size:w}=i;if(this.shared=v,this.size=w,T("Initializing AttributeStoreView",i),null==this._data)this._data=g.map(V=>null!=V?new M(V,w,v):null);else for(let V=0;V<this._data.length;V++){const X=this._data[V],G=g[V];null!=G&&(null==X?this._data[V]=new M(G,w,v):X.resize(G,w))}this._initialized=!0}destroy(){for(const i of this._data??[])i?.destroy();this._defaultTexture?.dispose()}isEmpty(){return null==this._data}isUpdating(){const i=null!=this._pendingAttributeUpdate,g=i;return(0,z.Z)("esri-2d-log-updating")&&console.log(`Updating AttributeStoreView ${g}\n  -> hasPendingUpdate ${i}`),g}getBlock(i){return null==this._data?null:this._data[i]}setLabelMinZoom(i,g){this.setData(i,0,1,g)}getLabelMinZoom(i){return this.getData(i,0,1,255)}getFilterFlags(i){return this.getData(i,0,0,0)}getVVSize(i){return this.getData(i,y.mb,0,0)}getData(i,g,v,w){if(!this._data)return 0;const V=this._data[g];return null==V?0:V.getData(i,v)??w}setData(i,g,v,w){this._data[g].setData(i,v,w)}lockTextureUpload(){this._locked=!0}unlockTextureUpload(){this._locked=!1}forceTextureUpload(){this._forceNextUpload=!0}requestUpdate(i){var g=this;return(0,k.Z)(function*(){if(g._pendingAttributeUpdate)return void L.error(new A.Z("mapview-webgl","Tried to update attribute data with a pending update"));const v=(0,_.hh)();return T("AttributeStoreView Update Requested",i),g._pendingAttributeUpdate={data:i,resolver:v},g._onUpdate(),v.promise})()}update(){if(this._initialized&&null!=this._pendingAttributeUpdate){(0,z.Z)("esri-2d-update-debug")&&console.debug("AttributeStoreView::update");const{data:i,resolver:g}=this._pendingAttributeUpdate,v=this._data;for(let w=0;w<i.blocks.length;w++){const V=i.blocks[w],X=v[w];null!=X&&null!=V&&(T(`Updating block ${w}`,V),X.update(V))}this._pendingAttributeUpdate=null,g(),this._onUpdate()}}bindTextures(i,g=!0){const v=this._getDefaultTexture(i);if(!this._initialized)return i.bindTexture(v,y.XO),void(g&&(i.bindTexture(v,y.jS),i.bindTexture(v,y.tg),i.bindTexture(v,y.$y),i.bindTexture(v,y.Im),i.bindTexture(v,y.o2),i.bindTexture(v,y.pb)));const w=this._data;if(!this._locked||this._forceNextUpload){for(const V of w)V?.updateTexture(i,()=>this._onUpdate());this._forceNextUpload=!1}i.bindTexture(w[y.j9]?.getTexture(i)??v,y.XO),g&&(i.bindTexture(w[y.U8]?.getTexture(i)??v,y.pb),i.bindTexture(w[y.S]?.getTexture(i)??v,y.jS),i.bindTexture(w[y.mb]?.getTexture(i)??v,y.tg),i.bindTexture(w[y.Fn]?.getTexture(i)??v,y.$y),i.bindTexture(w[y.Im]?.getTexture(i)??v,y.Im),i.bindTexture(w[y.o2]?.getTexture(i)??v,y.o2))}_getDefaultTexture(i){if(null==this._defaultTexture){const g=new O.X;g.wrapMode=P.e8.CLAMP_TO_EDGE,g.samplingMode=P.cw.NEAREST,g.width=1,g.height=1,this._defaultTexture=new E.x(i,g,new Uint8Array(4))}return this._defaultTexture}}},99666:(ne,Z,x)=>{x.d(Z,{Ht:()=>k,KS:()=>b,QC:()=>y,QS:()=>j,jL:()=>p,mi:()=>_,nE:()=>P,vs:()=>u});const k=8388607,A=8388608,_=0,y=1,u=E=>(E&A)>>>23,p=E=>E&k,b=E=>u(E)===y?254:255;function P(E){return u(E)===y}function j(E,O){return((O?A:0)|E)>>>0}},50465:(ne,Z,x)=>{x.d(Z,{I:()=>A,S:()=>z});var k=x(31823);class A{constructor(_,y,u,p,b){this.target=_,this.geometryType=y,this.materialKey=u,this.indexFrom=p,this.indexCount=b}get indexEnd(){return this.indexFrom+this.indexCount}extend(_){this.indexCount+=_}}class z{constructor(_,y){this.geometryType=0,this._target=_,this.geometryType=y}static from(_,y,u,p){const b=new z(_,y);if(null!=p)for(const P of p)u.seekIndex(P),b.addRecord(u);else for(;u.next();)b.addRecord(u);return b}addRecord(_){const p=_.materialKey;let b=_.indexFrom,P=_.indexCount;if(P||(b=_.vertexFrom,P=_.vertexCount),null==this._head){const T=new A(this._target,this.geometryType,p,b,P);return void(this._head=new k.a(T))}let O=null,L=this._head;for(;L;){if(b<L.data.indexFrom)return this._insert(p,b,P,O,L);O=L,L=L.next}this._insert(p,b,P,O,null)}forEach(_){null!=this._head&&this._head.forEach(_)}*infos(){if(null!=this._head)for(const _ of this._head.values())yield _}_insert(_,y,u,p,b){if(null==p&&null==b){const P=new A(this._target,this.geometryType,_,y,u);this._head=new k.a(P)}return null==p&&null!=b?this._insertAtHead(_,y,u,b):null!=p&&null==b?this._insertAtEnd(_,y,u,p):null!=p&&null!=b?this._insertAtMiddle(_,y,u,p,b):void 0}_insertAtHead(_,y,u,p){if(_===p.data.materialKey&&y+u===p.data.indexFrom)p.data.indexFrom=y,p.data.indexCount+=u;else{const P=new A(this._target,this.geometryType,_,y,u);this._head=new k.a(P),this._head.next=p}}_insertAtEnd(_,y,u,p){if(p.data.materialKey===_&&p.data.indexEnd===y)p.data.indexCount+=u;else{const b=new A(this._target,this.geometryType,_,y,u),P=new k.a(b);p.next=P}}_insertAtMiddle(_,y,u,p,b){const P=y+u;if(p.data.materialKey===_&&p.data.indexEnd===y)p.data.indexCount+=u,p.data.materialKey===b.data.materialKey&&p.data.indexEnd===b.data.indexFrom&&(p.data.indexCount+=b.data.indexCount,p.next=b.next);else if(_===b.data.materialKey&&P===b.data.indexFrom)b.data.indexFrom=y,b.data.indexCount+=u;else{const j=new A(this._target,this.geometryType,_,y,u),E=new k.a(j);p.next=E,E.next=b}}}},43783:(ne,Z,x)=>{x.d(Z,{I:()=>S});var k=x(30217),A=x(57477),z=x(58098);class S extends A.s{constructor(y,u,p,b,P,j,E=P,O=j){super(),this.triangleCountReportedInDebug=0,this.triangleCount=0,this.texture=null,this.key=new z.Z(y),this.resolution=u,this.x=p,this.y=b,this.width=P,this.height=j,this.rangeX=E,this.rangeY=O}destroy(){this.texture&&(this.texture.dispose(),this.texture=null)}setTransform(y){const u=this.resolution/(y.resolution*y.pixelRatio),p=this.transforms.tileMat3,[b,P]=y.toScreenNoRotation([0,0],[this.x,this.y]);(0,k.s)(p,this.width/this.rangeX*u,0,0,0,this.height/this.rangeY*u,0,b,P,1),(0,k.m)(this.transforms.dvs,y.displayViewMat3,p)}}},29443:(ne,Z,x)=>{x.d(Z,{o:()=>p});var k=x(31478),A=x(12225),z=x(30217),S=x(49966),_=x(39351),y=x(43783);class p extends y.I{constructor(P,j,E,O){super(P,j,E,O,_.i9,_.i9)}destroy(){super.destroy(),this._transforms&&p.TransformCache.release(this.key.hash)}setTransform(P){const j=this.resolution/P.resolution,E=this.transforms.tileMat3,[O,L]=P.toScreenNoRotation([0,0],[this.x,this.y]),T=this.width/this.rangeX*j,M=this.height/this.rangeY*j;(0,z.s)(E,T,0,0,0,M,0,O,L,1),(0,z.m)(this.transforms.dvs,P.displayViewMat3,E);const R=this.transforms.labelMat2d,D=window.devicePixelRatio,i=(0,k.d)((0,A.c)(),T*D,0,0,M*D,O*D,L*D);(0,k.m)(R,P.viewMat2d,i)}_createTransforms(){return p.TransformCache.acquire(this.key.hash)}}p.TransformCache=new class u{acquire(P){return{refCount:1,version:-1,labelMat2d:(0,A.c)(),tileMat3:(0,S.c)(),dvs:(0,S.c)()}}release(P){}}},37633:(ne,Z,x)=>{x.d(Z,{$:()=>S});var k=x(39351),A=x(50465);const z=2147483647;class S{constructor(u){this._head=u,this._cursor=u}static from(u,p=0,b=u.byteLength/_.BYTES_PER_RECORD-p){const P=new _(new Int32Array(u,p*_.BYTES_PER_RECORD,b*_.ELEMENTS_PER_RECORD));return new S(P)}size(){let u=this._cursor,p=0;for(;u;)p+=u.size(),u=u._link;return p}get id(){return this._cursor.id}set id(u){this._cursor.id=u}get materialKey(){return this._cursor.materialKey}set materialKey(u){this._cursor.materialKey=u}get insertAfter(){return this._cursor.insertAfter}get indexFrom(){return this._cursor.indexFrom}set indexFrom(u){this._cursor.indexFrom=u}get indexCount(){return this._cursor.indexCount}set indexCount(u){this._cursor.indexCount=u}get vertexFrom(){return this._cursor.vertexFrom}set vertexFrom(u){this._cursor.vertexFrom=u}get vertexCount(){return this._cursor.vertexCount}set vertexCount(u){this._cursor.vertexCount=u}get sortKey(){return this._cursor.sortKey}set sortKey(u){this._cursor.sortKey=u}get index(){return this._cursor._indexStart+this._cursor._index}seekIndex(u){let p=u;for(this._cursor=this._head;this._cursor;){const b=this._cursor.size();if(p<b)return this._cursor._index=p,!0;p-=b,this._cursor=this._cursor._link}return!1}forEach(u){const p=this.getCursor();for(;p.next();)u(p)}link(u){if(!this._head)return void(this._head=u._head);let p=this._head;for(;p._link;)p=p._link;p._link=u._head,p._link._indexStart=p._indexStart+p.size()}getCursor(){return this.copy()}getDrawInfo(u,p){return new A.I(u,p,this.materialKey,this.indexFrom,this.indexCount)}lookup(u){for(this._cursor=this._head;this._cursor&&!this._cursor.lookup(u);){if(!this._cursor._link)return!1;this._cursor=this._cursor._link}return!!this._cursor}copy(){const u=new S(this._head?.copy());if(!u._head)return u;let p=u._head,b=u._head._link;for(;b;)p._link=b.copy(),p=b,b=p._link;return u}next(){return!!this._cursor&&(!!this._cursor.next()||!!this._cursor._link&&(this._cursor=this._cursor._link,this.next()))}peekId(){return this._cursor.peekId()??this._cursor._link.peekId()}delete(u){let p=this._head,b=null;for(;p;){if(p.delete(u))return p.isEmpty()&&(null!=b&&(b._link=p._link),p===this._head&&(this._head=p._link),p===this._cursor&&(this._cursor=p._link)),!0;b=p,p=p._link}return!1}}S.ELEMENTS_PER_RECORD=k.T3,S.BYTES_PER_RECORD=S.ELEMENTS_PER_RECORD*Int32Array.BYTES_PER_ELEMENT;class _{constructor(u){this._link=null,this._index=-1,this._indexStart=0,this._packedRecordsF32=null,this._deletedCount=0,this._offsets={instance:null},this._packedRecords=u}static from(u,p=0,b=u.byteLength/this.BYTES_PER_RECORD-p){return new _(new Int32Array(u,p*this.BYTES_PER_RECORD,b*this.ELEMENTS_PER_RECORD))}delete(u){const p=this._index,b=this.lookup(u);if(b)for(this.id=z,++this._deletedCount;this.next()&&this.id===u;)this.id=z,++this._deletedCount;return this._index=p,b}isEmpty(){return this._deletedCount===this.size()}link(u){this._link?this._link.link(u):this._link=u}lookup(u){if(null==this._offsets.instance){this._offsets.instance=new Map;const b=this.copy();b._index=-1;let P=0;for(;b.next();)b.id!==P&&(this._offsets.instance.set(b.id,b._index),P=b.id)}if(!this._offsets.instance.has(u))return!1;const p=this._index;return this._index=this._offsets.instance.get(u),this.id!==z||(this._index=p,!1)}get id(){return this._packedRecords[this._index*_.ELEMENTS_PER_RECORD]}set id(u){this._packedRecords[this._index*_.ELEMENTS_PER_RECORD]=u}get materialKey(){return this._packedRecords[this._index*_.ELEMENTS_PER_RECORD+1]}set materialKey(u){this._packedRecords[this._index*_.ELEMENTS_PER_RECORD+1]=u}get insertAfter(){return this._packedRecords[this._index*_.ELEMENTS_PER_RECORD+2]}get indexFrom(){return this._packedRecords[this._index*_.ELEMENTS_PER_RECORD+3]}set indexFrom(u){this._packedRecords[this._index*_.ELEMENTS_PER_RECORD+3]=u}get indexCount(){return this._packedRecords[this._index*_.ELEMENTS_PER_RECORD+4]}set indexCount(u){this._packedRecords[this._index*_.ELEMENTS_PER_RECORD+4]=u}get vertexFrom(){return this._packedRecords[this._index*_.ELEMENTS_PER_RECORD+5]}set vertexFrom(u){this._packedRecords[this._index*_.ELEMENTS_PER_RECORD+5]=u}get vertexCount(){return this._packedRecords[this._index*_.ELEMENTS_PER_RECORD+6]}set vertexCount(u){this._packedRecords[this._index*_.ELEMENTS_PER_RECORD+6]=u}get sortKey(){return this._packedRecordsF32||(this._packedRecordsF32=new Float32Array(this._packedRecords.buffer)),this._packedRecordsF32[this._index*_.ELEMENTS_PER_RECORD+7]}set sortKey(u){this._packedRecordsF32||(this._packedRecordsF32=new Float32Array(this._packedRecords.buffer)),this._packedRecordsF32[this._index*_.ELEMENTS_PER_RECORD+7]=u}get index(){return this._index}size(){return this._packedRecords.length/_.ELEMENTS_PER_RECORD}next(){for(;++this._index<this.size()&&this.id===z;);return this._index<this.size()}peekId(){const u=(this._index+1)*_.ELEMENTS_PER_RECORD;return u>=this._packedRecords.length?0:this._packedRecords[u]}getCursor(){return this.copy()}copy(){const u=new _(this._packedRecords);return u._indexStart=this._indexStart,u._link=this._link,u._index=this._index,u._offsets=this._offsets,u._deletedCount=this._deletedCount,u}}_.ELEMENTS_PER_RECORD=k.T3,_.BYTES_PER_RECORD=_.ELEMENTS_PER_RECORD*Int32Array.BYTES_PER_ELEMENT},31823:(ne,Z,x)=>{x.d(Z,{a:()=>k,m:()=>A});class k{constructor(S){if(this.next=null,!Array.isArray(S))return void(this.data=S);this.data=S[0];let _=this;for(let y=1;y<S.length;y++)_.next=new k([S[y]]),_=_.next}*values(){let S=this;for(;S;)yield S.data,S=S.next}forEach(S){let _=this;for(;_;)S(_.data),_=_.next}find(S){return S(this.data)?this:this.next?.find(S)}max(S,_=this){const y=S(this.data)>S(_.data)?this:_;return this.next?this.next.max(S,y):y}remove(S,_=null){return this===S?_?(_.next=this.next,_):this.next:this.next?.remove(S,this)??null}get last(){return this.next?this.next.last:this}}class A{constructor(S){this._head=null,null!=S&&(this._head=new k(S))}get head(){return this._head}maxAvailableSpace(){if(null==this._head)return 0;const S=this._head.max(_=>_.end-_.start);return S.data.end-S.data.start}firstFit(S){if(null==this._head)return null;let _=null,y=this._head;for(;y;){const u=y.data.end-y.data.start;if(u===S)return _?_.next=y.next:this._head=y.next,y.data.start;if(u>S){const p=y.data.start;return y.data.start+=S,p}_=y,y=y.next}return null}free(S,_){const y=S+_;if(null==this._head){const P=new k({start:S,end:y});return void(this._head=P)}if(y<=this._head.data.start){if(y===this._head.data.start)return void(this._head.data.start-=_);const P=new k({start:S,end:y});return P.next=this._head,void(this._head=P)}let u=this._head,p=u.next;for(;p;){if(p.data.start>=y){if(u.data.end===S)return u.data.end+=_,u.data.end===p.data.start?(u.data.end+=p.data.end-p.data.start,void(u.next=p.next)):void 0;if(p.data.start===y)return void(p.data.start-=_);const P=new k({start:S,end:y});return P.next=u.next,void(u.next=P)}u=p,p=p.next}if(S===u.data.end)return void(u.data.end+=_);const b=new k({start:S,end:y});u.next=b}}},31982:(ne,Z,x)=>{x.d(Z,{P:()=>A,g:()=>k});const k=(z,S)=>z&&((..._)=>S.warn("DEBUG:",..._))||(()=>null),A=!1},25310:(ne,Z,x)=>{x.d(Z,{a:()=>_});var k=x(26584),A=x(63290),z=x(39406),S=x(87526);function _(y){return(0,S.hj)(y.minDataValue)&&(0,S.hj)(y.maxDataValue)&&null!=y.minSize&&null!=y.maxSize?z.X.SIZE_MINMAX_VALUE:(y.expression&&"view.scale"===y.expression||y.valueExpression&&"$view.scale"===y.valueExpression)&&Array.isArray(y.stops)?z.X.SIZE_SCALE_STOPS:(null!=y.field||y.expression&&"view.scale"!==y.expression||y.valueExpression&&"$view.scale"!==y.valueExpression)&&(Array.isArray(y.stops)||"levels"in y&&y.levels)?z.X.SIZE_FIELD_STOPS:(null!=y.field||y.expression&&"view.scale"!==y.expression||y.valueExpression&&"$view.scale"!==y.valueExpression)&&null!=y.valueUnit?z.X.SIZE_UNIT_VALUE:(A.Z.getLogger("esri.views.2d.engine.webgl").error(new k.Z("mapview-bad-type","Found invalid size VisualVariable",y)),z.X.NONE)}},3250:(ne,Z,x)=>{x.r(Z),x.d(Z,{createSymbolSchema:()=>y});var k=x(35909),A=x(39406),z=x(18716);function S(E){return"line-marker"===E.type?{type:"line-marker",color:E.color?.toJSON(),placement:E.placement,style:E.style}:E.constructor.fromJSON(E.toJSON()).toJSON()}function _(E){return(0,z.hF)(E)}function y(E,O,L=!1){if(!E)return null;switch(E.type){case"simple-fill":case"picture-fill":return function p(E,O,L){const T=(0,z.jj)(A.LW.FILL,O),M=L?_(T):T,R=E.clone(),D=R.outline,i=(0,z.jy)(O.symbologyType);i||(R.outline=null);const g={materialKey:M,hash:R.hash(),...S(R)};if(i)return g;const v=[];if(v.push(g),D){const w=(0,z.jj)(A.LW.LINE,{...O,isOutline:!0}),V={materialKey:L?_(w):w,hash:D.hash(),...S(D)};v.push(V)}return{type:"composite-symbol",layers:v,hash:v.reduce((w,V)=>V.hash+w,"")}}(E,O,L);case"simple-marker":case"picture-marker":return function P(E,O,L){if("simple-marker"===E.type&&("path"===E.style||E.outline&&"solid"!==E.outline.style&&"none"!==E.outline.style))return y({type:"CIMSymbolReference",symbol:k.B$.fromSimpleMarker(E)},O,L);const T=(0,z.jj)(A.LW.MARKER,O),M=L?_(T):T,R=S(E);return{materialKey:M,hash:E.hash(),...R,angle:E.angle,maxVVSize:O.maxVVSize}}(E,O,L);case"simple-line":return function b(E,O,L){const T=(0,z.jy)(O.symbologyType)?A.mD.DEFAULT:O.symbologyType,M=(0,z.jj)(A.LW.LINE,{...O,symbologyType:T}),R=L?_(M):M,D=E.clone(),i=D.marker;D.marker=null;const g=[];if(g.push({materialKey:R,hash:D.hash(),...S(D)}),i){const v=(0,z.jj)(A.LW.MARKER,O),w=L?_(v):v;i.color=i.color??D.color,g.push({materialKey:w,hash:i.hash(),lineWidth:D.width,...S(i)})}return{type:"composite-symbol",layers:g,hash:g.reduce((v,w)=>w.hash+v,"")}}(E,O,L);case"text":return function j(E,O,L){const T=(0,z.jj)(A.LW.TEXT,O),M=L?_(T):T,R=S(E);return{materialKey:M,hash:E.hash(),...R,angle:E.angle,maxVVSize:O.maxVVSize}}(E,O,L);case"label":return function u(E,O,L){const T=E.toJSON(),M=(0,z.jj)(A.LW.LABEL,{...O,placement:T.labelPlacement});return{materialKey:L?_(M):M,hash:E.hash(),...T,labelPlacement:T.labelPlacement}}(E,O,L);case"cim":return{type:"cim",rendererKey:O.vvFlags,data:E.data,maxVVSize:O.maxVVSize};case"CIMSymbolReference":return{type:"cim",rendererKey:O.vvFlags,data:E,maxVVSize:O.maxVVSize};case"web-style":return{...S(E),type:"web-style",hash:E.hash(),rendererKey:O.vvFlags,maxVVSize:O.maxVVSize};default:throw new Error(`symbol not supported ${E.type}`)}}},49391:(ne,Z,x)=>{x.d(Z,{MD:()=>Ae,Ew:()=>_e,q5:()=>be});var k=x(85931),A=x(26584),z=x(8314),S=x(63290),_=x(23841),y=x(95737),u=x(84682),p=x(62667),b=x(39406),P=x(87526),j=x(25575),E=x(25310);function O(r){if(!r)return b.X.NONE;let f=0;for(const d of r)if("size"===d.type){const c=(0,E.a)(d);f|=c,"outline"===d.target&&(f|=c<<4)}else"color"===d.type?f|=b.X.COLOR:"opacity"===d.type?f|=b.X.OPACITY:"rotation"===d.type&&(f|=b.X.ROTATION);return f}var L=x(3250),M=(x(35909),x(31375));x(39351);function U(r,f){return Math.max(r,f)}x(64596),x(51584),new M.Z(0,0,24,24);var H=x(22418),se=x(62192),me=x(43930);const re=S.Z.getLogger("esri.views.2d.layers.features.schemaUtils"),Q="ValidationError";function be(r,f){let d=0,c=0,C=b.mD.DEFAULT;if(null!=r){if(c=function w(r,f){if(!("visualVariables"in r)||!r.hasVisualVariables("size"))return 0;const d=r.getVisualVariablesForType("size");if(!d[0])return 0;const c=d[0];if(f&&"cluster_count"===c.field&&"cluster"===f.type)return f.clusterMaxSize;if("outline"===c.target)return 0;if("stops"===c.transformationType)return c.stops.map(C=>C.size).reduce(U,0);if("clamped-linear"===c.transformationType){let C=-1/0,I=-1/0;return C="number"==typeof c.maxSize?c.maxSize:c.maxSize.stops.map(F=>F.size).reduce(U,0),I="number"==typeof c.minSize?c.minSize:c.minSize.stops.map(F=>F.size).reduce(U,0),Math.max(C,I)}return"real-world-size"===c.transformationType?30:void 0}(r,f),"visualVariables"in r&&(d=O(r.visualVariables||[]),"dot-density"===r.type&&(C=b.mD.DOT_DENSITY)),"heatmap"===r.type&&(C=b.mD.HEATMAP),"dictionary"===r.type)return{maxVVSize:c,vvFlags:d,symbologyType:b.mD.DEFAULT};if("pie-chart"===r.type)return{maxVVSize:c,vvFlags:d,symbologyType:b.mD.PIE_CHART};if(C!==b.mD.DOT_DENSITY&&C!==b.mD.HEATMAP){const I=r.getSymbols();"backgroundFillSymbol"in r&&r.backgroundFillSymbol&&I.push(r.backgroundFillSymbol);let F=!0,N=!0;for(const K of I)if("cim"!==K.type&&"web-style"!==K.type||(N=!1),"simple-fill"===K.type||"picture-fill"===K.type){const J=K.outline,Y=J&&"none"!==J.style&&"solid"!==J.style;Y&&(F=!1),("picture-fill"===K.type||"simple-fill"===K.type&&"none"!==K.style&&"solid"!==K.style||Y)&&(N=!1)}F?C=N?b.mD.OUTLINE_FILL_SIMPLE:b.mD.OUTLINE_FILL:N&&(C=b.mD.SIMPLE)}}return{vvFlags:d,maxVVSize:c,symbologyType:C}}let fe=null;function _e(r){if((0,z.Z)("esri-2d-update-debug")){const f=Ee(r,!0);console.debug("Created new schema",f),console.debug("Schema diff",(0,u.Hg)(fe,f)),fe=f}return Ee(r)}function Ee(r,f=!1){try{const d=function Fe(r,f=!1){const d=new Array;return d.push(function Te(r,f,d=!1){const c={indexCount:0,fields:{}},C="featureReduction"in r?r.featureReduction??void 0:void 0,I=C?"aggregate":"feature";if("sublayers"in r){const xe={type:"subtype",subtypeField:r.subtypeField,renderers:{},symbologyType:b.mD.DEFAULT},ze={type:"subtype",mapping:{},target:"feature",subtypeField:r.subtypeField},Ue={type:"subtype",classes:{}},rt={type:"symbol",target:"feature",aggregateFields:[],attributes:c,storage:ze,mesh:{matcher:xe,aggregateMatcher:null,labels:Ue,sortKey:null}},Ne=new Set;let it=0;for(const{renderer:Se,subtypeCode:De,labelingInfo:at,labelsVisible:ot}of r.sublayers){let We=0;"visualVariables"in Se&&Se.visualVariables&&(Se.visualVariables.some(Pe=>"rotation"!==Pe.type)&&re.warnOnce("SubtypeGroupLayer currently only supports rotation visualVariables. All other visualVariable types will be ignored."),We=O(Se.visualVariables.filter(Pe=>"size"!==Pe.type)));const Ze={symbologyType:b.mD.DEFAULT,vvFlags:We,maxVVSize:0},Ie=Ae(c,I,Se,Ze,d),ke=Ke(c,I,Se),Ge=ot&&at;if("dictionary"===Ie.type)throw new A.Z(Q,"Dictionary renderer is not supported in subtype layers");if("subtype"===Ie.type)throw new A.Z(Q,"Nested subtype renderers is not supported");if(null!=ke&&"subtype"===ke.type)throw new A.Z(Q,"Nested subtype storage is not supported");if(null!=ke?.attributeMapping)throw new A.Z(Q,"Non-visual-variable attributes are not supported in subtype layers");if("heatmap"===Ie.type)throw new A.Z(Q,"Heatmaps are not supported in subtype layers");if("pie-chart"===Ie.type)throw new A.Z(Q,"Pie-charts are not supported in subtype layers");if(Ne.has(De))throw new A.Z(Q,"Subtype codes for sublayers must be unique");Ne.add(De),xe.renderers[De]=Ie,ze.mapping[De]=ke,Ge&&(Ue.classes[De]=Ge.map(Pe=>Oe(c,Pe,"feature",it++,Ze,d)))}return rt}if("heatmap"===r.renderer?.type&&"raster"===(0,H.rk)()){const{radius:xe,fieldOffset:ze,field:Ue}=r.renderer;return{type:"heatmap",aggregateFields:[],attributes:c,target:I,storage:null,mesh:{radius:xe,fieldOffset:ze,field:oe(c,{target:I,field:Ue,resultType:"numeric"}).field}}}const F=function Ve(r,f,d){const c="featureReduction"in f&&f.featureReduction;if(!c)return{fields:[],labels:[],matcher:void 0,rendererOverride:void 0};const I=[];let F=null,N=(0,me.oq)(f.geometryType),K=[],J=null;if(c)switch(c.type){case"selection":return re.error(new A.Z(Q,"Mapview does not support `selection` reduction type",c)),{fields:[],labels:[],matcher:void 0,rendererOverride:void 0};case"cluster":case"binning":if(I.push(...c.fields??[]),"cluster"===c.type?N="esriGeometryPoint":"binning"===c.type&&(N="esriGeometryPolygon"),c.renderer&&!c.renderer.authoringInfo?.isAutoGenerated){if("cluster"===c.type){const{renderer:ue}=(0,se.st)(c.renderer,c,null);J=ue}else J=c.renderer;const Y=be(c.renderer,c);F=Ae(r,"aggregate",c.renderer,Y,d),K=c&&c.labelsVisible&&c.labelingInfo||[]}else if("cluster"===c.type){if(J=(0,se.S1)(I,f.renderer,c,null,!0),c.symbol){const Y=be(J,c);F={type:"simple",symbol:(0,L.createSymbolSchema)(c.symbol,Y,d),symbologyType:Y.symbologyType}}K=c&&c.labelsVisible&&c.labelingInfo||[]}}return function He(r,f){const d={mesh:!0,storage:!0};for(const c of f){const{name:C,onStatisticField:I,onStatisticExpression:F,statisticType:N}=c;let K,J;const ue="feature";F?J=le(r,{type:"expression",target:ue,valueExpression:F.expression,resultType:"numeric"}).fieldIndex:K=le(r,{type:"field",target:ue,field:I}).field,le(r,{type:"statistic",target:"aggregate",name:C,context:d,inField:K,inFieldIndex:J,statisticType:N})}}(r,I),{labels:(0,p.a)(K,"binning"===c.type?"esriGeometryPolygon":N),matcher:F,fields:I,rendererOverride:J}}(c,r,d),N=(0,me.oq)(r.geometryType),K=F.rendererOverride??r.renderer,J=be(K,C),Y=Ae(c,I,K,J,d),ue=Ke(c,I,K),ye=function pe(r,f,d,c){if(null!=c)return null;if(null!=f&&f.length){f.length>1&&re.warn(`Layer rendering currently only supports ordering by 1 orderByInfo, but found ${f.length}. All but the first will be discarded`);const C=f[0],I="ascending"===C.order?"asc":"desc";return C.field?{field:C.field,order:I}:C.valueExpression?{fieldIndex:le(r,{type:"expression",target:"feature",valueExpression:C.valueExpression,resultType:"numeric"}).fieldIndex,order:I}:(re.error(new A.Z(Q,"Expected to find a field or valueExpression for OrderByInfo",C)),null)}return null!=d&&"unique-value"===d.type&&d.orderByClassesEnabled?{byRenderer:!0,order:"asc"}:null}(c,r.orderBy,r.renderer,C),st=(0,p.a)(r.labelsVisible&&r.labelingInfo||[],N);let je=0;const nt=[...st.map(xe=>Oe(c,xe,"feature",je++,J,d)),...F.labels.map(xe=>Oe(c,xe,"aggregate",je++,J,d))];return{type:"symbol",target:I,attributes:c,aggregateFields:F.fields,storage:ue,mesh:{matcher:Y,labels:{type:"simple",classes:nt},aggregateMatcher:F.matcher,sortKey:ye}}}(r)),d}(r,f),c=function he(r){return"heatmap"===r.renderer?.type&&"raster"===(0,H.rk)()?{type:"heatmap"}:{type:"symbol"}}(r),C={};return d.map(N=>function ae(r,f,d){switch(d.target){case"feature":return void ve(r,Me(f),d);case"aggregate":{if(!("featureReduction"in f))return;const c=f.featureReduction;switch(c?.type){case"selection":throw new A.Z(Q,"Mapview does not support `selection` reduction type",c);case"binning":return ve(r,Me(f),d),void function Le(r,f,d,c){r.aggregate||(r.aggregate={name:"aggregate",type:"bin",filters:null,input:"feature",params:{fixedBinLevel:f.fixedBinLevel,fields:(f.fields??[]).map(C=>({...C.toJSON(),type:Ce(C,d)}))},attributes:{}}),ge(r.aggregate,c.attributes.fields)}(r,c,f.fields.map(C=>C.toJSON()),d);case"cluster":return ve(r,Me(f),d),void function we(r,f,d,c){const C=c.aggregateFields??[],I=new Set;for(const F of C)I.add(F.name);for(const F of f?.fields??[])I.has(F.name)||C.push(F);r.aggregate||(r.aggregate={name:"aggregate",type:"cluster",input:"feature",filters:null,attributes:{},params:{clusterRadius:(0,_.F2)(f.clusterRadius/2),clusterPixelBuffer:64*Math.ceil((0,_.F2)(f.clusterMaxSize)/64),fields:C.map(F=>({...F.toJSON(),type:Ce(F,d)}))}}),ge(r.aggregate,c.attributes.fields)}(r,c,f.fields.map(C=>C.toJSON()),d)}}}}(C,r,N)),{source:{definitionExpression:(0,y._)(r.definitionExpression,null!=r.subtypeCode?`${r.subtypeField} = ${r.subtypeCode}`:null),fields:r.fields.map(N=>N.toJSON()),gdbVersion:r.gdbVersion,historicMoment:r.historicMoment?.getTime(),outFields:r.availableFields,pixelBuffer:r.pixelBuffer,spatialReference:r.spatialReference.toJSON(),timeExtent:r.timeExtent?.toJSON(),customParameters:r.customParameters},attributes:{fields:{},indexCount:0},processors:d,tileRenderer:c,targets:C}}catch(d){if(d.fieldName===Q)return re.error(d),null;throw d}}function ge(r,f){for(const d in f){const c=f[d];if(c.target!==r.name)continue;const C=r.attributes[d];if(C?.context){const I=C.context;I.mesh=I.mesh||c.context?.mesh,I.storage=I.storage||c.context?.storage}else r.attributes[d]=c}return r}function Me(r){return[r.filter?.toJSON()??null,r.featureEffect?.filter?.toJSON()??null]}function ve(r,f,d){return r.feature||(r.feature={name:"feature",input:"source",filters:f,attributes:{}}),ge(r.feature,d.attributes.fields),r}function Ce(r,f){const{onStatisticExpression:d,onStatisticField:c,statisticType:C}=r;switch(C){case"min":case"max":case"avg":case"avg_angle":case"sum":case"count":return"esriFieldTypeDouble";case"mode":{if(d){const{returnType:F}=d;return F?"string"===F?"esriFieldTypeString":"esriFieldTypeDouble":(re.error(new A.Z(Q,"Unable to infer type of aggregateField with onStatisticExpression. ReturnType is not defined",r)),"esriFieldTypeString")}const I=f.find(F=>F.name===c);return I?I.type:(re.error(new A.Z(Q,"Unable to infer type of aggregateField with onStatisticExpression. ReturnType is not defined",r)),"esriFieldTypeString")}}}function oe(r,f){return f.field?le(r,{...f,type:"field",field:f.field}):f.valueExpression?le(r,{...f,type:"expression",valueExpression:f.valueExpression}):{field:void 0,fieldIndex:void 0}}function le(r,f){switch(f.type){case"expression":{const d=f.valueExpression;if(!r.fields[d]){const c=r.indexCount++;r.fields[d]={...f,name:d,fieldIndex:c}}return{fieldIndex:r.fields[d].fieldIndex}}case"label-expression":{const d=JSON.stringify(f.label);if(!r.fields[d]){const c=r.indexCount++;r.fields[d]={...f,name:d,fieldIndex:c}}return{fieldIndex:r.fields[d].fieldIndex}}case"field":{const d=f.field;return"aggregate"===f.target&&r.fields[d]||(r.fields[d]={...f,name:d}),{field:d}}case"statistic":return r.fields[f.name]={...f},{field:f.name}}}function Oe(r,f,d,c,C,I=!1){const F=le(r,{type:"label-expression",target:d,context:{mesh:!0},resultType:"string",label:{labelExpression:f.labelExpression,labelExpressionInfo:f.labelExpressionInfo?{expression:f.labelExpressionInfo.expression}:null,symbol:!!f.symbol,where:f.where}}),{fieldIndex:N}=F;return{...(0,L.createSymbolSchema)(f,C,I),fieldIndex:N,target:d,index:c}}function Ke(r,f,d){let c;switch(d.type){case"simple":case"class-breaks":case"unique-value":case"dictionary":c={visualVariables:!0,attributes:null};break;default:c=(0,j.EJ)(d).getStorageSpec(d)}return function Xe(r,f,d,c){if(null==d)return null;const{visualVariables:C,attributes:I}=d;let F=null;C&&"visualVariables"in c&&(F=function Je(r,f,d){if(!d?.length)return[];const c={storage:!0},C="numeric";return(0,H.tv)(d).map(I=>{const F=(0,P.nU)(I.type),{field:N,fieldIndex:K}=oe(r,{target:f,valueExpression:I.valueExpression,field:I.field,context:c,resultType:C});switch(I.type){case"size":return"$view.scale"===I.valueExpression?null:{type:"size",binding:F,field:N,fieldIndex:K,normalizationField:oe(r,{target:f,field:I.normalizationField,context:c,resultType:C}).field,valueRepresentation:I.valueRepresentation??null};case"color":return{type:"color",binding:F,field:N,fieldIndex:K,normalizationField:oe(r,{target:f,field:I.normalizationField,context:c,resultType:C}).field};case"opacity":return{type:"opacity",binding:F,field:N,fieldIndex:K,normalizationField:oe(r,{target:f,field:I.normalizationField,context:c,resultType:C}).field};case"rotation":return{type:"rotation",binding:F,field:N,fieldIndex:K}}}).filter(k.pC)}(r,f,c.visualVariables));const N=null!=F?4:0;let K=null;return null!=I&&(K=I.map((J,Y)=>{const{field:ue,fieldIndex:ye}=oe(r,{valueExpression:J.valueExpression,field:J.field,resultType:"numeric",target:f});return{binding:Y+N,field:ue,fieldIndex:ye}})),{type:"simple",target:f,attributeMapping:K,vvMapping:F}}(r,f,c,d)}function Ae(r,f,d,c,C=!1){const I=r??{indexCount:0,fields:{}};switch(d.type){case"simple":case"dot-density":return function $e(r,f,d,c=!1){const C=f.getSymbols();return{type:"simple",symbol:(0,L.createSymbolSchema)(C.length?C[0]:null,d,c),symbologyType:d.symbologyType}}(0,d,c,C);case"class-breaks":return function Qe(r,f,d,c,C=!1){const F=d.backgroundFillSymbol,{field:N,fieldIndex:K}=oe(r,{target:f,field:d.field,valueExpression:d.valueExpression,resultType:"numeric",context:{mesh:!0,use:"renderer.field"}}),J=d.normalizationType,Y="log"===J?"esriNormalizeByLog":"percent-of-total"===J?"esriNormalizeByPercentOfTotal":"field"===J?"esriNormalizeByField":null,ue=d.classBreakInfos.map(ye=>({symbol:(0,L.createSymbolSchema)(ye.symbol,c,C),min:ye.minValue,max:ye.maxValue})).sort((ye,Be)=>ye.min-Be.min);return{type:"interval",attributes:r.fields,field:N,fieldIndex:K,backgroundFillSymbol:(0,L.createSymbolSchema)(F,c,C),defaultSymbol:(0,L.createSymbolSchema)(d.defaultSymbol,c,C),intervals:ue,normalizationField:d.normalizationField,normalizationTotal:d.normalizationTotal,normalizationType:Y,isMaxInclusive:d.isMaxInclusive,symbologyType:c.symbologyType}}(I,f,d,c,C);case"unique-value":return function qe(r,f,d,c,C=!1){const I=[],F=d.backgroundFillSymbol,N={target:f,context:{mesh:!0},resultType:"string"};if(d.field&&"string"!=typeof d.field)throw new A.Z(Q,"Expected renderer.field to be a string",d);const{field:K,fieldIndex:J}=oe(r,{...N,field:d.field,valueExpression:d.valueExpression});for(const Y of d.uniqueValueInfos??[])I.push({value:""+Y.value,symbol:(0,L.createSymbolSchema)(Y.symbol,c,C)});return{type:"map",attributes:r.fields,field:K,fieldIndex:J,field2:oe(r,{...N,field:d.field2}).field,field3:oe(r,{...N,field:d.field3}).field,fieldDelimiter:d.fieldDelimiter??void 0,backgroundFillSymbol:(0,L.createSymbolSchema)(F,c),defaultSymbol:(0,L.createSymbolSchema)(d.defaultSymbol,c),map:I,symbologyType:c.symbologyType}}(I,f,d,c,C);case"dictionary":return function et(r,f,d,c=!1){return{type:"dictionary",config:f.config,fieldMap:f.fieldMap,scaleExpression:f.scaleExpression,url:f.url,symbolOptions:d,symbologyType:d.symbologyType}}(0,d,c,C);case"heatmap":return function tt(r,f,d,c=!1){const C=f.getSymbols();return{type:"heatmap",symbol:(0,L.createSymbolSchema)(C.length?C[0]:null,d,c),symbologyType:d.symbologyType}}(0,d,c,C);case"pie-chart":return function Ye(r,f,d,c=!1){const C=f.getSymbols(),F=C.length>1?C[1]:null;return{type:"pie-chart",markerSymbol:(0,L.createSymbolSchema)(C[0],d,c),fillSymbol:(0,L.createSymbolSchema)(F,d,c),symbologyType:d.symbologyType}}(0,d,c,C)}}},22418:(ne,Z,x)=>{x.d(Z,{TT:()=>D,aR:()=>b,rk:()=>R,tv:()=>P});var k=x(26584),A=x(8314),z=x(63290),S=x(23841),_=x(31637);const y=8,u=y-2,p=z.Z.getLogger("esri.views.2d.layers.features.support.rendererUtils"),b=i=>{if(!("visualVariables"in i)||!i.visualVariables?.length)return i;const g=i.clone(),v=g.visualVariables.map(w=>j(w)?E(w):w);return g.visualVariables=v,g};function P(i){return i.map(g=>j(g)?E(g.clone()):g)}function j(i){return("size"===i.type||"color"===i.type||"opacity"===i.type)&&null!=i.stops}function E(i){return i.stops=function M(i,g){return g.length<=y?g:(p.warn(`Found ${g.length} Visual Variable stops, but MapView only supports ${y}. Displayed stops will be simplified.`),g.length>2*y?function L(i,g){const[v,...w]=g,V=w.pop(),X=w[0].value,G=w[w.length-1].value,q=(G-X)/u,$=[];for(let ee=X;ee<G;ee+=q){let te=0;for(;ee>=w[te].value;)te++;const de=w[te],ie=g[te-1],h=de.value===ie.value?1:(ee-ie.value)/(de.value-ie.value);if("color"===i){const B=w[te],W=g[te-1],U=B.color.clone();U.r=O(W.color.r,U.r,h),U.g=O(W.color.g,U.g,h),U.b=O(W.color.b,U.b,h),U.a=O(W.color.a,U.a,h),$.push({value:ee,color:U,label:B.label})}else if("size"===i){const B=w[te],W=g[te-1],U=(0,S.t_)(B.size),H=O((0,S.t_)(W.size),U,h);$.push({value:ee,size:H,label:B.label})}else{const B=w[te],W=O(g[te-1].opacity,B.opacity,h);$.push({value:ee,opacity:W,label:B.label})}}return[v,...$,V]}(i,g):function T(i){const[g,...v]=i,w=v.pop();for(;v.length>u;){let V=0,X=0;for(let G=1;G<v.length;G++){const ee=Math.abs(v[G].value-v[G-1].value);ee>X&&(X=ee,V=G)}v.splice(V,1)}return[g,...v,w]}(g))}(i.type,i.stops??[]),i}function O(i,g,v){return(1-v)*i+v*g}function R(){if((0,A.Z)("heatmap-force-raster"))return"raster";const{supportsTextureFloat:i,supportsTextureHalfFloat:g,supportsColorBufferFloat:v,supportsColorBufferFloatBlend:w,supportsColorBufferHalfFloat:V}=(0,_.hc)("2d");return i&&v&&w||g&&V?"symbol":(0,A.Z)("heatmap-allow-raster-fallback")?"raster":"none"}function D(i){if(!i)return!0;switch(i.type){case"dot-density":if(!(0,_.hc)("2d").supportsTextureFloat)return p.error(new k.Z("webgl-missing-extension","Missing WebGL extension OES_Texture_Float which is required for DotDensity")),!1;break;case"heatmap":{const g=R();if("none"===g||"raster"===g&&!(0,A.Z)("heatmap-force-raster")){const v=(0,_.hc)("2d"),w=["supportsTextureFloat","supportsTextureHalfFloat","supportsColorBufferFloat","supportsColorBufferFloatBlend","supportsColorBufferHalfFloat"].filter(V=>!v[V]).join(", ");if("none"===g)return p.errorOnce(new k.Z("webgl-missing-extension",`Missing WebGL${v.type} requirements for Heatmap: ${w}`)),!1;"raster"===g&&p.warnOnce(`Missing WebGL${v.type} requirements for accelerated Heatmap: ${w}. Feature support may be limited.`)}break}}return!0}},6257:(ne,Z,x)=>{x.d(Z,{I:()=>j,qc:()=>y});var k=x(23841),A=x(81295),z=x(39351),S=x(39406),_=x(25310);function y(T,M){if(!T||!M)return T;switch(M){case"radius":case"distance":return 2*T;case"diameter":case"width":return T;case"area":return Math.sqrt(T)}return T}function p(T){return(T??[]).map(M=>function u(T){return{value:T.value,size:(0,k.t_)(T.size)}}(M))}function b(T){return"string"==typeof T||"number"==typeof T?(0,k.t_)(T):{type:"size",expression:T.expression,stops:p(T.stops)}}const P=T=>{const M=[],R=[],D=p(T),i=D.length;for(let g=0;g<6;g++){const v=D[Math.min(g,i-1)];M.push(v.value),R.push(null==v.size?z.k9:(0,k.F2)(v.size))}return{values:new Float32Array(M),sizes:new Float32Array(R)}};function j(T){const M=T&&T.length>0?{}:null,R=M?{}:null;if(!M||!R)return{vvFields:M,vvRanges:R};for(const D of T)if(D.field&&(M[D.type]=D.field),"size"===D.type){R.size||(R.size={});const i=D;switch((0,_.a)(i)){case S.X.SIZE_MINMAX_VALUE:R.size.minMaxValue={minDataValue:i.minDataValue,maxDataValue:i.maxDataValue,minSize:b(i.minSize),maxSize:b(i.maxSize)};break;case S.X.SIZE_SCALE_STOPS:R.size.scaleStops={stops:p(i.stops)};break;case S.X.SIZE_FIELD_STOPS:if(i.levels){const g={};for(const v in i.levels)g[v]=P(i.levels[v]);R.size.fieldStops={type:"level-dependent",levels:g}}else R.size.fieldStops={type:"static",...P(i.stops)};break;case S.X.SIZE_UNIT_VALUE:R.size.unitValue={unit:i.valueUnit,valueRepresentation:i.valueRepresentation??void 0}}}else"color"===D.type?R.color=L(D):"opacity"===D.type?R.opacity=E(D):"rotation"===D.type&&(R.rotation={type:D.rotationType});return{vvFields:M,vvRanges:R}}function E(T){const M={values:[0,0,0,0,0,0,0,0],opacities:[0,0,0,0,0,0,0,0]};if("string"==typeof T.field){if(!T.stops)return null;{if(T.stops.length>8)return null;const R=T.stops;for(let D=0;D<8;++D){const i=R[Math.min(D,R.length-1)];M.values[D]=i.value,M.opacities[D]=i.opacity}}}else{if(!(T.stops&&T.stops.length>=0))return null;{const R=T.stops&&T.stops.length>=0?T.stops[0].opacity:0;for(let D=0;D<8;D++)M.values[D]=1/0,M.opacities[D]=R}}return M}function O(T,M,R){T[4*M]=R.r/255,T[4*M+1]=R.g/255,T[4*M+2]=R.b/255,T[4*M+3]=R.a}function L(T){if(null==T||T.normalizationField)return null;const M={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};if("string"==typeof T.field){if(!T.stops)return null;{if(T.stops.length>8)return null;M.field=T.field;const R=T.stops;for(let D=0;D<8;++D){const i=R[Math.min(D,R.length-1)];M.values[D]=i.value,O(M.colors,D,i.color)}}}else{if(!(T.stops&&T.stops.length>=0))return null;{const R=T.stops&&T.stops.length>=0&&T.stops[0].color;for(let D=0;D<8;D++)M.values[D]=1/0,O(M.colors,D,R)}}for(let R=0;R<32;R+=4)(0,A.pr)(M.colors,R,!0);return M}},64596:(ne,Z,x)=>{x.d(Z,{OC:()=>b,XA:()=>T,Zu:()=>P,ab:()=>j,eT:()=>O,i9:()=>p,yA:()=>E}),x(986);var A=x(37118),z=x(65401),S=x(37053);x(61261),x(39351),x(25797);const p=512,b=50;function P(M,R){const D=(0,S.C5)(R);if(!D)return null;const[i,g]=D.valid;return M[2]>g?[(0,z.Ue)([M[0],M[1],g,M[3]]),(0,z.Ue)([i,M[1],i+M[2]-g,M[3]])]:M[0]<i?[(0,z.Ue)([i,M[1],M[2],M[3]]),(0,z.Ue)([g-(i-M[0]),M[1],g,M[3]])]:null}function j(M){return"text"===M||"esriTS"===M}function E(M){return"simple-marker"===M||"picture-marker"===M||"esriSMS"===M||"esriPMS"===M}function O(M){switch(M.geometry.type){case"point":case"multipoint":return 0;case"polyline":return 1;case"polygon":case"extent":return 2}return 0}function T(M){if(!M)return null;const{xmin:R,ymin:D,xmax:i,ymax:g,spatialReference:v}=M;return new A.Z({rings:[[[R,D],[R,g],[i,g],[i,D],[R,D]]],spatialReference:v})}},51584:(ne,Z,x)=>{x.d(Z,{x:()=>j,B:()=>b});var k=x(15861),A=x(13871),z=x(39406),S=x(18716);const _={marker:z.LW.MARKER,fill:z.LW.FILL,line:z.LW.LINE,text:z.LW.TEXT};class y{constructor(O,L,T,M){const R={minScale:L?.minScale,maxScale:L?.maxScale},D=function u(E){return E.minScale||E.maxScale?E.minScale+"-"+E.maxScale:""}(R);this.layers=O,this.data=L,this.hash=this._createHash()+D,this.rendererKey=T;const i={isOutline:!1,placement:null,symbologyType:z.mD.DEFAULT,vvFlags:T};for(const g of O){const v=_[g.type];i.isOutline="line"===g.type&&g.isOutline,g.materialKey=(0,S.jj)(v,i),g.maxVVSize=M,g.scaleInfo=R,g.templateHash+=D}}get type(){return"expanded-cim"}_createHash(){let O="";for(const L of this.layers)O+=L.templateHash;return O}}const p=function(){var E=(0,k.Z)(function*(O,L,T){const M=new A._(T,L);return new y(yield M.analyzeSymbolReference(O.data,!1),O.data,O.rendererKey,O.maxVVSize)});return function(L,T,M){return E.apply(this,arguments)}}();function b(E,O,L,T){return P.apply(this,arguments)}function P(){return(P=(0,k.Z)(function*(E,O,L,T){if(!E)return null;if("cim"===E.type)return p(E,O,L);if("web-style"===E.type){const{fetchCIMSymbolReference:M}=yield Promise.all([x.e(8592),x.e(4740)]).then(x.bind(x,54740)),R={type:"cim",data:(yield M(E,null,T))??void 0,rendererKey:E.rendererKey,maxVVSize:E.maxVVSize};return p(R,O,L)}return E})).apply(this,arguments)}function j(E){if(!E)return null;const{avoidSDFRasterization:O,type:L,cim:T,url:M,materialHash:R,maxVVSize:D}=E,i={cim:T,type:L,mosaicHash:R,url:M,size:null,dashTemplate:null,path:null,text:null,fontName:null,animatedSymbolProperties:null,avoidSDFRasterization:O};switch(L){case"marker":D&&"size"in T&&(T.size=Math.max(D,T.size)),i.size=E.size,i.path=E.path,i.animatedSymbolProperties=E.animatedSymbolProperties;break;case"line":i.dashTemplate=E.dashTemplate;break;case"text":i.text=E.text,i.fontName=E.fontName}return i}},43930:(ne,Z,x)=>{x.d(Z,{JV:()=>_,oq:()=>z});const A=new(x(2076).X)({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch",mesh:"mesh"});function z(y){return A.toJSON(y)}function _(y){const{bandCount:u,attributeTable:p,colormap:b,pixelType:P}=y.raster.rasterInfo;return 1===u&&(null!=p||null!=b||"u8"===P||"s8"===P)}}}]);