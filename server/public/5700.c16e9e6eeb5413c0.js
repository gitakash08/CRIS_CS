"use strict";(self.webpackChunkCRIS=self.webpackChunkCRIS||[]).push([[5700,587],{55700:(G,E,s)=>{s.r(E),s.d(E,{default:()=>W});var p=s(15861),u=s(17626),T=s(46882),g=s(47877),D=s(63290),P=s(99959),U=s(10699),c=s(32917),y=s(77712),C=(s(90912),s(85931),s(8314),s(52323)),S=s(68653),Z=s(76898),M=s(99433),R=s(31283),A=s(44917),j=s(552),r=s(49286),t=s(6647),o=s(99555),n=s(30164),a=s(55463),b=s(38953),v=s(6432),O=s(6119);const f=Symbol("WebScene");var l=s(20885),B=s(71404),F=s(32584);let h=class extends((0,j.h)((0,o.M)((0,r.q)((0,t.I)((0,O.Q)((0,v.K)((0,P.R)(A.Z)))))))){constructor(e){var i;super(e),i=this,this.allLayers=new T.Z({getCollections:()=>[this.layers],getChildrenFunction:d=>"layers"in d?d.layers:null}),this.allTables=(0,b.a)(this),this.fullExtent=void 0,this.operationalLayerType="GroupLayer",this.spatialReference=void 0,this.type="group",this._debouncedSaveOperations=(0,U.Ds)(function(){var d=(0,p.Z)(function*(m,I,_){const{save:K,saveAs:w}=yield Promise.all([s.e(8592),s.e(2730)]).then(s.bind(s,46826));switch(m){case l.x.SAVE:return K(i,I);case l.x.SAVE_AS:return w(i,_,I)}});return function(m,I,_){return d.apply(this,arguments)}}())}initialize(){this._enforceVisibility(this.visibilityMode,this.visible),this.addHandles([(0,c.YP)(()=>{let e=this.parent;for(;e&&"parent"in e&&e.parent;)e=e.parent;return e&&f in e},e=>{const i="prevent-adding-tables";this.removeHandles(i),e&&(this.tables.removeAll(),this.addHandles((0,c.on)(()=>this.tables,"before-add",d=>{d.preventDefault(),D.Z.getLogger(this).errorOnce("tables","tables in group layers in a webscene are not supported. Please move the tables from the group layer to the webscene if you want to persist them.")}),i))},c.tX),(0,c.YP)(()=>this.visible,this._onVisibilityChange.bind(this),c.Z_)])}destroy(){this.allLayers.destroy(),this.allTables.destroy()}get sourceIsPortalItem(){return this.portalItem&&this.originIdOf("portalItem")===R.s3.USER}_writeLayers(e,i,d,m){const I=[];if(!e)return I;e.forEach(_=>{const K=(0,F.Nw)(_,m.webmap?m.webmap.getLayerJSONFromResourceInfo(_):null,m);K?.layerType&&I.push(K)}),i.layers=I}set portalItem(e){this._set("portalItem",e)}readPortalItem(e,i,d){const{itemId:m,layerType:I}=i;if("GroupLayer"===I&&m)return new a.default({id:m,portal:d?.portal})}writePortalItem(e,i){e?.id&&(i.itemId=e.id)}set visibilityMode(e){const i=this._get("visibilityMode")!==e;this._set("visibilityMode",e),i&&this._enforceVisibility(e,this.visible)}beforeSave(){var e=this;return(0,p.Z)(function*(){return(0,B.Pl)(e)})()}load(e){const i=this.loadFromPortal({supportedTypes:["Feature Service","Feature Collection","Group Layer","Scene Service"],layerModuleTypeMap:n.T},e).catch(d=>{if((0,U.r9)(d),this.sourceIsPortalItem)throw d});return this.addResolvingPromise(i),Promise.resolve(this)}loadAll(){var e=this;return(0,p.Z)(function*(){return(0,g.G)(e,i=>{i(e.layers,e.tables)})})()}save(e){var i=this;return(0,p.Z)(function*(){return i._debouncedSaveOperations(l.x.SAVE,e)})()}saveAs(e,i){var d=this;return(0,p.Z)(function*(){return d._debouncedSaveOperations(l.x.SAVE_AS,i,e)})()}layerAdded(e){e.visible&&"exclusive"===this.visibilityMode?this._turnOffOtherLayers(e):"inherited"===this.visibilityMode&&(e.visible=this.visible),this.hasHandles(e.uid)?console.error(`Layer readded to Grouplayer: uid=${e.uid}`):this.addHandles((0,c.YP)(()=>e.visible,i=>this._onChildVisibilityChange(e,i),c.Z_),e.uid)}layerRemoved(e){this.removeHandles(e.uid),this._enforceVisibility(this.visibilityMode,this.visible)}_turnOffOtherLayers(e){this.layers.forEach(i=>{i!==e&&(i.visible=!1)})}_enforceVisibility(e,i){if(!(0,C.vw)(this).initialized)return;const d=this.layers;let m=d.find(I=>I.visible);switch(e){case"exclusive":d.length&&!m&&(m=d.at(0),m.visible=!0),this._turnOffOtherLayers(m);break;case"inherited":d.forEach(I=>{I.visible=i})}}_onVisibilityChange(e){"inherited"===this.visibilityMode&&this.layers.forEach(i=>{i.visible=e})}_onChildVisibilityChange(e,i){switch(this.visibilityMode){case"exclusive":i?this._turnOffOtherLayers(e):this._isAnyLayerVisible()||(e.visible=!0);break;case"inherited":e.visible=this.visible}}_isAnyLayerVisible(){return this.layers.some(e=>e.visible)}};(0,u._)([(0,y.Cb)({readOnly:!0,dependsOn:[]})],h.prototype,"allLayers",void 0),(0,u._)([(0,y.Cb)({readOnly:!0})],h.prototype,"allTables",void 0),(0,u._)([(0,y.Cb)({json:{read:!0,write:!0}})],h.prototype,"blendMode",void 0),(0,u._)([(0,y.Cb)()],h.prototype,"fullExtent",void 0),(0,u._)([(0,y.Cb)({readOnly:!0})],h.prototype,"sourceIsPortalItem",null),(0,u._)([(0,y.Cb)({json:{read:!1,write:{ignoreOrigin:!0}}})],h.prototype,"layers",void 0),(0,u._)([(0,M.c)("layers")],h.prototype,"_writeLayers",null),(0,u._)([(0,y.Cb)({type:["GroupLayer"]})],h.prototype,"operationalLayerType",void 0),(0,u._)([(0,y.Cb)({json:{origins:{"web-map":{read:!1,write:{overridePolicy(e,i,d){return{enabled:"Group Layer"===e?.type&&d?.initiator!==this}}}},"web-scene":{read:!1,write:!1}}}})],h.prototype,"portalItem",null),(0,u._)([(0,S.r)("web-map","portalItem",["itemId"])],h.prototype,"readPortalItem",null),(0,u._)([(0,M.c)("web-map","portalItem",{itemId:{type:String}})],h.prototype,"writePortalItem",null),(0,u._)([(0,y.Cb)()],h.prototype,"spatialReference",void 0),(0,u._)([(0,y.Cb)({json:{read:!1},readOnly:!0,value:"group"})],h.prototype,"type",void 0),(0,u._)([(0,y.Cb)({type:["independent","inherited","exclusive"],value:"independent",json:{write:!0,origins:{"web-map":{type:["independent","exclusive"],write:(e,i,d)=>{"inherited"!==e&&(i[d]=e)}}}}})],h.prototype,"visibilityMode",null),h=(0,u._)([(0,Z.j)("esri.layers.GroupLayer")],h);const W=h},10587:(G,E,s)=>{s.r(E),s.d(E,{addOrUpdateResource:()=>U,contentToBlob:()=>M,fetchResources:()=>D,getSiblingOfSameType:()=>A,getSiblingOfSameTypeI:()=>j,removeAllResources:()=>V,removeResource:()=>y,splitPrefixFileNameAndExtension:()=>S});var p=s(15861),u=s(84792),T=s(26584),g=s(21726);function D(r){return P.apply(this,arguments)}function P(){return(P=(0,p.Z)(function*(r,t={},o){yield r.load(o);const n=(0,g.v_)(r.itemUrl,"resources"),{start:a=1,num:b=10,sortOrder:v="asc",sortField:O="created"}=t,f={query:{start:a,num:b,sortOrder:v,sortField:O,token:r.apiKey},signal:o?.signal},l=yield r.portal.request(n,f);return{total:l.total,nextStart:l.nextStart,resources:l.resources.map(({created:B,size:F,resource:h})=>({created:new Date(B),size:F,resource:r.resourceFromPath(h)}))}})).apply(this,arguments)}function U(r,t,o,n){return c.apply(this,arguments)}function c(){return(c=(0,p.Z)(function*(r,t,o,n){if(!r.hasPath())throw new T.Z(`portal-item-resource-${t}:invalid-path`,"Resource does not have a valid path");const a=r.portalItem;yield a.load(n);const b=(0,g.v_)(a.userItemUrl,"add"===t?"addResources":"updateResources"),[v,O]=C(r.path),f=new FormData;return v&&"."!==v&&f.append("resourcesPrefix",v),null!=n&&n.compress&&f.append("compress","true"),f.append("fileName",O),f.append("file",o,O),f.append("f","json"),n?.access&&f.append("access",n.access),yield a.portal.request(b,{method:"post",body:f,signal:n?.signal}),r})).apply(this,arguments)}function y(r,t,o){return x.apply(this,arguments)}function x(){return(x=(0,p.Z)(function*(r,t,o){if(!t.hasPath())throw new T.Z("portal-item-resources-remove:invalid-path","Resource does not have a valid path");yield r.load(o);const n=(0,g.v_)(r.userItemUrl,"removeResources");yield r.portal.request(n,{method:"post",query:{resource:t.path},signal:o?.signal}),t.portalItem=null})).apply(this,arguments)}function V(r,t){return L.apply(this,arguments)}function L(){return(L=(0,p.Z)(function*(r,t){yield r.load(t);const o=(0,g.v_)(r.userItemUrl,"removeResources");return r.portal.request(o,{method:"post",query:{deleteAll:!0},signal:t?.signal})})).apply(this,arguments)}function C(r){const t=r.lastIndexOf("/");return-1===t?[".",r]:[r.slice(0,t),r.slice(t+1)]}function S(r){const[t,o]=function Z(r){const t=(0,g.Ml)(r);return null==t?[r,""]:[r.slice(0,r.length-t.length-1),`.${t}`]}(r),[n,a]=C(t);return[n,a,o]}function M(r){return R.apply(this,arguments)}function R(){return(R=(0,p.Z)(function*(r){return"blob"===r.type?r.blob:"json"===r.type?new Blob([r.jsonString],{type:"application/json"}):(yield(0,u.Z)(r.url,{responseType:"blob"})).data})).apply(this,arguments)}function A(r,t){if(!r.hasPath())return null;const[o,,n]=S(r.path);return r.portalItem.resourceFromPath((0,g.v_)(o,t+n))}function j(r,t){if(!r.hasPath())return null;const[o,,n]=S(r.path);return r.portalItem.resourceFromPath((0,g.v_)(o,t+n))}},20885:(G,E,s)=>{var p,u;s.d(E,{x:()=>p}),(u=p||(p={}))[u.SAVE=0]="SAVE",u[u.SAVE_AS=1]="SAVE_AS"},71404:(G,E,s)=>{s.d(E,{Hn:()=>U,Pl:()=>j,bx:()=>y});var p=s(15861),u=s(59213),T=s(26584),g=s(10699),D=s(35948),P=s(10587);function U(t,o){return c.apply(this,arguments)}function c(){return(c=(0,p.Z)(function*(t,o,n=null){const a=yield V(t,o,n);yield C(a,o,n)})).apply(this,arguments)}function y(t,o,n,a){return x.apply(this,arguments)}function x(){return(x=(0,p.Z)(function*(t,o,n,a,b=null){const v=yield V(n,a,b);yield t.update({data:o}),yield C(v,a,b)})).apply(this,arguments)}function V(t,o){return L.apply(this,arguments)}function L(){return(L=(0,p.Z)(function*(t,o,n=null){if(!o?.resources)return;const a=o.portalItem===t.portalItem?new Set(t.paths):new Set;t.paths.length=0,t.portalItem=o.portalItem;const b=new Set(o.resources.toKeep.map(l=>l.resource.path)),v=new Set,O=[];b.forEach(l=>{a.delete(l),t.paths.push(l)});for(const l of o.resources.toUpdate)if(a.delete(l.resource.path),b.has(l.resource.path)||v.has(l.resource.path)){const{resource:B,content:F,finish:h,error:W}=l,e=(0,P.getSiblingOfSameTypeI)(B,(0,D.DO)());t.paths.push(e.path),O.push(Z({resource:e,content:F,compress:l.compress,finish:h,error:W},n))}else t.paths.push(l.resource.path),O.push(R(l,n)),v.add(l.resource.path);for(const l of o.resources.toAdd)t.paths.push(l.resource.path),a.has(l.resource.path)?a.delete(l.resource.path):O.push(Z(l,n));if(0===O.length)return a;const f=yield(0,g.UO)(O);if((0,g.k_)(n),f.length>0)throw new T.Z("save:resources","Failed to save one or more resources",{errors:f});return a})).apply(this,arguments)}function C(t,o){return S.apply(this,arguments)}function S(){return(S=(0,p.Z)(function*(t,o,n=null){if(!t||!o.portalItem)return;const a=[];for(const b of t){const v=o.portalItem.resourceFromPath(b);a.push(v.portalItem.removeResource(v,n))}yield(0,g.as)(a)})).apply(this,arguments)}function Z(t,o){return M.apply(this,arguments)}function M(){return(M=(0,p.Z)(function*(t,o){const n={...o??{},compress:t.compress},a=yield(0,u.q6)(t.resource.portalItem.addResource(t.resource,yield(0,P.contentToBlob)(t.content),n));if(!0!==a.ok)throw t.error?.(a.error),a.error;t.finish?.(t.resource)})).apply(this,arguments)}function R(t,o){return A.apply(this,arguments)}function A(){return(A=(0,p.Z)(function*(t,o){const n=yield(0,u.q6)(t.resource.update(yield(0,P.contentToBlob)(t.content),o));if(!0!==n.ok)throw t.error?.(n.error),n.error;t.finish?.(t.resource)})).apply(this,arguments)}function j(t){return r.apply(this,arguments)}function r(){return(r=(0,p.Z)(function*(t){const o=[];for(const n of t.allLayers)if("beforeSave"in n&&"function"==typeof n.beforeSave){const a=n.beforeSave();a&&o.push(a)}yield Promise.allSettled(o)})).apply(this,arguments)}}}]);