"use strict";(self.webpackChunkCRIS=self.webpackChunkCRIS||[]).push([[3705,9683],{83705:(N,g,i)=>{i.r(g),i.d(g,{load:()=>J});var _=i(15861),m=i(26584),D=i(38305),L=i(17196),M=i(27369),h=i(71074),d=i(30164),c=i(31099),E=i(88755),p=i(73391),I=i(37281),O=i(39683),X=i(45205);function J(e,r){return T.apply(this,arguments)}function T(){return T=(0,_.Z)(function*(e,r){const n=e.instance.portalItem;if(n?.id)return yield n.load(r),function Q(e){const r=e.instance.portalItem;if(!r?.type||!e.supportedTypes.includes(r.type))throw new m.Z("portal:invalid-layer-item-type","Invalid layer item type '${type}', expected '${expectedType}'",{type:r?.type,expectedType:e.supportedTypes.join(", ")})}(e),function V(e,r){return v.apply(this,arguments)}(e,r)}),T.apply(this,arguments)}function v(){return v=(0,_.Z)(function*(e,r){const n=e.instance,t=n.portalItem;if(!t)return;const{url:a,title:l}=t,s=(0,E.ht)(t);if("group"===n.type)return function z(e,r,n){return x.apply(this,arguments)}(n,s,e);a&&n.read({url:a},s);const o=new M.L,u=yield Z(e,o,r);return u&&n.read(u,s),n.resourceReferences={portalItem:t,paths:s.readResourcePaths??[]},"subtype-group"!==n.type&&n.read({title:l},s),(0,O.y)(n,s)}),v.apply(this,arguments)}function x(){return x=(0,_.Z)(function*(e,r,n){const t=e.portalItem;if(!e.sourceIsPortalItem)return;const{title:a,type:l}=t;if("Group Layer"===l){if(!(0,I._$)(t,"Map"))throw new m.Z("portal:invalid-layer-item-typekeyword","'Group Layer' item without 'Map' type keyword is not supported");return function Y(e){return C.apply(this,arguments)}(e)}return e.read({title:a},r),function H(e,r){return S.apply(this,arguments)}(e,n)}),x.apply(this,arguments)}function C(){return(C=(0,_.Z)(function*(e){const r=e.portalItem,n=yield r.fetchData("json");if(!n)return;const t=(0,E.wk)(r);e.read(n,t),yield(0,h.populateGroupLayer)(e,n,{context:t}),e.resourceReferences={portalItem:r,paths:t.readResourcePaths??[]}})).apply(this,arguments)}function S(){return S=(0,_.Z)(function*(e,r){let n;const{portalItem:t}=e;if(!t)return;const a=t.type,l=r.layerModuleTypeMap;switch(a){case"Feature Service":case"Feature Collection":n=l.FeatureLayer;break;case"Stream Service":n=l.StreamLayer;break;case"Scene Service":n=l.SceneLayer;break;default:throw new m.Z("portal:unsupported-item-type-as-group",`The item type '${a}' is not supported as a 'IGroupLayer'`)}const s=new M.L;let[o,u]=yield Promise.all([n(),Z(r,s)]),y=()=>o;if("Feature Service"===a){u=t.url?yield(0,p.$O)(u,t.url,s):{};const F=(0,p.XX)(u),w=(0,p._Y)(u),P=[];if(F.length||w?.length){F.length&&P.push("SubtypeGroupLayer"),w?.length&&P.push("OrientedImageryLayer");const G=[];for(const f of P)G.push((0,l[f])());const ae=yield Promise.all(G),$=new Map;P.forEach((f,W)=>{$.set(f,ae[W])}),y=f=>f.layerType?$.get(f.layerType)??o:o}const se=yield function ne(e){return b.apply(this,arguments)}(t.url);return yield j(e,y,u,se)}return"Scene Service"===a&&t.url&&(u=yield(0,p.CD)(t,u,s)),(0,p.Q4)(u)>0?yield j(e,y,u):yield function k(e,r){return R.apply(this,arguments)}(e,y)}),S.apply(this,arguments)}function R(){return(R=(0,_.Z)(function*(e,r){const{portalItem:n}=e;if(!n?.url)return;const t=yield(0,X.T)(n.url);t&&j(e,r,{layers:t.layers?.map(p.bS),tables:t.tables?.map(p.bS)})})).apply(this,arguments)}function j(e,r,n,t){return U.apply(this,arguments)}function U(){return(U=(0,_.Z)(function*(e,r,n,t){let a=n.layers||[];const l=n.tables||[];if("Feature Collection"===e.portalItem?.type?(a.forEach((s,o)=>{s.id=o,"Table"===s?.layerDefinition?.type&&l.push(s)}),a=a.filter(s=>"Table"!==s?.layerDefinition?.type)):(a.reverse(),l.reverse()),a.forEach(s=>{const o=t?.(s);if(o||!t){const u=K(e,r(s),n,s,o);e.add(u)}}),l.length){const s=yield d.T.FeatureLayer();l.forEach(o=>{const u=t?.(o);if(u||!t){const y=K(e,s,n,o,u);e.tables.add(y)}})}})).apply(this,arguments)}function K(e,r,n,t,a){const l=e.portalItem,s={portalItem:l.clone(),layerId:t.id};null!=t.url&&(s.url=t.url);const o=new r(s);if("sourceJSON"in o&&(o.sourceJSON=a),"subtype-group"!==o.type&&(o.sublayerTitleMode="service-name"),"Feature Collection"===l.type){const u={origin:"portal-item",portal:l.portal||c.Z.getDefault()};o.read(t,u);const y=n.showLegend;null!=y&&o.read({showLegend:y},u)}return o}function Z(e,r,n){return A.apply(this,arguments)}function A(){return A=(0,_.Z)(function*(e,r,n){if(!1===e.supportsData)return;const t=e.instance,a=t.portalItem;if(!a)return;let l=null;try{l=yield a.fetchData("json",n)}catch{}if(function te(e){return"stream"!==e.type&&"layerId"in e}(t)){let s=null;const o=yield function q(e,r,n){return B.apply(this,arguments)}(a,l,r);if((l?.layers||l?.tables)&&o>0){if(null==t.layerId){const u=(0,p.XX)(l);t.layerId="subtype-group"===t.type?u?.[0]:(0,p.Ok)(l)}s=function ee(e,r){const{layerId:n}=r,t=e.layers?.find(a=>a.id===n)||e.tables?.find(a=>a.id===n);return t&&function re(e,r){return!("feature"===r.type&&"layerType"in e&&"SubtypeGroupLayer"===e.layerType||"subtype-group"===r.type&&!("layerType"in e))}(t,r)?t:null}(l,t),s&&null!=l.showLegend&&(s.showLegend=l.showLegend)}return o>1&&"sublayerTitleMode"in t&&"service-name"!==t.sublayerTitleMode&&(t.sublayerTitleMode="item-title-and-service-name"),s}return l}),A.apply(this,arguments)}function B(){return(B=(0,_.Z)(function*(e,r,n){if(r?.layers&&r?.tables)return(0,p.Q4)(r);const t=(0,D.Qc)(e.url);if(!t)return 1;const a=yield n.fetchServiceMetadata(t.url.path).catch(()=>null);return(r?.layers?.length??a?.layers?.length??0)+(r?.tables?.length??a?.tables?.length??0)})).apply(this,arguments)}function b(){return(b=(0,_.Z)(function*(e){const{layersJSON:r}=yield(0,L.V)(e);if(!r)return null;const n=[...r.layers,...r.tables];return t=>n.find(a=>a.id===t.id)})).apply(this,arguments)}},39683:(N,g,i)=>{i.d(g,{y:()=>M});var _=i(15861),m=i(59213),D=i(10699),L=i(14889);function M(d,c,E){return h.apply(this,arguments)}function h(){return(h=(0,_.Z)(function*(d,c,E){const p=d&&d.getAtOrigin&&d.getAtOrigin("renderer",c.origin);if(p&&"unique-value"===p.type&&p.styleOrigin){const I=yield(0,m.q6)(p.populateFromStyle());if((0,D.k_)(E),!1===I.ok){const O=I.error;c?.messages&&c.messages.push(new L.Z("renderer:style-reference",`Failed to create unique value renderer from style reference: ${O.message}`,{error:O,context:c})),d.clear("renderer",c?.origin)}}})).apply(this,arguments)}}}]);